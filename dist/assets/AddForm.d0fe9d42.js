import{n as c,W as q,u as O,p as T,_ as $}from"./index.a2bf8911.js";/* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css                *//* empty css              *//* empty css               *//* empty css               */import{d as j,e as F,c as H,u as y,aS as V,aL as k,C as A,aE as N,aH as t,aI as a,G as B,D as L,bU as W,E as z,aW as G,b7 as Y,b_ as J,cc as K,bS as Q,c9 as X,c4 as Z,bc as x}from"./arco.b02d9b55.js";import{B as ee,u as ae}from"./index.c4821ce7.js";import{u as oe}from"./loading.7f7bf96d.js";import{I as te}from"./IconPicker.7129cb1a.js";import{I as se}from"./Icon.031e5930.js";import{u as ue}from"./common.66f89a6d.js";function qe(e){return c.get({url:"/system/account/get_list",params:e},{errorMessageMode:"none"})}function re(){return c.get({url:"/system/account/get_role"},{errorMessageMode:"none"})}function le(e){return e.password&&(e=Object.assign({},e,{password:q.exports(e.password)})),c.post({url:"/system/account/save",params:e},{errorMessageMode:"message"})}function ne(e){return c.post({url:"/system/account/isaccountexist",params:e},{errorMessageMode:"message",isTransformResponse:!1})}function Oe(e){return c.post({url:"/system/account/upStatus",params:e},{errorMessageMode:"message"})}function Te(e){return c.delete({url:"/system/account/del",params:e},{errorMessageMode:"message"})}const ie=j({name:"AddBook",components:{BasicModal:ee,IconPicker:te,Icon:se},emits:["success"],setup(e,{emit:u}){const{t:S}=O(),p=F(!1),b=F([]),I=F([]),d=F(),l={id:0,name:"",roleid:[],username:"",password:"",avatar:"",remark:""},o=F(l),[h,{setModalProps:w,closeModal:M}]=ae(async s=>{var g;(g=d.value)==null||g.resetFields(),w({confirmLoading:!1});const n=await re();n?b.value=n:b.value=[],p.value=!!(s!=null&&s.isUpdate),y(p)?o.value=T(s.record):o.value=l}),C=H(()=>y(p)?"\u7F16\u8F91\u7BA1\u7406\u8D26\u53F7":"\u65B0\u589E\u7BA1\u7406\u8D26\u53F7"),{loading:E,setLoading:f}=oe();return{registerModal:h,getTitle:C,handleSubmit:async()=>{var s;try{await((s=d.value)==null?void 0:s.validate())||(f(!0),!y(p)&&o.value.password==""&&(o.value.password="123456"),V.loading({content:"\u66F4\u65B0\u4E2D",id:"upStatus"}),await le(y(o)),V.success({content:"\u66F4\u65B0\u6210\u529F",id:"upStatus"}),M(),u("success"),f(!1))}catch{f(!1),V.clear("top")}},formRef:d,loading:E,formData:o,roleList:b,deptList:I,t:S,OYoptions:[{label:"\u5426",value:0},{label:"\u662F",value:1}],onChange:s=>{console.log("fileList",s)},customRequest:s=>{const n=new AbortController;return async function(){const{onProgress:m,onError:D,onSuccess:De,fileItem:v}=s;m(20);const P=i=>{let _;i.total>0&&(_=i.loaded/i.total*100),m(parseInt(String(_),10),i)};try{const i=(v==null?void 0:v.name)||"",_=await ue({name:"file",file:v.file,filename:i,data:{cid:0}},P);_&&(o.value.avatar=_.url)}catch(i){D(i)}}(),{abort(){n.abort()}}},usernameRules:[{validator:(s,n)=>new Promise(async g=>{if(!s)n("\u8BF7\u586B\u5199\u767B\u5F55\u8D26\u53F7");else{let m={username:s};o.value.id>0&&(m=Object.assign({},m,{id:o.value.id}));const D=await ne(m);D.code==1&&n(D.message)}g(!0)})}]}}}),de={class:z("arco-upload-list-item")},me={key:0,class:"arco-upload-list-picture custom-upload-avatar"},ce=["src"],pe={class:"arco-upload-list-picture-mask"},fe={key:1,class:"arco-upload-picture-card"},ge={class:"arco-upload-picture-card-text"},_e=B("div",{style:{"margin-top":"10px","font-weight":"600"}},"\u4E0A\u4F20\u5934\u50CF",-1);function Fe(e,u,S,p,b,I){const d=G,l=Y,o=J,h=K,w=Q,M=k("IconEdit"),C=k("IconPlus"),E=X,f=Z,R=x,U=k("BasicModal");return A(),N(U,W(e.$attrs,{onRegister:e.registerModal,loading:e.loading,helpMessage:"\u7F16\u8F91\u548C\u4FEE\u6539\u83DC\u5355",width:"800px",minHeight:320,title:e.getTitle,onOk:e.handleSubmit}),{default:t(()=>[a(R,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:t(()=>[a(f,{gutter:16},{default:t(()=>[a(o,{span:12},{default:t(()=>[a(l,{field:"username",label:"\u767B\u5F55\u8D26\u53F7",style:{"margin-bottom":"15px"},rules:[{required:!0,message:"\u8BF7\u586B\u5199\u7528\u6237\u540D"}],"validate-trigger":["change","blur"]},{default:t(()=>[a(d,{modelValue:e.formData.username,"onUpdate:modelValue":u[0]||(u[0]=r=>e.formData.username=r),placeholder:"\u8BF7\u586B\u767B\u5F55\u8D26\u53F7"},null,8,["modelValue"])]),_:1})]),_:1}),a(o,{span:12},{default:t(()=>[a(l,{field:"name",label:"\u7528\u6237\u540D","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u7528\u6237\u540D"}],style:{"margin-bottom":"15px"}},{default:t(()=>[a(d,{modelValue:e.formData.name,"onUpdate:modelValue":u[1]||(u[1]=r=>e.formData.name=r),placeholder:"\u8BF7\u586B\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1})]),_:1}),a(o,{span:12},{default:t(()=>[a(l,{label:"\u9009\u62E9\u89D2\u8272",field:"pid",style:{"margin-bottom":"15px"}},{default:t(()=>[a(h,{placeholder:"\u9009\u62E9\u89D2\u8272",data:e.roleList,fieldNames:{key:"id",title:"name",children:"children"},multiple:"",modelValue:e.formData.roleid,"onUpdate:modelValue":u[2]||(u[2]=r=>e.formData.roleid=r)},null,8,["data","modelValue"])]),_:1})]),_:1}),a(o,{span:12},{default:t(()=>[a(l,{field:"password",label:"\u767B\u5F55\u5BC6\u7801",style:{"margin-bottom":"15px"}},{default:t(()=>[a(d,{modelValue:e.formData.password,"onUpdate:modelValue":u[3]||(u[3]=r=>e.formData.password=r),placeholder:"\u767B\u5F55\u5BC6\u7801(\u4E0D\u4FEE\u6539\u5219\u4E3A\u7A7A\uFF0C\u9ED8\u8BA4\u5BC6\u7801123456)"},null,8,["modelValue"])]),_:1})]),_:1}),a(o,{span:12},{default:t(()=>[a(l,{field:"remark",label:"\u5907\u6CE8",style:{"margin-bottom":"15px"}},{default:t(()=>[a(w,{modelValue:e.formData.remark,"onUpdate:modelValue":u[4]||(u[4]=r=>e.formData.remark=r),placeholder:"\u8BF7\u586B\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1}),a(o,{span:12},{default:t(()=>[a(l,{field:"avatar",label:"\u5934\u50CF",style:{"margin-bottom":"15px"}},{default:t(()=>[a(E,{action:"/","show-file-list":!1,onChange:e.onChange,"custom-request":e.customRequest},{"upload-button":t(()=>[B("div",de,[e.formData.avatar?(A(),L("div",me,[B("img",{src:e.formData.avatar},null,8,ce),B("div",pe,[a(M)])])):(A(),L("div",fe,[B("div",ge,[a(C),_e])]))])]),_:1},8,["onChange","custom-request"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},16,["onRegister","loading","title","onOk"])}const Be=$(ie,[["render",Fe]]),$e=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{Be as A,$e as a,Te as d,qe as g,Oe as u};
