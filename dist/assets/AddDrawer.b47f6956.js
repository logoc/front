import{n as v,p as S,_ as U}from"./index.a2bf8911.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css              *//* empty css               */import{d as L,e as n,c as N,u as m,n as B,aS as w,C as T,aE as I,aH as s,aN as V,aO as A,G as C,aI as u,aF as $,aW as j,b7 as G,cc as H,bS as P,bR as Y,b9 as q,cg as z,bc as J,aZ as K}from"./arco.b02d9b55.js";import{u as W}from"./loading.7f7bf96d.js";/* empty css                */import{I as Z}from"./Icon.031e5930.js";function we(e){return v.get({url:"/system/role/get_list",params:e},{errorMessageMode:"none"})}function Q(){return v.get({url:"/system/role/get_parent"},{errorMessageMode:"none"})}function X(e){return v.get({url:"/system/role/get_menuList",params:e},{errorMessageMode:"none"})}function x(e){return v.post({url:"/system/role/save",params:e},{errorMessageMode:"message"})}function Ve(e){return v.delete({url:"/system/role/del",params:e},{errorMessageMode:"message"})}const ee=L({name:"AddDrawer",components:{Icon:Z},emits:["success"],setup(e,{emit:o}){const c=n(!1),i=n(!1),p=n([]),h=n(),t=n({id:0,pid:0,name:"",remark:"",menu:[],rules:[],weigh:1,data_access:0}),f=n(!1),b=n(!1),g=n(!1),r=n(),_=n([]),k=async a=>{var M;i.value=!!(a!=null&&a.isUpdate),c.value=!0,(M=h.value)==null||M.resetFields();const d=await Q();if(d&&d.length>0){if(p.value=d,!m(i))t.value.pid=d[0].id;else if(a.record.pid==0){const D=[{id:0,name:"\u4E00\u7EA7\u89D2\u8272",pid:0,locale:""}];p.value=D.concat(d)}}else p.value=[];if(m(i)){t.value=S(a.record);const D=S(a.record.menu);a.record.rules=="*"?f.value=!0:f.value=!1,D=="*"?(t.value.menu=[],B(()=>{setTimeout(()=>{r.value&&r.value.checkAll(!0)},800)})):t.value.menu&&D!="*"&&(t.value.menu=JSON.parse(D))}else t.value.menu=[];const O=m(i)?a.record.id:0,R=m(i)?a.record.pid:0;_.value=await X({id:O,pid:R}),B(()=>{g.value=!0,r.value.expandAll(g.value)})},E=N(()=>m(i)?"\u7F16\u8F91\u89D2\u8272\u83DC\u5355":"\u65B0\u589E\u89D2\u8272\u83DC\u5355"),{loading:l,setLoading:y}=W();return{showDrawer:c,handleCancel:()=>{c.value=!1},openDrawer:k,getTitle:E,handleSubmit:async()=>{var a;try{await((a=h.value)==null?void 0:a.validate())||(y(!0),w.loading({content:"\u63D0\u4EA4\u6570\u636E\u4E2D",id:"upStatus"}),await x(m(t)),w.success({content:"\u6570\u636E\u63D0\u4EA4\u6210\u529F",id:"upStatus"}),o("success"),c.value=!1,y(!1))}catch{y(!1),w.clear("top")}},formRef:h,loading:l,formData:t,parntList:p,OYoptions:[{label:"\u81EA\u5DF1",value:0},{label:"\u81EA\u5DF1\u53CA\u5B50\u6743\u9650",value:1},{label:"\u5168\u90E8",value:2}],menutreeData:_,onCheck:(a,d)=>{t.value.menu=a},toggleChecked:a=>{r.value.checkAll(a)},toggleExpanded:a=>{r.value.expandAll(a)},ruleTreeRef:r,onExpanded:g,IsChecked:b,isRules:f}}});const ae={class:"drawer-box"},oe={class:"rule_data"},te={class:"haeder"},le={class:"treebox"};function ue(e,o,c,i,p,h){const F=j,t=G,f=H,b=P,g=Y,r=q,_=z,k=J,E=K;return T(),I(E,{width:420,visible:e.showDrawer,onOk:e.handleSubmit,onCancel:e.handleCancel,unmountOnClose:""},{title:s(()=>[V(A(e.getTitle),1)]),default:s(()=>[C("div",ae,[u(k,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:s(()=>[u(t,{field:"name",label:"\u89D2\u8272\u540D\u79F0","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"}],style:{"margin-bottom":"15px"}},{default:s(()=>[u(F,{modelValue:e.formData.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.formData.name=l),placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0","allow-clear":""},null,8,["modelValue"])]),_:1}),u(t,{label:"\u4E0A\u7EA7\u83DC\u5355",field:"pid",style:{"margin-bottom":"15px"}},{default:s(()=>[u(f,{placeholder:"\u9009\u62E9\u4E0A\u7EA7\u83DC\u5355",data:e.parntList,fieldNames:{key:"id",title:"name",children:"children"},modelValue:e.formData.pid,"onUpdate:modelValue":o[1]||(o[1]=l=>e.formData.pid=l)},null,8,["data","modelValue"])]),_:1}),u(t,{field:"remark",label:"\u5907\u6CE8","validate-trigger":"input",style:{"margin-bottom":"15px"}},{default:s(()=>[u(b,{modelValue:e.formData.remark,"onUpdate:modelValue":o[2]||(o[2]=l=>e.formData.remark=l),placeholder:"\u8BF7\u586B\u5199\u5907\u6CE8","allow-clear":""},null,8,["modelValue"])]),_:1}),u(t,{field:"data_access",label:"\u6570\u636E\u6743\u9650",style:{"margin-bottom":"5px"}},{default:s(()=>[u(g,{modelValue:e.formData.data_access,"onUpdate:modelValue":o[3]||(o[3]=l=>e.formData.data_access=l),options:e.OYoptions},null,8,["modelValue","options"])]),_:1}),u(t,{field:"menu",label:"\u83DC\u5355\u5206\u914D",style:{"margin-bottom":"5px"}},{default:s(()=>[C("div",oe,[C("div",te,[e.isRules?$("",!0):(T(),I(r,{key:0,modelValue:e.IsChecked,"onUpdate:modelValue":o[4]||(o[4]=l=>e.IsChecked=l),onChange:e.toggleChecked,style:{"margin-right":"15px"}},{default:s(()=>[V(A(e.IsChecked?"\u53D6\u6D88":"\u5168\u9009"),1)]),_:1},8,["modelValue","onChange"])),u(r,{modelValue:e.onExpanded,"onUpdate:modelValue":o[5]||(o[5]=l=>e.onExpanded=l),onChange:e.toggleExpanded},{default:s(()=>[V(A(e.onExpanded?"\u6536\u8D77":"\u5C55\u5F00"),1)]),_:1},8,["modelValue","onChange"])]),C("div",le,[u(_,{"show-line":!0,checkable:!e.isRules,"checked-keys":e.formData.menu,"onUpdate:checkedKeys":o[6]||(o[6]=l=>e.formData.menu=l),fieldNames:{key:"id",title:"title",children:"children"},ref:"ruleTreeRef",onCheck:e.onCheck,data:e.menutreeData},null,8,["checkable","checked-keys","onCheck","data"])])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible","onOk","onCancel"])}const ne=U(ee,[["render",ue],["__scopeId","data-v-5ccef36f"]]),Ae=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{ne as A,Ae as a,Ve as d,we as g};
