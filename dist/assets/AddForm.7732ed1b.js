import{p as z,_ as Y}from"./index.a2bf8911.js";/* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css                *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css               *//* empty css               */import{d as Q,e as p,c as X,u as T,aS as _,aL as k,C as h,aE as C,aH as u,G as d,F as Z,aI as a,bA as x,aO as A,aN as f,bi as ee,D as O,aK as j,aJ as G,aF as K,bB as ue,bU as ae,b7 as te,b_ as le,cc as oe,ba as ne,bz as se,bN as ie,aW as re,bL as de,bM as pe,aY as me,bb as ce,c4 as fe,bc as Fe,b2 as Ee,b3 as _e}from"./arco.b02d9b55.js";import{B as ve,u as ge}from"./index.c4821ce7.js";import{u as he}from"./loading.7f7bf96d.js";import{a as J,g as De,s as Be,u as be}from"./generatecode.4bd8b8fc.js";import{g as Ce}from"./rule.507dee69.js";import{I as Ae}from"./IconPicker.7129cb1a.js";import{I as ye}from"./Icon.031e5930.js";import"./chart.67655b2c.js";import"./vue.e4c26cfd.js";/* empty css                *//* empty css                */var Ve=Array.prototype,we=Ve.join;function Se(e,s){return e==null?"":we.call(e,s)}const Pe=Q({name:"AddForm",components:{BasicModal:ve,IconPicker:Ae,Icon:ye},emits:["success"],setup(e,{emit:s}){const $={}.VITE_APP_ENV=="production",v=p([]),y=p([]),D=p([]),i=p(!1),r=p(1),U=p(620),V=p(620),b=p(),l=p({id:0,pid:"",comment:"",icon:"",tablename:"",engine:"",routePath:"",routeName:"",component:"",api_path:"",api_filename:"",fields:[],is_install:0,tpl_type:"list",cate_tablename:""}),N=p(),m=p(""),F=p(),[g,{setModalProps:w,closeModal:S}]=ge(async n=>{var E;(E=b.value)==null||E.resetFields(),r.value=1,i.value=!!(n!=null&&n.isUpdate);const o=await Ce({});if(o){v.value=o;const c=v.value.find(B=>B.id==n.record.pid);c&&(m.value=c.routePath),n.record.tpl_type=="cate"&&(D.value=await J({id:l.value.id}))}else v.value=[];T(i)&&(l.value=z(n.record),l.value.fields&&(l.value.fields=l.value.fields.split(",")),n.record.pid==0&&(l.value.pid=""),P(n),F.value=n),setTimeout(async()=>{y.value=await De({tablename:n.record.tablename})},1e3)}),L=n=>{const o=v.value.find(E=>E.id==n);o&&(m.value=o.routePath),P(F.value)},P=n=>{const o=n.record.tablename.split("_"),c=(window==null?void 0:window.globalConfig.Root_url).split("/");if(o&&o.length==3){l.value.cate_tablename=o[0]+"_"+o[1]+"_cate";const B=v.value.find(I=>I.routePath=="/"+o[1]);B&&(l.value.pid=B.id)}o&&o.length==3?(l.value.routePath=`${o[2]}`,l.value.routeName=`${o[2]}`,l.value.component=`${m.value?m.value.split("/")[1]:o[1]}/${o[2]}/index`,l.value.api_path=`${c[c.length-1]}/${m.value?m.value.split("/")[1]:o[1]}`,l.value.api_filename=o[2]+".go"):(l.value.routePath=`${o[1]}`,l.value.routeName=`${o[1]}`,l.value.component=`${m.value?m.value.split("/")[1]:"xx"}/${o[1]}/index`,l.value.api_path=`${c[c.length-1]}/${m.value?m.value.split("/")[1]:"xx"}`,l.value.api_filename=o[1]+".go")},H=X(()=>(T(i),"\u540E\u53F0\u4EE3\u7801\u751F\u6210\u7BA1\u7406")),{loading:M,setLoading:t}=he();return{registerModal:g,getTitle:H,handleSubmit:async()=>{var o;if($){_.error({content:"Go\u5C5E\u4E8E\u7F16\u8BD1\u8BED\u8A00\uFF0C\u751F\u4EA7\u73AF\u5883\u65E0\u6CD5\u4FEE\u6539\u4EE3\u7801\uFF0C\u8BF7\u60A8\u5728\u5F00\u53D1\u73AF\u5883\u4F7F\u7528\uFF01",id:"upStatus",duration:2e3});return}try{if(!await((o=b.value)==null?void 0:o.validate())){t(!0),_.loading({content:"\u751F\u6210\u4E2D",id:"upStatus",duration:0});let c=z(T(l));c.fields=Se(c.fields);var n=p([]);l.value.fields.forEach(B=>{let I=y.value.find(W=>W.value==B);I&&n.value.push(I)}),c.tablefieldname=n.value,await Be(c),_.success({content:"\u751F\u6210\u6210\u529F",id:"upStatus",duration:2e3}),S(),s("success"),t(!1)}}catch(E){console.error(E),t(!1),_.success({content:"\u751F\u6210\u529F",id:"upStatus",duration:10})}},formRef:b,loading:M,formData:l,OYoptions:[{label:"\u5426",value:0},{label:"\u662F",value:1}],tapList:[{id:1,name:"\u751F\u6210\u4EE3\u7801"},{id:2,name:"\u751F\u6210\u8BB0\u5F55"}],handleIcon:n=>{l.value.icon=n},activeKey:r,modelHeight:U,editorRef:N,handleChangeMenu:L,onHeightChange:n=>{V.value=n},windHeight:V,parntList:v,handleUninstall:async()=>{if($){_.error({content:"Go\u5C5E\u4E8E\u7F16\u8BD1\u8BED\u8A00\uFF0C\u751F\u4EA7\u73AF\u5883\u65E0\u6CD5\u4FEE\u6539\u4EE3\u7801\uFF0C\u8BF7\u60A8\u5728\u5F00\u53D1\u73AF\u5883\u4F7F\u7528\uFF01",id:"upStatus",duration:2e3});return}try{_.loading({content:"\u5378\u8F7D\u4E2D",id:"upStatus"}),await be({id:l.value.id})&&(l.value.is_install=0,_.success({content:"\u5378\u8F7D\u6210\u529F",id:"upStatus"}))}catch{_.success({content:"\u751F\u6210\u529F",id:"upStatus",duration:10})}},fieldList:y,handelTplType:async n=>{n=="cate"&&(!D.value||D.value.length==0)&&(D.value=await J({id:l.value.id}))},tablenameList:D}}});const q=e=>(Ee("data-v-e3e25b5a"),e=e(),_e(),e),Ie={class:"tabs-content"},ke={class:"content_box"},$e={class:"gcodebox"},Ue={class:"textbox"},Ne={class:"textbox"},Le=q(()=>d("div",null,"\u5982\u679C\u662F\u6839\u76EE\u5F55\u6216\u8BBF\u95EE\u8DEF\u7531\u4E0D\u52A0\u4E0A\u7EA7\u76EE\u5F55\u8BF7\u5728\u540D\u79F0\u524D\u52A0/",-1)),He=q(()=>d("span",{style:{width:"50px","text-align":"center"}},"\u6587\u4EF6",-1)),Me={class:"textbox"},Te={class:"btnbox"},qe=q(()=>d("div",{class:"tigmsg"},[d("div",null,"\u6CE8\u610F\uFF1A"),d("span",null,"\u751F\u6210\u4EE3\u7801\u662F\u60A8\u8981\u518D\u540E\u7AEFconfig/settings.yml\u914D\u7F6E\u4E2D\u4FEE\u6539\u524D\u7AEF\u4EE3\u7801\u6240\u5728\u7684\u76EE\u5F55vueobjroot=D:/Project/develop/vue/gofly_base/gofly_business(\u4FEE\u6539\u4F60\u524D\u7AEF\u4EE3\u7801\u8DEF\u5F84)")],-1));function Re(e,s,$,v,y,D){const i=te,r=le,U=oe,V=ne,b=k("Icon"),R=k("icon-apps"),l=k("IconPicker"),N=se,m=ie,F=re,g=de,w=pe,S=me,L=ce,P=fe,H=Fe,M=k("BasicModal");return h(),C(M,ae(e.$attrs,{onRegister:e.registerModal,footer:!1,"mask-closable":!1,isPadding:!1,loading:e.loading,width:"1000px",onHeightChange:e.onHeightChange,minHeight:e.modelHeight,title:e.getTitle,onOk:e.handleSubmit}),{default:u(()=>[d("div",{class:"addFormbox",style:Z({"min-height":`${e.windHeight}px`})},[d("div",Ie,[d("div",ke,[a(H,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:u(()=>[x(d("div",$e,[a(P,{gutter:16},{default:u(()=>[a(r,{span:12},{default:u(()=>[a(i,{field:"comment",label:"\u8868\u8BF4\u660E:","validate-trigger":"input"},{default:u(()=>[d("span",Ue,A(e.formData.comment),1)]),_:1})]),_:1}),a(r,{span:12},{default:u(()=>[a(i,{field:"tablename",label:"\u8868\u540D:","validate-trigger":"input"},{default:u(()=>[d("span",Ne,A(e.formData.tablename),1)]),_:1})]),_:1}),a(r,{span:12},{default:u(()=>[a(i,{label:"\u4E0A\u7EA7\u83DC\u5355",field:"pid",style:{"margin-bottom":"15px"},rules:[{required:!0,message:"\u8BF7\u586B\u4E0A\u7EA7\u83DC\u5355"}]},{extra:u(()=>[d("div",null,[f("\u82E5\u8981\u7ED1\u5B9A\u5230\u65B0\u7684\u76EE\u5F55\u8BF7\u5230"),a(V,{href:"/system/rule"},{default:u(()=>[f("\u83DC\u5355\u7BA1\u7406(dev)")]),_:1}),f("\u6DFB\u52A0\u65B0\u76EE\u5F55")])]),default:u(()=>[a(U,{placeholder:"\u9009\u62E9\u4E0A\u7EA7\u83DC\u5355",data:e.parntList,onChange:e.handleChangeMenu,fieldNames:{key:"id",title:"title",children:"children"},modelValue:e.formData.pid,"onUpdate:modelValue":s[0]||(s[0]=t=>e.formData.pid=t)},null,8,["data","onChange","modelValue"])]),_:1})]),_:1}),a(r,{span:12},{default:u(()=>[a(i,{label:"\u56FE\u6807",field:"icon",style:{"margin-bottom":"15px"}},{default:u(()=>[a(m,{modelValue:e.formData.icon,"onUpdate:modelValue":s[1]||(s[1]=t=>e.formData.icon=t),placeholder:"\u9009\u62E9\u56FE\u6807/\u586B\u5199","search-button":""},ee({"button-icon":u(()=>[a(N,{position:"br",trigger:"click"},{content:u(()=>[a(l,{onChange:e.handleIcon},null,8,["onChange"])]),default:u(()=>[a(R,{size:23})]),_:1})]),_:2},[e.formData.icon?{name:"prefix",fn:u(()=>[a(b,{icon:e.formData.icon},null,8,["icon"])]),key:"0"}:void 0]),1032,["modelValue"])]),_:1})]),_:1}),a(r,{span:12},{default:u(()=>[a(i,{field:"routePath",label:"\u8DEF\u7531Path","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u8DEF\u7531\u8DEF\u7531\uFF08path\uFF09"}]},{extra:u(()=>[Le]),default:u(()=>[a(F,{modelValue:e.formData.routePath,"onUpdate:modelValue":s[2]||(s[2]=t=>e.formData.routePath=t),placeholder:"\u8BF7\u586B\u8DEF\u7531\uFF08path\uFF09"},null,8,["modelValue"])]),_:1})]),_:1}),a(r,{span:12},{default:u(()=>[a(i,{field:"routeName",label:"\u8DEF\u7531name","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u8DEF\u7531\u8DEF\u7531\uFF08name\uFF09"}]},{default:u(()=>[a(F,{modelValue:e.formData.routeName,"onUpdate:modelValue":s[3]||(s[3]=t=>e.formData.routeName=t),placeholder:"\u8BF7\u586B\u8DEF\u7531\uFF08name\uFF09"},null,8,["modelValue"])]),_:1})]),_:1}),a(r,{span:10},{default:u(()=>[a(i,{field:"component",label:"\u524D\u7AEF\u7EC4\u4EF6\u8DEF\u5F84","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u524D\u7AEF\u7EC4\u4EF6\u8DEF\u5F84"}]},{default:u(()=>[a(F,{modelValue:e.formData.component,"onUpdate:modelValue":s[4]||(s[4]=t=>e.formData.component=t),placeholder:"\u8BF7\u586B\u524D\u7AEF\u7EC4\u4EF6\u8DEF\u5F84"},null,8,["modelValue"])]),_:1})]),_:1}),a(r,{span:14},{default:u(()=>[a(i,{field:"api_path",label:"\u540E\u53F0\u4EE3\u7801\u8DEF\u5F84","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u540E\u53F0\u4EE3\u7801\u8DEF\u5F84"}]},{extra:u(()=>[d("div",null,[f("\u540E\u53F0\u4E1A\u52A1\u4EE3\u7801 "),d("span",Me,A(e.formData.api_path+"/"+e.formData.api_filename),1),f("\u6587\u4EF6\u4E0B")])]),default:u(()=>[a(F,{modelValue:e.formData.api_path,"onUpdate:modelValue":s[5]||(s[5]=t=>e.formData.api_path=t),placeholder:"\u8BF7\u586B\u540E\u53F0\u4EE3\u7801\u8DEF\u5F84"},null,8,["modelValue"]),He,a(F,{modelValue:e.formData.api_filename,"onUpdate:modelValue":s[6]||(s[6]=t=>e.formData.api_filename=t),style:{width:"190px"},placeholder:"\u8BF7\u586B\u540E\u53F0\u4EE3\u7801\u6587\u4EF6"},null,8,["modelValue"])]),_:1})]),_:1}),a(r,{span:24},{default:u(()=>[a(i,{field:"fields",label:"\u67E5\u8BE2\u5217\u8868\u5B57\u6BB5","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u67E5\u8BE2\u5217\u8868\u5B57\u6BB5"}]},{default:u(()=>[a(w,{modelValue:e.formData.fields,"onUpdate:modelValue":s[7]||(s[7]=t=>e.formData.fields=t),placeholder:"\u9009\u62E9\u67E5\u8BE2\u5217\u8868\u5B57\u6BB5",multiple:"","max-tag-count":12,"allow-clear":""},{default:u(()=>[(h(!0),O(j,null,G(e.fieldList,t=>(h(),C(g,{value:t.value},{default:u(()=>[f(A(t.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(r,{span:12},{default:u(()=>[a(i,{field:"tpl_type",label:"\u6A21\u677F\u7C7B\u578B","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6A21\u677F\u7C7B\u578B"}]},{default:u(()=>[a(w,{onChange:e.handelTplType,modelValue:e.formData.tpl_type,"onUpdate:modelValue":s[8]||(s[8]=t=>e.formData.tpl_type=t),placeholder:"\u9009\u62E9\u6A21\u677F\u7C7B\u578B","allow-clear":""},{default:u(()=>[a(g,{value:"list"},{default:u(()=>[f("\u6570\u636E\u5217\u8868")]),_:1}),a(g,{value:"contentlist"},{default:u(()=>[f("\u5BCC\u6587\u672C\u6570\u636E\u5217\u8868")]),_:1}),a(g,{value:"contentcatelist"},{default:u(()=>[f("\u5BCC\u6587\u672C\u6570\u636E\u5173\u8054\u5206\u7C7B")]),_:1})]),_:1},8,["onChange","modelValue"])]),_:1})]),_:1}),e.formData.tpl_type=="contentcatelist"?(h(),C(r,{key:0,span:12},{default:u(()=>[a(i,{field:"cate_tablename",label:"\u5206\u7C7B\u7684\u6570\u636E\u5E93","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u9009\u5206\u7C7B\u7684\u6570\u636E\u5E93"}]},{default:u(()=>[a(w,{modelValue:e.formData.cate_tablename,"onUpdate:modelValue":s[9]||(s[9]=t=>e.formData.cate_tablename=t),placeholder:"\u9009\u62E9\u5206\u7C7B\u7684\u6570\u636E\u5E93","allow-clear":""},{default:u(()=>[(h(!0),O(j,null,G(e.tablenameList,t=>(h(),C(g,{value:t.value},{default:u(()=>[f(A(t.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):K("",!0),a(r,{span:24},{default:u(()=>[d("div",Te,[a(L,null,{default:u(()=>[a(S,{onClick:e.handleSubmit,"html-type":"submit",size:"large",type:"primary",shape:"round",style:{width:"200px","margin-top":"15px"}},{default:u(()=>[f("\u5F00\u59CB\u751F\u6210")]),_:1},8,["onClick"]),e.formData.is_install==1?(h(),C(S,{key:0,onClick:e.handleUninstall,size:"large",shape:"round",style:{width:"200px","margin-top":"15px"}},{default:u(()=>[f("\u5378\u8F7D\u4EE3\u7801\u53CA\u83DC\u5355")]),_:1},8,["onClick"])):K("",!0)]),_:1})])]),_:1})]),_:1}),qe],512),[[ue,e.activeKey==1]])]),_:1},8,["model"])])])],4)]),_:1},16,["onRegister","loading","onHeightChange","minHeight","title","onOk"])}const _u=Y(Pe,[["render",Re],["__scopeId","data-v-e3e25b5a"]]);export{_u as default};
