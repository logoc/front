var rg=Object.defineProperty;var sg=(l,t,e)=>t in l?rg(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var y=(l,t,e)=>(sg(l,typeof t!="symbol"?t+"":t,e),e),gc=(l,t,e)=>{if(!t.has(l))throw TypeError("Cannot "+e)};var ie=(l,t,e)=>(gc(l,t,"read from private field"),e?e.call(l):t.get(l)),rt=(l,t,e)=>{if(t.has(l))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(l):t.set(l,e)},Ze=(l,t,e,n)=>(gc(l,t,"write to private field"),n?n.call(l,e):t.set(l,e),e);import{n as ns,_ as gt,X as ys,W as _s,Y as og,p as mc}from"./index.a2bf8911.js";/* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css                *//* empty css              *//* empty css               *//* empty css               */import{aQ as ag,aP as lg,x as is,d as mt,bv as pr,e as xe,C as oe,aE as Je,aH as Be,D as pe,aO as Et,aF as Re,G as Ne,E as lt,bV as di,aN as Pr,o as Fi,aK as kt,aJ as Jt,w as Ps,aL as ct,aI as Ge,F as zn,z as Js,bz as Qa,h as Pf,bF as cg,bU as Yt,r as ug,b0 as dr,br as dg,b1 as fg,a_ as zf,aW as el,aY as qf,bQ as Da,bR as hg,bM as zs,bL as pg,n as gg,c as mg,u as Jo,aS as Xi,bA as vc,bB as bc,b7 as vg,b_ as bg,aV as yg,c4 as _g,bW as wg,bc as xg}from"./arco.b02d9b55.js";import{a as Hf,B as kg,u as Eg}from"./index.c4821ce7.js";import{u as Cg}from"./loading.7f7bf96d.js";import{l as Sg}from"./lodash.b99388fa.js";import{g as Ag}from"./api.94877843.js";import{u as Tg}from"./common.66f89a6d.js";import{_ as Wf,a as tl,b as Ng,e as nl,d as Dg,f as il,g as Rg,i as Uf,h as jf,j as hi,k as Qs,l as Mg,m as Vf,n as Bi,c as Ut,o as Lg,p as rl,q as Gf,r as Ig,s as Og,t as Zf,u as Fg,v as Kf,w as Xf,x as Bg,y as $g,z as Pg,A as zg,B as qg,C as Hg,D as Wg,E as Ug,F as jg}from"./cloneDeep.bb231cd9.js";/* empty css               *//* empty css                *//* empty css                */import Yf from"./FileManage.59225568.js";/* empty css                */import{C as Jn,c as Ke,r as sl,a as Vg}from"./htmlmixed.af7c8595.js";var Gg={exports:{}};function Nae(l){return l.createdTime&&(l.createdTime=Sg.exports.join(l.createdTime)),ns.get({url:"/makecode/product/get_list",params:l},{errorMessageMode:"none"})}function Zg(l){return ns.get({url:"/makecode/product/get_content",params:l},{errorMessageMode:"none"})}function Kg(l){return ns.post({url:"/makecode/product/save",params:l},{errorMessageMode:"message"})}function Dae(l){return ns.post({url:"/makecode/product/upStatus",params:l},{errorMessageMode:"message"})}function Rae(l){return ns.delete({url:"/makecode/product/del",params:l},{errorMessageMode:"message"})}var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});var Xg=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),Qo={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},Jf={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:Xg?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},ol={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(var ws=1;ws<20;ws++)ol["f"+ws]=111+ws;function eo(l,t,e){t&&!("byKey"in t)&&(e=t,t=null),Array.isArray(l)||(l=[l]);var n=l.map(function(s){return Qf(s,t)}),i=function(o){return n.some(function(a){return eh(a,o)})},r=e==null?i:i(e);return r}function Yg(l,t){return eo(l,t)}function Jg(l,t){return eo(l,{byKey:!0},t)}function Qf(l,t){var e=t&&t.byKey,n={};l=l.replace("++","+add");var i=l.split("+"),r=i.length;for(var s in Qo)n[Qo[s]]=!1;var o=!0,a=!1,c=void 0;try{for(var u=i[Symbol.iterator](),d;!(o=(d=u.next()).done);o=!0){var h=d.value,f=h.endsWith("?")&&h.length>1;f&&(h=h.slice(0,-1));var p=al(h),g=Qo[p];if(h.length>1&&!g&&!Jf[h]&&!ol[p])throw new TypeError('Unknown modifier: "'+h+'"');(r===1||!g)&&(e?n.key=p:n.which=th(h)),g&&(n[g]=f?null:!0)}}catch(m){a=!0,c=m}finally{try{!o&&u.return&&u.return()}finally{if(a)throw c}}return n}function eh(l,t){for(var e in l){var n=l[e],i=void 0;if(n!=null&&(e==="key"&&t.key!=null?i=t.key.toLowerCase():e==="which"?i=n===91&&t.which===93?91:t.which:i=t[e],!(i==null&&n===!1)&&i!==n))return!1}return!0}function th(l){l=al(l);var t=ol[l]||l.toUpperCase().charCodeAt(0);return t}function al(l){return l=l.toLowerCase(),l=Jf[l]||l,l}var ce=Wn.default=eo,xs=Wn.isHotkey=eo;Wn.isCodeHotkey=Yg;Wn.isKeyHotkey=Jg;Wn.parseHotkey=Qf;Wn.compareHotkey=eh;Wn.toKeyCode=th;Wn.toKeyName=al;var nh={exports:{}},Xe={},ll={exports:{}};const Qg="\xC1",em="\xE1",tm="\u0102",nm="\u0103",im="\u223E",rm="\u223F",sm="\u223E\u0333",om="\xC2",am="\xE2",lm="\xB4",cm="\u0410",um="\u0430",dm="\xC6",fm="\xE6",hm="\u2061",pm="\u{1D504}",gm="\u{1D51E}",mm="\xC0",vm="\xE0",bm="\u2135",ym="\u2135",_m="\u0391",wm="\u03B1",xm="\u0100",km="\u0101",Em="\u2A3F",Cm="&",Sm="&",Am="\u2A55",Tm="\u2A53",Nm="\u2227",Dm="\u2A5C",Rm="\u2A58",Mm="\u2A5A",Lm="\u2220",Im="\u29A4",Om="\u2220",Fm="\u29A8",Bm="\u29A9",$m="\u29AA",Pm="\u29AB",zm="\u29AC",qm="\u29AD",Hm="\u29AE",Wm="\u29AF",Um="\u2221",jm="\u221F",Vm="\u22BE",Gm="\u299D",Zm="\u2222",Km="\xC5",Xm="\u237C",Ym="\u0104",Jm="\u0105",Qm="\u{1D538}",ev="\u{1D552}",tv="\u2A6F",nv="\u2248",iv="\u2A70",rv="\u224A",sv="\u224B",ov="'",av="\u2061",lv="\u2248",cv="\u224A",uv="\xC5",dv="\xE5",fv="\u{1D49C}",hv="\u{1D4B6}",pv="\u2254",gv="*",mv="\u2248",vv="\u224D",bv="\xC3",yv="\xE3",_v="\xC4",wv="\xE4",xv="\u2233",kv="\u2A11",Ev="\u224C",Cv="\u03F6",Sv="\u2035",Av="\u223D",Tv="\u22CD",Nv="\u2216",Dv="\u2AE7",Rv="\u22BD",Mv="\u2305",Lv="\u2306",Iv="\u2305",Ov="\u23B5",Fv="\u23B6",Bv="\u224C",$v="\u0411",Pv="\u0431",zv="\u201E",qv="\u2235",Hv="\u2235",Wv="\u2235",Uv="\u29B0",jv="\u03F6",Vv="\u212C",Gv="\u212C",Zv="\u0392",Kv="\u03B2",Xv="\u2136",Yv="\u226C",Jv="\u{1D505}",Qv="\u{1D51F}",eb="\u22C2",tb="\u25EF",nb="\u22C3",ib="\u2A00",rb="\u2A01",sb="\u2A02",ob="\u2A06",ab="\u2605",lb="\u25BD",cb="\u25B3",ub="\u2A04",db="\u22C1",fb="\u22C0",hb="\u290D",pb="\u29EB",gb="\u25AA",mb="\u25B4",vb="\u25BE",bb="\u25C2",yb="\u25B8",_b="\u2423",wb="\u2592",xb="\u2591",kb="\u2593",Eb="\u2588",Cb="=\u20E5",Sb="\u2261\u20E5",Ab="\u2AED",Tb="\u2310",Nb="\u{1D539}",Db="\u{1D553}",Rb="\u22A5",Mb="\u22A5",Lb="\u22C8",Ib="\u29C9",Ob="\u2510",Fb="\u2555",Bb="\u2556",$b="\u2557",Pb="\u250C",zb="\u2552",qb="\u2553",Hb="\u2554",Wb="\u2500",Ub="\u2550",jb="\u252C",Vb="\u2564",Gb="\u2565",Zb="\u2566",Kb="\u2534",Xb="\u2567",Yb="\u2568",Jb="\u2569",Qb="\u229F",e0="\u229E",t0="\u22A0",n0="\u2518",i0="\u255B",r0="\u255C",s0="\u255D",o0="\u2514",a0="\u2558",l0="\u2559",c0="\u255A",u0="\u2502",d0="\u2551",f0="\u253C",h0="\u256A",p0="\u256B",g0="\u256C",m0="\u2524",v0="\u2561",b0="\u2562",y0="\u2563",_0="\u251C",w0="\u255E",x0="\u255F",k0="\u2560",E0="\u2035",C0="\u02D8",S0="\u02D8",A0="\xA6",T0="\u{1D4B7}",N0="\u212C",D0="\u204F",R0="\u223D",M0="\u22CD",L0="\u29C5",I0="\\",O0="\u27C8",F0="\u2022",B0="\u2022",$0="\u224E",P0="\u2AAE",z0="\u224F",q0="\u224E",H0="\u224F",W0="\u0106",U0="\u0107",j0="\u2A44",V0="\u2A49",G0="\u2A4B",Z0="\u2229",K0="\u22D2",X0="\u2A47",Y0="\u2A40",J0="\u2145",Q0="\u2229\uFE00",ey="\u2041",ty="\u02C7",ny="\u212D",iy="\u2A4D",ry="\u010C",sy="\u010D",oy="\xC7",ay="\xE7",ly="\u0108",cy="\u0109",uy="\u2230",dy="\u2A4C",fy="\u2A50",hy="\u010A",py="\u010B",gy="\xB8",my="\xB8",vy="\u29B2",by="\xA2",yy="\xB7",_y="\xB7",wy="\u{1D520}",xy="\u212D",ky="\u0427",Ey="\u0447",Cy="\u2713",Sy="\u2713",Ay="\u03A7",Ty="\u03C7",Ny="\u02C6",Dy="\u2257",Ry="\u21BA",My="\u21BB",Ly="\u229B",Iy="\u229A",Oy="\u229D",Fy="\u2299",By="\xAE",$y="\u24C8",Py="\u2296",zy="\u2295",qy="\u2297",Hy="\u25CB",Wy="\u29C3",Uy="\u2257",jy="\u2A10",Vy="\u2AEF",Gy="\u29C2",Zy="\u2232",Ky="\u201D",Xy="\u2019",Yy="\u2663",Jy="\u2663",Qy=":",e_="\u2237",t_="\u2A74",n_="\u2254",i_="\u2254",r_=",",s_="@",o_="\u2201",a_="\u2218",l_="\u2201",c_="\u2102",u_="\u2245",d_="\u2A6D",f_="\u2261",h_="\u222E",p_="\u222F",g_="\u222E",m_="\u{1D554}",v_="\u2102",b_="\u2210",y_="\u2210",__="\xA9",w_="\xA9",x_="\u2117",k_="\u2233",E_="\u21B5",C_="\u2717",S_="\u2A2F",A_="\u{1D49E}",T_="\u{1D4B8}",N_="\u2ACF",D_="\u2AD1",R_="\u2AD0",M_="\u2AD2",L_="\u22EF",I_="\u2938",O_="\u2935",F_="\u22DE",B_="\u22DF",$_="\u21B6",P_="\u293D",z_="\u2A48",q_="\u2A46",H_="\u224D",W_="\u222A",U_="\u22D3",j_="\u2A4A",V_="\u228D",G_="\u2A45",Z_="\u222A\uFE00",K_="\u21B7",X_="\u293C",Y_="\u22DE",J_="\u22DF",Q_="\u22CE",ew="\u22CF",tw="\xA4",nw="\u21B6",iw="\u21B7",rw="\u22CE",sw="\u22CF",ow="\u2232",aw="\u2231",lw="\u232D",cw="\u2020",uw="\u2021",dw="\u2138",fw="\u2193",hw="\u21A1",pw="\u21D3",gw="\u2010",mw="\u2AE4",vw="\u22A3",bw="\u290F",yw="\u02DD",_w="\u010E",ww="\u010F",xw="\u0414",kw="\u0434",Ew="\u2021",Cw="\u21CA",Sw="\u2145",Aw="\u2146",Tw="\u2911",Nw="\u2A77",Dw="\xB0",Rw="\u2207",Mw="\u0394",Lw="\u03B4",Iw="\u29B1",Ow="\u297F",Fw="\u{1D507}",Bw="\u{1D521}",$w="\u2965",Pw="\u21C3",zw="\u21C2",qw="\xB4",Hw="\u02D9",Ww="\u02DD",Uw="`",jw="\u02DC",Vw="\u22C4",Gw="\u22C4",Zw="\u22C4",Kw="\u2666",Xw="\u2666",Yw="\xA8",Jw="\u2146",Qw="\u03DD",e1="\u22F2",t1="\xF7",n1="\xF7",i1="\u22C7",r1="\u22C7",s1="\u0402",o1="\u0452",a1="\u231E",l1="\u230D",c1="$",u1="\u{1D53B}",d1="\u{1D555}",f1="\xA8",h1="\u02D9",p1="\u20DC",g1="\u2250",m1="\u2251",v1="\u2250",b1="\u2238",y1="\u2214",_1="\u22A1",w1="\u2306",x1="\u222F",k1="\xA8",E1="\u21D3",C1="\u21D0",S1="\u21D4",A1="\u2AE4",T1="\u27F8",N1="\u27FA",D1="\u27F9",R1="\u21D2",M1="\u22A8",L1="\u21D1",I1="\u21D5",O1="\u2225",F1="\u2913",B1="\u2193",$1="\u2193",P1="\u21D3",z1="\u21F5",q1="\u0311",H1="\u21CA",W1="\u21C3",U1="\u21C2",j1="\u2950",V1="\u295E",G1="\u2956",Z1="\u21BD",K1="\u295F",X1="\u2957",Y1="\u21C1",J1="\u21A7",Q1="\u22A4",ex="\u2910",tx="\u231F",nx="\u230C",ix="\u{1D49F}",rx="\u{1D4B9}",sx="\u0405",ox="\u0455",ax="\u29F6",lx="\u0110",cx="\u0111",ux="\u22F1",dx="\u25BF",fx="\u25BE",hx="\u21F5",px="\u296F",gx="\u29A6",mx="\u040F",vx="\u045F",bx="\u27FF",yx="\xC9",_x="\xE9",wx="\u2A6E",xx="\u011A",kx="\u011B",Ex="\xCA",Cx="\xEA",Sx="\u2256",Ax="\u2255",Tx="\u042D",Nx="\u044D",Dx="\u2A77",Rx="\u0116",Mx="\u0117",Lx="\u2251",Ix="\u2147",Ox="\u2252",Fx="\u{1D508}",Bx="\u{1D522}",$x="\u2A9A",Px="\xC8",zx="\xE8",qx="\u2A96",Hx="\u2A98",Wx="\u2A99",Ux="\u2208",jx="\u23E7",Vx="\u2113",Gx="\u2A95",Zx="\u2A97",Kx="\u0112",Xx="\u0113",Yx="\u2205",Jx="\u2205",Qx="\u25FB",ek="\u2205",tk="\u25AB",nk="\u2004",ik="\u2005",rk="\u2003",sk="\u014A",ok="\u014B",ak="\u2002",lk="\u0118",ck="\u0119",uk="\u{1D53C}",dk="\u{1D556}",fk="\u22D5",hk="\u29E3",pk="\u2A71",gk="\u03B5",mk="\u0395",vk="\u03B5",bk="\u03F5",yk="\u2256",_k="\u2255",wk="\u2242",xk="\u2A96",kk="\u2A95",Ek="\u2A75",Ck="=",Sk="\u2242",Ak="\u225F",Tk="\u21CC",Nk="\u2261",Dk="\u2A78",Rk="\u29E5",Mk="\u2971",Lk="\u2253",Ik="\u212F",Ok="\u2130",Fk="\u2250",Bk="\u2A73",$k="\u2242",Pk="\u0397",zk="\u03B7",qk="\xD0",Hk="\xF0",Wk="\xCB",Uk="\xEB",jk="\u20AC",Vk="!",Gk="\u2203",Zk="\u2203",Kk="\u2130",Xk="\u2147",Yk="\u2147",Jk="\u2252",Qk="\u0424",eE="\u0444",tE="\u2640",nE="\uFB03",iE="\uFB00",rE="\uFB04",sE="\u{1D509}",oE="\u{1D523}",aE="\uFB01",lE="\u25FC",cE="\u25AA",uE="fj",dE="\u266D",fE="\uFB02",hE="\u25B1",pE="\u0192",gE="\u{1D53D}",mE="\u{1D557}",vE="\u2200",bE="\u2200",yE="\u22D4",_E="\u2AD9",wE="\u2131",xE="\u2A0D",kE="\xBD",EE="\u2153",CE="\xBC",SE="\u2155",AE="\u2159",TE="\u215B",NE="\u2154",DE="\u2156",RE="\xBE",ME="\u2157",LE="\u215C",IE="\u2158",OE="\u215A",FE="\u215D",BE="\u215E",$E="\u2044",PE="\u2322",zE="\u{1D4BB}",qE="\u2131",HE="\u01F5",WE="\u0393",UE="\u03B3",jE="\u03DC",VE="\u03DD",GE="\u2A86",ZE="\u011E",KE="\u011F",XE="\u0122",YE="\u011C",JE="\u011D",QE="\u0413",eC="\u0433",tC="\u0120",nC="\u0121",iC="\u2265",rC="\u2267",sC="\u2A8C",oC="\u22DB",aC="\u2265",lC="\u2267",cC="\u2A7E",uC="\u2AA9",dC="\u2A7E",fC="\u2A80",hC="\u2A82",pC="\u2A84",gC="\u22DB\uFE00",mC="\u2A94",vC="\u{1D50A}",bC="\u{1D524}",yC="\u226B",_C="\u22D9",wC="\u22D9",xC="\u2137",kC="\u0403",EC="\u0453",CC="\u2AA5",SC="\u2277",AC="\u2A92",TC="\u2AA4",NC="\u2A8A",DC="\u2A8A",RC="\u2A88",MC="\u2269",LC="\u2A88",IC="\u2269",OC="\u22E7",FC="\u{1D53E}",BC="\u{1D558}",$C="`",PC="\u2265",zC="\u22DB",qC="\u2267",HC="\u2AA2",WC="\u2277",UC="\u2A7E",jC="\u2273",VC="\u{1D4A2}",GC="\u210A",ZC="\u2273",KC="\u2A8E",XC="\u2A90",YC="\u2AA7",JC="\u2A7A",QC=">",eS=">",tS="\u226B",nS="\u22D7",iS="\u2995",rS="\u2A7C",sS="\u2A86",oS="\u2978",aS="\u22D7",lS="\u22DB",cS="\u2A8C",uS="\u2277",dS="\u2273",fS="\u2269\uFE00",hS="\u2269\uFE00",pS="\u02C7",gS="\u200A",mS="\xBD",vS="\u210B",bS="\u042A",yS="\u044A",_S="\u2948",wS="\u2194",xS="\u21D4",kS="\u21AD",ES="^",CS="\u210F",SS="\u0124",AS="\u0125",TS="\u2665",NS="\u2665",DS="\u2026",RS="\u22B9",MS="\u{1D525}",LS="\u210C",IS="\u210B",OS="\u2925",FS="\u2926",BS="\u21FF",$S="\u223B",PS="\u21A9",zS="\u21AA",qS="\u{1D559}",HS="\u210D",WS="\u2015",US="\u2500",jS="\u{1D4BD}",VS="\u210B",GS="\u210F",ZS="\u0126",KS="\u0127",XS="\u224E",YS="\u224F",JS="\u2043",QS="\u2010",eA="\xCD",tA="\xED",nA="\u2063",iA="\xCE",rA="\xEE",sA="\u0418",oA="\u0438",aA="\u0130",lA="\u0415",cA="\u0435",uA="\xA1",dA="\u21D4",fA="\u{1D526}",hA="\u2111",pA="\xCC",gA="\xEC",mA="\u2148",vA="\u2A0C",bA="\u222D",yA="\u29DC",_A="\u2129",wA="\u0132",xA="\u0133",kA="\u012A",EA="\u012B",CA="\u2111",SA="\u2148",AA="\u2110",TA="\u2111",NA="\u0131",DA="\u2111",RA="\u22B7",MA="\u01B5",LA="\u21D2",IA="\u2105",OA="\u221E",FA="\u29DD",BA="\u0131",$A="\u22BA",PA="\u222B",zA="\u222C",qA="\u2124",HA="\u222B",WA="\u22BA",UA="\u22C2",jA="\u2A17",VA="\u2A3C",GA="\u2063",ZA="\u2062",KA="\u0401",XA="\u0451",YA="\u012E",JA="\u012F",QA="\u{1D540}",e2="\u{1D55A}",t2="\u0399",n2="\u03B9",i2="\u2A3C",r2="\xBF",s2="\u{1D4BE}",o2="\u2110",a2="\u2208",l2="\u22F5",c2="\u22F9",u2="\u22F4",d2="\u22F3",f2="\u2208",h2="\u2062",p2="\u0128",g2="\u0129",m2="\u0406",v2="\u0456",b2="\xCF",y2="\xEF",_2="\u0134",w2="\u0135",x2="\u0419",k2="\u0439",E2="\u{1D50D}",C2="\u{1D527}",S2="\u0237",A2="\u{1D541}",T2="\u{1D55B}",N2="\u{1D4A5}",D2="\u{1D4BF}",R2="\u0408",M2="\u0458",L2="\u0404",I2="\u0454",O2="\u039A",F2="\u03BA",B2="\u03F0",$2="\u0136",P2="\u0137",z2="\u041A",q2="\u043A",H2="\u{1D50E}",W2="\u{1D528}",U2="\u0138",j2="\u0425",V2="\u0445",G2="\u040C",Z2="\u045C",K2="\u{1D542}",X2="\u{1D55C}",Y2="\u{1D4A6}",J2="\u{1D4C0}",Q2="\u21DA",eT="\u0139",tT="\u013A",nT="\u29B4",iT="\u2112",rT="\u039B",sT="\u03BB",oT="\u27E8",aT="\u27EA",lT="\u2991",cT="\u27E8",uT="\u2A85",dT="\u2112",fT="\xAB",hT="\u21E4",pT="\u291F",gT="\u2190",mT="\u219E",vT="\u21D0",bT="\u291D",yT="\u21A9",_T="\u21AB",wT="\u2939",xT="\u2973",kT="\u21A2",ET="\u2919",CT="\u291B",ST="\u2AAB",AT="\u2AAD",TT="\u2AAD\uFE00",NT="\u290C",DT="\u290E",RT="\u2772",MT="{",LT="[",IT="\u298B",OT="\u298F",FT="\u298D",BT="\u013D",$T="\u013E",PT="\u013B",zT="\u013C",qT="\u2308",HT="{",WT="\u041B",UT="\u043B",jT="\u2936",VT="\u201C",GT="\u201E",ZT="\u2967",KT="\u294B",XT="\u21B2",YT="\u2264",JT="\u2266",QT="\u27E8",e5="\u21E4",t5="\u2190",n5="\u2190",i5="\u21D0",r5="\u21C6",s5="\u21A2",o5="\u2308",a5="\u27E6",l5="\u2961",c5="\u2959",u5="\u21C3",d5="\u230A",f5="\u21BD",h5="\u21BC",p5="\u21C7",g5="\u2194",m5="\u2194",v5="\u21D4",b5="\u21C6",y5="\u21CB",_5="\u21AD",w5="\u294E",x5="\u21A4",k5="\u22A3",E5="\u295A",C5="\u22CB",S5="\u29CF",A5="\u22B2",T5="\u22B4",N5="\u2951",D5="\u2960",R5="\u2958",M5="\u21BF",L5="\u2952",I5="\u21BC",O5="\u2A8B",F5="\u22DA",B5="\u2264",$5="\u2266",P5="\u2A7D",z5="\u2AA8",q5="\u2A7D",H5="\u2A7F",W5="\u2A81",U5="\u2A83",j5="\u22DA\uFE00",V5="\u2A93",G5="\u2A85",Z5="\u22D6",K5="\u22DA",X5="\u2A8B",Y5="\u22DA",J5="\u2266",Q5="\u2276",eN="\u2276",tN="\u2AA1",nN="\u2272",iN="\u2A7D",rN="\u2272",sN="\u297C",oN="\u230A",aN="\u{1D50F}",lN="\u{1D529}",cN="\u2276",uN="\u2A91",dN="\u2962",fN="\u21BD",hN="\u21BC",pN="\u296A",gN="\u2584",mN="\u0409",vN="\u0459",bN="\u21C7",yN="\u226A",_N="\u22D8",wN="\u231E",xN="\u21DA",kN="\u296B",EN="\u25FA",CN="\u013F",SN="\u0140",AN="\u23B0",TN="\u23B0",NN="\u2A89",DN="\u2A89",RN="\u2A87",MN="\u2268",LN="\u2A87",IN="\u2268",ON="\u22E6",FN="\u27EC",BN="\u21FD",$N="\u27E6",PN="\u27F5",zN="\u27F5",qN="\u27F8",HN="\u27F7",WN="\u27F7",UN="\u27FA",jN="\u27FC",VN="\u27F6",GN="\u27F6",ZN="\u27F9",KN="\u21AB",XN="\u21AC",YN="\u2985",JN="\u{1D543}",QN="\u{1D55D}",eD="\u2A2D",tD="\u2A34",nD="\u2217",iD="_",rD="\u2199",sD="\u2198",oD="\u25CA",aD="\u25CA",lD="\u29EB",cD="(",uD="\u2993",dD="\u21C6",fD="\u231F",hD="\u21CB",pD="\u296D",gD="\u200E",mD="\u22BF",vD="\u2039",bD="\u{1D4C1}",yD="\u2112",_D="\u21B0",wD="\u21B0",xD="\u2272",kD="\u2A8D",ED="\u2A8F",CD="[",SD="\u2018",AD="\u201A",TD="\u0141",ND="\u0142",DD="\u2AA6",RD="\u2A79",MD="<",LD="<",ID="\u226A",OD="\u22D6",FD="\u22CB",BD="\u22C9",$D="\u2976",PD="\u2A7B",zD="\u25C3",qD="\u22B4",HD="\u25C2",WD="\u2996",UD="\u294A",jD="\u2966",VD="\u2268\uFE00",GD="\u2268\uFE00",ZD="\xAF",KD="\u2642",XD="\u2720",YD="\u2720",JD="\u21A6",QD="\u21A6",eR="\u21A7",tR="\u21A4",nR="\u21A5",iR="\u25AE",rR="\u2A29",sR="\u041C",oR="\u043C",aR="\u2014",lR="\u223A",cR="\u2221",uR="\u205F",dR="\u2133",fR="\u{1D510}",hR="\u{1D52A}",pR="\u2127",gR="\xB5",mR="*",vR="\u2AF0",bR="\u2223",yR="\xB7",_R="\u229F",wR="\u2212",xR="\u2238",kR="\u2A2A",ER="\u2213",CR="\u2ADB",SR="\u2026",AR="\u2213",TR="\u22A7",NR="\u{1D544}",DR="\u{1D55E}",RR="\u2213",MR="\u{1D4C2}",LR="\u2133",IR="\u223E",OR="\u039C",FR="\u03BC",BR="\u22B8",$R="\u22B8",PR="\u2207",zR="\u0143",qR="\u0144",HR="\u2220\u20D2",WR="\u2249",UR="\u2A70\u0338",jR="\u224B\u0338",VR="\u0149",GR="\u2249",ZR="\u266E",KR="\u2115",XR="\u266E",YR="\xA0",JR="\u224E\u0338",QR="\u224F\u0338",eM="\u2A43",tM="\u0147",nM="\u0148",iM="\u0145",rM="\u0146",sM="\u2247",oM="\u2A6D\u0338",aM="\u2A42",lM="\u041D",cM="\u043D",uM="\u2013",dM="\u2924",fM="\u2197",hM="\u21D7",pM="\u2197",gM="\u2260",mM="\u2250\u0338",vM="\u200B",bM="\u200B",yM="\u200B",_M="\u200B",wM="\u2262",xM="\u2928",kM="\u2242\u0338",EM="\u226B",CM="\u226A",SM=`
`,AM="\u2204",TM="\u2204",NM="\u{1D511}",DM="\u{1D52B}",RM="\u2267\u0338",MM="\u2271",LM="\u2271",IM="\u2267\u0338",OM="\u2A7E\u0338",FM="\u2A7E\u0338",BM="\u22D9\u0338",$M="\u2275",PM="\u226B\u20D2",zM="\u226F",qM="\u226F",HM="\u226B\u0338",WM="\u21AE",UM="\u21CE",jM="\u2AF2",VM="\u220B",GM="\u22FC",ZM="\u22FA",KM="\u220B",XM="\u040A",YM="\u045A",JM="\u219A",QM="\u21CD",e3="\u2025",t3="\u2266\u0338",n3="\u2270",i3="\u219A",r3="\u21CD",s3="\u21AE",o3="\u21CE",a3="\u2270",l3="\u2266\u0338",c3="\u2A7D\u0338",u3="\u2A7D\u0338",d3="\u226E",f3="\u22D8\u0338",h3="\u2274",p3="\u226A\u20D2",g3="\u226E",m3="\u22EA",v3="\u22EC",b3="\u226A\u0338",y3="\u2224",_3="\u2060",w3="\xA0",x3="\u{1D55F}",k3="\u2115",E3="\u2AEC",C3="\xAC",S3="\u2262",A3="\u226D",T3="\u2226",N3="\u2209",D3="\u2260",R3="\u2242\u0338",M3="\u2204",L3="\u226F",I3="\u2271",O3="\u2267\u0338",F3="\u226B\u0338",B3="\u2279",$3="\u2A7E\u0338",P3="\u2275",z3="\u224E\u0338",q3="\u224F\u0338",H3="\u2209",W3="\u22F5\u0338",U3="\u22F9\u0338",j3="\u2209",V3="\u22F7",G3="\u22F6",Z3="\u29CF\u0338",K3="\u22EA",X3="\u22EC",Y3="\u226E",J3="\u2270",Q3="\u2278",eL="\u226A\u0338",tL="\u2A7D\u0338",nL="\u2274",iL="\u2AA2\u0338",rL="\u2AA1\u0338",sL="\u220C",oL="\u220C",aL="\u22FE",lL="\u22FD",cL="\u2280",uL="\u2AAF\u0338",dL="\u22E0",fL="\u220C",hL="\u29D0\u0338",pL="\u22EB",gL="\u22ED",mL="\u228F\u0338",vL="\u22E2",bL="\u2290\u0338",yL="\u22E3",_L="\u2282\u20D2",wL="\u2288",xL="\u2281",kL="\u2AB0\u0338",EL="\u22E1",CL="\u227F\u0338",SL="\u2283\u20D2",AL="\u2289",TL="\u2241",NL="\u2244",DL="\u2247",RL="\u2249",ML="\u2224",LL="\u2226",IL="\u2226",OL="\u2AFD\u20E5",FL="\u2202\u0338",BL="\u2A14",$L="\u2280",PL="\u22E0",zL="\u2280",qL="\u2AAF\u0338",HL="\u2AAF\u0338",WL="\u2933\u0338",UL="\u219B",jL="\u21CF",VL="\u219D\u0338",GL="\u219B",ZL="\u21CF",KL="\u22EB",XL="\u22ED",YL="\u2281",JL="\u22E1",QL="\u2AB0\u0338",eI="\u{1D4A9}",tI="\u{1D4C3}",nI="\u2224",iI="\u2226",rI="\u2241",sI="\u2244",oI="\u2244",aI="\u2224",lI="\u2226",cI="\u22E2",uI="\u22E3",dI="\u2284",fI="\u2AC5\u0338",hI="\u2288",pI="\u2282\u20D2",gI="\u2288",mI="\u2AC5\u0338",vI="\u2281",bI="\u2AB0\u0338",yI="\u2285",_I="\u2AC6\u0338",wI="\u2289",xI="\u2283\u20D2",kI="\u2289",EI="\u2AC6\u0338",CI="\u2279",SI="\xD1",AI="\xF1",TI="\u2278",NI="\u22EA",DI="\u22EC",RI="\u22EB",MI="\u22ED",LI="\u039D",II="\u03BD",OI="#",FI="\u2116",BI="\u2007",$I="\u224D\u20D2",PI="\u22AC",zI="\u22AD",qI="\u22AE",HI="\u22AF",WI="\u2265\u20D2",UI=">\u20D2",jI="\u2904",VI="\u29DE",GI="\u2902",ZI="\u2264\u20D2",KI="<\u20D2",XI="\u22B4\u20D2",YI="\u2903",JI="\u22B5\u20D2",QI="\u223C\u20D2",eO="\u2923",tO="\u2196",nO="\u21D6",iO="\u2196",rO="\u2927",sO="\xD3",oO="\xF3",aO="\u229B",lO="\xD4",cO="\xF4",uO="\u229A",dO="\u041E",fO="\u043E",hO="\u229D",pO="\u0150",gO="\u0151",mO="\u2A38",vO="\u2299",bO="\u29BC",yO="\u0152",_O="\u0153",wO="\u29BF",xO="\u{1D512}",kO="\u{1D52C}",EO="\u02DB",CO="\xD2",SO="\xF2",AO="\u29C1",TO="\u29B5",NO="\u03A9",DO="\u222E",RO="\u21BA",MO="\u29BE",LO="\u29BB",IO="\u203E",OO="\u29C0",FO="\u014C",BO="\u014D",$O="\u03A9",PO="\u03C9",zO="\u039F",qO="\u03BF",HO="\u29B6",WO="\u2296",UO="\u{1D546}",jO="\u{1D560}",VO="\u29B7",GO="\u201C",ZO="\u2018",KO="\u29B9",XO="\u2295",YO="\u21BB",JO="\u2A54",QO="\u2228",e6="\u2A5D",t6="\u2134",n6="\u2134",i6="\xAA",r6="\xBA",s6="\u22B6",o6="\u2A56",a6="\u2A57",l6="\u2A5B",c6="\u24C8",u6="\u{1D4AA}",d6="\u2134",f6="\xD8",h6="\xF8",p6="\u2298",g6="\xD5",m6="\xF5",v6="\u2A36",b6="\u2A37",y6="\u2297",_6="\xD6",w6="\xF6",x6="\u233D",k6="\u203E",E6="\u23DE",C6="\u23B4",S6="\u23DC",A6="\xB6",T6="\u2225",N6="\u2225",D6="\u2AF3",R6="\u2AFD",M6="\u2202",L6="\u2202",I6="\u041F",O6="\u043F",F6="%",B6=".",$6="\u2030",P6="\u22A5",z6="\u2031",q6="\u{1D513}",H6="\u{1D52D}",W6="\u03A6",U6="\u03C6",j6="\u03D5",V6="\u2133",G6="\u260E",Z6="\u03A0",K6="\u03C0",X6="\u22D4",Y6="\u03D6",J6="\u210F",Q6="\u210E",eF="\u210F",tF="\u2A23",nF="\u229E",iF="\u2A22",rF="+",sF="\u2214",oF="\u2A25",aF="\u2A72",lF="\xB1",cF="\xB1",uF="\u2A26",dF="\u2A27",fF="\xB1",hF="\u210C",pF="\u2A15",gF="\u{1D561}",mF="\u2119",vF="\xA3",bF="\u2AB7",yF="\u2ABB",_F="\u227A",wF="\u227C",xF="\u2AB7",kF="\u227A",EF="\u227C",CF="\u227A",SF="\u2AAF",AF="\u227C",TF="\u227E",NF="\u2AAF",DF="\u2AB9",RF="\u2AB5",MF="\u22E8",LF="\u2AAF",IF="\u2AB3",OF="\u227E",FF="\u2032",BF="\u2033",$F="\u2119",PF="\u2AB9",zF="\u2AB5",qF="\u22E8",HF="\u220F",WF="\u220F",UF="\u232E",jF="\u2312",VF="\u2313",GF="\u221D",ZF="\u221D",KF="\u2237",XF="\u221D",YF="\u227E",JF="\u22B0",QF="\u{1D4AB}",eB="\u{1D4C5}",tB="\u03A8",nB="\u03C8",iB="\u2008",rB="\u{1D514}",sB="\u{1D52E}",oB="\u2A0C",aB="\u{1D562}",lB="\u211A",cB="\u2057",uB="\u{1D4AC}",dB="\u{1D4C6}",fB="\u210D",hB="\u2A16",pB="?",gB="\u225F",mB='"',vB='"',bB="\u21DB",yB="\u223D\u0331",_B="\u0154",wB="\u0155",xB="\u221A",kB="\u29B3",EB="\u27E9",CB="\u27EB",SB="\u2992",AB="\u29A5",TB="\u27E9",NB="\xBB",DB="\u2975",RB="\u21E5",MB="\u2920",LB="\u2933",IB="\u2192",OB="\u21A0",FB="\u21D2",BB="\u291E",$B="\u21AA",PB="\u21AC",zB="\u2945",qB="\u2974",HB="\u2916",WB="\u21A3",UB="\u219D",jB="\u291A",VB="\u291C",GB="\u2236",ZB="\u211A",KB="\u290D",XB="\u290F",YB="\u2910",JB="\u2773",QB="}",e4="]",t4="\u298C",n4="\u298E",i4="\u2990",r4="\u0158",s4="\u0159",o4="\u0156",a4="\u0157",l4="\u2309",c4="}",u4="\u0420",d4="\u0440",f4="\u2937",h4="\u2969",p4="\u201D",g4="\u201D",m4="\u21B3",v4="\u211C",b4="\u211B",y4="\u211C",_4="\u211D",w4="\u211C",x4="\u25AD",k4="\xAE",E4="\xAE",C4="\u220B",S4="\u21CB",A4="\u296F",T4="\u297D",N4="\u230B",D4="\u{1D52F}",R4="\u211C",M4="\u2964",L4="\u21C1",I4="\u21C0",O4="\u296C",F4="\u03A1",B4="\u03C1",$4="\u03F1",P4="\u27E9",z4="\u21E5",q4="\u2192",H4="\u2192",W4="\u21D2",U4="\u21C4",j4="\u21A3",V4="\u2309",G4="\u27E7",Z4="\u295D",K4="\u2955",X4="\u21C2",Y4="\u230B",J4="\u21C1",Q4="\u21C0",e8="\u21C4",t8="\u21CC",n8="\u21C9",i8="\u219D",r8="\u21A6",s8="\u22A2",o8="\u295B",a8="\u22CC",l8="\u29D0",c8="\u22B3",u8="\u22B5",d8="\u294F",f8="\u295C",h8="\u2954",p8="\u21BE",g8="\u2953",m8="\u21C0",v8="\u02DA",b8="\u2253",y8="\u21C4",_8="\u21CC",w8="\u200F",x8="\u23B1",k8="\u23B1",E8="\u2AEE",C8="\u27ED",S8="\u21FE",A8="\u27E7",T8="\u2986",N8="\u{1D563}",D8="\u211D",R8="\u2A2E",M8="\u2A35",L8="\u2970",I8=")",O8="\u2994",F8="\u2A12",B8="\u21C9",$8="\u21DB",P8="\u203A",z8="\u{1D4C7}",q8="\u211B",H8="\u21B1",W8="\u21B1",U8="]",j8="\u2019",V8="\u2019",G8="\u22CC",Z8="\u22CA",K8="\u25B9",X8="\u22B5",Y8="\u25B8",J8="\u29CE",Q8="\u29F4",e7="\u2968",t7="\u211E",n7="\u015A",i7="\u015B",r7="\u201A",s7="\u2AB8",o7="\u0160",a7="\u0161",l7="\u2ABC",c7="\u227B",u7="\u227D",d7="\u2AB0",f7="\u2AB4",h7="\u015E",p7="\u015F",g7="\u015C",m7="\u015D",v7="\u2ABA",b7="\u2AB6",y7="\u22E9",_7="\u2A13",w7="\u227F",x7="\u0421",k7="\u0441",E7="\u22A1",C7="\u22C5",S7="\u2A66",A7="\u2925",T7="\u2198",N7="\u21D8",D7="\u2198",R7="\xA7",M7=";",L7="\u2929",I7="\u2216",O7="\u2216",F7="\u2736",B7="\u{1D516}",$7="\u{1D530}",P7="\u2322",z7="\u266F",q7="\u0429",H7="\u0449",W7="\u0428",U7="\u0448",j7="\u2193",V7="\u2190",G7="\u2223",Z7="\u2225",K7="\u2192",X7="\u2191",Y7="\xAD",J7="\u03A3",Q7="\u03C3",e$="\u03C2",t$="\u03C2",n$="\u223C",i$="\u2A6A",r$="\u2243",s$="\u2243",o$="\u2A9E",a$="\u2AA0",l$="\u2A9D",c$="\u2A9F",u$="\u2246",d$="\u2A24",f$="\u2972",h$="\u2190",p$="\u2218",g$="\u2216",m$="\u2A33",v$="\u29E4",b$="\u2223",y$="\u2323",_$="\u2AAA",w$="\u2AAC",x$="\u2AAC\uFE00",k$="\u042C",E$="\u044C",C$="\u233F",S$="\u29C4",A$="/",T$="\u{1D54A}",N$="\u{1D564}",D$="\u2660",R$="\u2660",M$="\u2225",L$="\u2293",I$="\u2293\uFE00",O$="\u2294",F$="\u2294\uFE00",B$="\u221A",$$="\u228F",P$="\u2291",z$="\u228F",q$="\u2291",H$="\u2290",W$="\u2292",U$="\u2290",j$="\u2292",V$="\u25A1",G$="\u25A1",Z$="\u2293",K$="\u228F",X$="\u2291",Y$="\u2290",J$="\u2292",Q$="\u2294",e9="\u25AA",t9="\u25A1",n9="\u25AA",i9="\u2192",r9="\u{1D4AE}",s9="\u{1D4C8}",o9="\u2216",a9="\u2323",l9="\u22C6",c9="\u22C6",u9="\u2606",d9="\u2605",f9="\u03F5",h9="\u03D5",p9="\xAF",g9="\u2282",m9="\u22D0",v9="\u2ABD",b9="\u2AC5",y9="\u2286",_9="\u2AC3",w9="\u2AC1",x9="\u2ACB",k9="\u228A",E9="\u2ABF",C9="\u2979",S9="\u2282",A9="\u22D0",T9="\u2286",N9="\u2AC5",D9="\u2286",R9="\u228A",M9="\u2ACB",L9="\u2AC7",I9="\u2AD5",O9="\u2AD3",F9="\u2AB8",B9="\u227B",$9="\u227D",P9="\u227B",z9="\u2AB0",q9="\u227D",H9="\u227F",W9="\u2AB0",U9="\u2ABA",j9="\u2AB6",V9="\u22E9",G9="\u227F",Z9="\u220B",K9="\u2211",X9="\u2211",Y9="\u266A",J9="\xB9",Q9="\xB2",eP="\xB3",tP="\u2283",nP="\u22D1",iP="\u2ABE",rP="\u2AD8",sP="\u2AC6",oP="\u2287",aP="\u2AC4",lP="\u2283",cP="\u2287",uP="\u27C9",dP="\u2AD7",fP="\u297B",hP="\u2AC2",pP="\u2ACC",gP="\u228B",mP="\u2AC0",vP="\u2283",bP="\u22D1",yP="\u2287",_P="\u2AC6",wP="\u228B",xP="\u2ACC",kP="\u2AC8",EP="\u2AD4",CP="\u2AD6",SP="\u2926",AP="\u2199",TP="\u21D9",NP="\u2199",DP="\u292A",RP="\xDF",MP="	",LP="\u2316",IP="\u03A4",OP="\u03C4",FP="\u23B4",BP="\u0164",$P="\u0165",PP="\u0162",zP="\u0163",qP="\u0422",HP="\u0442",WP="\u20DB",UP="\u2315",jP="\u{1D517}",VP="\u{1D531}",GP="\u2234",ZP="\u2234",KP="\u2234",XP="\u0398",YP="\u03B8",JP="\u03D1",QP="\u03D1",ez="\u2248",tz="\u223C",nz="\u205F\u200A",iz="\u2009",rz="\u2009",sz="\u2248",oz="\u223C",az="\xDE",lz="\xFE",cz="\u02DC",uz="\u223C",dz="\u2243",fz="\u2245",hz="\u2248",pz="\u2A31",gz="\u22A0",mz="\xD7",vz="\u2A30",bz="\u222D",yz="\u2928",_z="\u2336",wz="\u2AF1",xz="\u22A4",kz="\u{1D54B}",Ez="\u{1D565}",Cz="\u2ADA",Sz="\u2929",Az="\u2034",Tz="\u2122",Nz="\u2122",Dz="\u25B5",Rz="\u25BF",Mz="\u25C3",Lz="\u22B4",Iz="\u225C",Oz="\u25B9",Fz="\u22B5",Bz="\u25EC",$z="\u225C",Pz="\u2A3A",zz="\u20DB",qz="\u2A39",Hz="\u29CD",Wz="\u2A3B",Uz="\u23E2",jz="\u{1D4AF}",Vz="\u{1D4C9}",Gz="\u0426",Zz="\u0446",Kz="\u040B",Xz="\u045B",Yz="\u0166",Jz="\u0167",Qz="\u226C",eq="\u219E",tq="\u21A0",nq="\xDA",iq="\xFA",rq="\u2191",sq="\u219F",oq="\u21D1",aq="\u2949",lq="\u040E",cq="\u045E",uq="\u016C",dq="\u016D",fq="\xDB",hq="\xFB",pq="\u0423",gq="\u0443",mq="\u21C5",vq="\u0170",bq="\u0171",yq="\u296E",_q="\u297E",wq="\u{1D518}",xq="\u{1D532}",kq="\xD9",Eq="\xF9",Cq="\u2963",Sq="\u21BF",Aq="\u21BE",Tq="\u2580",Nq="\u231C",Dq="\u231C",Rq="\u230F",Mq="\u25F8",Lq="\u016A",Iq="\u016B",Oq="\xA8",Fq="_",Bq="\u23DF",$q="\u23B5",Pq="\u23DD",zq="\u22C3",qq="\u228E",Hq="\u0172",Wq="\u0173",Uq="\u{1D54C}",jq="\u{1D566}",Vq="\u2912",Gq="\u2191",Zq="\u2191",Kq="\u21D1",Xq="\u21C5",Yq="\u2195",Jq="\u2195",Qq="\u21D5",eH="\u296E",tH="\u21BF",nH="\u21BE",iH="\u228E",rH="\u2196",sH="\u2197",oH="\u03C5",aH="\u03D2",lH="\u03D2",cH="\u03A5",uH="\u03C5",dH="\u21A5",fH="\u22A5",hH="\u21C8",pH="\u231D",gH="\u231D",mH="\u230E",vH="\u016E",bH="\u016F",yH="\u25F9",_H="\u{1D4B0}",wH="\u{1D4CA}",xH="\u22F0",kH="\u0168",EH="\u0169",CH="\u25B5",SH="\u25B4",AH="\u21C8",TH="\xDC",NH="\xFC",DH="\u29A7",RH="\u299C",MH="\u03F5",LH="\u03F0",IH="\u2205",OH="\u03D5",FH="\u03D6",BH="\u221D",$H="\u2195",PH="\u21D5",zH="\u03F1",qH="\u03C2",HH="\u228A\uFE00",WH="\u2ACB\uFE00",UH="\u228B\uFE00",jH="\u2ACC\uFE00",VH="\u03D1",GH="\u22B2",ZH="\u22B3",KH="\u2AE8",XH="\u2AEB",YH="\u2AE9",JH="\u0412",QH="\u0432",eW="\u22A2",tW="\u22A8",nW="\u22A9",iW="\u22AB",rW="\u2AE6",sW="\u22BB",oW="\u2228",aW="\u22C1",lW="\u225A",cW="\u22EE",uW="|",dW="\u2016",fW="|",hW="\u2016",pW="\u2223",gW="|",mW="\u2758",vW="\u2240",bW="\u200A",yW="\u{1D519}",_W="\u{1D533}",wW="\u22B2",xW="\u2282\u20D2",kW="\u2283\u20D2",EW="\u{1D54D}",CW="\u{1D567}",SW="\u221D",AW="\u22B3",TW="\u{1D4B1}",NW="\u{1D4CB}",DW="\u2ACB\uFE00",RW="\u228A\uFE00",MW="\u2ACC\uFE00",LW="\u228B\uFE00",IW="\u22AA",OW="\u299A",FW="\u0174",BW="\u0175",$W="\u2A5F",PW="\u2227",zW="\u22C0",qW="\u2259",HW="\u2118",WW="\u{1D51A}",UW="\u{1D534}",jW="\u{1D54E}",VW="\u{1D568}",GW="\u2118",ZW="\u2240",KW="\u2240",XW="\u{1D4B2}",YW="\u{1D4CC}",JW="\u22C2",QW="\u25EF",eU="\u22C3",tU="\u25BD",nU="\u{1D51B}",iU="\u{1D535}",rU="\u27F7",sU="\u27FA",oU="\u039E",aU="\u03BE",lU="\u27F5",cU="\u27F8",uU="\u27FC",dU="\u22FB",fU="\u2A00",hU="\u{1D54F}",pU="\u{1D569}",gU="\u2A01",mU="\u2A02",vU="\u27F6",bU="\u27F9",yU="\u{1D4B3}",_U="\u{1D4CD}",wU="\u2A06",xU="\u2A04",kU="\u25B3",EU="\u22C1",CU="\u22C0",SU="\xDD",AU="\xFD",TU="\u042F",NU="\u044F",DU="\u0176",RU="\u0177",MU="\u042B",LU="\u044B",IU="\xA5",OU="\u{1D51C}",FU="\u{1D536}",BU="\u0407",$U="\u0457",PU="\u{1D550}",zU="\u{1D56A}",qU="\u{1D4B4}",HU="\u{1D4CE}",WU="\u042E",UU="\u044E",jU="\xFF",VU="\u0178",GU="\u0179",ZU="\u017A",KU="\u017D",XU="\u017E",YU="\u0417",JU="\u0437",QU="\u017B",ej="\u017C",tj="\u2128",nj="\u200B",ij="\u0396",rj="\u03B6",sj="\u{1D537}",oj="\u2128",aj="\u0416",lj="\u0436",cj="\u21DD",uj="\u{1D56B}",dj="\u2124",fj="\u{1D4B5}",hj="\u{1D4CF}",pj="\u200D",gj="\u200C",mj={Aacute:Qg,aacute:em,Abreve:tm,abreve:nm,ac:im,acd:rm,acE:sm,Acirc:om,acirc:am,acute:lm,Acy:cm,acy:um,AElig:dm,aelig:fm,af:hm,Afr:pm,afr:gm,Agrave:mm,agrave:vm,alefsym:bm,aleph:ym,Alpha:_m,alpha:wm,Amacr:xm,amacr:km,amalg:Em,amp:Cm,AMP:Sm,andand:Am,And:Tm,and:Nm,andd:Dm,andslope:Rm,andv:Mm,ang:Lm,ange:Im,angle:Om,angmsdaa:Fm,angmsdab:Bm,angmsdac:$m,angmsdad:Pm,angmsdae:zm,angmsdaf:qm,angmsdag:Hm,angmsdah:Wm,angmsd:Um,angrt:jm,angrtvb:Vm,angrtvbd:Gm,angsph:Zm,angst:Km,angzarr:Xm,Aogon:Ym,aogon:Jm,Aopf:Qm,aopf:ev,apacir:tv,ap:nv,apE:iv,ape:rv,apid:sv,apos:ov,ApplyFunction:av,approx:lv,approxeq:cv,Aring:uv,aring:dv,Ascr:fv,ascr:hv,Assign:pv,ast:gv,asymp:mv,asympeq:vv,Atilde:bv,atilde:yv,Auml:_v,auml:wv,awconint:xv,awint:kv,backcong:Ev,backepsilon:Cv,backprime:Sv,backsim:Av,backsimeq:Tv,Backslash:Nv,Barv:Dv,barvee:Rv,barwed:Mv,Barwed:Lv,barwedge:Iv,bbrk:Ov,bbrktbrk:Fv,bcong:Bv,Bcy:$v,bcy:Pv,bdquo:zv,becaus:qv,because:Hv,Because:Wv,bemptyv:Uv,bepsi:jv,bernou:Vv,Bernoullis:Gv,Beta:Zv,beta:Kv,beth:Xv,between:Yv,Bfr:Jv,bfr:Qv,bigcap:eb,bigcirc:tb,bigcup:nb,bigodot:ib,bigoplus:rb,bigotimes:sb,bigsqcup:ob,bigstar:ab,bigtriangledown:lb,bigtriangleup:cb,biguplus:ub,bigvee:db,bigwedge:fb,bkarow:hb,blacklozenge:pb,blacksquare:gb,blacktriangle:mb,blacktriangledown:vb,blacktriangleleft:bb,blacktriangleright:yb,blank:_b,blk12:wb,blk14:xb,blk34:kb,block:Eb,bne:Cb,bnequiv:Sb,bNot:Ab,bnot:Tb,Bopf:Nb,bopf:Db,bot:Rb,bottom:Mb,bowtie:Lb,boxbox:Ib,boxdl:Ob,boxdL:Fb,boxDl:Bb,boxDL:$b,boxdr:Pb,boxdR:zb,boxDr:qb,boxDR:Hb,boxh:Wb,boxH:Ub,boxhd:jb,boxHd:Vb,boxhD:Gb,boxHD:Zb,boxhu:Kb,boxHu:Xb,boxhU:Yb,boxHU:Jb,boxminus:Qb,boxplus:e0,boxtimes:t0,boxul:n0,boxuL:i0,boxUl:r0,boxUL:s0,boxur:o0,boxuR:a0,boxUr:l0,boxUR:c0,boxv:u0,boxV:d0,boxvh:f0,boxvH:h0,boxVh:p0,boxVH:g0,boxvl:m0,boxvL:v0,boxVl:b0,boxVL:y0,boxvr:_0,boxvR:w0,boxVr:x0,boxVR:k0,bprime:E0,breve:C0,Breve:S0,brvbar:A0,bscr:T0,Bscr:N0,bsemi:D0,bsim:R0,bsime:M0,bsolb:L0,bsol:I0,bsolhsub:O0,bull:F0,bullet:B0,bump:$0,bumpE:P0,bumpe:z0,Bumpeq:q0,bumpeq:H0,Cacute:W0,cacute:U0,capand:j0,capbrcup:V0,capcap:G0,cap:Z0,Cap:K0,capcup:X0,capdot:Y0,CapitalDifferentialD:J0,caps:Q0,caret:ey,caron:ty,Cayleys:ny,ccaps:iy,Ccaron:ry,ccaron:sy,Ccedil:oy,ccedil:ay,Ccirc:ly,ccirc:cy,Cconint:uy,ccups:dy,ccupssm:fy,Cdot:hy,cdot:py,cedil:gy,Cedilla:my,cemptyv:vy,cent:by,centerdot:yy,CenterDot:_y,cfr:wy,Cfr:xy,CHcy:ky,chcy:Ey,check:Cy,checkmark:Sy,Chi:Ay,chi:Ty,circ:Ny,circeq:Dy,circlearrowleft:Ry,circlearrowright:My,circledast:Ly,circledcirc:Iy,circleddash:Oy,CircleDot:Fy,circledR:By,circledS:$y,CircleMinus:Py,CirclePlus:zy,CircleTimes:qy,cir:Hy,cirE:Wy,cire:Uy,cirfnint:jy,cirmid:Vy,cirscir:Gy,ClockwiseContourIntegral:Zy,CloseCurlyDoubleQuote:Ky,CloseCurlyQuote:Xy,clubs:Yy,clubsuit:Jy,colon:Qy,Colon:e_,Colone:t_,colone:n_,coloneq:i_,comma:r_,commat:s_,comp:o_,compfn:a_,complement:l_,complexes:c_,cong:u_,congdot:d_,Congruent:f_,conint:h_,Conint:p_,ContourIntegral:g_,copf:m_,Copf:v_,coprod:b_,Coproduct:y_,copy:__,COPY:w_,copysr:x_,CounterClockwiseContourIntegral:k_,crarr:E_,cross:C_,Cross:S_,Cscr:A_,cscr:T_,csub:N_,csube:D_,csup:R_,csupe:M_,ctdot:L_,cudarrl:I_,cudarrr:O_,cuepr:F_,cuesc:B_,cularr:$_,cularrp:P_,cupbrcap:z_,cupcap:q_,CupCap:H_,cup:W_,Cup:U_,cupcup:j_,cupdot:V_,cupor:G_,cups:Z_,curarr:K_,curarrm:X_,curlyeqprec:Y_,curlyeqsucc:J_,curlyvee:Q_,curlywedge:ew,curren:tw,curvearrowleft:nw,curvearrowright:iw,cuvee:rw,cuwed:sw,cwconint:ow,cwint:aw,cylcty:lw,dagger:cw,Dagger:uw,daleth:dw,darr:fw,Darr:hw,dArr:pw,dash:gw,Dashv:mw,dashv:vw,dbkarow:bw,dblac:yw,Dcaron:_w,dcaron:ww,Dcy:xw,dcy:kw,ddagger:Ew,ddarr:Cw,DD:Sw,dd:Aw,DDotrahd:Tw,ddotseq:Nw,deg:Dw,Del:Rw,Delta:Mw,delta:Lw,demptyv:Iw,dfisht:Ow,Dfr:Fw,dfr:Bw,dHar:$w,dharl:Pw,dharr:zw,DiacriticalAcute:qw,DiacriticalDot:Hw,DiacriticalDoubleAcute:Ww,DiacriticalGrave:Uw,DiacriticalTilde:jw,diam:Vw,diamond:Gw,Diamond:Zw,diamondsuit:Kw,diams:Xw,die:Yw,DifferentialD:Jw,digamma:Qw,disin:e1,div:t1,divide:n1,divideontimes:i1,divonx:r1,DJcy:s1,djcy:o1,dlcorn:a1,dlcrop:l1,dollar:c1,Dopf:u1,dopf:d1,Dot:f1,dot:h1,DotDot:p1,doteq:g1,doteqdot:m1,DotEqual:v1,dotminus:b1,dotplus:y1,dotsquare:_1,doublebarwedge:w1,DoubleContourIntegral:x1,DoubleDot:k1,DoubleDownArrow:E1,DoubleLeftArrow:C1,DoubleLeftRightArrow:S1,DoubleLeftTee:A1,DoubleLongLeftArrow:T1,DoubleLongLeftRightArrow:N1,DoubleLongRightArrow:D1,DoubleRightArrow:R1,DoubleRightTee:M1,DoubleUpArrow:L1,DoubleUpDownArrow:I1,DoubleVerticalBar:O1,DownArrowBar:F1,downarrow:B1,DownArrow:$1,Downarrow:P1,DownArrowUpArrow:z1,DownBreve:q1,downdownarrows:H1,downharpoonleft:W1,downharpoonright:U1,DownLeftRightVector:j1,DownLeftTeeVector:V1,DownLeftVectorBar:G1,DownLeftVector:Z1,DownRightTeeVector:K1,DownRightVectorBar:X1,DownRightVector:Y1,DownTeeArrow:J1,DownTee:Q1,drbkarow:ex,drcorn:tx,drcrop:nx,Dscr:ix,dscr:rx,DScy:sx,dscy:ox,dsol:ax,Dstrok:lx,dstrok:cx,dtdot:ux,dtri:dx,dtrif:fx,duarr:hx,duhar:px,dwangle:gx,DZcy:mx,dzcy:vx,dzigrarr:bx,Eacute:yx,eacute:_x,easter:wx,Ecaron:xx,ecaron:kx,Ecirc:Ex,ecirc:Cx,ecir:Sx,ecolon:Ax,Ecy:Tx,ecy:Nx,eDDot:Dx,Edot:Rx,edot:Mx,eDot:Lx,ee:Ix,efDot:Ox,Efr:Fx,efr:Bx,eg:$x,Egrave:Px,egrave:zx,egs:qx,egsdot:Hx,el:Wx,Element:Ux,elinters:jx,ell:Vx,els:Gx,elsdot:Zx,Emacr:Kx,emacr:Xx,empty:Yx,emptyset:Jx,EmptySmallSquare:Qx,emptyv:ek,EmptyVerySmallSquare:tk,emsp13:nk,emsp14:ik,emsp:rk,ENG:sk,eng:ok,ensp:ak,Eogon:lk,eogon:ck,Eopf:uk,eopf:dk,epar:fk,eparsl:hk,eplus:pk,epsi:gk,Epsilon:mk,epsilon:vk,epsiv:bk,eqcirc:yk,eqcolon:_k,eqsim:wk,eqslantgtr:xk,eqslantless:kk,Equal:Ek,equals:Ck,EqualTilde:Sk,equest:Ak,Equilibrium:Tk,equiv:Nk,equivDD:Dk,eqvparsl:Rk,erarr:Mk,erDot:Lk,escr:Ik,Escr:Ok,esdot:Fk,Esim:Bk,esim:$k,Eta:Pk,eta:zk,ETH:qk,eth:Hk,Euml:Wk,euml:Uk,euro:jk,excl:Vk,exist:Gk,Exists:Zk,expectation:Kk,exponentiale:Xk,ExponentialE:Yk,fallingdotseq:Jk,Fcy:Qk,fcy:eE,female:tE,ffilig:nE,fflig:iE,ffllig:rE,Ffr:sE,ffr:oE,filig:aE,FilledSmallSquare:lE,FilledVerySmallSquare:cE,fjlig:uE,flat:dE,fllig:fE,fltns:hE,fnof:pE,Fopf:gE,fopf:mE,forall:vE,ForAll:bE,fork:yE,forkv:_E,Fouriertrf:wE,fpartint:xE,frac12:kE,frac13:EE,frac14:CE,frac15:SE,frac16:AE,frac18:TE,frac23:NE,frac25:DE,frac34:RE,frac35:ME,frac38:LE,frac45:IE,frac56:OE,frac58:FE,frac78:BE,frasl:$E,frown:PE,fscr:zE,Fscr:qE,gacute:HE,Gamma:WE,gamma:UE,Gammad:jE,gammad:VE,gap:GE,Gbreve:ZE,gbreve:KE,Gcedil:XE,Gcirc:YE,gcirc:JE,Gcy:QE,gcy:eC,Gdot:tC,gdot:nC,ge:iC,gE:rC,gEl:sC,gel:oC,geq:aC,geqq:lC,geqslant:cC,gescc:uC,ges:dC,gesdot:fC,gesdoto:hC,gesdotol:pC,gesl:gC,gesles:mC,Gfr:vC,gfr:bC,gg:yC,Gg:_C,ggg:wC,gimel:xC,GJcy:kC,gjcy:EC,gla:CC,gl:SC,glE:AC,glj:TC,gnap:NC,gnapprox:DC,gne:RC,gnE:MC,gneq:LC,gneqq:IC,gnsim:OC,Gopf:FC,gopf:BC,grave:$C,GreaterEqual:PC,GreaterEqualLess:zC,GreaterFullEqual:qC,GreaterGreater:HC,GreaterLess:WC,GreaterSlantEqual:UC,GreaterTilde:jC,Gscr:VC,gscr:GC,gsim:ZC,gsime:KC,gsiml:XC,gtcc:YC,gtcir:JC,gt:QC,GT:eS,Gt:tS,gtdot:nS,gtlPar:iS,gtquest:rS,gtrapprox:sS,gtrarr:oS,gtrdot:aS,gtreqless:lS,gtreqqless:cS,gtrless:uS,gtrsim:dS,gvertneqq:fS,gvnE:hS,Hacek:pS,hairsp:gS,half:mS,hamilt:vS,HARDcy:bS,hardcy:yS,harrcir:_S,harr:wS,hArr:xS,harrw:kS,Hat:ES,hbar:CS,Hcirc:SS,hcirc:AS,hearts:TS,heartsuit:NS,hellip:DS,hercon:RS,hfr:MS,Hfr:LS,HilbertSpace:IS,hksearow:OS,hkswarow:FS,hoarr:BS,homtht:$S,hookleftarrow:PS,hookrightarrow:zS,hopf:qS,Hopf:HS,horbar:WS,HorizontalLine:US,hscr:jS,Hscr:VS,hslash:GS,Hstrok:ZS,hstrok:KS,HumpDownHump:XS,HumpEqual:YS,hybull:JS,hyphen:QS,Iacute:eA,iacute:tA,ic:nA,Icirc:iA,icirc:rA,Icy:sA,icy:oA,Idot:aA,IEcy:lA,iecy:cA,iexcl:uA,iff:dA,ifr:fA,Ifr:hA,Igrave:pA,igrave:gA,ii:mA,iiiint:vA,iiint:bA,iinfin:yA,iiota:_A,IJlig:wA,ijlig:xA,Imacr:kA,imacr:EA,image:CA,ImaginaryI:SA,imagline:AA,imagpart:TA,imath:NA,Im:DA,imof:RA,imped:MA,Implies:LA,incare:IA,in:"\u2208",infin:OA,infintie:FA,inodot:BA,intcal:$A,int:PA,Int:zA,integers:qA,Integral:HA,intercal:WA,Intersection:UA,intlarhk:jA,intprod:VA,InvisibleComma:GA,InvisibleTimes:ZA,IOcy:KA,iocy:XA,Iogon:YA,iogon:JA,Iopf:QA,iopf:e2,Iota:t2,iota:n2,iprod:i2,iquest:r2,iscr:s2,Iscr:o2,isin:a2,isindot:l2,isinE:c2,isins:u2,isinsv:d2,isinv:f2,it:h2,Itilde:p2,itilde:g2,Iukcy:m2,iukcy:v2,Iuml:b2,iuml:y2,Jcirc:_2,jcirc:w2,Jcy:x2,jcy:k2,Jfr:E2,jfr:C2,jmath:S2,Jopf:A2,jopf:T2,Jscr:N2,jscr:D2,Jsercy:R2,jsercy:M2,Jukcy:L2,jukcy:I2,Kappa:O2,kappa:F2,kappav:B2,Kcedil:$2,kcedil:P2,Kcy:z2,kcy:q2,Kfr:H2,kfr:W2,kgreen:U2,KHcy:j2,khcy:V2,KJcy:G2,kjcy:Z2,Kopf:K2,kopf:X2,Kscr:Y2,kscr:J2,lAarr:Q2,Lacute:eT,lacute:tT,laemptyv:nT,lagran:iT,Lambda:rT,lambda:sT,lang:oT,Lang:aT,langd:lT,langle:cT,lap:uT,Laplacetrf:dT,laquo:fT,larrb:hT,larrbfs:pT,larr:gT,Larr:mT,lArr:vT,larrfs:bT,larrhk:yT,larrlp:_T,larrpl:wT,larrsim:xT,larrtl:kT,latail:ET,lAtail:CT,lat:ST,late:AT,lates:TT,lbarr:NT,lBarr:DT,lbbrk:RT,lbrace:MT,lbrack:LT,lbrke:IT,lbrksld:OT,lbrkslu:FT,Lcaron:BT,lcaron:$T,Lcedil:PT,lcedil:zT,lceil:qT,lcub:HT,Lcy:WT,lcy:UT,ldca:jT,ldquo:VT,ldquor:GT,ldrdhar:ZT,ldrushar:KT,ldsh:XT,le:YT,lE:JT,LeftAngleBracket:QT,LeftArrowBar:e5,leftarrow:t5,LeftArrow:n5,Leftarrow:i5,LeftArrowRightArrow:r5,leftarrowtail:s5,LeftCeiling:o5,LeftDoubleBracket:a5,LeftDownTeeVector:l5,LeftDownVectorBar:c5,LeftDownVector:u5,LeftFloor:d5,leftharpoondown:f5,leftharpoonup:h5,leftleftarrows:p5,leftrightarrow:g5,LeftRightArrow:m5,Leftrightarrow:v5,leftrightarrows:b5,leftrightharpoons:y5,leftrightsquigarrow:_5,LeftRightVector:w5,LeftTeeArrow:x5,LeftTee:k5,LeftTeeVector:E5,leftthreetimes:C5,LeftTriangleBar:S5,LeftTriangle:A5,LeftTriangleEqual:T5,LeftUpDownVector:N5,LeftUpTeeVector:D5,LeftUpVectorBar:R5,LeftUpVector:M5,LeftVectorBar:L5,LeftVector:I5,lEg:O5,leg:F5,leq:B5,leqq:$5,leqslant:P5,lescc:z5,les:q5,lesdot:H5,lesdoto:W5,lesdotor:U5,lesg:j5,lesges:V5,lessapprox:G5,lessdot:Z5,lesseqgtr:K5,lesseqqgtr:X5,LessEqualGreater:Y5,LessFullEqual:J5,LessGreater:Q5,lessgtr:eN,LessLess:tN,lesssim:nN,LessSlantEqual:iN,LessTilde:rN,lfisht:sN,lfloor:oN,Lfr:aN,lfr:lN,lg:cN,lgE:uN,lHar:dN,lhard:fN,lharu:hN,lharul:pN,lhblk:gN,LJcy:mN,ljcy:vN,llarr:bN,ll:yN,Ll:_N,llcorner:wN,Lleftarrow:xN,llhard:kN,lltri:EN,Lmidot:CN,lmidot:SN,lmoustache:AN,lmoust:TN,lnap:NN,lnapprox:DN,lne:RN,lnE:MN,lneq:LN,lneqq:IN,lnsim:ON,loang:FN,loarr:BN,lobrk:$N,longleftarrow:PN,LongLeftArrow:zN,Longleftarrow:qN,longleftrightarrow:HN,LongLeftRightArrow:WN,Longleftrightarrow:UN,longmapsto:jN,longrightarrow:VN,LongRightArrow:GN,Longrightarrow:ZN,looparrowleft:KN,looparrowright:XN,lopar:YN,Lopf:JN,lopf:QN,loplus:eD,lotimes:tD,lowast:nD,lowbar:iD,LowerLeftArrow:rD,LowerRightArrow:sD,loz:oD,lozenge:aD,lozf:lD,lpar:cD,lparlt:uD,lrarr:dD,lrcorner:fD,lrhar:hD,lrhard:pD,lrm:gD,lrtri:mD,lsaquo:vD,lscr:bD,Lscr:yD,lsh:_D,Lsh:wD,lsim:xD,lsime:kD,lsimg:ED,lsqb:CD,lsquo:SD,lsquor:AD,Lstrok:TD,lstrok:ND,ltcc:DD,ltcir:RD,lt:MD,LT:LD,Lt:ID,ltdot:OD,lthree:FD,ltimes:BD,ltlarr:$D,ltquest:PD,ltri:zD,ltrie:qD,ltrif:HD,ltrPar:WD,lurdshar:UD,luruhar:jD,lvertneqq:VD,lvnE:GD,macr:ZD,male:KD,malt:XD,maltese:YD,Map:"\u2905",map:JD,mapsto:QD,mapstodown:eR,mapstoleft:tR,mapstoup:nR,marker:iR,mcomma:rR,Mcy:sR,mcy:oR,mdash:aR,mDDot:lR,measuredangle:cR,MediumSpace:uR,Mellintrf:dR,Mfr:fR,mfr:hR,mho:pR,micro:gR,midast:mR,midcir:vR,mid:bR,middot:yR,minusb:_R,minus:wR,minusd:xR,minusdu:kR,MinusPlus:ER,mlcp:CR,mldr:SR,mnplus:AR,models:TR,Mopf:NR,mopf:DR,mp:RR,mscr:MR,Mscr:LR,mstpos:IR,Mu:OR,mu:FR,multimap:BR,mumap:$R,nabla:PR,Nacute:zR,nacute:qR,nang:HR,nap:WR,napE:UR,napid:jR,napos:VR,napprox:GR,natural:ZR,naturals:KR,natur:XR,nbsp:YR,nbump:JR,nbumpe:QR,ncap:eM,Ncaron:tM,ncaron:nM,Ncedil:iM,ncedil:rM,ncong:sM,ncongdot:oM,ncup:aM,Ncy:lM,ncy:cM,ndash:uM,nearhk:dM,nearr:fM,neArr:hM,nearrow:pM,ne:gM,nedot:mM,NegativeMediumSpace:vM,NegativeThickSpace:bM,NegativeThinSpace:yM,NegativeVeryThinSpace:_M,nequiv:wM,nesear:xM,nesim:kM,NestedGreaterGreater:EM,NestedLessLess:CM,NewLine:SM,nexist:AM,nexists:TM,Nfr:NM,nfr:DM,ngE:RM,nge:MM,ngeq:LM,ngeqq:IM,ngeqslant:OM,nges:FM,nGg:BM,ngsim:$M,nGt:PM,ngt:zM,ngtr:qM,nGtv:HM,nharr:WM,nhArr:UM,nhpar:jM,ni:VM,nis:GM,nisd:ZM,niv:KM,NJcy:XM,njcy:YM,nlarr:JM,nlArr:QM,nldr:e3,nlE:t3,nle:n3,nleftarrow:i3,nLeftarrow:r3,nleftrightarrow:s3,nLeftrightarrow:o3,nleq:a3,nleqq:l3,nleqslant:c3,nles:u3,nless:d3,nLl:f3,nlsim:h3,nLt:p3,nlt:g3,nltri:m3,nltrie:v3,nLtv:b3,nmid:y3,NoBreak:_3,NonBreakingSpace:w3,nopf:x3,Nopf:k3,Not:E3,not:C3,NotCongruent:S3,NotCupCap:A3,NotDoubleVerticalBar:T3,NotElement:N3,NotEqual:D3,NotEqualTilde:R3,NotExists:M3,NotGreater:L3,NotGreaterEqual:I3,NotGreaterFullEqual:O3,NotGreaterGreater:F3,NotGreaterLess:B3,NotGreaterSlantEqual:$3,NotGreaterTilde:P3,NotHumpDownHump:z3,NotHumpEqual:q3,notin:H3,notindot:W3,notinE:U3,notinva:j3,notinvb:V3,notinvc:G3,NotLeftTriangleBar:Z3,NotLeftTriangle:K3,NotLeftTriangleEqual:X3,NotLess:Y3,NotLessEqual:J3,NotLessGreater:Q3,NotLessLess:eL,NotLessSlantEqual:tL,NotLessTilde:nL,NotNestedGreaterGreater:iL,NotNestedLessLess:rL,notni:sL,notniva:oL,notnivb:aL,notnivc:lL,NotPrecedes:cL,NotPrecedesEqual:uL,NotPrecedesSlantEqual:dL,NotReverseElement:fL,NotRightTriangleBar:hL,NotRightTriangle:pL,NotRightTriangleEqual:gL,NotSquareSubset:mL,NotSquareSubsetEqual:vL,NotSquareSuperset:bL,NotSquareSupersetEqual:yL,NotSubset:_L,NotSubsetEqual:wL,NotSucceeds:xL,NotSucceedsEqual:kL,NotSucceedsSlantEqual:EL,NotSucceedsTilde:CL,NotSuperset:SL,NotSupersetEqual:AL,NotTilde:TL,NotTildeEqual:NL,NotTildeFullEqual:DL,NotTildeTilde:RL,NotVerticalBar:ML,nparallel:LL,npar:IL,nparsl:OL,npart:FL,npolint:BL,npr:$L,nprcue:PL,nprec:zL,npreceq:qL,npre:HL,nrarrc:WL,nrarr:UL,nrArr:jL,nrarrw:VL,nrightarrow:GL,nRightarrow:ZL,nrtri:KL,nrtrie:XL,nsc:YL,nsccue:JL,nsce:QL,Nscr:eI,nscr:tI,nshortmid:nI,nshortparallel:iI,nsim:rI,nsime:sI,nsimeq:oI,nsmid:aI,nspar:lI,nsqsube:cI,nsqsupe:uI,nsub:dI,nsubE:fI,nsube:hI,nsubset:pI,nsubseteq:gI,nsubseteqq:mI,nsucc:vI,nsucceq:bI,nsup:yI,nsupE:_I,nsupe:wI,nsupset:xI,nsupseteq:kI,nsupseteqq:EI,ntgl:CI,Ntilde:SI,ntilde:AI,ntlg:TI,ntriangleleft:NI,ntrianglelefteq:DI,ntriangleright:RI,ntrianglerighteq:MI,Nu:LI,nu:II,num:OI,numero:FI,numsp:BI,nvap:$I,nvdash:PI,nvDash:zI,nVdash:qI,nVDash:HI,nvge:WI,nvgt:UI,nvHarr:jI,nvinfin:VI,nvlArr:GI,nvle:ZI,nvlt:KI,nvltrie:XI,nvrArr:YI,nvrtrie:JI,nvsim:QI,nwarhk:eO,nwarr:tO,nwArr:nO,nwarrow:iO,nwnear:rO,Oacute:sO,oacute:oO,oast:aO,Ocirc:lO,ocirc:cO,ocir:uO,Ocy:dO,ocy:fO,odash:hO,Odblac:pO,odblac:gO,odiv:mO,odot:vO,odsold:bO,OElig:yO,oelig:_O,ofcir:wO,Ofr:xO,ofr:kO,ogon:EO,Ograve:CO,ograve:SO,ogt:AO,ohbar:TO,ohm:NO,oint:DO,olarr:RO,olcir:MO,olcross:LO,oline:IO,olt:OO,Omacr:FO,omacr:BO,Omega:$O,omega:PO,Omicron:zO,omicron:qO,omid:HO,ominus:WO,Oopf:UO,oopf:jO,opar:VO,OpenCurlyDoubleQuote:GO,OpenCurlyQuote:ZO,operp:KO,oplus:XO,orarr:YO,Or:JO,or:QO,ord:e6,order:t6,orderof:n6,ordf:i6,ordm:r6,origof:s6,oror:o6,orslope:a6,orv:l6,oS:c6,Oscr:u6,oscr:d6,Oslash:f6,oslash:h6,osol:p6,Otilde:g6,otilde:m6,otimesas:v6,Otimes:b6,otimes:y6,Ouml:_6,ouml:w6,ovbar:x6,OverBar:k6,OverBrace:E6,OverBracket:C6,OverParenthesis:S6,para:A6,parallel:T6,par:N6,parsim:D6,parsl:R6,part:M6,PartialD:L6,Pcy:I6,pcy:O6,percnt:F6,period:B6,permil:$6,perp:P6,pertenk:z6,Pfr:q6,pfr:H6,Phi:W6,phi:U6,phiv:j6,phmmat:V6,phone:G6,Pi:Z6,pi:K6,pitchfork:X6,piv:Y6,planck:J6,planckh:Q6,plankv:eF,plusacir:tF,plusb:nF,pluscir:iF,plus:rF,plusdo:sF,plusdu:oF,pluse:aF,PlusMinus:lF,plusmn:cF,plussim:uF,plustwo:dF,pm:fF,Poincareplane:hF,pointint:pF,popf:gF,Popf:mF,pound:vF,prap:bF,Pr:yF,pr:_F,prcue:wF,precapprox:xF,prec:kF,preccurlyeq:EF,Precedes:CF,PrecedesEqual:SF,PrecedesSlantEqual:AF,PrecedesTilde:TF,preceq:NF,precnapprox:DF,precneqq:RF,precnsim:MF,pre:LF,prE:IF,precsim:OF,prime:FF,Prime:BF,primes:$F,prnap:PF,prnE:zF,prnsim:qF,prod:HF,Product:WF,profalar:UF,profline:jF,profsurf:VF,prop:GF,Proportional:ZF,Proportion:KF,propto:XF,prsim:YF,prurel:JF,Pscr:QF,pscr:eB,Psi:tB,psi:nB,puncsp:iB,Qfr:rB,qfr:sB,qint:oB,qopf:aB,Qopf:lB,qprime:cB,Qscr:uB,qscr:dB,quaternions:fB,quatint:hB,quest:pB,questeq:gB,quot:mB,QUOT:vB,rAarr:bB,race:yB,Racute:_B,racute:wB,radic:xB,raemptyv:kB,rang:EB,Rang:CB,rangd:SB,range:AB,rangle:TB,raquo:NB,rarrap:DB,rarrb:RB,rarrbfs:MB,rarrc:LB,rarr:IB,Rarr:OB,rArr:FB,rarrfs:BB,rarrhk:$B,rarrlp:PB,rarrpl:zB,rarrsim:qB,Rarrtl:HB,rarrtl:WB,rarrw:UB,ratail:jB,rAtail:VB,ratio:GB,rationals:ZB,rbarr:KB,rBarr:XB,RBarr:YB,rbbrk:JB,rbrace:QB,rbrack:e4,rbrke:t4,rbrksld:n4,rbrkslu:i4,Rcaron:r4,rcaron:s4,Rcedil:o4,rcedil:a4,rceil:l4,rcub:c4,Rcy:u4,rcy:d4,rdca:f4,rdldhar:h4,rdquo:p4,rdquor:g4,rdsh:m4,real:v4,realine:b4,realpart:y4,reals:_4,Re:w4,rect:x4,reg:k4,REG:E4,ReverseElement:C4,ReverseEquilibrium:S4,ReverseUpEquilibrium:A4,rfisht:T4,rfloor:N4,rfr:D4,Rfr:R4,rHar:M4,rhard:L4,rharu:I4,rharul:O4,Rho:F4,rho:B4,rhov:$4,RightAngleBracket:P4,RightArrowBar:z4,rightarrow:q4,RightArrow:H4,Rightarrow:W4,RightArrowLeftArrow:U4,rightarrowtail:j4,RightCeiling:V4,RightDoubleBracket:G4,RightDownTeeVector:Z4,RightDownVectorBar:K4,RightDownVector:X4,RightFloor:Y4,rightharpoondown:J4,rightharpoonup:Q4,rightleftarrows:e8,rightleftharpoons:t8,rightrightarrows:n8,rightsquigarrow:i8,RightTeeArrow:r8,RightTee:s8,RightTeeVector:o8,rightthreetimes:a8,RightTriangleBar:l8,RightTriangle:c8,RightTriangleEqual:u8,RightUpDownVector:d8,RightUpTeeVector:f8,RightUpVectorBar:h8,RightUpVector:p8,RightVectorBar:g8,RightVector:m8,ring:v8,risingdotseq:b8,rlarr:y8,rlhar:_8,rlm:w8,rmoustache:x8,rmoust:k8,rnmid:E8,roang:C8,roarr:S8,robrk:A8,ropar:T8,ropf:N8,Ropf:D8,roplus:R8,rotimes:M8,RoundImplies:L8,rpar:I8,rpargt:O8,rppolint:F8,rrarr:B8,Rrightarrow:$8,rsaquo:P8,rscr:z8,Rscr:q8,rsh:H8,Rsh:W8,rsqb:U8,rsquo:j8,rsquor:V8,rthree:G8,rtimes:Z8,rtri:K8,rtrie:X8,rtrif:Y8,rtriltri:J8,RuleDelayed:Q8,ruluhar:e7,rx:t7,Sacute:n7,sacute:i7,sbquo:r7,scap:s7,Scaron:o7,scaron:a7,Sc:l7,sc:c7,sccue:u7,sce:d7,scE:f7,Scedil:h7,scedil:p7,Scirc:g7,scirc:m7,scnap:v7,scnE:b7,scnsim:y7,scpolint:_7,scsim:w7,Scy:x7,scy:k7,sdotb:E7,sdot:C7,sdote:S7,searhk:A7,searr:T7,seArr:N7,searrow:D7,sect:R7,semi:M7,seswar:L7,setminus:I7,setmn:O7,sext:F7,Sfr:B7,sfr:$7,sfrown:P7,sharp:z7,SHCHcy:q7,shchcy:H7,SHcy:W7,shcy:U7,ShortDownArrow:j7,ShortLeftArrow:V7,shortmid:G7,shortparallel:Z7,ShortRightArrow:K7,ShortUpArrow:X7,shy:Y7,Sigma:J7,sigma:Q7,sigmaf:e$,sigmav:t$,sim:n$,simdot:i$,sime:r$,simeq:s$,simg:o$,simgE:a$,siml:l$,simlE:c$,simne:u$,simplus:d$,simrarr:f$,slarr:h$,SmallCircle:p$,smallsetminus:g$,smashp:m$,smeparsl:v$,smid:b$,smile:y$,smt:_$,smte:w$,smtes:x$,SOFTcy:k$,softcy:E$,solbar:C$,solb:S$,sol:A$,Sopf:T$,sopf:N$,spades:D$,spadesuit:R$,spar:M$,sqcap:L$,sqcaps:I$,sqcup:O$,sqcups:F$,Sqrt:B$,sqsub:$$,sqsube:P$,sqsubset:z$,sqsubseteq:q$,sqsup:H$,sqsupe:W$,sqsupset:U$,sqsupseteq:j$,square:V$,Square:G$,SquareIntersection:Z$,SquareSubset:K$,SquareSubsetEqual:X$,SquareSuperset:Y$,SquareSupersetEqual:J$,SquareUnion:Q$,squarf:e9,squ:t9,squf:n9,srarr:i9,Sscr:r9,sscr:s9,ssetmn:o9,ssmile:a9,sstarf:l9,Star:c9,star:u9,starf:d9,straightepsilon:f9,straightphi:h9,strns:p9,sub:g9,Sub:m9,subdot:v9,subE:b9,sube:y9,subedot:_9,submult:w9,subnE:x9,subne:k9,subplus:E9,subrarr:C9,subset:S9,Subset:A9,subseteq:T9,subseteqq:N9,SubsetEqual:D9,subsetneq:R9,subsetneqq:M9,subsim:L9,subsub:I9,subsup:O9,succapprox:F9,succ:B9,succcurlyeq:$9,Succeeds:P9,SucceedsEqual:z9,SucceedsSlantEqual:q9,SucceedsTilde:H9,succeq:W9,succnapprox:U9,succneqq:j9,succnsim:V9,succsim:G9,SuchThat:Z9,sum:K9,Sum:X9,sung:Y9,sup1:J9,sup2:Q9,sup3:eP,sup:tP,Sup:nP,supdot:iP,supdsub:rP,supE:sP,supe:oP,supedot:aP,Superset:lP,SupersetEqual:cP,suphsol:uP,suphsub:dP,suplarr:fP,supmult:hP,supnE:pP,supne:gP,supplus:mP,supset:vP,Supset:bP,supseteq:yP,supseteqq:_P,supsetneq:wP,supsetneqq:xP,supsim:kP,supsub:EP,supsup:CP,swarhk:SP,swarr:AP,swArr:TP,swarrow:NP,swnwar:DP,szlig:RP,Tab:MP,target:LP,Tau:IP,tau:OP,tbrk:FP,Tcaron:BP,tcaron:$P,Tcedil:PP,tcedil:zP,Tcy:qP,tcy:HP,tdot:WP,telrec:UP,Tfr:jP,tfr:VP,there4:GP,therefore:ZP,Therefore:KP,Theta:XP,theta:YP,thetasym:JP,thetav:QP,thickapprox:ez,thicksim:tz,ThickSpace:nz,ThinSpace:iz,thinsp:rz,thkap:sz,thksim:oz,THORN:az,thorn:lz,tilde:cz,Tilde:uz,TildeEqual:dz,TildeFullEqual:fz,TildeTilde:hz,timesbar:pz,timesb:gz,times:mz,timesd:vz,tint:bz,toea:yz,topbot:_z,topcir:wz,top:xz,Topf:kz,topf:Ez,topfork:Cz,tosa:Sz,tprime:Az,trade:Tz,TRADE:Nz,triangle:Dz,triangledown:Rz,triangleleft:Mz,trianglelefteq:Lz,triangleq:Iz,triangleright:Oz,trianglerighteq:Fz,tridot:Bz,trie:$z,triminus:Pz,TripleDot:zz,triplus:qz,trisb:Hz,tritime:Wz,trpezium:Uz,Tscr:jz,tscr:Vz,TScy:Gz,tscy:Zz,TSHcy:Kz,tshcy:Xz,Tstrok:Yz,tstrok:Jz,twixt:Qz,twoheadleftarrow:eq,twoheadrightarrow:tq,Uacute:nq,uacute:iq,uarr:rq,Uarr:sq,uArr:oq,Uarrocir:aq,Ubrcy:lq,ubrcy:cq,Ubreve:uq,ubreve:dq,Ucirc:fq,ucirc:hq,Ucy:pq,ucy:gq,udarr:mq,Udblac:vq,udblac:bq,udhar:yq,ufisht:_q,Ufr:wq,ufr:xq,Ugrave:kq,ugrave:Eq,uHar:Cq,uharl:Sq,uharr:Aq,uhblk:Tq,ulcorn:Nq,ulcorner:Dq,ulcrop:Rq,ultri:Mq,Umacr:Lq,umacr:Iq,uml:Oq,UnderBar:Fq,UnderBrace:Bq,UnderBracket:$q,UnderParenthesis:Pq,Union:zq,UnionPlus:qq,Uogon:Hq,uogon:Wq,Uopf:Uq,uopf:jq,UpArrowBar:Vq,uparrow:Gq,UpArrow:Zq,Uparrow:Kq,UpArrowDownArrow:Xq,updownarrow:Yq,UpDownArrow:Jq,Updownarrow:Qq,UpEquilibrium:eH,upharpoonleft:tH,upharpoonright:nH,uplus:iH,UpperLeftArrow:rH,UpperRightArrow:sH,upsi:oH,Upsi:aH,upsih:lH,Upsilon:cH,upsilon:uH,UpTeeArrow:dH,UpTee:fH,upuparrows:hH,urcorn:pH,urcorner:gH,urcrop:mH,Uring:vH,uring:bH,urtri:yH,Uscr:_H,uscr:wH,utdot:xH,Utilde:kH,utilde:EH,utri:CH,utrif:SH,uuarr:AH,Uuml:TH,uuml:NH,uwangle:DH,vangrt:RH,varepsilon:MH,varkappa:LH,varnothing:IH,varphi:OH,varpi:FH,varpropto:BH,varr:$H,vArr:PH,varrho:zH,varsigma:qH,varsubsetneq:HH,varsubsetneqq:WH,varsupsetneq:UH,varsupsetneqq:jH,vartheta:VH,vartriangleleft:GH,vartriangleright:ZH,vBar:KH,Vbar:XH,vBarv:YH,Vcy:JH,vcy:QH,vdash:eW,vDash:tW,Vdash:nW,VDash:iW,Vdashl:rW,veebar:sW,vee:oW,Vee:aW,veeeq:lW,vellip:cW,verbar:uW,Verbar:dW,vert:fW,Vert:hW,VerticalBar:pW,VerticalLine:gW,VerticalSeparator:mW,VerticalTilde:vW,VeryThinSpace:bW,Vfr:yW,vfr:_W,vltri:wW,vnsub:xW,vnsup:kW,Vopf:EW,vopf:CW,vprop:SW,vrtri:AW,Vscr:TW,vscr:NW,vsubnE:DW,vsubne:RW,vsupnE:MW,vsupne:LW,Vvdash:IW,vzigzag:OW,Wcirc:FW,wcirc:BW,wedbar:$W,wedge:PW,Wedge:zW,wedgeq:qW,weierp:HW,Wfr:WW,wfr:UW,Wopf:jW,wopf:VW,wp:GW,wr:ZW,wreath:KW,Wscr:XW,wscr:YW,xcap:JW,xcirc:QW,xcup:eU,xdtri:tU,Xfr:nU,xfr:iU,xharr:rU,xhArr:sU,Xi:oU,xi:aU,xlarr:lU,xlArr:cU,xmap:uU,xnis:dU,xodot:fU,Xopf:hU,xopf:pU,xoplus:gU,xotime:mU,xrarr:vU,xrArr:bU,Xscr:yU,xscr:_U,xsqcup:wU,xuplus:xU,xutri:kU,xvee:EU,xwedge:CU,Yacute:SU,yacute:AU,YAcy:TU,yacy:NU,Ycirc:DU,ycirc:RU,Ycy:MU,ycy:LU,yen:IU,Yfr:OU,yfr:FU,YIcy:BU,yicy:$U,Yopf:PU,yopf:zU,Yscr:qU,yscr:HU,YUcy:WU,yucy:UU,yuml:jU,Yuml:VU,Zacute:GU,zacute:ZU,Zcaron:KU,zcaron:XU,Zcy:YU,zcy:JU,Zdot:QU,zdot:ej,zeetrf:tj,ZeroWidthSpace:nj,Zeta:ij,zeta:rj,zfr:sj,Zfr:oj,ZHcy:aj,zhcy:lj,zigrarr:cj,zopf:uj,Zopf:dj,Zscr:fj,zscr:hj,zwj:pj,zwnj:gj};(function(l){l.exports=mj})(ll);var cl=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4E\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,gr={},yc={};function vj(l){var t,e,n=yc[l];if(n)return n;for(n=yc[l]=[],t=0;t<128;t++)e=String.fromCharCode(t),/^[0-9a-z]$/i.test(e)?n.push(e):n.push("%"+("0"+t.toString(16).toUpperCase()).slice(-2));for(t=0;t<l.length;t++)n[l.charCodeAt(t)]=l[t];return n}function to(l,t,e){var n,i,r,s,o,a="";for(typeof t!="string"&&(e=t,t=to.defaultChars),typeof e>"u"&&(e=!0),o=vj(t),n=0,i=l.length;n<i;n++){if(r=l.charCodeAt(n),e&&r===37&&n+2<i&&/^[0-9a-f]{2}$/i.test(l.slice(n+1,n+3))){a+=l.slice(n,n+3),n+=2;continue}if(r<128){a+=o[r];continue}if(r>=55296&&r<=57343){if(r>=55296&&r<=56319&&n+1<i&&(s=l.charCodeAt(n+1),s>=56320&&s<=57343)){a+=encodeURIComponent(l[n]+l[n+1]),n++;continue}a+="%EF%BF%BD";continue}a+=encodeURIComponent(l[n])}return a}to.defaultChars=";/?:@&=+$,-_.!~*'()#";to.componentChars="-_.!~*'()";var bj=to,_c={};function yj(l){var t,e,n=_c[l];if(n)return n;for(n=_c[l]=[],t=0;t<128;t++)e=String.fromCharCode(t),n.push(e);for(t=0;t<l.length;t++)e=l.charCodeAt(t),n[e]="%"+("0"+e.toString(16).toUpperCase()).slice(-2);return n}function no(l,t){var e;return typeof t!="string"&&(t=no.defaultChars),e=yj(t),l.replace(/(%[a-f0-9]{2})+/gi,function(n){var i,r,s,o,a,c,u,d="";for(i=0,r=n.length;i<r;i+=3){if(s=parseInt(n.slice(i+1,i+3),16),s<128){d+=e[s];continue}if((s&224)===192&&i+3<r&&(o=parseInt(n.slice(i+4,i+6),16),(o&192)===128)){u=s<<6&1984|o&63,u<128?d+="\uFFFD\uFFFD":d+=String.fromCharCode(u),i+=3;continue}if((s&240)===224&&i+6<r&&(o=parseInt(n.slice(i+4,i+6),16),a=parseInt(n.slice(i+7,i+9),16),(o&192)===128&&(a&192)===128)){u=s<<12&61440|o<<6&4032|a&63,u<2048||u>=55296&&u<=57343?d+="\uFFFD\uFFFD\uFFFD":d+=String.fromCharCode(u),i+=6;continue}if((s&248)===240&&i+9<r&&(o=parseInt(n.slice(i+4,i+6),16),a=parseInt(n.slice(i+7,i+9),16),c=parseInt(n.slice(i+10,i+12),16),(o&192)===128&&(a&192)===128&&(c&192)===128)){u=s<<18&1835008|o<<12&258048|a<<6&4032|c&63,u<65536||u>1114111?d+="\uFFFD\uFFFD\uFFFD\uFFFD":(u-=65536,d+=String.fromCharCode(55296+(u>>10),56320+(u&1023))),i+=9;continue}d+="\uFFFD"}return d})}no.defaultChars=";/?:@&=+$,#";no.componentChars="";var _j=no,wj=function(t){var e="";return e+=t.protocol||"",e+=t.slashes?"//":"",e+=t.auth?t.auth+"@":"",t.hostname&&t.hostname.indexOf(":")!==-1?e+="["+t.hostname+"]":e+=t.hostname||"",e+=t.port?":"+t.port:"",e+=t.pathname||"",e+=t.search||"",e+=t.hash||"",e};function qs(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}var xj=/^([a-z0-9.+-]+:)/i,kj=/:[0-9]*$/,Ej=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Cj=["<",">",'"',"`"," ","\r",`
`,"	"],Sj=["{","}","|","\\","^","`"].concat(Cj),Aj=["'"].concat(Sj),wc=["%","/","?",";","#"].concat(Aj),xc=["/","?","#"],Tj=255,kc=/^[+a-z0-9A-Z_-]{0,63}$/,Nj=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Ec={javascript:!0,"javascript:":!0},Cc={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Dj(l,t){if(l&&l instanceof qs)return l;var e=new qs;return e.parse(l,t),e}qs.prototype.parse=function(l,t){var e,n,i,r,s,o=l;if(o=o.trim(),!t&&l.split("#").length===1){var a=Ej.exec(o);if(a)return this.pathname=a[1],a[2]&&(this.search=a[2]),this}var c=xj.exec(o);if(c&&(c=c[0],i=c.toLowerCase(),this.protocol=c,o=o.substr(c.length)),(t||c||o.match(/^\/\/[^@\/]+@[^@\/]+/))&&(s=o.substr(0,2)==="//",s&&!(c&&Ec[c])&&(o=o.substr(2),this.slashes=!0)),!Ec[c]&&(s||c&&!Cc[c])){var u=-1;for(e=0;e<xc.length;e++)r=o.indexOf(xc[e]),r!==-1&&(u===-1||r<u)&&(u=r);var d,h;for(u===-1?h=o.lastIndexOf("@"):h=o.lastIndexOf("@",u),h!==-1&&(d=o.slice(0,h),o=o.slice(h+1),this.auth=d),u=-1,e=0;e<wc.length;e++)r=o.indexOf(wc[e]),r!==-1&&(u===-1||r<u)&&(u=r);u===-1&&(u=o.length),o[u-1]===":"&&u--;var f=o.slice(0,u);o=o.slice(u),this.parseHost(f),this.hostname=this.hostname||"";var p=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!p){var g=this.hostname.split(/\./);for(e=0,n=g.length;e<n;e++){var m=g[e];if(!!m&&!m.match(kc)){for(var v="",b=0,_=m.length;b<_;b++)m.charCodeAt(b)>127?v+="x":v+=m[b];if(!v.match(kc)){var x=g.slice(0,e),w=g.slice(e+1),E=m.match(Nj);E&&(x.push(E[1]),w.unshift(E[2])),w.length&&(o=w.join(".")+o),this.hostname=x.join(".");break}}}}this.hostname.length>Tj&&(this.hostname=""),p&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}var S=o.indexOf("#");S!==-1&&(this.hash=o.substr(S),o=o.slice(0,S));var R=o.indexOf("?");return R!==-1&&(this.search=o.substr(R),o=o.slice(0,R)),o&&(this.pathname=o),Cc[i]&&this.hostname&&!this.pathname&&(this.pathname=""),this};qs.prototype.parseHost=function(l){var t=kj.exec(l);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),l=l.substr(0,l.length-t.length)),l&&(this.hostname=l)};var Rj=Dj;gr.encode=bj;gr.decode=_j;gr.format=wj;gr.parse=Rj;var Ei={},ea,Sc;function ih(){return Sc||(Sc=1,ea=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/),ea}var ta,Ac;function rh(){return Ac||(Ac=1,ta=/[\0-\x1F\x7F-\x9F]/),ta}var na,Tc;function Mj(){return Tc||(Tc=1,na=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/),na}var ia,Nc;function sh(){return Nc||(Nc=1,ia=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/),ia}var Dc;function Lj(){return Dc||(Dc=1,Ei.Any=ih(),Ei.Cc=rh(),Ei.Cf=Mj(),Ei.P=cl,Ei.Z=sh()),Ei}(function(l){function t(A){return Object.prototype.toString.call(A)}function e(A){return t(A)==="[object String]"}var n=Object.prototype.hasOwnProperty;function i(A,F){return n.call(A,F)}function r(A){var F=Array.prototype.slice.call(arguments,1);return F.forEach(function(W){if(!!W){if(typeof W!="object")throw new TypeError(W+"must be object");Object.keys(W).forEach(function(G){A[G]=W[G]})}}),A}function s(A,F,W){return[].concat(A.slice(0,F),W,A.slice(F+1))}function o(A){return!(A>=55296&&A<=57343||A>=64976&&A<=65007||(A&65535)===65535||(A&65535)===65534||A>=0&&A<=8||A===11||A>=14&&A<=31||A>=127&&A<=159||A>1114111)}function a(A){if(A>65535){A-=65536;var F=55296+(A>>10),W=56320+(A&1023);return String.fromCharCode(F,W)}return String.fromCharCode(A)}var c=/\\([!"#$%&'()*+,\-.\/:;<=>?@[\\\]^_`{|}~])/g,u=/&([a-z#][a-z0-9]{1,31});/gi,d=new RegExp(c.source+"|"+u.source,"gi"),h=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i,f=ll.exports;function p(A,F){var W=0;return i(f,F)?f[F]:F.charCodeAt(0)===35&&h.test(F)&&(W=F[1].toLowerCase()==="x"?parseInt(F.slice(2),16):parseInt(F.slice(1),10),o(W))?a(W):A}function g(A){return A.indexOf("\\")<0?A:A.replace(c,"$1")}function m(A){return A.indexOf("\\")<0&&A.indexOf("&")<0?A:A.replace(d,function(F,W,G){return W||p(F,G)})}var v=/[&<>"]/,b=/[&<>"]/g,_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function x(A){return _[A]}function w(A){return v.test(A)?A.replace(b,x):A}var E=/[.?*+^$[\]\\(){}|-]/g;function S(A){return A.replace(E,"\\$&")}function R(A){switch(A){case 9:case 32:return!0}return!1}function D(A){if(A>=8192&&A<=8202)return!0;switch(A){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}var P=cl;function O(A){return P.test(A)}function L(A){switch(A){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function B(A){return A=A.trim().replace(/\s+/g," "),"\u1E9E".toLowerCase()==="\u1E7E"&&(A=A.replace(/ẞ/g,"\xDF")),A.toLowerCase().toUpperCase()}l.lib={},l.lib.mdurl=gr,l.lib.ucmicro=Lj(),l.assign=r,l.isString=e,l.has=i,l.unescapeMd=g,l.unescapeAll=m,l.isValidEntityCode=o,l.fromCodePoint=a,l.escapeHtml=w,l.arrayReplaceAt=s,l.isSpace=R,l.isWhiteSpace=D,l.isMdAsciiPunct=L,l.isPunctChar=O,l.escapeRE=S,l.normalizeReference=B})(Xe);var io={},Ij=function(t,e,n){var i,r,s,o,a=-1,c=t.posMax,u=t.pos;for(t.pos=e+1,i=1;t.pos<c;){if(s=t.src.charCodeAt(t.pos),s===93&&(i--,i===0)){r=!0;break}if(o=t.pos,t.md.inline.skipToken(t),s===91){if(o===t.pos-1)i++;else if(n)return t.pos=u,-1}}return r&&(a=t.pos),t.pos=u,a},Rc=Xe.unescapeAll,Oj=function(t,e,n){var i,r,s=0,o=e,a={ok:!1,pos:0,lines:0,str:""};if(t.charCodeAt(e)===60){for(e++;e<n;){if(i=t.charCodeAt(e),i===10||i===60)return a;if(i===62)return a.pos=e+1,a.str=Rc(t.slice(o+1,e)),a.ok=!0,a;if(i===92&&e+1<n){e+=2;continue}e++}return a}for(r=0;e<n&&(i=t.charCodeAt(e),!(i===32||i<32||i===127));){if(i===92&&e+1<n){if(t.charCodeAt(e+1)===32)break;e+=2;continue}if(i===40&&(r++,r>32))return a;if(i===41){if(r===0)break;r--}e++}return o===e||r!==0||(a.str=Rc(t.slice(o,e)),a.lines=s,a.pos=e,a.ok=!0),a},Fj=Xe.unescapeAll,Bj=function(t,e,n){var i,r,s=0,o=e,a={ok:!1,pos:0,lines:0,str:""};if(e>=n||(r=t.charCodeAt(e),r!==34&&r!==39&&r!==40))return a;for(e++,r===40&&(r=41);e<n;){if(i=t.charCodeAt(e),i===r)return a.pos=e+1,a.lines=s,a.str=Fj(t.slice(o+1,e)),a.ok=!0,a;if(i===40&&r===41)return a;i===10?s++:i===92&&e+1<n&&(e++,t.charCodeAt(e)===10&&s++),e++}return a};io.parseLinkLabel=Ij;io.parseLinkDestination=Oj;io.parseLinkTitle=Bj;var $j=Xe.assign,Pj=Xe.unescapeAll,Ii=Xe.escapeHtml,Rn={};Rn.code_inline=function(l,t,e,n,i){var r=l[t];return"<code"+i.renderAttrs(r)+">"+Ii(l[t].content)+"</code>"};Rn.code_block=function(l,t,e,n,i){var r=l[t];return"<pre"+i.renderAttrs(r)+"><code>"+Ii(l[t].content)+`</code></pre>
`};Rn.fence=function(l,t,e,n,i){var r=l[t],s=r.info?Pj(r.info).trim():"",o="",a="",c,u,d,h,f;return s&&(d=s.split(/(\s+)/g),o=d[0],a=d.slice(2).join("")),e.highlight?c=e.highlight(r.content,o,a)||Ii(r.content):c=Ii(r.content),c.indexOf("<pre")===0?c+`
`:s?(u=r.attrIndex("class"),h=r.attrs?r.attrs.slice():[],u<0?h.push(["class",e.langPrefix+o]):(h[u]=h[u].slice(),h[u][1]+=" "+e.langPrefix+o),f={attrs:h},"<pre><code"+i.renderAttrs(f)+">"+c+`</code></pre>
`):"<pre><code"+i.renderAttrs(r)+">"+c+`</code></pre>
`};Rn.image=function(l,t,e,n,i){var r=l[t];return r.attrs[r.attrIndex("alt")][1]=i.renderInlineAsText(r.children,e,n),i.renderToken(l,t,e)};Rn.hardbreak=function(l,t,e){return e.xhtmlOut?`<br />
`:`<br>
`};Rn.softbreak=function(l,t,e){return e.breaks?e.xhtmlOut?`<br />
`:`<br>
`:`
`};Rn.text=function(l,t){return Ii(l[t].content)};Rn.html_block=function(l,t){return l[t].content};Rn.html_inline=function(l,t){return l[t].content};function mr(){this.rules=$j({},Rn)}mr.prototype.renderAttrs=function(t){var e,n,i;if(!t.attrs)return"";for(i="",e=0,n=t.attrs.length;e<n;e++)i+=" "+Ii(t.attrs[e][0])+'="'+Ii(t.attrs[e][1])+'"';return i};mr.prototype.renderToken=function(t,e,n){var i,r="",s=!1,o=t[e];return o.hidden?"":(o.block&&o.nesting!==-1&&e&&t[e-1].hidden&&(r+=`
`),r+=(o.nesting===-1?"</":"<")+o.tag,r+=this.renderAttrs(o),o.nesting===0&&n.xhtmlOut&&(r+=" /"),o.block&&(s=!0,o.nesting===1&&e+1<t.length&&(i=t[e+1],(i.type==="inline"||i.hidden||i.nesting===-1&&i.tag===o.tag)&&(s=!1))),r+=s?`>
`:">",r)};mr.prototype.renderInline=function(l,t,e){for(var n,i="",r=this.rules,s=0,o=l.length;s<o;s++)n=l[s].type,typeof r[n]<"u"?i+=r[n](l,s,t,e,this):i+=this.renderToken(l,s,t);return i};mr.prototype.renderInlineAsText=function(l,t,e){for(var n="",i=0,r=l.length;i<r;i++)l[i].type==="text"?n+=l[i].content:l[i].type==="image"?n+=this.renderInlineAsText(l[i].children,t,e):l[i].type==="softbreak"&&(n+=`
`);return n};mr.prototype.render=function(l,t,e){var n,i,r,s="",o=this.rules;for(n=0,i=l.length;n<i;n++)r=l[n].type,r==="inline"?s+=this.renderInline(l[n].children,t,e):typeof o[r]<"u"?s+=o[l[n].type](l,n,t,e,this):s+=this.renderToken(l,n,t,e);return s};var zj=mr;function dn(){this.__rules__=[],this.__cache__=null}dn.prototype.__find__=function(l){for(var t=0;t<this.__rules__.length;t++)if(this.__rules__[t].name===l)return t;return-1};dn.prototype.__compile__=function(){var l=this,t=[""];l.__rules__.forEach(function(e){!e.enabled||e.alt.forEach(function(n){t.indexOf(n)<0&&t.push(n)})}),l.__cache__={},t.forEach(function(e){l.__cache__[e]=[],l.__rules__.forEach(function(n){!n.enabled||e&&n.alt.indexOf(e)<0||l.__cache__[e].push(n.fn)})})};dn.prototype.at=function(l,t,e){var n=this.__find__(l),i=e||{};if(n===-1)throw new Error("Parser rule not found: "+l);this.__rules__[n].fn=t,this.__rules__[n].alt=i.alt||[],this.__cache__=null};dn.prototype.before=function(l,t,e,n){var i=this.__find__(l),r=n||{};if(i===-1)throw new Error("Parser rule not found: "+l);this.__rules__.splice(i,0,{name:t,enabled:!0,fn:e,alt:r.alt||[]}),this.__cache__=null};dn.prototype.after=function(l,t,e,n){var i=this.__find__(l),r=n||{};if(i===-1)throw new Error("Parser rule not found: "+l);this.__rules__.splice(i+1,0,{name:t,enabled:!0,fn:e,alt:r.alt||[]}),this.__cache__=null};dn.prototype.push=function(l,t,e){var n=e||{};this.__rules__.push({name:l,enabled:!0,fn:t,alt:n.alt||[]}),this.__cache__=null};dn.prototype.enable=function(l,t){Array.isArray(l)||(l=[l]);var e=[];return l.forEach(function(n){var i=this.__find__(n);if(i<0){if(t)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[i].enabled=!0,e.push(n)},this),this.__cache__=null,e};dn.prototype.enableOnly=function(l,t){Array.isArray(l)||(l=[l]),this.__rules__.forEach(function(e){e.enabled=!1}),this.enable(l,t)};dn.prototype.disable=function(l,t){Array.isArray(l)||(l=[l]);var e=[];return l.forEach(function(n){var i=this.__find__(n);if(i<0){if(t)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[i].enabled=!1,e.push(n)},this),this.__cache__=null,e};dn.prototype.getRules=function(l){return this.__cache__===null&&this.__compile__(),this.__cache__[l]||[]};var ul=dn,qj=/\r\n?|\n/g,Hj=/\0/g,Wj=function(t){var e;e=t.src.replace(qj,`
`),e=e.replace(Hj,"\uFFFD"),t.src=e},Uj=function(t){var e;t.inlineMode?(e=new t.Token("inline","",0),e.content=t.src,e.map=[0,1],e.children=[],t.tokens.push(e)):t.md.block.parse(t.src,t.md,t.env,t.tokens)},jj=function(t){var e=t.tokens,n,i,r;for(i=0,r=e.length;i<r;i++)n=e[i],n.type==="inline"&&t.md.inline.parse(n.content,t.md,t.env,n.children)},Vj=Xe.arrayReplaceAt;function Gj(l){return/^<a[>\s]/i.test(l)}function Zj(l){return/^<\/a\s*>/i.test(l)}var Kj=function(t){var e,n,i,r,s,o,a,c,u,d,h,f,p,g,m,v,b=t.tokens,_;if(!!t.md.options.linkify){for(n=0,i=b.length;n<i;n++)if(!(b[n].type!=="inline"||!t.md.linkify.pretest(b[n].content)))for(r=b[n].children,p=0,e=r.length-1;e>=0;e--){if(o=r[e],o.type==="link_close"){for(e--;r[e].level!==o.level&&r[e].type!=="link_open";)e--;continue}if(o.type==="html_inline"&&(Gj(o.content)&&p>0&&p--,Zj(o.content)&&p++),!(p>0)&&o.type==="text"&&t.md.linkify.test(o.content)){for(u=o.content,_=t.md.linkify.match(u),a=[],f=o.level,h=0,_.length>0&&_[0].index===0&&e>0&&r[e-1].type==="text_special"&&(_=_.slice(1)),c=0;c<_.length;c++)g=_[c].url,m=t.md.normalizeLink(g),t.md.validateLink(m)&&(v=_[c].text,_[c].schema?_[c].schema==="mailto:"&&!/^mailto:/i.test(v)?v=t.md.normalizeLinkText("mailto:"+v).replace(/^mailto:/,""):v=t.md.normalizeLinkText(v):v=t.md.normalizeLinkText("http://"+v).replace(/^http:\/\//,""),d=_[c].index,d>h&&(s=new t.Token("text","",0),s.content=u.slice(h,d),s.level=f,a.push(s)),s=new t.Token("link_open","a",1),s.attrs=[["href",m]],s.level=f++,s.markup="linkify",s.info="auto",a.push(s),s=new t.Token("text","",0),s.content=v,s.level=f,a.push(s),s=new t.Token("link_close","a",-1),s.level=--f,s.markup="linkify",s.info="auto",a.push(s),h=_[c].lastIndex);h<u.length&&(s=new t.Token("text","",0),s.content=u.slice(h),s.level=f,a.push(s)),b[n].children=r=Vj(r,e,a)}}}},oh=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,Xj=/\((c|tm|r)\)/i,Yj=/\((c|tm|r)\)/ig,Jj={c:"\xA9",r:"\xAE",tm:"\u2122"};function Qj(l,t){return Jj[t.toLowerCase()]}function eV(l){var t,e,n=0;for(t=l.length-1;t>=0;t--)e=l[t],e.type==="text"&&!n&&(e.content=e.content.replace(Yj,Qj)),e.type==="link_open"&&e.info==="auto"&&n--,e.type==="link_close"&&e.info==="auto"&&n++}function tV(l){var t,e,n=0;for(t=l.length-1;t>=0;t--)e=l[t],e.type==="text"&&!n&&oh.test(e.content)&&(e.content=e.content.replace(/\+-/g,"\xB1").replace(/\.{2,}/g,"\u2026").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1\u2014").replace(/(^|\s)--(?=\s|$)/mg,"$1\u2013").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1\u2013")),e.type==="link_open"&&e.info==="auto"&&n--,e.type==="link_close"&&e.info==="auto"&&n++}var nV=function(t){var e;if(!!t.md.options.typographer)for(e=t.tokens.length-1;e>=0;e--)t.tokens[e].type==="inline"&&(Xj.test(t.tokens[e].content)&&eV(t.tokens[e].children),oh.test(t.tokens[e].content)&&tV(t.tokens[e].children))},Mc=Xe.isWhiteSpace,Lc=Xe.isPunctChar,Ic=Xe.isMdAsciiPunct,iV=/['"]/,Oc=/['"]/g,Fc="\u2019";function ks(l,t,e){return l.slice(0,t)+e+l.slice(t+1)}function rV(l,t){var e,n,i,r,s,o,a,c,u,d,h,f,p,g,m,v,b,_,x,w,E;for(x=[],e=0;e<l.length;e++){for(n=l[e],a=l[e].level,b=x.length-1;b>=0&&!(x[b].level<=a);b--);if(x.length=b+1,n.type!=="text")continue;i=n.content,s=0,o=i.length;e:for(;s<o&&(Oc.lastIndex=s,r=Oc.exec(i),!!r);){if(m=v=!0,s=r.index+1,_=r[0]==="'",u=32,r.index-1>=0)u=i.charCodeAt(r.index-1);else for(b=e-1;b>=0&&!(l[b].type==="softbreak"||l[b].type==="hardbreak");b--)if(!!l[b].content){u=l[b].content.charCodeAt(l[b].content.length-1);break}if(d=32,s<o)d=i.charCodeAt(s);else for(b=e+1;b<l.length&&!(l[b].type==="softbreak"||l[b].type==="hardbreak");b++)if(!!l[b].content){d=l[b].content.charCodeAt(0);break}if(h=Ic(u)||Lc(String.fromCharCode(u)),f=Ic(d)||Lc(String.fromCharCode(d)),p=Mc(u),g=Mc(d),g?m=!1:f&&(p||h||(m=!1)),p?v=!1:h&&(g||f||(v=!1)),d===34&&r[0]==='"'&&u>=48&&u<=57&&(v=m=!1),m&&v&&(m=h,v=f),!m&&!v){_&&(n.content=ks(n.content,r.index,Fc));continue}if(v){for(b=x.length-1;b>=0&&(c=x[b],!(x[b].level<a));b--)if(c.single===_&&x[b].level===a){c=x[b],_?(w=t.md.options.quotes[2],E=t.md.options.quotes[3]):(w=t.md.options.quotes[0],E=t.md.options.quotes[1]),n.content=ks(n.content,r.index,E),l[c.token].content=ks(l[c.token].content,c.pos,w),s+=E.length-1,c.token===e&&(s+=w.length-1),i=n.content,o=i.length,x.length=b;continue e}}m?x.push({token:e,pos:r.index,single:_,level:a}):v&&_&&(n.content=ks(n.content,r.index,Fc))}}}var sV=function(t){var e;if(!!t.md.options.typographer)for(e=t.tokens.length-1;e>=0;e--)t.tokens[e].type!=="inline"||!iV.test(t.tokens[e].content)||rV(t.tokens[e].children,t)},oV=function(t){var e,n,i,r,s,o,a=t.tokens;for(e=0,n=a.length;e<n;e++)if(a[e].type==="inline"){for(i=a[e].children,s=i.length,r=0;r<s;r++)i[r].type==="text_special"&&(i[r].type="text");for(r=o=0;r<s;r++)i[r].type==="text"&&r+1<s&&i[r+1].type==="text"?i[r+1].content=i[r].content+i[r+1].content:(r!==o&&(i[o]=i[r]),o++);r!==o&&(i.length=o)}};function vr(l,t,e){this.type=l,this.tag=t,this.attrs=null,this.map=null,this.nesting=e,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}vr.prototype.attrIndex=function(t){var e,n,i;if(!this.attrs)return-1;for(e=this.attrs,n=0,i=e.length;n<i;n++)if(e[n][0]===t)return n;return-1};vr.prototype.attrPush=function(t){this.attrs?this.attrs.push(t):this.attrs=[t]};vr.prototype.attrSet=function(t,e){var n=this.attrIndex(t),i=[t,e];n<0?this.attrPush(i):this.attrs[n]=i};vr.prototype.attrGet=function(t){var e=this.attrIndex(t),n=null;return e>=0&&(n=this.attrs[e][1]),n};vr.prototype.attrJoin=function(t,e){var n=this.attrIndex(t);n<0?this.attrPush([t,e]):this.attrs[n][1]=this.attrs[n][1]+" "+e};var dl=vr,aV=dl;function ah(l,t,e){this.src=l,this.env=e,this.tokens=[],this.inlineMode=!1,this.md=t}ah.prototype.Token=aV;var lV=ah,cV=ul,ra=[["normalize",Wj],["block",Uj],["inline",jj],["linkify",Kj],["replacements",nV],["smartquotes",sV],["text_join",oV]];function fl(){this.ruler=new cV;for(var l=0;l<ra.length;l++)this.ruler.push(ra[l][0],ra[l][1])}fl.prototype.process=function(l){var t,e,n;for(n=this.ruler.getRules(""),t=0,e=n.length;t<e;t++)n[t](l)};fl.prototype.State=lV;var uV=fl,sa=Xe.isSpace;function oa(l,t){var e=l.bMarks[t]+l.tShift[t],n=l.eMarks[t];return l.src.slice(e,n)}function Bc(l){var t=[],e=0,n=l.length,i,r=!1,s=0,o="";for(i=l.charCodeAt(e);e<n;)i===124&&(r?(o+=l.substring(s,e-1),s=e):(t.push(o+l.substring(s,e)),o="",s=e+1)),r=i===92,e++,i=l.charCodeAt(e);return t.push(o+l.substring(s)),t}var dV=function(t,e,n,i){var r,s,o,a,c,u,d,h,f,p,g,m,v,b,_,x,w,E;if(e+2>n||(u=e+1,t.sCount[u]<t.blkIndent)||t.sCount[u]-t.blkIndent>=4||(o=t.bMarks[u]+t.tShift[u],o>=t.eMarks[u])||(w=t.src.charCodeAt(o++),w!==124&&w!==45&&w!==58)||o>=t.eMarks[u]||(E=t.src.charCodeAt(o++),E!==124&&E!==45&&E!==58&&!sa(E))||w===45&&sa(E))return!1;for(;o<t.eMarks[u];){if(r=t.src.charCodeAt(o),r!==124&&r!==45&&r!==58&&!sa(r))return!1;o++}for(s=oa(t,e+1),d=s.split("|"),p=[],a=0;a<d.length;a++){if(g=d[a].trim(),!g){if(a===0||a===d.length-1)continue;return!1}if(!/^:?-+:?$/.test(g))return!1;g.charCodeAt(g.length-1)===58?p.push(g.charCodeAt(0)===58?"center":"right"):g.charCodeAt(0)===58?p.push("left"):p.push("")}if(s=oa(t,e).trim(),s.indexOf("|")===-1||t.sCount[e]-t.blkIndent>=4||(d=Bc(s),d.length&&d[0]===""&&d.shift(),d.length&&d[d.length-1]===""&&d.pop(),h=d.length,h===0||h!==p.length))return!1;if(i)return!0;for(b=t.parentType,t.parentType="table",x=t.md.block.ruler.getRules("blockquote"),f=t.push("table_open","table",1),f.map=m=[e,0],f=t.push("thead_open","thead",1),f.map=[e,e+1],f=t.push("tr_open","tr",1),f.map=[e,e+1],a=0;a<d.length;a++)f=t.push("th_open","th",1),p[a]&&(f.attrs=[["style","text-align:"+p[a]]]),f=t.push("inline","",0),f.content=d[a].trim(),f.children=[],f=t.push("th_close","th",-1);for(f=t.push("tr_close","tr",-1),f=t.push("thead_close","thead",-1),u=e+2;u<n&&!(t.sCount[u]<t.blkIndent);u++){for(_=!1,a=0,c=x.length;a<c;a++)if(x[a](t,u,n,!0)){_=!0;break}if(_||(s=oa(t,u).trim(),!s)||t.sCount[u]-t.blkIndent>=4)break;for(d=Bc(s),d.length&&d[0]===""&&d.shift(),d.length&&d[d.length-1]===""&&d.pop(),u===e+2&&(f=t.push("tbody_open","tbody",1),f.map=v=[e+2,0]),f=t.push("tr_open","tr",1),f.map=[u,u+1],a=0;a<h;a++)f=t.push("td_open","td",1),p[a]&&(f.attrs=[["style","text-align:"+p[a]]]),f=t.push("inline","",0),f.content=d[a]?d[a].trim():"",f.children=[],f=t.push("td_close","td",-1);f=t.push("tr_close","tr",-1)}return v&&(f=t.push("tbody_close","tbody",-1),v[1]=u),f=t.push("table_close","table",-1),m[1]=u,t.parentType=b,t.line=u,!0},fV=function(t,e,n){var i,r,s;if(t.sCount[e]-t.blkIndent<4)return!1;for(r=i=e+1;i<n;){if(t.isEmpty(i)){i++;continue}if(t.sCount[i]-t.blkIndent>=4){i++,r=i;continue}break}return t.line=r,s=t.push("code_block","code",0),s.content=t.getLines(e,r,4+t.blkIndent,!1)+`
`,s.map=[e,t.line],!0},hV=function(t,e,n,i){var r,s,o,a,c,u,d,h=!1,f=t.bMarks[e]+t.tShift[e],p=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||f+3>p||(r=t.src.charCodeAt(f),r!==126&&r!==96)||(c=f,f=t.skipChars(f,r),s=f-c,s<3)||(d=t.src.slice(c,f),o=t.src.slice(f,p),r===96&&o.indexOf(String.fromCharCode(r))>=0))return!1;if(i)return!0;for(a=e;a++,!(a>=n||(f=c=t.bMarks[a]+t.tShift[a],p=t.eMarks[a],f<p&&t.sCount[a]<t.blkIndent));)if(t.src.charCodeAt(f)===r&&!(t.sCount[a]-t.blkIndent>=4)&&(f=t.skipChars(f,r),!(f-c<s)&&(f=t.skipSpaces(f),!(f<p)))){h=!0;break}return s=t.sCount[e],t.line=a+(h?1:0),u=t.push("fence","code",0),u.info=o,u.content=t.getLines(e+1,a,s,!0),u.markup=d,u.map=[e,t.line],!0},$c=Xe.isSpace,pV=function(t,e,n,i){var r,s,o,a,c,u,d,h,f,p,g,m,v,b,_,x,w,E,S,R,D=t.lineMax,P=t.bMarks[e]+t.tShift[e],O=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(P++)!==62)return!1;if(i)return!0;for(a=f=t.sCount[e]+1,t.src.charCodeAt(P)===32?(P++,a++,f++,r=!1,x=!0):t.src.charCodeAt(P)===9?(x=!0,(t.bsCount[e]+f)%4===3?(P++,a++,f++,r=!1):r=!0):x=!1,p=[t.bMarks[e]],t.bMarks[e]=P;P<O&&(s=t.src.charCodeAt(P),$c(s));){s===9?f+=4-(f+t.bsCount[e]+(r?1:0))%4:f++;P++}for(g=[t.bsCount[e]],t.bsCount[e]=t.sCount[e]+1+(x?1:0),u=P>=O,b=[t.sCount[e]],t.sCount[e]=f-a,_=[t.tShift[e]],t.tShift[e]=P-t.bMarks[e],E=t.md.block.ruler.getRules("blockquote"),v=t.parentType,t.parentType="blockquote",h=e+1;h<n&&(R=t.sCount[h]<t.blkIndent,P=t.bMarks[h]+t.tShift[h],O=t.eMarks[h],!(P>=O));h++){if(t.src.charCodeAt(P++)===62&&!R){for(a=f=t.sCount[h]+1,t.src.charCodeAt(P)===32?(P++,a++,f++,r=!1,x=!0):t.src.charCodeAt(P)===9?(x=!0,(t.bsCount[h]+f)%4===3?(P++,a++,f++,r=!1):r=!0):x=!1,p.push(t.bMarks[h]),t.bMarks[h]=P;P<O&&(s=t.src.charCodeAt(P),$c(s));){s===9?f+=4-(f+t.bsCount[h]+(r?1:0))%4:f++;P++}u=P>=O,g.push(t.bsCount[h]),t.bsCount[h]=t.sCount[h]+1+(x?1:0),b.push(t.sCount[h]),t.sCount[h]=f-a,_.push(t.tShift[h]),t.tShift[h]=P-t.bMarks[h];continue}if(u)break;for(w=!1,o=0,c=E.length;o<c;o++)if(E[o](t,h,n,!0)){w=!0;break}if(w){t.lineMax=h,t.blkIndent!==0&&(p.push(t.bMarks[h]),g.push(t.bsCount[h]),_.push(t.tShift[h]),b.push(t.sCount[h]),t.sCount[h]-=t.blkIndent);break}p.push(t.bMarks[h]),g.push(t.bsCount[h]),_.push(t.tShift[h]),b.push(t.sCount[h]),t.sCount[h]=-1}for(m=t.blkIndent,t.blkIndent=0,S=t.push("blockquote_open","blockquote",1),S.markup=">",S.map=d=[e,0],t.md.block.tokenize(t,e,h),S=t.push("blockquote_close","blockquote",-1),S.markup=">",t.lineMax=D,t.parentType=v,d[1]=t.line,o=0;o<_.length;o++)t.bMarks[o+e]=p[o],t.tShift[o+e]=_[o],t.sCount[o+e]=b[o],t.bsCount[o+e]=g[o];return t.blkIndent=m,!0},gV=Xe.isSpace,mV=function(t,e,n,i){var r,s,o,a,c=t.bMarks[e]+t.tShift[e],u=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||(r=t.src.charCodeAt(c++),r!==42&&r!==45&&r!==95))return!1;for(s=1;c<u;){if(o=t.src.charCodeAt(c++),o!==r&&!gV(o))return!1;o===r&&s++}return s<3?!1:(i||(t.line=e+1,a=t.push("hr","hr",0),a.map=[e,t.line],a.markup=Array(s+1).join(String.fromCharCode(r))),!0)},lh=Xe.isSpace;function Pc(l,t){var e,n,i,r;return n=l.bMarks[t]+l.tShift[t],i=l.eMarks[t],e=l.src.charCodeAt(n++),e!==42&&e!==45&&e!==43||n<i&&(r=l.src.charCodeAt(n),!lh(r))?-1:n}function zc(l,t){var e,n=l.bMarks[t]+l.tShift[t],i=n,r=l.eMarks[t];if(i+1>=r||(e=l.src.charCodeAt(i++),e<48||e>57))return-1;for(;;){if(i>=r)return-1;if(e=l.src.charCodeAt(i++),e>=48&&e<=57){if(i-n>=10)return-1;continue}if(e===41||e===46)break;return-1}return i<r&&(e=l.src.charCodeAt(i),!lh(e))?-1:i}function vV(l,t){var e,n,i=l.level+2;for(e=t+2,n=l.tokens.length-2;e<n;e++)l.tokens[e].level===i&&l.tokens[e].type==="paragraph_open"&&(l.tokens[e+2].hidden=!0,l.tokens[e].hidden=!0,e+=2)}var bV=function(t,e,n,i){var r,s,o,a,c,u,d,h,f,p,g,m,v,b,_,x,w,E,S,R,D,P,O,L,B,A,F,W,G=!1,k=!0;if(t.sCount[e]-t.blkIndent>=4||t.listIndent>=0&&t.sCount[e]-t.listIndent>=4&&t.sCount[e]<t.blkIndent)return!1;if(i&&t.parentType==="paragraph"&&t.sCount[e]>=t.blkIndent&&(G=!0),(O=zc(t,e))>=0){if(d=!0,B=t.bMarks[e]+t.tShift[e],v=Number(t.src.slice(B,O-1)),G&&v!==1)return!1}else if((O=Pc(t,e))>=0)d=!1;else return!1;if(G&&t.skipSpaces(O)>=t.eMarks[e])return!1;if(m=t.src.charCodeAt(O-1),i)return!0;for(g=t.tokens.length,d?(W=t.push("ordered_list_open","ol",1),v!==1&&(W.attrs=[["start",v]])):W=t.push("bullet_list_open","ul",1),W.map=p=[e,0],W.markup=String.fromCharCode(m),_=e,L=!1,F=t.md.block.ruler.getRules("list"),E=t.parentType,t.parentType="list";_<n;){for(P=O,b=t.eMarks[_],u=x=t.sCount[_]+O-(t.bMarks[e]+t.tShift[e]);P<b;){if(r=t.src.charCodeAt(P),r===9)x+=4-(x+t.bsCount[_])%4;else if(r===32)x++;else break;P++}if(s=P,s>=b?c=1:c=x-u,c>4&&(c=1),a=u+c,W=t.push("list_item_open","li",1),W.markup=String.fromCharCode(m),W.map=h=[e,0],d&&(W.info=t.src.slice(B,O-1)),D=t.tight,R=t.tShift[e],S=t.sCount[e],w=t.listIndent,t.listIndent=t.blkIndent,t.blkIndent=a,t.tight=!0,t.tShift[e]=s-t.bMarks[e],t.sCount[e]=x,s>=b&&t.isEmpty(e+1)?t.line=Math.min(t.line+2,n):t.md.block.tokenize(t,e,n,!0),(!t.tight||L)&&(k=!1),L=t.line-e>1&&t.isEmpty(t.line-1),t.blkIndent=t.listIndent,t.listIndent=w,t.tShift[e]=R,t.sCount[e]=S,t.tight=D,W=t.push("list_item_close","li",-1),W.markup=String.fromCharCode(m),_=e=t.line,h[1]=_,s=t.bMarks[e],_>=n||t.sCount[_]<t.blkIndent||t.sCount[e]-t.blkIndent>=4)break;for(A=!1,o=0,f=F.length;o<f;o++)if(F[o](t,_,n,!0)){A=!0;break}if(A)break;if(d){if(O=zc(t,_),O<0)break;B=t.bMarks[_]+t.tShift[_]}else if(O=Pc(t,_),O<0)break;if(m!==t.src.charCodeAt(O-1))break}return d?W=t.push("ordered_list_close","ol",-1):W=t.push("bullet_list_close","ul",-1),W.markup=String.fromCharCode(m),p[1]=_,t.line=_,t.parentType=E,k&&vV(t,g),!0},yV=Xe.normalizeReference,Es=Xe.isSpace,_V=function(t,e,n,i){var r,s,o,a,c,u,d,h,f,p,g,m,v,b,_,x,w=0,E=t.bMarks[e]+t.tShift[e],S=t.eMarks[e],R=e+1;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(E)!==91)return!1;for(;++E<S;)if(t.src.charCodeAt(E)===93&&t.src.charCodeAt(E-1)!==92){if(E+1===S||t.src.charCodeAt(E+1)!==58)return!1;break}for(a=t.lineMax,_=t.md.block.ruler.getRules("reference"),p=t.parentType,t.parentType="reference";R<a&&!t.isEmpty(R);R++)if(!(t.sCount[R]-t.blkIndent>3)&&!(t.sCount[R]<0)){for(b=!1,u=0,d=_.length;u<d;u++)if(_[u](t,R,a,!0)){b=!0;break}if(b)break}for(v=t.getLines(e,R,t.blkIndent,!1).trim(),S=v.length,E=1;E<S;E++){if(r=v.charCodeAt(E),r===91)return!1;if(r===93){f=E;break}else r===10?w++:r===92&&(E++,E<S&&v.charCodeAt(E)===10&&w++)}if(f<0||v.charCodeAt(f+1)!==58)return!1;for(E=f+2;E<S;E++)if(r=v.charCodeAt(E),r===10)w++;else if(!Es(r))break;if(g=t.md.helpers.parseLinkDestination(v,E,S),!g.ok||(c=t.md.normalizeLink(g.str),!t.md.validateLink(c)))return!1;for(E=g.pos,w+=g.lines,s=E,o=w,m=E;E<S;E++)if(r=v.charCodeAt(E),r===10)w++;else if(!Es(r))break;for(g=t.md.helpers.parseLinkTitle(v,E,S),E<S&&m!==E&&g.ok?(x=g.str,E=g.pos,w+=g.lines):(x="",E=s,w=o);E<S&&(r=v.charCodeAt(E),!!Es(r));)E++;if(E<S&&v.charCodeAt(E)!==10&&x)for(x="",E=s,w=o;E<S&&(r=v.charCodeAt(E),!!Es(r));)E++;return E<S&&v.charCodeAt(E)!==10||(h=yV(v.slice(1,f)),!h)?!1:(i||(typeof t.env.references>"u"&&(t.env.references={}),typeof t.env.references[h]>"u"&&(t.env.references[h]={title:x,href:c}),t.parentType=p,t.line=e+w+1),!0)},wV=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","section","source","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],ro={},xV="[a-zA-Z_:][a-zA-Z0-9:._-]*",kV="[^\"'=<>`\\x00-\\x20]+",EV="'[^']*'",CV='"[^"]*"',SV="(?:"+kV+"|"+EV+"|"+CV+")",AV="(?:\\s+"+xV+"(?:\\s*=\\s*"+SV+")?)",ch="<[A-Za-z][A-Za-z0-9\\-]*"+AV+"*\\s*\\/?>",uh="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",TV="<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->",NV="<[?][\\s\\S]*?[?]>",DV="<![A-Z]+\\s+[^>]*>",RV="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",MV=new RegExp("^(?:"+ch+"|"+uh+"|"+TV+"|"+NV+"|"+DV+"|"+RV+")"),LV=new RegExp("^(?:"+ch+"|"+uh+")");ro.HTML_TAG_RE=MV;ro.HTML_OPEN_CLOSE_TAG_RE=LV;var IV=wV,OV=ro.HTML_OPEN_CLOSE_TAG_RE,Yi=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+IV.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(OV.source+"\\s*$"),/^$/,!1]],FV=function(t,e,n,i){var r,s,o,a,c=t.bMarks[e]+t.tShift[e],u=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||!t.md.options.html||t.src.charCodeAt(c)!==60)return!1;for(a=t.src.slice(c,u),r=0;r<Yi.length&&!Yi[r][0].test(a);r++);if(r===Yi.length)return!1;if(i)return Yi[r][2];if(s=e+1,!Yi[r][1].test(a)){for(;s<n&&!(t.sCount[s]<t.blkIndent);s++)if(c=t.bMarks[s]+t.tShift[s],u=t.eMarks[s],a=t.src.slice(c,u),Yi[r][1].test(a)){a.length!==0&&s++;break}}return t.line=s,o=t.push("html_block","",0),o.map=[e,s],o.content=t.getLines(e,s,t.blkIndent,!0),!0},qc=Xe.isSpace,BV=function(t,e,n,i){var r,s,o,a,c=t.bMarks[e]+t.tShift[e],u=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||(r=t.src.charCodeAt(c),r!==35||c>=u))return!1;for(s=1,r=t.src.charCodeAt(++c);r===35&&c<u&&s<=6;)s++,r=t.src.charCodeAt(++c);return s>6||c<u&&!qc(r)?!1:(i||(u=t.skipSpacesBack(u,c),o=t.skipCharsBack(u,35,c),o>c&&qc(t.src.charCodeAt(o-1))&&(u=o),t.line=e+1,a=t.push("heading_open","h"+String(s),1),a.markup="########".slice(0,s),a.map=[e,t.line],a=t.push("inline","",0),a.content=t.src.slice(c,u).trim(),a.map=[e,t.line],a.children=[],a=t.push("heading_close","h"+String(s),-1),a.markup="########".slice(0,s)),!0)},$V=function(t,e,n){var i,r,s,o,a,c,u,d,h,f=e+1,p,g=t.md.block.ruler.getRules("paragraph");if(t.sCount[e]-t.blkIndent>=4)return!1;for(p=t.parentType,t.parentType="paragraph";f<n&&!t.isEmpty(f);f++)if(!(t.sCount[f]-t.blkIndent>3)){if(t.sCount[f]>=t.blkIndent&&(c=t.bMarks[f]+t.tShift[f],u=t.eMarks[f],c<u&&(h=t.src.charCodeAt(c),(h===45||h===61)&&(c=t.skipChars(c,h),c=t.skipSpaces(c),c>=u)))){d=h===61?1:2;break}if(!(t.sCount[f]<0)){for(r=!1,s=0,o=g.length;s<o;s++)if(g[s](t,f,n,!0)){r=!0;break}if(r)break}}return d?(i=t.getLines(e,f,t.blkIndent,!1).trim(),t.line=f+1,a=t.push("heading_open","h"+String(d),1),a.markup=String.fromCharCode(h),a.map=[e,t.line],a=t.push("inline","",0),a.content=i,a.map=[e,t.line-1],a.children=[],a=t.push("heading_close","h"+String(d),-1),a.markup=String.fromCharCode(h),t.parentType=p,!0):!1},PV=function(t,e){var n,i,r,s,o,a,c=e+1,u=t.md.block.ruler.getRules("paragraph"),d=t.lineMax;for(a=t.parentType,t.parentType="paragraph";c<d&&!t.isEmpty(c);c++)if(!(t.sCount[c]-t.blkIndent>3)&&!(t.sCount[c]<0)){for(i=!1,r=0,s=u.length;r<s;r++)if(u[r](t,c,d,!0)){i=!0;break}if(i)break}return n=t.getLines(e,c,t.blkIndent,!1).trim(),t.line=c,o=t.push("paragraph_open","p",1),o.map=[e,t.line],o=t.push("inline","",0),o.content=n,o.map=[e,t.line],o.children=[],o=t.push("paragraph_close","p",-1),t.parentType=a,!0},dh=dl,so=Xe.isSpace;function Mn(l,t,e,n){var i,r,s,o,a,c,u,d;for(this.src=l,this.md=t,this.env=e,this.tokens=n,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0,this.result="",r=this.src,d=!1,s=o=c=u=0,a=r.length;o<a;o++){if(i=r.charCodeAt(o),!d)if(so(i)){c++,i===9?u+=4-u%4:u++;continue}else d=!0;(i===10||o===a-1)&&(i!==10&&o++,this.bMarks.push(s),this.eMarks.push(o),this.tShift.push(c),this.sCount.push(u),this.bsCount.push(0),d=!1,c=0,u=0,s=o+1)}this.bMarks.push(r.length),this.eMarks.push(r.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}Mn.prototype.push=function(l,t,e){var n=new dh(l,t,e);return n.block=!0,e<0&&this.level--,n.level=this.level,e>0&&this.level++,this.tokens.push(n),n};Mn.prototype.isEmpty=function(t){return this.bMarks[t]+this.tShift[t]>=this.eMarks[t]};Mn.prototype.skipEmptyLines=function(t){for(var e=this.lineMax;t<e&&!(this.bMarks[t]+this.tShift[t]<this.eMarks[t]);t++);return t};Mn.prototype.skipSpaces=function(t){for(var e,n=this.src.length;t<n&&(e=this.src.charCodeAt(t),!!so(e));t++);return t};Mn.prototype.skipSpacesBack=function(t,e){if(t<=e)return t;for(;t>e;)if(!so(this.src.charCodeAt(--t)))return t+1;return t};Mn.prototype.skipChars=function(t,e){for(var n=this.src.length;t<n&&this.src.charCodeAt(t)===e;t++);return t};Mn.prototype.skipCharsBack=function(t,e,n){if(t<=n)return t;for(;t>n;)if(e!==this.src.charCodeAt(--t))return t+1;return t};Mn.prototype.getLines=function(t,e,n,i){var r,s,o,a,c,u,d,h=t;if(t>=e)return"";for(u=new Array(e-t),r=0;h<e;h++,r++){for(s=0,d=a=this.bMarks[h],h+1<e||i?c=this.eMarks[h]+1:c=this.eMarks[h];a<c&&s<n;){if(o=this.src.charCodeAt(a),so(o))o===9?s+=4-(s+this.bsCount[h])%4:s++;else if(a-d<this.tShift[h])s++;else break;a++}s>n?u[r]=new Array(s-n+1).join(" ")+this.src.slice(a,c):u[r]=this.src.slice(a,c)}return u.join("")};Mn.prototype.Token=dh;var zV=Mn,qV=ul,Cs=[["table",dV,["paragraph","reference"]],["code",fV],["fence",hV,["paragraph","reference","blockquote","list"]],["blockquote",pV,["paragraph","reference","blockquote","list"]],["hr",mV,["paragraph","reference","blockquote","list"]],["list",bV,["paragraph","reference","blockquote"]],["reference",_V],["html_block",FV,["paragraph","reference","blockquote"]],["heading",BV,["paragraph","reference","blockquote"]],["lheading",$V],["paragraph",PV]];function oo(){this.ruler=new qV;for(var l=0;l<Cs.length;l++)this.ruler.push(Cs[l][0],Cs[l][1],{alt:(Cs[l][2]||[]).slice()})}oo.prototype.tokenize=function(l,t,e){for(var n,i,r=this.ruler.getRules(""),s=r.length,o=t,a=!1,c=l.md.options.maxNesting;o<e&&(l.line=o=l.skipEmptyLines(o),!(o>=e||l.sCount[o]<l.blkIndent));){if(l.level>=c){l.line=e;break}for(i=0;i<s&&(n=r[i](l,o,e,!1),!n);i++);l.tight=!a,l.isEmpty(l.line-1)&&(a=!0),o=l.line,o<e&&l.isEmpty(o)&&(a=!0,o++,l.line=o)}};oo.prototype.parse=function(l,t,e,n){var i;!l||(i=new this.State(l,t,e,n),this.tokenize(i,i.line,i.lineMax))};oo.prototype.State=zV;var HV=oo;function WV(l){switch(l){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}var UV=function(t,e){for(var n=t.pos;n<t.posMax&&!WV(t.src.charCodeAt(n));)n++;return n===t.pos?!1:(e||(t.pending+=t.src.slice(t.pos,n)),t.pos=n,!0)},jV=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i,VV=function(t,e){var n,i,r,s,o,a,c,u;return!t.md.options.linkify||t.linkLevel>0||(n=t.pos,i=t.posMax,n+3>i)||t.src.charCodeAt(n)!==58||t.src.charCodeAt(n+1)!==47||t.src.charCodeAt(n+2)!==47||(r=t.pending.match(jV),!r)||(s=r[1],o=t.md.linkify.matchAtStart(t.src.slice(n-s.length)),!o)||(a=o.url,a=a.replace(/\*+$/,""),c=t.md.normalizeLink(a),!t.md.validateLink(c))?!1:(e||(t.pending=t.pending.slice(0,-s.length),u=t.push("link_open","a",1),u.attrs=[["href",c]],u.markup="linkify",u.info="auto",u=t.push("text","",0),u.content=t.md.normalizeLinkText(a),u=t.push("link_close","a",-1),u.markup="linkify",u.info="auto"),t.pos+=a.length-s.length,!0)},GV=Xe.isSpace,ZV=function(t,e){var n,i,r,s=t.pos;if(t.src.charCodeAt(s)!==10)return!1;if(n=t.pending.length-1,i=t.posMax,!e)if(n>=0&&t.pending.charCodeAt(n)===32)if(n>=1&&t.pending.charCodeAt(n-1)===32){for(r=n-1;r>=1&&t.pending.charCodeAt(r-1)===32;)r--;t.pending=t.pending.slice(0,r),t.push("hardbreak","br",0)}else t.pending=t.pending.slice(0,-1),t.push("softbreak","br",0);else t.push("softbreak","br",0);for(s++;s<i&&GV(t.src.charCodeAt(s));)s++;return t.pos=s,!0},KV=Xe.isSpace,hl=[];for(var Hc=0;Hc<256;Hc++)hl.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(l){hl[l.charCodeAt(0)]=1});var XV=function(t,e){var n,i,r,s,o,a=t.pos,c=t.posMax;if(t.src.charCodeAt(a)!==92||(a++,a>=c))return!1;if(n=t.src.charCodeAt(a),n===10){for(e||t.push("hardbreak","br",0),a++;a<c&&(n=t.src.charCodeAt(a),!!KV(n));)a++;return t.pos=a,!0}return s=t.src[a],n>=55296&&n<=56319&&a+1<c&&(i=t.src.charCodeAt(a+1),i>=56320&&i<=57343&&(s+=t.src[a+1],a++)),r="\\"+s,e||(o=t.push("text_special","",0),n<256&&hl[n]!==0?o.content=s:o.content=r,o.markup=r,o.info="escape"),t.pos=a+1,!0},YV=function(t,e){var n,i,r,s,o,a,c,u,d=t.pos,h=t.src.charCodeAt(d);if(h!==96)return!1;for(n=d,d++,i=t.posMax;d<i&&t.src.charCodeAt(d)===96;)d++;if(r=t.src.slice(n,d),c=r.length,t.backticksScanned&&(t.backticks[c]||0)<=n)return e||(t.pending+=r),t.pos+=c,!0;for(o=a=d;(o=t.src.indexOf("`",a))!==-1;){for(a=o+1;a<i&&t.src.charCodeAt(a)===96;)a++;if(u=a-o,u===c)return e||(s=t.push("code_inline","code",0),s.markup=r,s.content=t.src.slice(d,o).replace(/\n/g," ").replace(/^ (.+) $/,"$1")),t.pos=a,!0;t.backticks[u]=o}return t.backticksScanned=!0,e||(t.pending+=r),t.pos+=c,!0},ao={};ao.tokenize=function(t,e){var n,i,r,s,o,a=t.pos,c=t.src.charCodeAt(a);if(e||c!==126||(i=t.scanDelims(t.pos,!0),s=i.length,o=String.fromCharCode(c),s<2))return!1;for(s%2&&(r=t.push("text","",0),r.content=o,s--),n=0;n<s;n+=2)r=t.push("text","",0),r.content=o+o,t.delimiters.push({marker:c,length:0,token:t.tokens.length-1,end:-1,open:i.can_open,close:i.can_close});return t.pos+=i.length,!0};function Wc(l,t){var e,n,i,r,s,o=[],a=t.length;for(e=0;e<a;e++)i=t[e],i.marker===126&&i.end!==-1&&(r=t[i.end],s=l.tokens[i.token],s.type="s_open",s.tag="s",s.nesting=1,s.markup="~~",s.content="",s=l.tokens[r.token],s.type="s_close",s.tag="s",s.nesting=-1,s.markup="~~",s.content="",l.tokens[r.token-1].type==="text"&&l.tokens[r.token-1].content==="~"&&o.push(r.token-1));for(;o.length;){for(e=o.pop(),n=e+1;n<l.tokens.length&&l.tokens[n].type==="s_close";)n++;n--,e!==n&&(s=l.tokens[n],l.tokens[n]=l.tokens[e],l.tokens[e]=s)}}ao.postProcess=function(t){var e,n=t.tokens_meta,i=t.tokens_meta.length;for(Wc(t,t.delimiters),e=0;e<i;e++)n[e]&&n[e].delimiters&&Wc(t,n[e].delimiters)};var lo={};lo.tokenize=function(t,e){var n,i,r,s=t.pos,o=t.src.charCodeAt(s);if(e||o!==95&&o!==42)return!1;for(i=t.scanDelims(t.pos,o===42),n=0;n<i.length;n++)r=t.push("text","",0),r.content=String.fromCharCode(o),t.delimiters.push({marker:o,length:i.length,token:t.tokens.length-1,end:-1,open:i.can_open,close:i.can_close});return t.pos+=i.length,!0};function Uc(l,t){var e,n,i,r,s,o,a=t.length;for(e=a-1;e>=0;e--)n=t[e],!(n.marker!==95&&n.marker!==42)&&n.end!==-1&&(i=t[n.end],o=e>0&&t[e-1].end===n.end+1&&t[e-1].marker===n.marker&&t[e-1].token===n.token-1&&t[n.end+1].token===i.token+1,s=String.fromCharCode(n.marker),r=l.tokens[n.token],r.type=o?"strong_open":"em_open",r.tag=o?"strong":"em",r.nesting=1,r.markup=o?s+s:s,r.content="",r=l.tokens[i.token],r.type=o?"strong_close":"em_close",r.tag=o?"strong":"em",r.nesting=-1,r.markup=o?s+s:s,r.content="",o&&(l.tokens[t[e-1].token].content="",l.tokens[t[n.end+1].token].content="",e--))}lo.postProcess=function(t){var e,n=t.tokens_meta,i=t.tokens_meta.length;for(Uc(t,t.delimiters),e=0;e<i;e++)n[e]&&n[e].delimiters&&Uc(t,n[e].delimiters)};var JV=Xe.normalizeReference,aa=Xe.isSpace,QV=function(t,e){var n,i,r,s,o,a,c,u,d,h="",f="",p=t.pos,g=t.posMax,m=t.pos,v=!0;if(t.src.charCodeAt(t.pos)!==91||(o=t.pos+1,s=t.md.helpers.parseLinkLabel(t,t.pos,!0),s<0))return!1;if(a=s+1,a<g&&t.src.charCodeAt(a)===40){for(v=!1,a++;a<g&&(i=t.src.charCodeAt(a),!(!aa(i)&&i!==10));a++);if(a>=g)return!1;if(m=a,c=t.md.helpers.parseLinkDestination(t.src,a,t.posMax),c.ok){for(h=t.md.normalizeLink(c.str),t.md.validateLink(h)?a=c.pos:h="",m=a;a<g&&(i=t.src.charCodeAt(a),!(!aa(i)&&i!==10));a++);if(c=t.md.helpers.parseLinkTitle(t.src,a,t.posMax),a<g&&m!==a&&c.ok)for(f=c.str,a=c.pos;a<g&&(i=t.src.charCodeAt(a),!(!aa(i)&&i!==10));a++);}(a>=g||t.src.charCodeAt(a)!==41)&&(v=!0),a++}if(v){if(typeof t.env.references>"u")return!1;if(a<g&&t.src.charCodeAt(a)===91?(m=a+1,a=t.md.helpers.parseLinkLabel(t,a),a>=0?r=t.src.slice(m,a++):a=s+1):a=s+1,r||(r=t.src.slice(o,s)),u=t.env.references[JV(r)],!u)return t.pos=p,!1;h=u.href,f=u.title}return e||(t.pos=o,t.posMax=s,d=t.push("link_open","a",1),d.attrs=n=[["href",h]],f&&n.push(["title",f]),t.linkLevel++,t.md.inline.tokenize(t),t.linkLevel--,d=t.push("link_close","a",-1)),t.pos=a,t.posMax=g,!0},eG=Xe.normalizeReference,la=Xe.isSpace,tG=function(t,e){var n,i,r,s,o,a,c,u,d,h,f,p,g,m="",v=t.pos,b=t.posMax;if(t.src.charCodeAt(t.pos)!==33||t.src.charCodeAt(t.pos+1)!==91||(a=t.pos+2,o=t.md.helpers.parseLinkLabel(t,t.pos+1,!1),o<0))return!1;if(c=o+1,c<b&&t.src.charCodeAt(c)===40){for(c++;c<b&&(i=t.src.charCodeAt(c),!(!la(i)&&i!==10));c++);if(c>=b)return!1;for(g=c,d=t.md.helpers.parseLinkDestination(t.src,c,t.posMax),d.ok&&(m=t.md.normalizeLink(d.str),t.md.validateLink(m)?c=d.pos:m=""),g=c;c<b&&(i=t.src.charCodeAt(c),!(!la(i)&&i!==10));c++);if(d=t.md.helpers.parseLinkTitle(t.src,c,t.posMax),c<b&&g!==c&&d.ok)for(h=d.str,c=d.pos;c<b&&(i=t.src.charCodeAt(c),!(!la(i)&&i!==10));c++);else h="";if(c>=b||t.src.charCodeAt(c)!==41)return t.pos=v,!1;c++}else{if(typeof t.env.references>"u")return!1;if(c<b&&t.src.charCodeAt(c)===91?(g=c+1,c=t.md.helpers.parseLinkLabel(t,c),c>=0?s=t.src.slice(g,c++):c=o+1):c=o+1,s||(s=t.src.slice(a,o)),u=t.env.references[eG(s)],!u)return t.pos=v,!1;m=u.href,h=u.title}return e||(r=t.src.slice(a,o),t.md.inline.parse(r,t.md,t.env,p=[]),f=t.push("image","img",0),f.attrs=n=[["src",m],["alt",""]],f.children=p,f.content=r,h&&n.push(["title",h])),t.pos=c,t.posMax=b,!0},nG=/^([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,iG=/^([a-zA-Z][a-zA-Z0-9+.\-]{1,31}):([^<>\x00-\x20]*)$/,rG=function(t,e){var n,i,r,s,o,a,c=t.pos;if(t.src.charCodeAt(c)!==60)return!1;for(o=t.pos,a=t.posMax;;){if(++c>=a||(s=t.src.charCodeAt(c),s===60))return!1;if(s===62)break}return n=t.src.slice(o+1,c),iG.test(n)?(i=t.md.normalizeLink(n),t.md.validateLink(i)?(e||(r=t.push("link_open","a",1),r.attrs=[["href",i]],r.markup="autolink",r.info="auto",r=t.push("text","",0),r.content=t.md.normalizeLinkText(n),r=t.push("link_close","a",-1),r.markup="autolink",r.info="auto"),t.pos+=n.length+2,!0):!1):nG.test(n)?(i=t.md.normalizeLink("mailto:"+n),t.md.validateLink(i)?(e||(r=t.push("link_open","a",1),r.attrs=[["href",i]],r.markup="autolink",r.info="auto",r=t.push("text","",0),r.content=t.md.normalizeLinkText(n),r=t.push("link_close","a",-1),r.markup="autolink",r.info="auto"),t.pos+=n.length+2,!0):!1):!1},sG=ro.HTML_TAG_RE;function oG(l){return/^<a[>\s]/i.test(l)}function aG(l){return/^<\/a\s*>/i.test(l)}function lG(l){var t=l|32;return t>=97&&t<=122}var cG=function(t,e){var n,i,r,s,o=t.pos;return!t.md.options.html||(r=t.posMax,t.src.charCodeAt(o)!==60||o+2>=r)||(n=t.src.charCodeAt(o+1),n!==33&&n!==63&&n!==47&&!lG(n))||(i=t.src.slice(o).match(sG),!i)?!1:(e||(s=t.push("html_inline","",0),s.content=t.src.slice(o,o+i[0].length),oG(s.content)&&t.linkLevel++,aG(s.content)&&t.linkLevel--),t.pos+=i[0].length,!0)},jc=ll.exports,uG=Xe.has,dG=Xe.isValidEntityCode,Vc=Xe.fromCodePoint,fG=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,hG=/^&([a-z][a-z0-9]{1,31});/i,pG=function(t,e){var n,i,r,s,o=t.pos,a=t.posMax;if(t.src.charCodeAt(o)!==38||o+1>=a)return!1;if(n=t.src.charCodeAt(o+1),n===35){if(r=t.src.slice(o).match(fG),r)return e||(i=r[1][0].toLowerCase()==="x"?parseInt(r[1].slice(1),16):parseInt(r[1],10),s=t.push("text_special","",0),s.content=dG(i)?Vc(i):Vc(65533),s.markup=r[0],s.info="entity"),t.pos+=r[0].length,!0}else if(r=t.src.slice(o).match(hG),r&&uG(jc,r[1]))return e||(s=t.push("text_special","",0),s.content=jc[r[1]],s.markup=r[0],s.info="entity"),t.pos+=r[0].length,!0;return!1};function Gc(l,t){var e,n,i,r,s,o,a,c,u={},d=t.length;if(!!d){var h=0,f=-2,p=[];for(e=0;e<d;e++)if(i=t[e],p.push(0),(t[h].marker!==i.marker||f!==i.token-1)&&(h=e),f=i.token,i.length=i.length||0,!!i.close){for(u.hasOwnProperty(i.marker)||(u[i.marker]=[-1,-1,-1,-1,-1,-1]),s=u[i.marker][(i.open?3:0)+i.length%3],n=h-p[h]-1,o=n;n>s;n-=p[n]+1)if(r=t[n],r.marker===i.marker&&r.open&&r.end<0&&(a=!1,(r.close||i.open)&&(r.length+i.length)%3===0&&(r.length%3!==0||i.length%3!==0)&&(a=!0),!a)){c=n>0&&!t[n-1].open?p[n-1]+1:0,p[e]=e-n+c,p[n]=c,i.open=!1,r.end=e,r.close=!1,o=-1,f=-2;break}o!==-1&&(u[i.marker][(i.open?3:0)+(i.length||0)%3]=o)}}}var gG=function(t){var e,n=t.tokens_meta,i=t.tokens_meta.length;for(Gc(t,t.delimiters),e=0;e<i;e++)n[e]&&n[e].delimiters&&Gc(t,n[e].delimiters)},mG=function(t){var e,n,i=0,r=t.tokens,s=t.tokens.length;for(e=n=0;e<s;e++)r[e].nesting<0&&i--,r[e].level=i,r[e].nesting>0&&i++,r[e].type==="text"&&e+1<s&&r[e+1].type==="text"?r[e+1].content=r[e].content+r[e+1].content:(e!==n&&(r[n]=r[e]),n++);e!==n&&(r.length=n)},pl=dl,Zc=Xe.isWhiteSpace,Kc=Xe.isPunctChar,Xc=Xe.isMdAsciiPunct;function rs(l,t,e,n){this.src=l,this.env=e,this.md=t,this.tokens=n,this.tokens_meta=Array(n.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}rs.prototype.pushPending=function(){var l=new pl("text","",0);return l.content=this.pending,l.level=this.pendingLevel,this.tokens.push(l),this.pending="",l};rs.prototype.push=function(l,t,e){this.pending&&this.pushPending();var n=new pl(l,t,e),i=null;return e<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),n.level=this.level,e>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],i={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(n),this.tokens_meta.push(i),n};rs.prototype.scanDelims=function(l,t){var e=l,n,i,r,s,o,a,c,u,d,h=!0,f=!0,p=this.posMax,g=this.src.charCodeAt(l);for(n=l>0?this.src.charCodeAt(l-1):32;e<p&&this.src.charCodeAt(e)===g;)e++;return r=e-l,i=e<p?this.src.charCodeAt(e):32,c=Xc(n)||Kc(String.fromCharCode(n)),d=Xc(i)||Kc(String.fromCharCode(i)),a=Zc(n),u=Zc(i),u?h=!1:d&&(a||c||(h=!1)),a?f=!1:c&&(u||d||(f=!1)),t?(s=h,o=f):(s=h&&(!f||c),o=f&&(!h||d)),{can_open:s,can_close:o,length:r}};rs.prototype.Token=pl;var vG=rs,Yc=ul,ca=[["text",UV],["linkify",VV],["newline",ZV],["escape",XV],["backticks",YV],["strikethrough",ao.tokenize],["emphasis",lo.tokenize],["link",QV],["image",tG],["autolink",rG],["html_inline",cG],["entity",pG]],ua=[["balance_pairs",gG],["strikethrough",ao.postProcess],["emphasis",lo.postProcess],["fragments_join",mG]];function ss(){var l;for(this.ruler=new Yc,l=0;l<ca.length;l++)this.ruler.push(ca[l][0],ca[l][1]);for(this.ruler2=new Yc,l=0;l<ua.length;l++)this.ruler2.push(ua[l][0],ua[l][1])}ss.prototype.skipToken=function(l){var t,e,n=l.pos,i=this.ruler.getRules(""),r=i.length,s=l.md.options.maxNesting,o=l.cache;if(typeof o[n]<"u"){l.pos=o[n];return}if(l.level<s)for(e=0;e<r&&(l.level++,t=i[e](l,!0),l.level--,!t);e++);else l.pos=l.posMax;t||l.pos++,o[n]=l.pos};ss.prototype.tokenize=function(l){for(var t,e,n=this.ruler.getRules(""),i=n.length,r=l.posMax,s=l.md.options.maxNesting;l.pos<r;){if(l.level<s)for(e=0;e<i&&(t=n[e](l,!1),!t);e++);if(t){if(l.pos>=r)break;continue}l.pending+=l.src[l.pos++]}l.pending&&l.pushPending()};ss.prototype.parse=function(l,t,e,n){var i,r,s,o=new this.State(l,t,e,n);for(this.tokenize(o),r=this.ruler2.getRules(""),s=r.length,i=0;i<s;i++)r[i](o)};ss.prototype.State=vG;var bG=ss,da,Jc;function yG(){return Jc||(Jc=1,da=function(l){var t={};l=l||{},t.src_Any=ih().source,t.src_Cc=rh().source,t.src_Z=sh().source,t.src_P=cl.source,t.src_ZPCc=[t.src_Z,t.src_P,t.src_Cc].join("|"),t.src_ZCc=[t.src_Z,t.src_Cc].join("|");var e="[><\uFF5C]";return t.src_pseudo_letter="(?:(?!"+e+"|"+t.src_ZPCc+")"+t.src_Any+")",t.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",t.src_auth="(?:(?:(?!"+t.src_ZCc+"|[@/\\[\\]()]).)+@)?",t.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",t.src_host_terminator="(?=$|"+e+"|"+t.src_ZPCc+")(?!"+(l["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+t.src_ZPCc+"))",t.src_path="(?:[/?#](?:(?!"+t.src_ZCc+"|"+e+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+t.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+t.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+t.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+t.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+t.src_ZCc+"|[']).)+\\'|\\'(?="+t.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+t.src_ZCc+"|[.]|$)|"+(l["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+t.src_ZCc+"|$)|;(?!"+t.src_ZCc+"|$)|\\!+(?!"+t.src_ZCc+"|[!]|$)|\\?(?!"+t.src_ZCc+"|[?]|$))+|\\/)?",t.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',t.src_xn="xn--[a-z0-9\\-]{1,59}",t.src_domain_root="(?:"+t.src_xn+"|"+t.src_pseudo_letter+"{1,63})",t.src_domain="(?:"+t.src_xn+"|(?:"+t.src_pseudo_letter+")|(?:"+t.src_pseudo_letter+"(?:-|"+t.src_pseudo_letter+"){0,61}"+t.src_pseudo_letter+"))",t.src_host="(?:(?:(?:(?:"+t.src_domain+")\\.)*"+t.src_domain+"))",t.tpl_host_fuzzy="(?:"+t.src_ip4+"|(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%)))",t.tpl_host_no_ip_fuzzy="(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%))",t.src_host_strict=t.src_host+t.src_host_terminator,t.tpl_host_fuzzy_strict=t.tpl_host_fuzzy+t.src_host_terminator,t.src_host_port_strict=t.src_host+t.src_port+t.src_host_terminator,t.tpl_host_port_fuzzy_strict=t.tpl_host_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_port_no_ip_fuzzy_strict=t.tpl_host_no_ip_fuzzy+t.src_port+t.src_host_terminator,t.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+t.src_ZPCc+"|>|$))",t.tpl_email_fuzzy="(^|"+e+'|"|\\(|'+t.src_ZCc+")("+t.src_email_name+"@"+t.tpl_host_fuzzy_strict+")",t.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+t.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+t.tpl_host_port_fuzzy_strict+t.src_path+")",t.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+t.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+t.tpl_host_port_no_ip_fuzzy_strict+t.src_path+")",t}),da}function Ra(l){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(e){!e||Object.keys(e).forEach(function(n){l[n]=e[n]})}),l}function co(l){return Object.prototype.toString.call(l)}function _G(l){return co(l)==="[object String]"}function wG(l){return co(l)==="[object Object]"}function xG(l){return co(l)==="[object RegExp]"}function Qc(l){return co(l)==="[object Function]"}function kG(l){return l.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}var fh={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function EG(l){return Object.keys(l||{}).reduce(function(t,e){return t||fh.hasOwnProperty(e)},!1)}var CG={"http:":{validate:function(l,t,e){var n=l.slice(t);return e.re.http||(e.re.http=new RegExp("^\\/\\/"+e.re.src_auth+e.re.src_host_port_strict+e.re.src_path,"i")),e.re.http.test(n)?n.match(e.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(l,t,e){var n=l.slice(t);return e.re.no_http||(e.re.no_http=new RegExp("^"+e.re.src_auth+"(?:localhost|(?:(?:"+e.re.src_domain+")\\.)+"+e.re.src_domain_root+")"+e.re.src_port+e.re.src_host_terminator+e.re.src_path,"i")),e.re.no_http.test(n)?t>=3&&l[t-3]===":"||t>=3&&l[t-3]==="/"?0:n.match(e.re.no_http)[0].length:0}},"mailto:":{validate:function(l,t,e){var n=l.slice(t);return e.re.mailto||(e.re.mailto=new RegExp("^"+e.re.src_email_name+"@"+e.re.src_host_strict,"i")),e.re.mailto.test(n)?n.match(e.re.mailto)[0].length:0}}},SG="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",AG="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|\u0440\u0444".split("|");function TG(l){l.__index__=-1,l.__text_cache__=""}function NG(l){return function(t,e){var n=t.slice(e);return l.test(n)?n.match(l)[0].length:0}}function eu(){return function(l,t){t.normalize(l)}}function Hs(l){var t=l.re=yG()(l.__opts__),e=l.__tlds__.slice();l.onCompile(),l.__tlds_replaced__||e.push(SG),e.push(t.src_xn),t.src_tlds=e.join("|");function n(o){return o.replace("%TLDS%",t.src_tlds)}t.email_fuzzy=RegExp(n(t.tpl_email_fuzzy),"i"),t.link_fuzzy=RegExp(n(t.tpl_link_fuzzy),"i"),t.link_no_ip_fuzzy=RegExp(n(t.tpl_link_no_ip_fuzzy),"i"),t.host_fuzzy_test=RegExp(n(t.tpl_host_fuzzy_test),"i");var i=[];l.__compiled__={};function r(o,a){throw new Error('(LinkifyIt) Invalid schema "'+o+'": '+a)}Object.keys(l.__schemas__).forEach(function(o){var a=l.__schemas__[o];if(a!==null){var c={validate:null,link:null};if(l.__compiled__[o]=c,wG(a)){xG(a.validate)?c.validate=NG(a.validate):Qc(a.validate)?c.validate=a.validate:r(o,a),Qc(a.normalize)?c.normalize=a.normalize:a.normalize?r(o,a):c.normalize=eu();return}if(_G(a)){i.push(o);return}r(o,a)}}),i.forEach(function(o){!l.__compiled__[l.__schemas__[o]]||(l.__compiled__[o].validate=l.__compiled__[l.__schemas__[o]].validate,l.__compiled__[o].normalize=l.__compiled__[l.__schemas__[o]].normalize)}),l.__compiled__[""]={validate:null,normalize:eu()};var s=Object.keys(l.__compiled__).filter(function(o){return o.length>0&&l.__compiled__[o]}).map(kG).join("|");l.re.schema_test=RegExp("(^|(?!_)(?:[><\uFF5C]|"+t.src_ZPCc+"))("+s+")","i"),l.re.schema_search=RegExp("(^|(?!_)(?:[><\uFF5C]|"+t.src_ZPCc+"))("+s+")","ig"),l.re.schema_at_start=RegExp("^"+l.re.schema_search.source,"i"),l.re.pretest=RegExp("("+l.re.schema_test.source+")|("+l.re.host_fuzzy_test.source+")|@","i"),TG(l)}function DG(l,t){var e=l.__index__,n=l.__last_index__,i=l.__text_cache__.slice(e,n);this.schema=l.__schema__.toLowerCase(),this.index=e+t,this.lastIndex=n+t,this.raw=i,this.text=i,this.url=i}function Ma(l,t){var e=new DG(l,t);return l.__compiled__[e.schema].normalize(e,l),e}function jt(l,t){if(!(this instanceof jt))return new jt(l,t);t||EG(l)&&(t=l,l={}),this.__opts__=Ra({},fh,t),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=Ra({},CG,l),this.__compiled__={},this.__tlds__=AG,this.__tlds_replaced__=!1,this.re={},Hs(this)}jt.prototype.add=function(t,e){return this.__schemas__[t]=e,Hs(this),this};jt.prototype.set=function(t){return this.__opts__=Ra(this.__opts__,t),this};jt.prototype.test=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return!1;var e,n,i,r,s,o,a,c,u;if(this.re.schema_test.test(t)){for(a=this.re.schema_search,a.lastIndex=0;(e=a.exec(t))!==null;)if(r=this.testSchemaAt(t,e[2],a.lastIndex),r){this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+r;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(c=t.search(this.re.host_fuzzy_test),c>=0&&(this.__index__<0||c<this.__index__)&&(n=t.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(s=n.index+n[1].length,(this.__index__<0||s<this.__index__)&&(this.__schema__="",this.__index__=s,this.__last_index__=n.index+n[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(u=t.indexOf("@"),u>=0&&(i=t.match(this.re.email_fuzzy))!==null&&(s=i.index+i[1].length,o=i.index+i[0].length,(this.__index__<0||s<this.__index__||s===this.__index__&&o>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=s,this.__last_index__=o))),this.__index__>=0};jt.prototype.pretest=function(t){return this.re.pretest.test(t)};jt.prototype.testSchemaAt=function(t,e,n){return this.__compiled__[e.toLowerCase()]?this.__compiled__[e.toLowerCase()].validate(t,n,this):0};jt.prototype.match=function(t){var e=0,n=[];this.__index__>=0&&this.__text_cache__===t&&(n.push(Ma(this,e)),e=this.__last_index__);for(var i=e?t.slice(e):t;this.test(i);)n.push(Ma(this,e)),i=i.slice(this.__last_index__),e+=this.__last_index__;return n.length?n:null};jt.prototype.matchAtStart=function(t){if(this.__text_cache__=t,this.__index__=-1,!t.length)return null;var e=this.re.schema_at_start.exec(t);if(!e)return null;var n=this.testSchemaAt(t,e[2],e[0].length);return n?(this.__schema__=e[2],this.__index__=e.index+e[1].length,this.__last_index__=e.index+e[0].length+n,Ma(this,0)):null};jt.prototype.tlds=function(t,e){return t=Array.isArray(t)?t:[t],e?(this.__tlds__=this.__tlds__.concat(t).sort().filter(function(n,i,r){return n!==r[i-1]}).reverse(),Hs(this),this):(this.__tlds__=t.slice(),this.__tlds_replaced__=!0,Hs(this),this)};jt.prototype.normalize=function(t){t.schema||(t.url="http://"+t.url),t.schema==="mailto:"&&!/^mailto:/i.test(t.url)&&(t.url="mailto:"+t.url)};jt.prototype.onCompile=function(){};var RG=jt;const er=2147483647,kn=36,gl=1,Ur=26,MG=38,LG=700,hh=72,ph=128,gh="-",IG=/^xn--/,OG=/[^\0-\x7F]/,FG=/[\x2E\u3002\uFF0E\uFF61]/g,BG={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},fa=kn-gl,En=Math.floor,ha=String.fromCharCode;function ni(l){throw new RangeError(BG[l])}function $G(l,t){const e=[];let n=l.length;for(;n--;)e[n]=t(l[n]);return e}function mh(l,t){const e=l.split("@");let n="";e.length>1&&(n=e[0]+"@",l=e[1]),l=l.replace(FG,".");const i=l.split("."),r=$G(i,t).join(".");return n+r}function ml(l){const t=[];let e=0;const n=l.length;for(;e<n;){const i=l.charCodeAt(e++);if(i>=55296&&i<=56319&&e<n){const r=l.charCodeAt(e++);(r&64512)==56320?t.push(((i&1023)<<10)+(r&1023)+65536):(t.push(i),e--)}else t.push(i)}return t}const vh=l=>String.fromCodePoint(...l),PG=function(l){return l>=48&&l<58?26+(l-48):l>=65&&l<91?l-65:l>=97&&l<123?l-97:kn},tu=function(l,t){return l+22+75*(l<26)-((t!=0)<<5)},bh=function(l,t,e){let n=0;for(l=e?En(l/LG):l>>1,l+=En(l/t);l>fa*Ur>>1;n+=kn)l=En(l/fa);return En(n+(fa+1)*l/(l+MG))},vl=function(l){const t=[],e=l.length;let n=0,i=ph,r=hh,s=l.lastIndexOf(gh);s<0&&(s=0);for(let o=0;o<s;++o)l.charCodeAt(o)>=128&&ni("not-basic"),t.push(l.charCodeAt(o));for(let o=s>0?s+1:0;o<e;){const a=n;for(let u=1,d=kn;;d+=kn){o>=e&&ni("invalid-input");const h=PG(l.charCodeAt(o++));h>=kn&&ni("invalid-input"),h>En((er-n)/u)&&ni("overflow"),n+=h*u;const f=d<=r?gl:d>=r+Ur?Ur:d-r;if(h<f)break;const p=kn-f;u>En(er/p)&&ni("overflow"),u*=p}const c=t.length+1;r=bh(n-a,c,a==0),En(n/c)>er-i&&ni("overflow"),i+=En(n/c),n%=c,t.splice(n++,0,i)}return String.fromCodePoint(...t)},bl=function(l){const t=[];l=ml(l);const e=l.length;let n=ph,i=0,r=hh;for(const a of l)a<128&&t.push(ha(a));const s=t.length;let o=s;for(s&&t.push(gh);o<e;){let a=er;for(const u of l)u>=n&&u<a&&(a=u);const c=o+1;a-n>En((er-i)/c)&&ni("overflow"),i+=(a-n)*c,n=a;for(const u of l)if(u<n&&++i>er&&ni("overflow"),u===n){let d=i;for(let h=kn;;h+=kn){const f=h<=r?gl:h>=r+Ur?Ur:h-r;if(d<f)break;const p=d-f,g=kn-f;t.push(ha(tu(f+p%g,0))),d=En(p/g)}t.push(ha(tu(d,0))),r=bh(i,c,o===s),i=0,++o}++i,++n}return t.join("")},yh=function(l){return mh(l,function(t){return IG.test(t)?vl(t.slice(4).toLowerCase()):t})},_h=function(l){return mh(l,function(t){return OG.test(t)?"xn--"+bl(t):t})},zG={version:"2.1.0",ucs2:{decode:ml,encode:vh},decode:vl,encode:bl,toASCII:_h,toUnicode:yh},qG=Object.freeze(Object.defineProperty({__proto__:null,ucs2decode:ml,ucs2encode:vh,decode:vl,encode:bl,toASCII:_h,toUnicode:yh,default:zG},Symbol.toStringTag,{value:"Module"})),HG=ag(qG);var WG={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},UG={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},jG={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}},zr=Xe,VG=io,GG=zj,ZG=uV,KG=HV,XG=bG,YG=RG,Ni=gr,wh=HG,JG={default:WG,zero:UG,commonmark:jG},QG=/^(vbscript|javascript|file|data):/,eZ=/^data:image\/(gif|png|jpeg|webp);/;function tZ(l){var t=l.trim().toLowerCase();return QG.test(t)?!!eZ.test(t):!0}var xh=["http:","https:","mailto:"];function nZ(l){var t=Ni.parse(l,!0);if(t.hostname&&(!t.protocol||xh.indexOf(t.protocol)>=0))try{t.hostname=wh.toASCII(t.hostname)}catch{}return Ni.encode(Ni.format(t))}function iZ(l){var t=Ni.parse(l,!0);if(t.hostname&&(!t.protocol||xh.indexOf(t.protocol)>=0))try{t.hostname=wh.toUnicode(t.hostname)}catch{}return Ni.decode(Ni.format(t),Ni.decode.defaultChars+"%")}function Qt(l,t){if(!(this instanceof Qt))return new Qt(l,t);t||zr.isString(l)||(t=l||{},l="default"),this.inline=new XG,this.block=new KG,this.core=new ZG,this.renderer=new GG,this.linkify=new YG,this.validateLink=tZ,this.normalizeLink=nZ,this.normalizeLinkText=iZ,this.utils=zr,this.helpers=zr.assign({},VG),this.options={},this.configure(l),t&&this.set(t)}Qt.prototype.set=function(l){return zr.assign(this.options,l),this};Qt.prototype.configure=function(l){var t=this,e;if(zr.isString(l)&&(e=l,l=JG[e],!l))throw new Error('Wrong `markdown-it` preset "'+e+'", check name');if(!l)throw new Error("Wrong `markdown-it` preset, can't be empty");return l.options&&t.set(l.options),l.components&&Object.keys(l.components).forEach(function(n){l.components[n].rules&&t[n].ruler.enableOnly(l.components[n].rules),l.components[n].rules2&&t[n].ruler2.enableOnly(l.components[n].rules2)}),this};Qt.prototype.enable=function(l,t){var e=[];Array.isArray(l)||(l=[l]),["core","block","inline"].forEach(function(i){e=e.concat(this[i].ruler.enable(l,!0))},this),e=e.concat(this.inline.ruler2.enable(l,!0));var n=l.filter(function(i){return e.indexOf(i)<0});if(n.length&&!t)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+n);return this};Qt.prototype.disable=function(l,t){var e=[];Array.isArray(l)||(l=[l]),["core","block","inline"].forEach(function(i){e=e.concat(this[i].ruler.disable(l,!0))},this),e=e.concat(this.inline.ruler2.disable(l,!0));var n=l.filter(function(i){return e.indexOf(i)<0});if(n.length&&!t)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+n);return this};Qt.prototype.use=function(l){var t=[this].concat(Array.prototype.slice.call(arguments,1));return l.apply(l,t),this};Qt.prototype.parse=function(l,t){if(typeof l!="string")throw new Error("Input data should be a String");var e=new this.core.State(l,this,t);return this.core.process(e),e.tokens};Qt.prototype.render=function(l,t){return t=t||{},this.renderer.render(this.parse(l,t),this.options,t)};Qt.prototype.parseInline=function(l,t){var e=new this.core.State(l,this,t);return e.inlineMode=!0,this.core.process(e),e.tokens};Qt.prototype.renderInline=function(l,t){return t=t||{},this.renderer.render(this.parseInline(l,t),this.options,t)};var rZ=Qt;(function(l){l.exports=rZ})(nh);const sZ=lg(nh.exports);class oZ{constructor(t){y(this,"options",{limitHeight:5e3,canvasCache:[],canvasCount:0});if(!t.container)throw new Error("need a cantainer!");this.options={...this.options,...t},t.container.style["line-height"]="0px"}removeCanvas(){const{canvasCache:t}=this.options;t==null||t.forEach(e=>{var n;(n=e==null?void 0:e.parentElement)==null||n.removeChild(e)}),this.options.canvasCache=[]}getCanvas(t){const{canvasCache:e}=this.options;return t=t>0?t-1:t,e?e[t]:void 0}resize(t,e){const{limitHeight:n,canvasCount:i,container:r}=this.options;let{canvasCache:s}=this.options;const o=Math.ceil(e/(n||0));if(o!==i){this.removeCanvas(),s=[];for(let a=0;a<o;a++){const c=document.createElement("canvas");c.style["vertical-align"]="bottom",c.setAttribute("width",t.toString()),a===o-1?c.setAttribute("height",(e%(n||0)).toString()):c.setAttribute("height",(n||0).toString()),r==null||r.appendChild(c),s.push(c)}this.options.canvasCache=s}else{const a=this.getCanvas(o);s==null||s.forEach(c=>{c.setAttribute("width",t.toString())}),a&&a.setAttribute("height",(e%(n||0)).toString())}}handleSingleRect(t){const{x:e,y:n,index:i,width:r,height:s,callback:o}=t,{limitHeight:a}=this.options,c=this.getCanvas(i);if(c){const u=c.getContext("2d"),d=new DOMRect(e,n-(a||0)*(i-1),r,s);o({...d.toJSON(),context:u})}}drawRect(t){const{x:e,y:n,width:i,height:r,fill:s,stroke:o}=t,a=u=>{const{context:d}=u;!d||(d.fillStyle=s===void 0?"#FFEC3D":s,d.strokeStyle=o===void 0?"#FFEC3D":o,d.fillRect(u.x,u.y,u.width,u.height))},c=new DOMRect(e,n,i,r);this.handleRect({...c.toJSON(),callback:a})}handleRect(t){const{x:e,y:n,width:i,height:r,callback:s}=t,{limitHeight:o}=this.options,a={x:e+i,y:n+r},c=Math.ceil(n/(o||0)),u=Math.ceil(a.y/(o||0)),d=new DOMRect(e,n,i,r);this.handleSingleRect({...d.toJSON(),index:c,callback:s}),c!==u&&this.handleSingleRect({...d.toJSON(),index:u,callback:s})}getImageData(t){const{x:e,y:n,width:i,height:r}=t,{limitHeight:s}=this.options,o=Math.ceil(n/(s||0)),a=this.getCanvas(o),c=a==null?void 0:a.getContext("2d");return c==null?void 0:c.getImageData(e,n,i,r)}clearRect(t){const{x:e,y:n,width:i,height:r}=t,s=a=>{const{context:c,x:u,y:d,width:h,height:f}=a;c==null||c.clearRect(u,d,h,f)},o=new DOMRect(e,n,i,r);this.handleRect({...o.toJSON(),callback:s})}clear(){const{canvasCache:t}=this.options;t==null||t.forEach(e=>{const n=e.getContext("2d"),i=Number(e.getAttribute("width")),r=Number(e.getAttribute("height"));n==null||n.clearRect(0,0,i,r)})}destroy(){this.removeCanvas()}}const le="data-element",we="data-id",qn="root",fi=`[${le}="${qn}"]`,Qe="ui",$i=`[${le}="${Qe}"]`,pi="editable",ze=`[${le}="${pi}"]`,Nt="data-transient-attributes",jr="data-transient-element",pa="am-engine",aZ="am-engine-mobile",La="am-engine-view",Tn="anchor",Nn="focus",Dn="cursor",yl="span[".concat(le,"=").concat(Tn,"],anchor"),_l="span[".concat(le,"=").concat(Nn,"],focus"),uo="span[".concat(le,"=").concat(Dn,"],cursor"),lZ="card",ke="data-card-key",We="data-ready-card",pt="data-card-type",je="data-card-value",He="data-card-element",Ct="data-card-loading",an="data-card-editable",ut="div[".concat(ke,"],span[").concat(ke,"]"),tr="div[".concat(We,"],span[").concat(We,"]"),St="span[".concat(He,"=left]"),Ws="div[".concat(He,"=center],span[").concat(He,"=center]"),At="span[".concat(He,"=right]"),fo="trigger-card-id",Un=(typeof navigator<"u"?navigator:window.navigator).userAgent.toLowerCase(),Ia=typeof navigator>"u",wl=/edge/i.test(Un),cZ=!wl&&/chrome/i.test(Un),Oa=/firefox/i.test(Un),Vr=!wl&&!cZ&&/safari/i.test(Un),ue=/mobile/i.test(Un),uZ=/os [\.\_\d]+ like mac os/i.test(Un),Gr=/android/i.test(Un),xn=!uZ&&/mac os x/i.test(Un),dZ=/windows\s*(?:nt)?\s*[\.\_\d]+/i.test(Un),Zr=(l=5)=>{l<5&&(l=5);const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let n=0;n<l;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},Fa=(l,t="lower")=>l.split("-").map((e,n)=>t==="upper"||n>0?e.charAt(0).toUpperCase()+e.substr(1):t==="lower"&&n===0?e.charAt(0).toLowerCase()+e.substr(1):e).join(""),kh=l=>{const t=n=>{const i=parseInt(n,10).toString(16).toUpperCase();return i.length>1?i:"0"+i},e=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/gi;return l.replace(e,(n,i,r,s)=>"#"+t(i)+t(r)+t(s))},fZ=l=>{const t={},e=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g;let n;for(;n=e.exec(l);){const i=(n[1]||n[2]||n[4]||n[6]).toLowerCase(),r=(n[2]?n[3]:n[4]?n[5]:n[7])||"";t[i]=r}return t},nu=new Map,fr=l=>{const t=l.replace(/\s+/g,""),e={};if(!t)return e;const n=nu.get(t);if(n)return Object.assign({},n);const i=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g;let r;for(l=l.toLowerCase();r=i.exec(l);){let[s,o,a]=r;(o.endsWith("color")||a.includes("rgb"))&&(a=kh(a)),e[o.trim()]=a.trim()}return nu.set(t,e),Object.assign({},e)},en=(l,t)=>{const e=Fa(t),n=window.getComputedStyle(l,null);return n?n[e]:""},dt=l=>(l||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),ho=l=>(l||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&"),Eh=l=>l.replace(/&dot;/g,"."),ga=(l,t="px")=>l&&/^-?\d+(?:\.\d+)?$/.test(l.toString())?l+t:l,Ee=l=>{let t;return l&&(t=/^((-?\d+)(\.\d+)?)/.exec(l))?Math.floor(parseFloat(t[1])*1e4)/1e4:0},Pi=l=>{let t="";try{t=encodeURIComponent(JSON.stringify(l||""))}catch{}return"data:".concat(t)},at=l=>{try{return l=l.substr(5),JSON.parse(decodeURIComponent(l))}catch{return{}}},Oi=l=>l.replace(/<anchor\s*\/>/gi,"<span ".concat(le,'="').concat(Tn,'"></span>')).replace(/<focus\s*\/>/gi,"<span ".concat(le,'="').concat(Nn,'"></span>')).replace(/<cursor\s*\/>/gi,"<span ".concat(le,'="').concat(Dn,'"></span>')).replace(/(<card\s+[^>]+>).*?<\/card>/gi,(t,e)=>{const n=fZ(e),{type:i,name:r,value:s,editable:o}=n,c=i==="inline"?"span":"div",u=["<".concat(c)];return u.push(" ".concat(pt,'="').concat(i||"",'"')),u.push(" ".concat(We,'="').concat(r||"",'"')),o!==""&&u.push(" ".concat(an,'="').concat(o||"false",'"')),Object.keys(n).forEach(d=>{d.indexOf("data-")===0&&d.indexOf("data-card")!==0&&u.push(" ".concat(d,'="').concat(n[d]||"",'"'))}),s!==void 0&&u.push(" ".concat(je,'="').concat(s,'"')),u.push("></".concat(c,">")),u.join("")}),Ch=l=>typeof l!="string"||(l=l.toLowerCase(),l.startsWith("data:text/html"))||!l.match(/^\S*$/)?!1:!!(["http:","https:","data:","ftp:"].some(t=>l.startsWith(t))||l.startsWith("./")||l.startsWith("/")||l.indexOf(":")<0),Sn=l=>Ch(l)?l:"",Sh=l=>{let t=l.toLowerCase().split("+");return t=t.map(e=>e==="mod"?xn?"\u2318":"Ctrl":e==="opt"?xn?"Option":"Alt":e.length>1?e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase():e.toUpperCase()),t.join("+")},iu=(l,t=0)=>{if(!(t=+t))return"\u2022";switch(l==null?void 0:l.toLowerCase()){case"disc":return"\u2022";case"circle":return"\u25E6";case"square":return"\u25FC";case"lower-alpha":return String.fromCharCode("a".charCodeAt(0)+t);case"lower-roman":return String.fromCharCode(8559+t);case"decimal":default:return t}},it=l=>{if(typeof document>"u"&&typeof global.__amWindow>"u")throw"document is not defined,If you are using ssr, you can assign a value to the `__amWindow` global variable.";return l?l.ownerDocument||l.document||l:typeof document>"u"?global.__amWindow.document:document},hZ=l=>{l instanceof Node||(l=l[0]),l.normalize()},Ba=l=>l.nodeType===it().ELEMENT_NODE&&l.getAttribute(le)===qn?void 0:l.parentNode||void 0,V=l=>l.kind==="engine",po=(l,t="default")=>{const e=new sZ(t,{html:!0,typographer:!0,linkify:!0});return l.trigger("markdown-it",e),e},xl=(l,t,e,n=!0)=>{const{renderer:i,options:r}=t;let s=!1;const o=l.schema.getTags("blocks");let a="",c=[];return e.forEach((u,d)=>{var b;const{type:h,tag:f,children:p,nesting:g}=u;if(l.trigger("markdown-it-token",{token:u,markdown:t,callback:_=>{a+=_}})===!1){s=!0;return}let v="";h==="inline"&&p?(v=i.renderInline(p,r,{}),n&&p.find(_=>_.type==="image"||_.type.endsWith("_open"))&&(s=!0)):typeof i.rules[h]<"u"?v=i.rules[h](e,d,r,{},i):v=i.renderToken(e,d,r),g===1?(c.push(""),a+=v):g===0?c.length===0?(a+=v,f&&!s&&(s=!0)):v&&(c[c.length-1]+=v):g===-1&&(c.length>0&&!c[c.length-1]&&o.includes(f)&&(c[c.length-1]+="<br />"),a+=(b=c[c.length-1])!=null?b:"",c.pop(),c.every(_=>!_)&&(c=[]),a+=v,!s&&f!=="p"&&(s=!0))}),s&&a?a:null},Fe={TAG_NAME:0,ATTRIBUTE:1,ELEMENT:2},Bn="data-uuid",ma="data-color";class Ah{constructor(){y(this,"listeners",{})}on(t,e,n){this.listeners[t]||(this.listeners[t]=[]),(typeof n!="object"||!n.once)&&this.listeners[t].push(e)}off(t,e){const n=this.listeners[t];if(!!n){for(let i=0;i<n.length;i++)if(n[i]===e){n.splice(i,1);break}}}trigger(t,...e){const n=this.listeners[t];if(n){let i;return n.every(r=>(i=r(...e),typeof i!="boolean"||i!==!1)),i}}destroy(){Object.keys(this.listeners).forEach(t=>{this.listeners[t].forEach(e=>{this.off(t,e)})})}}const ft=l=>!!l&&l.get!==void 0,pZ=l=>!!l&&l.entries!==void 0,be=l=>!!l&&l.nodeType!==void 0,$a=(l,t)=>{if(l.nodeType!==Node.ELEMENT_NODE||!t)return!1;const e=(i,r)=>{var a;let s=(a=it(i))==null?void 0:a.querySelectorAll(r),o=s?s.length:0;for(;--o>=0&&(s==null?void 0:s.item(o))!==i;);return o>-1};return(l.matches||l.webkitMatchesSelector||l.mozMatchesSelector||l.msMatchesSelector||l.oMatchesSelector||l.matchesSelector||e).call(l,t)},li=l=>l.nodeName===lZ||!!l.getAttribute(pt),gZ=l=>l.getAttribute(pt)==="block",mZ=l=>l.getAttribute(pt)==="inline",Lr=l=>l.getAttribute(le)===pi||l.getAttribute(an)==="true"||!!(l!=null&&l.querySelector(ze)),hr=(l,t)=>l.getAttribute(le)===qn&&(!t||l===t),Th=l=>hr(l)||l.getAttribute(le)===pi,vZ=(l,t)=>{if(l.nodeType===Node.ELEMENT_NODE&&hr(l,t))return!1;const e=Kr(l,fi);return!!e&&(!t||e===t)},bZ=l=>{const t=l.getAttribute(le);return!!t&&[Tn,Nn,Dn].indexOf(t)>-1},Kr=(l,t,e=n=>n.parentElement||void 0)=>{let n=l||void 0;for(;n;){if($a(n,t))return n;n=e(n)}return n},ru=new Map;function Ai(l,t){if(!l)return[];if(typeof l=="string"){if(!t||/<[^>]+>/g.test(l)){const e=l.indexOf("<tr")===0,n=l.indexOf("<td")===0;l=l.trim().replace(/<!--[^>]*-->/g,"");const i=ru.get(l);if(i){if(e){const s=i.querySelector("tbody");return s?s.cloneNode(!0).childNodes:[]}if(n){const s=i.querySelector("tr");return s?s.cloneNode(!0).childNodes:[]}return i.cloneNode(!0).childNodes}e&&(l="<table><tbody>".concat(l,"</tbody></table>")),n&&(l="<table><tbody><tr>".concat(l,"</tr></tbody></table>"));const r=it().createElement("div");if(r.innerHTML=l,ru.set(l,r.cloneNode(!0)),e){const s=r.querySelector("tbody");return s?s.childNodes:[]}if(n){const s=r.querySelector("tr");return s?s.childNodes:[]}return r.childNodes}return t.querySelectorAll(l)}if(pZ(l)||Array.isArray(l))return l;if(ft(l)){const e=[];return l.each(n=>{e.push(n)}),e}if(be(l)&&l.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const e=[];for(const n of l.childNodes)e.push(n);return e}return[l]}class st{constructor(t,e){y(this,"events",[]);y(this,"document",null);y(this,"context");y(this,"name","");y(this,"type");y(this,"window",null);y(this,"display");y(this,"fragment");be(t)&&(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(this.fragment=t),t=[t]),t.forEach((i,r)=>{this[r]=i,this.events[r]=new Ah});const n=this[0];if(n){this.document=it(e),this.context=e;const{nodeName:i,nodeType:r}=n;this.name=i.toLowerCase(),this.type=r,this.window=this.document.defaultView||window}}get length(){let t=0;for(;this[t];)t++;return t}each(t){let e=0,n;for(;(n=this[e])&&t(n,e)!==!1;)e++;return this}toArray(){const t=[];return this.each(e=>{t.push(new st(e))}),t}isElement(){return this.type===Node.ELEMENT_NODE}isText(){return this.type===Node.TEXT_NODE}isCard(){const t=this.get();return(t==null?void 0:t.nodeType)===Node.ELEMENT_NODE&&li(t)}isBlockCard(){const t=this.get();return(t==null?void 0:t.nodeType)===Node.ELEMENT_NODE&&gZ(t)}isInlineCard(){const t=this.get();return(t==null?void 0:t.nodeType)===Node.ELEMENT_NODE&&mZ(t)}isEditableCard(){const t=this.get();return(t==null?void 0:t.nodeType)===Node.ELEMENT_NODE&&Lr(t)}isRoot(t){var n;const e=this.get();return(e==null?void 0:e.nodeType)===Node.ELEMENT_NODE&&hr(e,t?(n=t[0])!=null?n:t:void 0)}isEditable(){const t=this.get();return(t==null?void 0:t.nodeType)===Node.ELEMENT_NODE&&Th(t)}inEditor(t){var n;const e=this.get();return!!e&&vZ(e,t?(n=t[0])!=null?n:t:void 0)}isCursor(){const t=this.get();return(t==null?void 0:t.nodeType)===Node.ELEMENT_NODE&&bZ(t)}get(t=0){return this.length===0?null:this[t]}eq(t){return t>-1&&t<this.length?new st(this[t]):void 0}index(){var n;let t=(n=this.get())==null?void 0:n.previousSibling,e=0;for(;t&&t.nodeType===Node.ELEMENT_NODE;)e++,t=t.previousSibling;return e}parent(){var e;const t=(e=this.get())==null?void 0:e.parentNode;return t?new st(t):void 0}children(t){if(this.length===0)return new st([]);const e=this.get().childNodes;if(t){let n=[];for(let i=0;i<e.length;i++){const r=e[i];$a(r,t)&&n.push(r)}return new st(n)}return new st(e)}first(){var e;if(this.fragment)return this.eq(0)||null;const t=this.length===0?null:(e=this.get())==null?void 0:e.firstChild;return t?new st(t):null}last(){var e;if(this.fragment)return this.eq(this.length-1)||null;const t=this.length===0?null:(e=this.get())==null?void 0:e.lastChild;return t?new st(t):null}prev(){var e;const t=this.length===0?null:(e=this.get())==null?void 0:e.previousSibling;return t?new st(t):null}next(){var e;const t=this.length===0?null:(e=this.get())==null?void 0:e.nextSibling;return t?new st(t):null}prevElement(){const t=this.length===0?null:this.get().previousElementSibling;return t?new st(t):null}nextElement(){const t=this.length===0?null:this.get().nextElementSibling;return t?new st(t):null}getPath(t,e,n){t=t||document.body;let i=[];if(this.length>0){const s=this.getIndex(e);if(n){const o=n(s,i,this);o&&(i=o)}else i.unshift(s)}if(this.equal(t))return i;let r=this.parent();for(;r&&!r.equal(t);){const s=r.getIndex(e);if(n){const o=n(s,i,r);o&&(i=o)}else i.unshift(s);r=r.parent()}return i}contains(t){let e=be(t)?t:t.get();if(this.length===0)return!1;if(this.get().nodeType===Node.DOCUMENT_NODE&&(e==null?void 0:e.nodeType)!==Node.DOCUMENT_NODE||e===this[0])return!0;for(;e=(e==null?void 0:e.parentNode)||null;)if(e===this[0])return!0;return!1}find(t){var e;if(this.length>0&&(this.isElement()||this.fragment)){const n=(e=this.fragment?this.fragment:this.get())==null?void 0:e.querySelectorAll(t);return new st(n||[])}return new st([])}closest(t,e=n=>n.parentNode||void 0){const n=[];let i=this.get()||void 0;for(;i;){if($a(i,t))return n.push(i),new st(n);i=e(i)}return new st(n)}on(t,e,n){return this.each((i,r)=>{i.addEventListener(t,e,n),this.events[r]&&this.events[r].on(t,e,n)}),this}off(t,e,n){return this.each((i,r)=>{i.removeEventListener(t,e,n),this.events[r]&&this.events[r].off(t,e,n)}),this}getBoundingClientRect(t){if(this.length!==0){try{const n=this.get().getBoundingClientRect(),i=document.documentElement.clientTop,r=document.documentElement.clientLeft;return{top:n.top-i,bottom:n.bottom-i,left:n.left-r,right:n.right-r}}catch(e){console.error(e)}return t}}removeAllEvents(){return this.each((t,e)=>{!this.events[e]||Object.keys(this.events[e].listeners).forEach(n=>{const i=this.events[e].listeners[n];for(let r=0;r<i.length;r++)this.off(n,i[r]),this.events[e].off(n,i[r]),t.removeEventListener(n,i[r],!1)})}),this}attributes(t,e){if(t===void 0){const i=this.get();if(!i)return{};const r={},s=i.attributes;for(let o=s.length;o--;){const a=s[o];r[a.name]=a.value}return r}if(typeof t=="object"){for(const i in t){const r=t[i];this.attributes(i,r)}return this}if(e===void 0){const i=this.get();return this.length>0&&this.isElement()&&(i==null?void 0:i.getAttribute(t))||""}const n=t==="style"&&e==="";return this.each(i=>{const r=i;n?r.removeAttribute("style"):r.setAttribute(t,e.toString())}),this}removeAttributes(t){return this.each(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;e.removeAttribute(t)}),this}hasClass(t){if(this.length===0)return!1;const e=this.get();if(!e)return!1;let n=0,i=null;const r=e.classList||{};for(;i=r[n];){if(i===t)return!0;n++}return!1}addClass(t){return this.each(e=>{e.classList.add(t)}),this}removeClass(t){return this.each(e=>{e.classList.remove(t)}),this}css(t,e){if(t===void 0)return fr(this.attributes("style")||"");if(typeof t=="object"){for(const n in t){const i=t[n];this.css(n,i)}return this}if(e===void 0){if(this.length===0||this.isText())return"";const n=this.get();return n&&(n.style[Fa(t)]||en(this[0],t))||""}return this.each(n=>{const i=n;i.style[Fa(t)]=e.toString(),i.style.length===0&&i.removeAttribute("style")}),this}width(){let t=this.css("width");return t==="auto"&&(t=this.get().offsetWidth.toString()),t&&Ee(t)||0}height(){let t=this.css("height");return t==="auto"&&(t=this.get().offsetHeight.toString()),t&&parseFloat(t)||0}html(t){if(t!==void 0){const e=Ai(t);return this.each(n=>{if(n.nodeType!==Node.ELEMENT_NODE)return;let i=n.firstChild;for(;i;){const r=i.nextSibling;n.removeChild(i),i=r}e.forEach(r=>{n.appendChild(r.cloneNode(!0))})}),this}return this.length>0?this[0].innerHTML:""}text(t){var e;return t!==void 0?(this.each(n=>{n.textContent=t}),this):this.length===0?"":((e=this.get())==null?void 0:e.textContent)||""}show(t){return t===void 0&&(t=this.display||""),t==="none"&&(t=""),this.css("display")!=="none"?this:this.css("display",t)}hide(){var t;return this.length===0?this:(this.display=(t=this.get())==null?void 0:t.style.display,this.css("display","none"))}remove(){return this.each((t,e)=>{!t.parentNode||(t.parentNode.removeChild(t),delete this[e])}),this}empty(){return this.each(t=>{let e=t.firstChild;for(;e;){const n=e.nextSibling;t.removeChild(e),e=n}}),this}equal(t){return be(t)?this.get()===t:ft(t)?this.get()===t.get():!1}clone(t){const e=[];return this.each(n=>{e.push(n.cloneNode(t))}),new st(e)}prepend(t){const e=Ai(t,this.context),n=typeof t=="string"&&/<.+>/.test(t);return this.each(i=>{for(let r=e.length-1;r>=0;r--){const s=n?e[r].cloneNode(!0):e[r];i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s)}}),this}append(t){const e=Ai(t,this.context),n=typeof t=="string"&&/<.+>/.test(t);return this.each(i=>{for(let r=0;r<e.length;r++){const s=n?e[r].cloneNode(!0):e[r];typeof t=="string"?i.append(s):i.appendChild(s)}}),this}before(t){const e=Ai(t,this.context),n=typeof t=="string"&&/<.+>/.test(t);return this.each(i=>{const r=i.parentNode;!r||e.forEach(s=>{n&&(s=s.cloneNode(!0)),r.insertBefore(s,i),i=s})}),this}after(t){const e=Ai(t,this.context),n=typeof t=="string"&&/<.+>/.test(t);return this.each(i=>{const r=i.parentNode;!r||e.forEach(s=>{n&&(s=s.cloneNode(!0)),i.nextSibling?(r.insertBefore(s,i.nextSibling),i=s):r.appendChild(s)})}),this}replaceWith(t){const e=[],n=Ai(t,this.context),i=typeof t=="string"&&/<.+>/.test(t);return this.each(r=>{const s=r.parentNode;if(!s)return;const o=i?n[0].cloneNode(!0):n[0];try{s.replaceChild(o,r),e.push(o)}catch{}}),new st(e)}getRoot(){return this.closest(fi)}traverse(t,e=!0,n=!1,i,r){const s=o=>{let a=o.isCard();if(a&&(!n||n==="editable"&&!o.isEditableCard()))return;let c=e?o.first():o.last();for(;c;){const u=e?c.next():c.prev();i&&i(c);const d=t(c);if(d===!1){r&&r(c,u);return}if(d!==!0){const h=d&&typeof d!="boolean";if(h&&(r&&r(c,d),c=d),a=c.isCard(),a){if(n===!0)h&&t(c),s(c);else if(n==="editable"&&c.isEditableCard()){const f=c.find(ze);f.each((p,g)=>{const m=f.eq(g);m&&s(m)})}}else h&&t(c),s(c)}r&&r(c,u),c=u}};t(this),s(this)}getChildByPath(t,e){let n=this.get();if(t.length===0)return n;const i=r=>{let s=0;for(const o of n.childNodes)if(!(e&&!e(o))){if(s==r)return o;s++}};for(let r=0;t[r]!==void 0;){const s=i(t[r]);if(!s)break;n=s,r++}return n}getIndex(t){const e=this[0].parentNode;if(!e)return 0;let n=0;for(const i of e.childNodes)if(!(t&&!t(i))){if(i===this[0])return n;n++}return-1}findParent(t=this.closest(fi)){var i;const e=(i=t[0])!=null?i:t;if(this.length===0||!e.parentNode)return null;let n=this[0];for(;n.parentNode!==e;){if(!n.parentNode)return null;n=n.parentNode}return new st(n)}allChildren(t=!1){const e=[];return this.traverse(n=>{e.push(n)},void 0,t),e.shift(),e}getViewport(){var c;const{innerHeight:t,innerWidth:e}=this.window||{innerHeight:0,innerWidth:0},n=this.isText()?(c=this.parent())==null?void 0:c.get():this.get();if(!n)return{top:0,left:0,bottom:0,right:0};const i=n.getBoundingClientRect(),{top:r,left:s,bottom:o,right:a}=i;return{top:r,left:s,bottom:Math.min(o,t),right:Math.min(a,e)}}inViewport(t,e=!1){var u,d,h;let n=null;if(t.type!==Node.ELEMENT_NODE){if(!t.document)return!1;n=t.document.createElement("span"),t.next()?(u=t[0].parentNode)==null||u.insertBefore(n,t[0].nextSibling):(d=t[0].parentNode)==null||d.appendChild(n),t=new st(n)}const i=t.get();if(!i)return!0;const{top:r,left:s,right:o,bottom:a}=i.getBoundingClientRect(),c=this.getViewport();return n&&((h=n.parentNode)==null||h.removeChild(n)),e?r>0&&r<=c.bottom||a>0&&a<=c.bottom:r>0&&r>=c.top&&s>0&&s>=c.left&&a<=c.bottom&&o<=c.right}scrollIntoView(t,e="nearest"){var n,i,r,s;if(typeof((n=t.document)==null?void 0:n.body.scrollIntoView)=="function"){let o=null;(t.type!==Node.ELEMENT_NODE||t.name.toLowerCase()==="br")&&(o=t.document.createElement("span"),o.innerHTML="&nbsp;",(i=t[0].parentNode)==null||i.insertBefore(o,t[0]),t=new st(o)),this.inViewport(t)||(r=t.get())==null||r.scrollIntoView({block:e,inline:e}),o&&((s=o.parentNode)==null||s.removeChild(o))}}}const I=(l,t,e)=>{t===void 0&&(t=it());const n=Ai(l,t),i=new(e||st)(n,t||void 0);return be(l)&&l.nodeType===window.Node.DOCUMENT_FRAGMENT_NODE&&(i.fragment=l),i},yZ=[{from:(l,t,e)=>!!e[ke]||!!e[We],to:(l,t,e)=>{const n=e[je],i={...e};e={type:e[pt],name:(e[ke]||e[We]).toLowerCase(),editable:e[an],[we]:e[we]};for(const s in i)s!==We&&s.indexOf("data-")===0&&s.indexOf("data-card")!==0&&(e[s]=i[s]);n!==void 0&&(e.value=n);const r=I("<card />");for(const s in e)r.attributes(s,e[s]);return r}},{from:(l,t,e)=>(l==="div"||l==="section")&&(!e[ke]||!e[We])&&e[le]!==qn,to:(l,t,e)=>{const n=I("<p />");n.css(t);for(const i in e)n.attributes(i,e[i]);return n}},{from:l=>[Dn,Tn,Nn].includes(l),to:l=>({node:I(`<${l} />`),replace:!0})}],_Z=[{type:"block",attributes:{[we]:"*"}},{name:"p",type:"block",allowIn:["$root"]},{name:"br",type:"inline",isVoid:!0},{name:Tn,type:"inline",isVoid:!0},{name:Nn,type:"inline",isVoid:!0},{name:Dn,type:"inline",isVoid:!0},{name:"span",type:"mark",attributes:{[le]:{required:!0,value:["anchor","cursor","focus"]}}},{name:"card",type:"inline",attributes:{name:{required:!0,value:/\w+/},type:{required:!0,value:"inline"},editable:"*",value:"*"}},{name:"span",type:"inline",attributes:{[ke]:{required:!0,value:/\w+/},[pt]:{required:!0,value:"inline"},[je]:"*",[an]:"*",class:"*",contenteditable:"*"}},{name:"span",type:"inline",attributes:{[We]:{required:!0,value:/\w+/},[pt]:{required:!0,value:"inline"},[je]:"*",[an]:"*",class:"*",contenteditable:"*"}},{name:"card",type:"block",attributes:{name:{required:!0,value:/\w+/},type:{required:!0,value:"block"},editable:"*",value:"*"}},{name:"div",type:"block",attributes:{[ke]:{required:!0,value:/\w+/},[pt]:{required:!0,value:"block"},[je]:"*",[an]:"*",class:"*",contenteditable:"*"}},{name:"div",type:"block",attributes:{[We]:{required:!0,value:/\w+/},[pt]:{required:!0,value:"block"},[je]:"*",[an]:"*",class:"*",contenteditable:"*"}}],yt="contenteditable";var Nh={exports:{}};(function(l){(function(t){function e(w,E){var S=(w&65535)+(E&65535),R=(w>>16)+(E>>16)+(S>>16);return R<<16|S&65535}function n(w,E){return w<<E|w>>>32-E}function i(w,E,S,R,D,P){return e(n(e(e(E,w),e(R,P)),D),S)}function r(w,E,S,R,D,P,O){return i(E&S|~E&R,w,E,D,P,O)}function s(w,E,S,R,D,P,O){return i(E&R|S&~R,w,E,D,P,O)}function o(w,E,S,R,D,P,O){return i(E^S^R,w,E,D,P,O)}function a(w,E,S,R,D,P,O){return i(S^(E|~R),w,E,D,P,O)}function c(w,E){w[E>>5]|=128<<E%32,w[(E+64>>>9<<4)+14]=E;var S,R,D,P,O,L=1732584193,B=-271733879,A=-1732584194,F=271733878;for(S=0;S<w.length;S+=16)R=L,D=B,P=A,O=F,L=r(L,B,A,F,w[S],7,-680876936),F=r(F,L,B,A,w[S+1],12,-389564586),A=r(A,F,L,B,w[S+2],17,606105819),B=r(B,A,F,L,w[S+3],22,-1044525330),L=r(L,B,A,F,w[S+4],7,-176418897),F=r(F,L,B,A,w[S+5],12,1200080426),A=r(A,F,L,B,w[S+6],17,-1473231341),B=r(B,A,F,L,w[S+7],22,-45705983),L=r(L,B,A,F,w[S+8],7,1770035416),F=r(F,L,B,A,w[S+9],12,-1958414417),A=r(A,F,L,B,w[S+10],17,-42063),B=r(B,A,F,L,w[S+11],22,-1990404162),L=r(L,B,A,F,w[S+12],7,1804603682),F=r(F,L,B,A,w[S+13],12,-40341101),A=r(A,F,L,B,w[S+14],17,-1502002290),B=r(B,A,F,L,w[S+15],22,1236535329),L=s(L,B,A,F,w[S+1],5,-165796510),F=s(F,L,B,A,w[S+6],9,-1069501632),A=s(A,F,L,B,w[S+11],14,643717713),B=s(B,A,F,L,w[S],20,-373897302),L=s(L,B,A,F,w[S+5],5,-701558691),F=s(F,L,B,A,w[S+10],9,38016083),A=s(A,F,L,B,w[S+15],14,-660478335),B=s(B,A,F,L,w[S+4],20,-405537848),L=s(L,B,A,F,w[S+9],5,568446438),F=s(F,L,B,A,w[S+14],9,-1019803690),A=s(A,F,L,B,w[S+3],14,-187363961),B=s(B,A,F,L,w[S+8],20,1163531501),L=s(L,B,A,F,w[S+13],5,-1444681467),F=s(F,L,B,A,w[S+2],9,-51403784),A=s(A,F,L,B,w[S+7],14,1735328473),B=s(B,A,F,L,w[S+12],20,-1926607734),L=o(L,B,A,F,w[S+5],4,-378558),F=o(F,L,B,A,w[S+8],11,-2022574463),A=o(A,F,L,B,w[S+11],16,1839030562),B=o(B,A,F,L,w[S+14],23,-35309556),L=o(L,B,A,F,w[S+1],4,-1530992060),F=o(F,L,B,A,w[S+4],11,1272893353),A=o(A,F,L,B,w[S+7],16,-155497632),B=o(B,A,F,L,w[S+10],23,-1094730640),L=o(L,B,A,F,w[S+13],4,681279174),F=o(F,L,B,A,w[S],11,-358537222),A=o(A,F,L,B,w[S+3],16,-722521979),B=o(B,A,F,L,w[S+6],23,76029189),L=o(L,B,A,F,w[S+9],4,-640364487),F=o(F,L,B,A,w[S+12],11,-421815835),A=o(A,F,L,B,w[S+15],16,530742520),B=o(B,A,F,L,w[S+2],23,-995338651),L=a(L,B,A,F,w[S],6,-198630844),F=a(F,L,B,A,w[S+7],10,1126891415),A=a(A,F,L,B,w[S+14],15,-1416354905),B=a(B,A,F,L,w[S+5],21,-57434055),L=a(L,B,A,F,w[S+12],6,1700485571),F=a(F,L,B,A,w[S+3],10,-1894986606),A=a(A,F,L,B,w[S+10],15,-1051523),B=a(B,A,F,L,w[S+1],21,-2054922799),L=a(L,B,A,F,w[S+8],6,1873313359),F=a(F,L,B,A,w[S+15],10,-30611744),A=a(A,F,L,B,w[S+6],15,-1560198380),B=a(B,A,F,L,w[S+13],21,1309151649),L=a(L,B,A,F,w[S+4],6,-145523070),F=a(F,L,B,A,w[S+11],10,-1120210379),A=a(A,F,L,B,w[S+2],15,718787259),B=a(B,A,F,L,w[S+9],21,-343485551),L=e(L,R),B=e(B,D),A=e(A,P),F=e(F,O);return[L,B,A,F]}function u(w){var E,S="",R=w.length*32;for(E=0;E<R;E+=8)S+=String.fromCharCode(w[E>>5]>>>E%32&255);return S}function d(w){var E,S=[];for(S[(w.length>>2)-1]=void 0,E=0;E<S.length;E+=1)S[E]=0;var R=w.length*8;for(E=0;E<R;E+=8)S[E>>5]|=(w.charCodeAt(E/8)&255)<<E%32;return S}function h(w){return u(c(d(w),w.length*8))}function f(w,E){var S,R=d(w),D=[],P=[],O;for(D[15]=P[15]=void 0,R.length>16&&(R=c(R,w.length*8)),S=0;S<16;S+=1)D[S]=R[S]^909522486,P[S]=R[S]^1549556828;return O=c(D.concat(d(E)),512+E.length*8),u(c(P.concat(O),512+128))}function p(w){var E="0123456789abcdef",S="",R,D;for(D=0;D<w.length;D+=1)R=w.charCodeAt(D),S+=E.charAt(R>>>4&15)+E.charAt(R&15);return S}function g(w){return unescape(encodeURIComponent(w))}function m(w){return h(g(w))}function v(w){return p(m(w))}function b(w,E){return f(g(w),g(E))}function _(w,E){return p(b(w,E))}function x(w,E,S){return E?S?b(E,w):_(E,w):S?m(w):v(w)}l.exports?l.exports=x:t.md5=x})(is)})(Nh);const wZ=Nh.exports,va={},xZ=(l,t=16)=>{const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");let n=[],i;if(t=t||e.length,t>e.length&&(t=e.length),l)for(i=0;i<l;i++)n[i]=e[0|Math.random()*t];else{let r;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",i=0;i<36;i++)n[i]||(r=0|Math.random()*16,n[i]=e[i==19?r&3|8:r])}return n.join("")},su=new Map,kl=(l,t=!0)=>{var r,s;let e="";if(typeof l!="string"){let o=(r=l[0])!=null?r:l;if(o.nodeType===Node.ELEMENT_NODE){const a=o,c=a.localName;e=c.substring(0,1),l=c;const u=a.attributes;for(let d=u.length;d--;){const h=u[d];[we,"id"].includes(h.name)||(l+=`${h.name}="${h.value}"`)}}else l=(s=o.textContent)!=null?s:""}const n=su.get(l);if(n)e=n;else{const o=wZ(l);e=e+o.substr(0,4)+o.substr(o.length-3),su.set(l,e)}const i=e;if(t){const o=va[i]||0;return va[i]=o+1,`${i}-${xZ(8,48+va[i])}`}return i};class kZ{constructor(t){y(this,"editor");y(this,"addBrForBlock",t=>{if(t.isText())return;const e=t.get().childNodes;let n=0,i=!0,r=!1;const s=t.name==="p";for(const o of e)if(i&&o.nodeType===Node.TEXT_NODE?i=!1:!s&&!r&&o.nodeType===Node.ELEMENT_NODE&&this.isBlock(o)&&(r=!0),o.nodeType===Node.ELEMENT_NODE&&[Tn,Nn,Dn].indexOf(o.getAttribute(le)||"")<1&&n++,!i&&n>1)break;if(s&&n===0){const o=document.createElement("br");t.each(a=>{a.appendChild(o.cloneNode())})}!r&&i&&this.isBlock(t)&&(e.length!==1||e[0].nodeName!=="BR")&&this.isEmptyWithTrim(t)&&(t.empty(),t.append(document.createElement("br")))});this.editor=t}isVoid(t,e=this.editor.schema){let n=typeof t=="string"?t:"";return be(t)?n=t.nodeName.toLowerCase():ft(t)&&(n=t.name),e.find(i=>i.name===n&&i.isVoid===!0).length>0}isMark(t,e=this.editor.schema){var n,i;return e.getTags("marks").includes(((i=(n=t.nodeName)==null?void 0:n.toLowerCase())!=null?i:t.name).toLowerCase())&&e.getType(t)==="mark"}isInline(t,e=this.editor.schema){var n,i;return e.getTags("inlines").includes((i=(n=t.nodeName)==null?void 0:n.toLowerCase())!=null?i:t.name)&&e.getType(t)==="inline"}isBlock(t,e=this.editor.schema){var n,i;return e.getTags("blocks").includes(((i=(n=t.nodeName)==null?void 0:n.toLowerCase())!=null?i:t.name).toLowerCase())&&e.getType(t)==="block"}isNestedBlock(t){if(!this.isBlock(t))return!1;const e=t.length?t[0]:t;if(!e)return!1;let n=e.firstChild;for(;n;){if(this.isBlock(n))return!1;n=n.nextSibling}return!0}isRootBlock(t,e){var n;return!((n=t.parent())!=null&&n.isEditable())||!this.isNestedBlock(t)?!1:(e||this.editor.schema).find(i=>i.name===t.name).every(i=>{if(i.type!=="block")return!1;const r=i.allowIn;return r?r.indexOf("$root")>-1:!0})}isEmpty(t,e){var i;if(t.length>0&&t.isElement()){const r=t.attributes(),s=(i=t.fragment)!=null?i:t.get(),o=Array.from(s.querySelectorAll(`${ut},${tr},${ze},br`));if(r[ke]||r[We]||o.some(a=>a.hasAttribute(ke)||a.hasAttribute(We))&&!o.some(a=>a.getAttribute(le)===pi)||t.name!=="br"&&this.isVoid(t)||o.filter(a=>a.localName==="br").length>1)return!1}let n=t.isText()?t[0].nodeValue||"":t.text();return n=n==null?void 0:n.replace(/\u200B/g,""),n=n==null?void 0:n.replace(/\r\n|\n/,""),n&&e&&(n=n.trim()),n===""}isEmptyWithTrim(t){return this.isEmpty(t,!0)}isEmptyWidthChild(t){if(t.length===0)return!0;if(t.isCard())return!1;if(t.isText())return this.isEmpty(t);const{childNodes:e}=t[0];if(e.length===0)return!0;for(let n=0;n<e.length;n++){const i=e[n];if(i.nodeType===Node.TEXT_NODE){if(i.data.replace(/\u200b/g,"")!=="")return!1}else if(i.nodeType===Node.ELEMENT_NODE&&(i.nodeName.toLowerCase()==="li"&&!this.editor.list.isEmptyItem(I(i))||i.hasAttribute(ke)||!this.isEmptyWidthChild(I(i))))return!1}return!0}isList(t){let e=typeof t=="string"?t:"";return be(t)?e=t.nodeName.toLowerCase():ft(t)&&(e=t.name),["ul","ol"].indexOf(e)>-1}isCustomize(t){const{list:e}=this.editor;switch(t.name){case"li":return t.hasClass(e.CUSTOMZIE_LI_CLASS);case"ul":return t.hasClass(e.CUSTOMZIE_UL_CLASS);default:return!1}}unwrap(t){let e=t.first();const n=[];for(;e;){const i=e.next();t.before(e),n.push(e),e=i}return t.remove(),n}wrap(t,e,n=!1){const{mark:i}=this.editor;if(be(t)&&(t=I(t)),e=this.clone(e,!1),t.isText())return e.append(this.clone(t,!1)),t.replaceWith(e);if(n&&this.isMark(e)){const o=this.clone(e,!1,!1);if(t.name===e.name){const c=t.attributes();delete c.style,delete c[we],Object.keys(c).forEach(d=>{if(!e.attributes(d))e.attributes(d,c[d]);else{const h=e.attributes(d).split(",");h[d]!==void 0&&h.indexOf(h[d])<0&&h.push(h[d]),e.attributes(d,h.join(","))}});const u=t.css();Object.keys(u).forEach(d=>{e.css(d)||e.css(d,u[d])}),e.append(this.clone(t,!0,!1).children())}else e.append(this.clone(t,!0,!1));return e.allChildren().forEach(c=>{!c.isText()&&this.isMark(c)&&i.compare(c,o)&&this.unwrap(c)}),t.replaceWith(e)}const r=t.parent(),s=this.clone(t,!1,!1);return t.after(s),e.append(t),r?s.replaceWith(e):e}merge(t,e,n=!0){var f,p;if(t.equal(e))return;if(e.isText()){t.append(e),this.removeSide(t);return}const{block:i,mark:r,list:s}=this.editor;let o=e;const a=this.isList(t),c=this.isList(e.name);if(a&&!c){const g=t.find("li");if(g.length===0)return;t=I(g[g.length-1])}if(!a&&c){const g=e.find("li");g.length>0&&(e=I(g[0])),g[1]&&(o=I(g[0]))}if(this.isCustomize(t)){let g=t.first();if(!(g!=null&&g.isCard())){const m=s.getPlugins(),v=s.getPluginNameByNode(t),b=m.find(_=>_.constructor.pluginName===v);b!=null&&b.cardName&&(s.addCardToCustomize(t,b.cardName),g=t.first())}if(this.isCustomize(e)&&!(g!=null&&g.equal(e))){const m=e.first();(m==null?void 0:m.isCard())&&g.attributes(ke)===m.attributes(ke)&&m.remove()}}const u=t.last();let d=e.first();const h=i.findPlugin(t);for(;d;){const g=d.next(),m=r.findPlugin(d);if(h&&m&&h.disableMark&&h.disableMark.indexOf(m.constructor.pluginName)>-1)this.unwrap(d).forEach(b=>{t.append(b)});else if(d.isText()&&/\u200b/.test(d.text())){const v=d.parent(),b=d.prev(),_=d.next();if(!v||!this.isMark(v)&&(b&&!this.isInline(b)||_&&!this.isInline(_))){d.remove(),d=_;continue}}else if(m&&((f=d.get())==null?void 0:f.childNodes.length)===1){const v=d.prev();(!v||v.isText())&&d.allChildren().forEach(b=>{var x;const _=b.text();b.type===it().TEXT_NODE&&!!_&&!((x=b.next())!=null&&x.isCursor())&&b.text(_.replace(/\u200b/,""))})}d.length>0&&!d.equal(t)&&!((p=d.parent())!=null&&p.equal(t))&&t.append(d),d=g}if(n&&o.remove(),u&&u.name==="br"){let g=u.next();for(;g;){if(g.isCursor()){u.remove();break}g=g.next()}}this.removeSide(t)}replace(t,e,n=!1){var s,o;const i=this.clone(e,!1,n);let r=this.isCustomize(t)&&t.name==="li"&&((s=t.first())==null?void 0:s.isCard())?(o=t.first())==null?void 0:o.next():t.first();for(;r;){const a=r.next();i.append(r),r=a}return t.isText()&&i.append(t.clone()),t.replaceWith(i)}insertText(t,e){var a;const n=this.editor;if(!V(n))return;const{change:i}=n,r=e||i.range.toTrusty(),s=it(r.startContainer);r.collapsed||i.delete(e);const o=s.createTextNode(t);return(a=this.insert(o,r))==null||a.handleBr(),e||i.apply(r),r}insert(t,e,n=!1){var m,v;if(ft(t)){if(t.length===0)throw"Not found node";t=t[0]}const i=this.editor;if(!V(i))return;const{change:r,block:s,schema:o,mark:a}=i;e=e||r.range.get();const{startNode:c,startOffset:u}=e.cloneRange().shrinkToTextNode(),d=c.prev(),h=c.parent();let f=c.text()||"";const p=f.substr(0,u);c.isText()&&/\u200b$/.test(p)&&f.length>1&&(d&&!this.isInline(d)||!d&&h&&!this.isInline(h))&&c.get().splitText(f.length-1).remove();let g=h==null?void 0:h.attributes(He);if(!g&&c.isCard()&&e.setStartAfter(c),g&&h&&["left","right"].includes(g)){const b=i.card.find(h);b&&(g==="left"?e.setStartBefore(b.root):e.setStartAfter(b.root))}if(this.isBlock(t)){let{commonAncestorNode:b}=e;b.isText()&&(b=i.block.closest(b));let _=null;if(this.isBlock(b)&&this.isEmpty(b))_=n?b:void 0;else{let w=!1;s.isFirstOffset(e,"start")&&(w=!0),_=s.split(e),w&&(_=_==null?void 0:_.prev())}let x=s.closest(e.startNode.isEditable()?e.cloneRange().shrinkToElementNode().shrinkToTextNode().startNode:e.startNode);if(x.isRoot()&&!e.startNode.next())x.append(t);else if(!x.isCard()&&o.isAllowIn(x.name,t.nodeName.toLowerCase()))x.find("br").remove(),x.append(t);else{let w=x.parent();for(;w&&this.isBlock(w)&&!x.isEditable()&&!o.isAllowIn(w.name,t.nodeName.toLowerCase());)x=w,w=x.parent();const E=o.getCanMergeTags(),S=t.nodeName.toLowerCase();let R=null;if(_&&x.name===S&&E.includes(x.name)){x=_;const D=document.createDocumentFragment(),P=[],O=(m=x.get())==null?void 0:m.nextSibling;t.childNodes.forEach(L=>{O?P.push(L):P.unshift(L)}),D.append(...P),t=D,R=D.lastChild}x.isEditable()&&((v=x.get())==null?void 0:v.childNodes.length)===0?x.append(t):(this.isEmptyWidthChild(x)||s.isLastOffset(e,"start")?(x.after(t),this.isEmptyWidthChild(x)&&_&&x.remove()):(x.before(t),_&&this.isEmptyWidthChild(_)&&_.remove()),R&&(t=R))}(t instanceof Element||t instanceof DocumentFragment)&&i.nodeId.generate(t)}else{const b=s.closest(e.startNode.isEditable()?e.cloneRange().shrinkToElementNode().shrinkToTextNode().startNode:e.startNode),_=b?s.findPlugin(b):void 0;if(_){const x=I(t),w=E=>{if(this.isMark(E)){const S=a.findPlugin(E);if(!S)return;if(_.disableMark&&_.disableMark.indexOf(S.constructor.pluginName)>-1)return!0}return!1};if(x.allChildren().forEach(E=>{w(E)&&this.unwrap(E)}),w(x)){const E=x.document.createDocumentFragment();x.children().each(S=>{E.appendChild(S)}),x.remove(),t=E.childNodes[E.childNodes.length-1],e.insertNode(E)}else e.insertNode(t);if(x.length===0)return e}else e.insertNode(t)}return t.nodeType===Node.ELEMENT_NODE&&(t.hasAttribute(We)||t.hasAttribute(ke))?e.collapse(!1):e.select(t,!(this.isVoid(t)||t.nodeType===Node.TEXT_NODE)).shrinkToElementNode().collapse(!1)}setAttributes(t,e){let n=e.style;for(const r in e)if(r!=="style")if(r==="className"){const s=e[r];Array.isArray(s)?s.forEach(o=>t.addClass(o)):t.addClass(s)}else t.attributes(r,e[r].toString());typeof n=="number"?n={}:typeof n=="string"&&(n=fr(n)),n=n||{};const i=Object.keys(n);for(const r in n){let s=n[r];/^0(px|em)?$/.test(s.toString())&&(s=""),t.css(r,s.toString())}return(i.length===0||Object.keys(t.attributes("style")).length===0)&&t.removeAttributes("style"),t}removeMinusStyle(t,e){if(t.isElement()){const n=t.css();n[e]&&(parseInt(n[e]||"0",10)||0)<0&&t.css(e,"")}}mergeChild(t){const{schema:e,list:n}=this.editor,i=e.getAllowInTags();let r=t.first();for(;r;){let s=r.next();for(;s&&r.name===s.name&&(i.indexOf(r.name)>-1&&!this.isList(r)||this.isList(r)&&n.isSame(r,s));){const o=s.next();let a=s.first();for(;a;){const c=a.next();r.append(a),a=c}s.remove(),this.mergeChild(r),s=o}r=s}}removeSide(t,e="br"){const n=t.first();(n==null?void 0:n.name)===e&&t.children().toArray().filter(r=>!r.isCursor()).length>1&&n.remove();const i=t.last();(i==null?void 0:i.name)===e&&t.children().toArray().filter(r=>!r.isCursor()).length>1&&i.remove()}flat(t,e=t){var s;const{block:n}=this.editor;let i=t.first();const r=t.fragment?I("<p />"):this.clone(t,!1);for(;i;){let o=i.next();if(i.isBlockCard()||this.isNestedBlock(i))n.flat(i,e);else if(this.isBlock(i))i=this.flat(i,e);else{const a=this.clone(r,!1),c=a.name==="li";for(i.before(a);i;){o=i.next();const u=i.name==="br"&&!c;if(u&&((s=i.parent())==null?void 0:s.isRoot())&&a.append(i),i.isText()){let d=i.text(),h=/^((\n|\r)+)/.exec(d),f=!1;if(h&&(d=d.substring(h[1].length),f=!0,d.length===0&&i.remove()),h=/((\n|\r)+)$/.exec(d),h){i.text(d.substr(0,h.index)),a.append(i);break}else f&&i.length>0&&i.text(d)}if(i.length>0&&a.append(i),o!=null&&o.isText()){const d=o.text();if(/^(\n|\r)+/.exec(d))break}if(u||!o||this.isBlock(o)||o.isBlockCard())break;i=o}this.removeSide(a),n.flat(a,e),this.addBrForBlock(a)}this.addBrForBlock(i),this.removeSide(i),i=o}return t.fragment&&(t=I(t.fragment)),i=t.first(),i||t.remove(),t}normalize(t){return t=this.flat(t),this.mergeChild(t),t}html(t,e){var n;return e===void 0?t.length>0&&((n=t.get())==null?void 0:n.innerHTML)||"":(t.each(i=>{const r=i;r.innerHTML=e,this.editor.nodeId.generateAll(r)}),t)}clone(t,e,n=!0){const{nodeId:i}=this.editor,r=[];return t.each(s=>{const o=s.cloneNode(e),a=I(o);n||(i.generateAll(a,!0),i.isNeed(a)&&i.generate(a,!0)),r.push(o)}),I(r)}getBatchAppendHTML(t,e){var i;if(t.length===0)return e;let n=e.startsWith("\\u")||e.startsWith("&#")?I(e,null):I(e);return t.forEach(r=>{r=r.clone(!1),r.append(n),n=r}),((i=n.get())==null?void 0:i.outerHTML)||""}removeZeroWidthSpace(t){t.traverse(e=>{var a;const n=e[0];if(n.nodeType!==Node.TEXT_NODE)return;const i=n.nodeValue;if((i==null?void 0:i.length)!==2)return;const r=n.nextSibling,s=n.previousSibling;if(i.charCodeAt(1)===8203&&r&&r.nodeType===Node.ELEMENT_NODE&&[Tn,Nn,Dn].indexOf(r.getAttribute(le)||"")>=0)return;const o=e.parent();if(!(i.charCodeAt(1)===8203&&(!r&&o&&this.isInline(o)||r&&this.isInline(r)))&&!(i.charCodeAt(0)===8203&&(!s&&o&&this.isInline(o)||s&&this.isInline(s)))&&i.charCodeAt(0)===8203){const c=n.splitText(1);c.previousSibling&&((a=c.parentNode)==null||a.removeChild(c.previousSibling))}})}}class go{constructor(t,e,n=""){y(this,"range");y(this,"editor");y(this,"key","");y(this,"anchor",null);y(this,"focus",null);this.editor=t,this.range=e,this.key=n}has(){return!!this.focus&&!!this.anchor}create(){const{commonAncestorNode:t,startNode:e,endNode:n}=this.range;if(!t.isEditable()&&!t.inEditor())return;const{document:i}=t;if(!i)return;const r=t.closest(fi);if(this.key)r.find(`[data-anchor-id="${this.key}"]`).remove(),r.find(`[data-focus-id="${this.key}"]`).remove(),r.find(`[data-cursor-id="${this.key}"]`).remove();else{const d=r.find(yl);d.each((p,g)=>{const m=d.eq(g);m&&!m.attributes("data-anchor-id")&&m.remove()});const h=r.find(_l);h.each((p,g)=>{const m=h.eq(g);m&&!m.attributes("data-focus-id")&&m.remove()});const f=r.find(uo);f.each((p,g)=>{const m=f.eq(g);m&&!m.attributes("data-cursor-id")&&m.remove()})}const s=e.closest(ut);if(s.length>0&&(e.closest(St).length>0&&this.range.setStartBefore(s),e.closest(At).length>0&&this.range.setStartAfter(s)),!e.equal(n)){const d=n.closest(ut);d.length>0&&(n.closest(St).length>0&&this.range.setEndBefore(d),n.closest(At).length>0&&this.range.setEndAfter(d))}if(this.range.collapsed){const d=I(i.createElement("span"));d.attributes(le,Dn),this.key&&d.attributes("data-cursor-id",this.key),this.range.insertNode(d),this.anchor=d,this.focus=d;return}const o=this.range.cloneRange();o.collapse(!0);const a=I(i.createElement("span"));a.attributes(le,Tn),this.key&&a.attributes("data-anchor-id",this.key),o.insertNode(a),this.range.setStartAfter(a);const c=this.range.cloneRange();c.collapse(!1);const u=I(i.createElement("span"));u.attributes(le,Nn),this.key&&u.attributes("data-focus-id",this.key),c.insertNode(u),this.anchor=a,this.focus=u}move(){var n,i,r,s,o,a;if(!this.focus||!this.anchor)return;if(this.key){const{commonAncestorNode:c}=this.range,u=c.closest(fi);(!this.focus.inEditor()||!((n=this.focus.get())!=null&&n.isConnected))&&(this.focus=u.find(`[data-${this.focus.attributes(le)}-id="${this.key}"]`)),(!this.anchor.inEditor()||!((i=this.anchor.get())!=null&&i.isConnected))&&(this.anchor=u.find(`[data-${this.anchor.attributes(le)}-id="${this.key}"]`))}const{node:t}=this.editor;if((r=this.anchor.get())!=null&&r.isConnected||(this.anchor=this.range.commonAncestorNode.find(`[${le}="anchor"]`)),(s=this.focus.get())!=null&&s.isConnected||(this.focus=this.range.commonAncestorNode.find(`[${le}="focus"]`)),this.anchor.equal(this.focus)){const c=this.anchor,u=c.parent();if(!u)return;t.removeZeroWidthSpace(u),u[0].normalize();let d=!1;const h=c.prev(),f=c.next();if(h&&h.isCard()){const p=h.find(At);p.length>0&&(this.range.select(p,!0),this.range.collapse(!1),d=!0)}else if(f&&f.isCard()){const p=f.find(St);p.length>0&&(this.range.select(p,!0),this.range.collapse(!1),d=!0)}d||(this.range.setStartBefore(c[0]),this.range.collapse(!0)),wl?(u[0].normalize(),c.remove()):(c.remove(),u[0].normalize()),u.name==="p"&&((o=u.get())==null?void 0:o.childNodes.length)===0&&u.append(I("<br />"));return}let e=this.anchor.parent();if(e&&(t.removeZeroWidthSpace(e),this.anchor.length>0&&this.range.setStartBefore(this.anchor),this.anchor.remove(),e[0].normalize()),e=this.focus.parent(),e&&(t.removeZeroWidthSpace(e),this.focus.length>0&&this.range.setEndBefore(this.focus),this.focus.remove(),e[0].normalize(),e.name==="p"&&((a=e.get())==null?void 0:a.childNodes.length)===0&&e.append(I("<br />")),Vr)){const c=window.getSelection();c==null||c.removeAllRanges(),c==null||c.addRange(this.range.base)}}getNode(t,e="center",n=!0,i=()=>!0){const r=n?t.clone(!0):t;if(!this.focus||!this.anchor)return r;if(e==="left"||e==="center"){const s=e!=="center"?this.anchor:this.focus;let o=I(this.key?`[data-${s.attributes(le)}-id="${this.key}"]`:`[${le}=${s.attributes(le)}]`,r.get());this.key||(o=o.toArray().find(c=>!c.attributes(`data-${s.attributes(le)}-id`)));let a=!1;r.traverse(c=>{var u;if(o&&c.equal(o)){const d=c.parent();o.remove(),(d==null?void 0:d.name)==="p"&&((u=d.get())==null?void 0:u.childNodes.length)===0&&d.append(I("<br />")),a=!0;return}a&&i(c)&&(c.attributes(le)!==s.attributes(le)||s.attributes(le)==="cursor")&&c.remove()},!0)}if(e==="right"||e==="center"){const s=e!=="center"?this.focus:this.anchor;let o=I(this.key?`[data-${s.attributes(le)}-id="${this.key}"]`:`[${le}=${s.attributes(le)}]`,r.get());this.key||(o=o.toArray().find(c=>!c.attributes(`data-${s.attributes(le)}-id`)));let a=!1;r.traverse(c=>{var u;if(o&&c.equal(o)){const d=c.parent();o.remove(),(d==null?void 0:d.name)==="p"&&((u=d.get())==null?void 0:u.childNodes.length)===0&&d.append(I("<br />")),a=!0;return}a&&i(c)&&(c.attributes(le)!==s.attributes(le)||s.attributes(le)==="cursor")&&c.remove()},!1)}return r}}y(go,"removeTags",t=>t.replace(/<anchor\s*\/>/gi,"").replace(/<focus\s*\/>/gi,"").replace(/<cursor\s*\/>/gi,""));var EZ="__lodash_hash_undefined__";function CZ(l){return this.__data__.set(l,EZ),this}var SZ=CZ;function AZ(l){return this.__data__.has(l)}var TZ=AZ,NZ=Wf,DZ=SZ,RZ=TZ;function Us(l){var t=-1,e=l==null?0:l.length;for(this.__data__=new NZ;++t<e;)this.add(l[t])}Us.prototype.add=Us.prototype.push=DZ;Us.prototype.has=RZ;var MZ=Us;function LZ(l,t){for(var e=-1,n=l==null?0:l.length;++e<n;)if(t(l[e],e,l))return!0;return!1}var IZ=LZ;function OZ(l,t){return l.has(t)}var FZ=OZ,BZ=MZ,$Z=IZ,PZ=FZ,zZ=1,qZ=2;function HZ(l,t,e,n,i,r){var s=e&zZ,o=l.length,a=t.length;if(o!=a&&!(s&&a>o))return!1;var c=r.get(l),u=r.get(t);if(c&&u)return c==t&&u==l;var d=-1,h=!0,f=e&qZ?new BZ:void 0;for(r.set(l,t),r.set(t,l);++d<o;){var p=l[d],g=t[d];if(n)var m=s?n(g,p,d,t,l,r):n(p,g,d,l,t,r);if(m!==void 0){if(m)continue;h=!1;break}if(f){if(!$Z(t,function(v,b){if(!PZ(f,b)&&(p===v||i(p,v,e,n,r)))return f.push(b)})){h=!1;break}}else if(!(p===g||i(p,g,e,n,r))){h=!1;break}}return r.delete(l),r.delete(t),h}var Dh=HZ;function WZ(l){var t=-1,e=Array(l.size);return l.forEach(function(n,i){e[++t]=[i,n]}),e}var UZ=WZ;function jZ(l){var t=-1,e=Array(l.size);return l.forEach(function(n){e[++t]=n}),e}var VZ=jZ,ou=tl,au=Ng,GZ=nl,ZZ=Dh,KZ=UZ,XZ=VZ,YZ=1,JZ=2,QZ="[object Boolean]",eK="[object Date]",tK="[object Error]",nK="[object Map]",iK="[object Number]",rK="[object RegExp]",sK="[object Set]",oK="[object String]",aK="[object Symbol]",lK="[object ArrayBuffer]",cK="[object DataView]",lu=ou?ou.prototype:void 0,ba=lu?lu.valueOf:void 0;function uK(l,t,e,n,i,r,s){switch(e){case cK:if(l.byteLength!=t.byteLength||l.byteOffset!=t.byteOffset)return!1;l=l.buffer,t=t.buffer;case lK:return!(l.byteLength!=t.byteLength||!r(new au(l),new au(t)));case QZ:case eK:case iK:return GZ(+l,+t);case tK:return l.name==t.name&&l.message==t.message;case rK:case oK:return l==t+"";case nK:var o=KZ;case sK:var a=n&YZ;if(o||(o=XZ),l.size!=t.size&&!a)return!1;var c=s.get(l);if(c)return c==t;n|=JZ,s.set(l,t);var u=ZZ(o(l),o(t),n,i,r,s);return s.delete(l),u;case aK:if(ba)return ba.call(l)==ba.call(t)}return!1}var dK=uK,cu=Dg,fK=1,hK=Object.prototype,pK=hK.hasOwnProperty;function gK(l,t,e,n,i,r){var s=e&fK,o=cu(l),a=o.length,c=cu(t),u=c.length;if(a!=u&&!s)return!1;for(var d=a;d--;){var h=o[d];if(!(s?h in t:pK.call(t,h)))return!1}var f=r.get(l),p=r.get(t);if(f&&p)return f==t&&p==l;var g=!0;r.set(l,t),r.set(t,l);for(var m=s;++d<a;){h=o[d];var v=l[h],b=t[h];if(n)var _=s?n(b,v,h,t,l,r):n(v,b,h,l,t,r);if(!(_===void 0?v===b||i(v,b,e,n,r):_)){g=!1;break}m||(m=h=="constructor")}if(g&&!m){var x=l.constructor,w=t.constructor;x!=w&&"constructor"in l&&"constructor"in t&&!(typeof x=="function"&&x instanceof x&&typeof w=="function"&&w instanceof w)&&(g=!1)}return r.delete(l),r.delete(t),g}var mK=gK,ya=il,vK=Dh,bK=dK,yK=mK,uu=Rg,du=hi,fu=Uf.exports,_K=jf,wK=1,hu="[object Arguments]",pu="[object Array]",Ss="[object Object]",xK=Object.prototype,gu=xK.hasOwnProperty;function kK(l,t,e,n,i,r){var s=du(l),o=du(t),a=s?pu:uu(l),c=o?pu:uu(t);a=a==hu?Ss:a,c=c==hu?Ss:c;var u=a==Ss,d=c==Ss,h=a==c;if(h&&fu(l)){if(!fu(t))return!1;s=!0,u=!1}if(h&&!u)return r||(r=new ya),s||_K(l)?vK(l,t,e,n,i,r):bK(l,t,a,e,n,i,r);if(!(e&wK)){var f=u&&gu.call(l,"__wrapped__"),p=d&&gu.call(t,"__wrapped__");if(f||p){var g=f?l.value():l,m=p?t.value():t;return r||(r=new ya),i(g,m,e,n,r)}}return h?(r||(r=new ya),yK(l,t,e,n,i,r)):!1}var EK=kK,CK=EK,mu=Qs;function Rh(l,t,e,n,i){return l===t?!0:l==null||t==null||!mu(l)&&!mu(t)?l!==l&&t!==t:CK(l,t,e,n,Rh,i)}var El=Rh,SK=El;function AK(l,t){return SK(l,t)}var Bt=AK;const ci=(l,t,e)=>{const n=be(l)?l:l[0];if(n.nodeType===Node.ELEMENT_NODE){const i=n.getAttribute(le)||"";if([Dn,Tn,Nn].indexOf(i)>-1||!!n.getAttribute(jr)||i===Qe)return!0;const r=n.parentElement,s=(r==null?void 0:r.getAttribute(le))||"";if(i===qn||s===qn)return!1;const o=li(n);if((r==null?void 0:r.getAttribute(Ct))&&r&&(e==null||e.push(I(r))),!o&&r&&li(r)&&!Lr(r))return!0;if(t){if(o)return!1;const h=t.find(f=>f===l[0]);if(h)return h.__card_root&&(e==null||e.push(h.__card_root)),!0}let c=Kr(n,`${ut},${$i}`,Ba);if(!c||!(c instanceof Element))return!1;if(c.getAttribute(le)===Qe||(c.getAttribute(Ct)&&(e==null||e.push(I(c))),!o&&li(c)&&!Lr(c)))return!0;if(!o||Lr(n)||!r)return!1;const u=Kr(r,ut,Ba);if(!u||!(u instanceof Element))return!1;if(u.getAttribute(Ct)&&u&&(e==null||e.push(I(u))),u&&li(u)&&!Lr(u))return!0}return!1},Mh=(l,t)=>{const e=be(l)?l:l[0];if(hr(e)||li(e)&&["id","class","style",Ct,an].includes(t))return!0;const n=e.getAttribute(Nt);return!!(n==="*"||n&&n.split(",").some(i=>i.trim().toLowerCase()===t.toLowerCase()))},TK=l=>{const t=[];for(let e=0;e<l.length;e++){const n=l[e],i=l[e+1];Pa(n,i)?e++:t.push(n)}return t},Pa=(l,t)=>{const e=l,n=l,i=t,r=t,s=l,o=l,a=t,c=t;return!l||!t?!1:e.li&&r.ld?Bt(e.li,r.ld)&&Bt(l.p,t.p):n.ld&&i.li?Bt(n.ld,i.li)&&Bt(l.p,t.p):s.si&&c.sd?Bt(s.si,c.sd)&&(Bt(l.p,t.p)||vu(l.p,t.p,s.si.length)||vu(t.p,l.p,s.si.length)):o.sd&&a.si?Bt(o.sd,a.si)&&Bt(l.p,t.p):!1},vu=(l,t,e=1)=>{if(l.length!==t.length)return!1;const n=t.slice();return n[n.length-1]=n[n.length-1]-e,Bt(l.slice(),n)},Cl=l=>{const t=document.createDocumentFragment();let e=null,n=0,i=null;for(typeof l[0]=="string"&&(e=l[0],n=1);n<l.length;n++)if(Array.isArray(l[n])){const r=l[n-1];if(r&&r.toString()==="[object Object]"&&Object.keys(r).includes(We))continue;const s=Cl(l[n]);s&&t.appendChild(s)}else if(l[n].toString()==="[object Object]"){if(e){i=document.createElement(e);for(let s in l[n])i==null||i.setAttribute(Eh(s),ho(l[n][s]));const r=Object.keys(l[n]);r.indexOf(ke)>-1&&r.indexOf(We)<0&&(i==null||i.setAttribute(We,l[n][ke]),i==null||i.removeAttribute(ke))}}else if(typeof l[n]=="number"||typeof l[n]=="string"){const r=document.createTextNode(l[n].toString());t.appendChild(r)}return!i&&e&&(i=document.createElement(e)),i?(i.appendChild(t),i):t.childNodes[0]},NK=(l,t)=>{l instanceof Node||(l=l[0]);const e=l.childNodes;if(e.length!==0)for(let n=0;n<e.length;n++){const i=e.item(n);if(!i)continue;const r=An(i);r&&t.push(r)}},An=l=>{let t;if(l instanceof Node||(l=l[0]),!ci(l)){const{nodeValue:e}=l;if(l instanceof Element){const n=l.attributes;t=[l.nodeName.toLowerCase()];const i={};for(let r=0;n&&r<n.length;r++){const{name:s,specified:o,value:a}=n[r];o&&!Mh(l,s)&&(s==="style"&&l instanceof HTMLElement?i.style=kh(l.style.cssText||a):typeof a=="string"&&(i[s]=a))}return t.push(i),NK(l,t),t}else if(l instanceof Text)return String(e)}},Sl=(l,t)=>{if(!Array.isArray(l)||l.length<1)return null;for(let e=1;e<l.length;e++)if(e===1){const n=l[e];if(typeof n=="object"&&t&&t(n))return{path:[],name:l[0],attributes:n,children:l.slice(e+1)}}else if(Array.isArray(l[e])){const n=Sl(l[e],t);if(n)return n.path.unshift(e),n}return null},DK=(l,t)=>{const e=Sl(l,n=>n["data-card-key"]?t?t(n):!0:!1);if(e){const{attributes:n,children:i}=e;return{attributes:n,rendered:Array.isArray(i)&&Array.isArray(i[2])&&Array.isArray(i[2][2])}}},Wr=class{constructor(t,e){y(this,"editor");y(this,"base");y(this,"toRange",()=>this.base);y(this,"collapse",t=>(this.base.collapse(t),this));y(this,"cloneRange",()=>Wr.from(this.editor,this.base.cloneRange()));y(this,"select",(t,e)=>(e?this.base.selectNodeContents(ft(t)?t[0]:t):this.base.selectNode(ft(t)?t[0]:t),this));y(this,"getText",()=>this.cloneContents().textContent);y(this,"getClientRect",()=>{let t=this.getClientRects().item(0);return t||(t=this.getBoundingClientRect()),t});y(this,"enlargeFromTextNode",()=>{const t=(e,n,i)=>{var r;if(e.nodeType===Node.TEXT_NODE){if(n===0)switch(i){case"start":this.setStartBefore(e);break;case"end":this.setEndBefore(e);break}else if(n===((r=e.nodeValue)==null?void 0:r.length))switch(i){case"start":this.setStartAfter(e);break;case"end":this.setEndAfter(e);break}}};return t(this.startContainer,this.startOffset,"start"),t(this.endContainer,this.endOffset,"end"),this});y(this,"shrinkToTextNode",()=>{const t=(e,n,i)=>{var c;if(e.nodeType!==Node.ELEMENT_NODE)return;const r=e.childNodes;if(r.length===0)return;let s,o,a;if(n>0&&(s=r[n-1]),n<r.length&&(o=r[n]),s&&s.nodeType===Node.TEXT_NODE&&(a=s,n=((c=a.nodeValue)==null?void 0:c.length)||0),o&&o.nodeType===Node.TEXT_NODE&&(a=o,n=0),!!a)switch(i){case"start":this.setStart(a,n);break;case"end":this.setEnd(a,n);break}};return t(this.startContainer,this.startOffset,"start"),t(this.endContainer,this.endOffset,"end"),this});y(this,"enlargeToElementNode",(t=!1,e=!0)=>{const n=this.enlargeFromTextNode(),i=this.editor.node,r=(s,o,a)=>{var d;let c=I(s);if(c.type===Node.TEXT_NODE||!t&&i.isBlock(c)||c.isEditable())return;let u;if(o===0){for(;!c.prev()&&(u=c.parent(),!(!u||!t&&i.isBlock(u)||!u.inEditor()||u.isEditable()||!e&&(!t&&u.isElement()||t&&i.isBlock(u))));)c=u;a?n.setStartBefore(c[0]):n.setEndBefore(c[0])}else if(o===((d=c.get())==null?void 0:d.childNodes.length)){for(;!c.next()&&(u=c.parent(),!(!u||!t&&i.isBlock(u)||!u.inEditor()||u.isEditable()||!e&&(!t&&u.isElement()||t&&i.isBlock(u))));)c=u;a?n.setStartAfter(c[0]):n.setEndAfter(c[0])}};return r(n.startContainer,n.startOffset,!0),r(n.endContainer,n.endOffset,!1),this});y(this,"shrinkToElementNode",()=>{const{node:t}=this.editor;let e,n;for(;this.startContainer.nodeType===Node.ELEMENT_NODE&&(e=this.startContainer.childNodes[this.startOffset])&&(n=I(e))&&e.nodeType===Node.ELEMENT_NODE&&!n.isCursor()&&!t.isVoid(e)&&(!n.isCard()||n.isEditableCard()||n.find(St).length>0);)this.setStart(e,0);for(;this.endContainer.nodeType===Node.ELEMENT_NODE&&this.endOffset>0&&(e=this.endContainer.childNodes[this.endOffset-1])&&(n=I(e))&&e.nodeType===Node.ELEMENT_NODE&&!t.isVoid(e)&&!n.isCursor()&&(!n.isCard()||n.isEditableCard()||n.find(At).length>0);)this.setEnd(e,e.childNodes.length);return this});y(this,"createSelection",(t="")=>{const e=new go(this.editor,this,t);return e.create(),e});y(this,"getSubRanges",(t=!1,e=!0)=>{const n=[];return this.commonAncestorNode.traverse(i=>{var r,s;if(i.isText()){let o=0;const a=i.get(),c=((r=a.nodeValue)==null?void 0:r.length)||0,u=this.comparePoint(a,o),d=this.comparePoint(a,c),h=Wr.create(this.editor);if(u<0){if(d<0)return;d===0?h.setOffset(a,this.startOffset,c):h.setOffset(a,this.startOffset,this.endOffset)}else{if(u!==0||d<0)return;d===0?h.setOffset(a,o,c):h.setOffset(a,o,this.endOffset)}n.push(h)}else if(t&&i.isCard()&&!i.isEditableCard()){const o=this.editor.card.find(i);if(!o||e&&o.constructor.singleSelectable===!1)return;const a=o.getCenter(),c=(s=a.get())==null?void 0:s.parentNode;if(!c||!a.inEditor())return;const u=a.index(),d=i.get(),h=this.comparePoint(c,u),f=this.comparePoint(c,u+1),p=Wr.create(this.editor);if(h<0){if(f<0)return;f===0?p.setOffset(d,this.startOffset,u+1):p.setOffset(d,this.startOffset,this.endOffset)}else{if(h!==0||f<0)return;f===0?p.setOffset(c,u,u+1):p.setOffset(c,u,this.endOffset)}n.push(p)}}),n.length===0&&n.push(this),n});y(this,"setOffset",(t,e,n)=>(ft(t)&&(t=t[0]),this.setStart(t,e),this.setEnd(t,n),this));y(this,"findElements",()=>{const{startContainer:t,endContainer:e,startOffset:n,endOffset:i,collapsed:r}=this,s=[];if(t!==e||r===!0||t.nodeType===Node.TEXT_NODE)return s;const{childNodes:o}=t;for(let a=n;a<i;a++)s.push(o[a]);return s});y(this,"inCard",()=>{const t=this.startNode.closest(ut);return t&&t.length>0});y(this,"getStartOffsetNode",()=>{const{startContainer:t,startOffset:e}=this;return(t.nodeType===Node.ELEMENT_NODE||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE)&&(t.childNodes[e]||t.childNodes[e-1])||t});y(this,"getEndOffsetNode",()=>{const{endContainer:t,endOffset:e}=this;return(t.nodeType===Node.ELEMENT_NODE||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE)&&(t.childNodes[e]||t.childNodes[e-1])||t});y(this,"scrollIntoView",()=>{const t=this.endNode.get();ue&&t&&t.scrollIntoView&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})});y(this,"scrollRangeIntoView",()=>{const t=this.getEndOffsetNode(),e=t.nodeType===Node.TEXT_NODE?t.parentNode:t,n=this.collapsed?e.getBoundingClientRect():this.getClientRect(),i=window.innerHeight;(n.bottom>=i||n.bottom<=0)&&e.scrollIntoView({block:"center"})});y(this,"scrollIntoViewIfNeeded",(t=this.editor.container,e)=>{if(this.collapsed)t.scrollIntoView(I(this.getEndOffsetNode()));else{const n=this.getStartOffsetNode(),i=this.getEndOffsetNode();I(n).scrollIntoView(e),I(i).scrollIntoView(e)}});y(this,"containsCard",()=>{const{collapsed:t,commonAncestorNode:e}=this;return!t&&(e.type!==3&&e.find(ut).length>0||e.closest(ut).length>0)});y(this,"handleBr",t=>{var o,a;const e=this.editor,{list:n}=e,i=e.block.closest(this.commonAncestorNode);i.find("br").each(c=>{var p,g;const u=I(c),d=u.prev(),h=u.next(),f=u.parent();if((!d||(f==null?void 0:f.hasClass(n.CUSTOMZIE_LI_CLASS))&&((p=f==null?void 0:f.first())==null?void 0:p.equal(d)))&&h&&h.name!=="br"&&!h.isCursor()||!h&&d&&d.name!=="br"){if(t&&d&&!((f==null?void 0:f.hasClass(n.CUSTOMZIE_LI_CLASS))&&((g=f==null?void 0:f.first())==null?void 0:g.equal(u.prev()))))return;u.remove()}});const r=i.first(),s=i.children();return!r||s.length===1&&i.hasClass(n.CUSTOMZIE_LI_CLASS)&&(r==null?void 0:r.isCard())?(i.append(I("<br />")),this):s.length===1&&r.isText()&&r.text().replace(/\r\n|\n|\t|\u200b/g,"").length===0?(i.html("<br />"),this):(s.length===2&&i.hasClass(n.CUSTOMZIE_LI_CLASS)&&(r==null?void 0:r.isCard())&&["cursor","anchor","focus"].includes(((o=i.last())==null?void 0:o.attributes(le))||"")&&((a=i.first())==null||a.after("<br />")),this)});y(this,"getPrevNode",()=>{this.enlargeFromTextNode();const{startNode:t,startOffset:e}=this;if(t.isText())return;const n=t.children();if(n.length!==0)return n.eq(e-1)});y(this,"getNextNode",()=>{this.enlargeFromTextNode();const{endNode:t,endOffset:e}=this;if(t.isText())return;const n=t.children();if(n.length!==0)return n.eq(e)});this.editor=t,this.base=e}get collapsed(){return this.base.collapsed}get endOffset(){return this.base.endOffset}get startOffset(){return this.base.startOffset}get startContainer(){return this.base.startContainer}get endContainer(){return this.base.endContainer}get commonAncestorContainer(){return this.base.commonAncestorContainer}cloneContents(){return this.base.cloneContents()}deleteContents(){return this.base.deleteContents()}extractContents(){return this.base.extractContents()}getBoundingClientRect(){return this.base.getBoundingClientRect()}getClientRects(){return this.base.getClientRects()}insertNode(t){var n,i,r;ft(t)&&(t=t[0]);const e=this.startNode;!I(t).isCursor()&&((n=e.get())==null?void 0:n.childNodes.length)===1&&((i=e.first())==null?void 0:i.name)==="br"?(r=e.first())==null||r.remove():e.name==="br"&&e.remove(),(t.nodeType===Node.TEXT_NODE||t.nodeName==="BR")&&e.isEditable()&&this.shrinkToElementNode().shrinkToTextNode(),(t instanceof Element||t instanceof DocumentFragment)&&this.editor.nodeId.generate(t),this.base.insertNode(t)}isPointInRange(t,e){return ft(t)&&(t=t[0]),this.base.isPointInRange(t,e)}comparePoint(t,e){return ft(t)&&(t=t[0]),this.base.comparePoint(t,e)}setEnd(t,e){return ft(t)&&(t=t[0]),this.base.setEnd(t,e)}setEndAfter(t){if(ft(t)&&(t=t[0]),!!t.parentNode)return this.base.setEndAfter(t)}setEndBefore(t){if(ft(t)&&(t=t[0]),!!t.parentNode)return this.base.setEndBefore(t)}setStart(t,e){return ft(t)&&(t=t[0]),this.base.setStart(t,e)}setStartAfter(t){if(ft(t)&&(t=t[0]),!!t.parentNode)return this.base.setStartAfter(t)}setStartBefore(t){if(ft(t)&&(t=t[0]),!!t.parentNode)return this.base.setStartBefore(t)}toString(){return this.base.toString()}get startNode(){return I(this.base.startContainer)}get endNode(){return I(this.base.endContainer)}get commonAncestorNode(){return I(this.base.commonAncestorContainer)}deepCut(){this.collapsed||this.extractContents();const{startNode:t}=this;if(!t.isEditable()){let e=t;if(e&&!e.isEditable()){let n=e.parent();for(;n&&!n.isEditable();)e=n,n=n.parent();this.setEndAfter(e[0]);const i=this.extractContents();this.insertNode(i),this.collapse(!0)}}}equal(t){return this.startContainer===t.startContainer&&this.startOffset===t.startOffset&&this.endContainer===t.endContainer&&this.endOffset===t.endOffset}getRootBlock(){if(this.startNode.isEditable())return this.startNode.children().eq(this.startOffset);let t=this.startNode;for(;(t==null?void 0:t.parent())&&!t.parent().isEditable();)t=t.parent();return t}filterPath(t=!1){const e=[];return n=>{const i=I(n);if(t&&["left","right","center","body"].includes(i.attributes(He))){const r=this.editor.card.closest(i);return r&&(r==null?void 0:r.length)>0&&e.push(r),!0}return t&&i.isCard()&&e.includes(i)?!0:!ci(i)}}toPath(t=!1,e=this.editor.container){const n=this.cloneRange(),i=n.commonAncestorNode;if(!i.isRoot()&&!i.inEditor())return;n.shrinkToElementNode().shrinkToTextNode();const r=(s,o)=>{var d;let a=s.attributes(we),c=a?0:-1;const u=s.getPath(e,(d=s.parent())!=null&&d.isRoot()?void 0:this.filterPath(t),(h,f,p)=>{if(h===-1)return a="",c=-1,[];a||(a=p.attributes(we),c=f.length),f.unshift(h)});return c=u.length-c,u.push(o),{path:u,id:a,bi:c}};return{start:r(n.startNode,n.startOffset),end:r(n.endNode,n.endOffset)}}};let Te=Wr;y(Te,"create"),y(Te,"from"),y(Te,"fromPath");Te.create=(l,t=document,e)=>{let n;return e?n=t.caretRangeFromPoint(e.x,e.y):n=t.createRange(),Te.from(l,n)};Te.from=(l,t=window)=>{if(!MK(t)){const e=RK(t)?t:t.getSelection();if(e&&e.rangeCount>0)t=e.getRangeAt(0);else return null}return new Te(l,t)};Te.fromPath=(l,t,e=!1,n=l.container)=>{var g,m;const i=t.start.path.slice(),r=t.end.path.slice(),s=i.pop(),o=r.pop(),a=(v,b=l.container.get())=>{let _=b;for(let x=0;x<v.length;x++){let w=v[x];w<0&&(w=0);let E,S=_.firstChild,R=0;for(;S;)if(!(S instanceof Element)||!S.getAttribute(jr)&&S.getAttribute(le)!==Qe||e&&["left","right"].includes(S.getAttribute(He)||"")){if(R===w||!S.nextSibling){E=S;break}R++,S=S.nextSibling}else S=S.nextSibling;if(!E)break;_=E}return _},c=(v,b,_,x)=>{var w,E;_!==null&&(x<0&&(x=0),_.nodeType===Node.ELEMENT_NODE&&x>_.childNodes.length&&(x=_.childNodes.length),_.nodeType===Node.TEXT_NODE&&x>(((w=_.nodeValue)==null?void 0:w.length)||0)&&(x=((E=_.nodeValue)==null?void 0:E.length)||0),b[v](_,x))},u=t.start.id?(g=n.get())==null?void 0:g.querySelector(`[${we}="${t.start.id}"]`):n.get(),d=a(t.start.bi>-1&&u instanceof Element?i.slice(t.start.bi):i,u instanceof Element?u:void 0),h=t.end.id?(m=n.get())==null?void 0:m.querySelector(`[${we}="${t.end.id}"]`):n,f=a(t.end.bi>-1&&h instanceof Element?r.slice(t.end.bi):r,h instanceof Element?h:void 0),p=Te.create(l,document);return c("setStart",p,d,s===void 0?0:s),c("setEnd",p,f,o===void 0?0:o),p};const RK=l=>l.getRangeAt!==void 0,MK=l=>l.collapsed!==void 0,nr=l=>!!l&&l.base!==void 0;class LK{constructor(t,e){y(this,"x",0);y(this,"y",0);y(this,"doc",document);y(this,"range");y(this,"caretRange");y(this,"targetCard");y(this,"caretCard");y(this,"isCardLeftRange",!1);y(this,"engine");y(this,"options",{className:"data-drop-cursor"});this.engine=t,this.options={...this.options,...e}}getRangeForPoint(){const{doc:t,x:e,y:n}=this;if(t.caretRangeFromPoint!==void 0){const i=Te.create(this.engine,t,{x:e,y:n});if(i)return i}if(event&&event.rangeParent!==void 0){const i=Te.create(this.engine,t);return i.setStart(event.rangeParent,event.rangeOffset),i.collapse(!0),i}}getCard(){return this.targetCard||this.caretCard}parseEvent(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer&&(t.dataTransfer.dropEffect="move");const{card:e}=this.engine;this.x=t.clientX,this.y=t.clientY;const n=I(t.target||[]);this.doc=n.document||document,this.targetCard=e.find(n),this.caretRange=this.getRangeForPoint(),this.caretCard=this.caretRange?e.find(this.caretRange.commonAncestorContainer):void 0}getRange(){const{caretRange:t,doc:e,x:n}=this,i=this.getCard();let r;if(i&&i.root.length>0){r=Te.create(this.engine,e);const{left:s,right:o}=i.root.getBoundingClientRect()||{left:0,right:0},a=(s+o)/2;r.select(i.root.get()),a<n?(r.collapse(!1),this.isCardLeftRange=!1):(r.collapse(!0),this.isCardLeftRange=!0)}return this.range=r||t,this.range}getRect(t=2){var c,u;const{isCardLeftRange:e,range:n}=this,i=this.getCard();if(i&&i.root.length>0&&n){if(e){n.setEnd(n.commonAncestorContainer,n.endOffset+1);const{left:p,bottom:g,top:m}=n.getBoundingClientRect();return n.setEnd(n.commonAncestorContainer,n.endOffset-1),{x:p-t,y:m,height:g-m}}n.setStart(n.commonAncestorContainer,n.startOffset-1);const{right:d,top:h,bottom:f}=n.getBoundingClientRect();return n.setStart(n.commonAncestorContainer,n.startOffset+1),{x:d-t,y:h,height:f-h}}let r=(c=this.range)==null?void 0:c.getBoundingClientRect();(r==null?void 0:r.height)===0&&(r=((u=this.range)==null?void 0:u.startContainer).getBoundingClientRect());const{left:s,top:o,bottom:a}=r||{};return{x:s,y:o,height:(a||0)-(o||0)}}getCursor(){const{className:t}=this.options;return I(`body > div.${t}`)}removeCursor(){this.getCursor().remove()}setCursor(){this.removeCursor();const{className:t}=this.options,e=I(`<div class="${t}" />`);I(document.body).append(e)}}class IK{constructor(t,e={}){y(this,"events",{});y(this,"globalEvents",{});y(this,"engine");y(this,"isComposing");y(this,"isSelecting");y(this,"dragoverHelper");y(this,"options");y(this,"keydownRange",null);this.engine=t,this.isComposing=!1,this.isSelecting=!1,this.dragoverHelper=new LK(t),this.options=e}isCardInput(t){let e=t.target?I(t.target):null;for(;e;){if(e.isEditable())return!1;if(e.attributes(He)==="center"||e.attributes(le)===Qe)return!0;const n=e.parent();if(!n)break;e=n}return!1}onInput(t){const{bindInput:e}=this.options;if(e&&!e())return;let n=null;this.onContainer("compositionstart",s=>{var h;if(this.engine.readonly)return;this.isCardInput(s)||this.engine.ot.startMutationCache();const{change:o,node:a,block:c,list:u}=this.engine,d=o.range.get().cloneRange().shrinkToTextNode().enlargeToElementNode();if(!d.collapsed){const f=c.closest(d.startNode),p=c.closest(d.endNode);(a.isCustomize(f)||a.isCustomize(p))&&!f.equal(p)&&((h=u.backspaceEvent)==null||h.trigger(new KeyboardEvent("")))}this.isComposing=!0});const i=s=>{if(!this.isComposing){if(Gr&&n){const o=n.first(),a=o==null?void 0:o.next();if(a!=null&&a.isText()){const h=a.text();if(/^\u200b/.test(h)){const f=a.get();f==null||f.splitText(1),f==null||f.remove()}}const c=this.engine.change.range.get(),{startNode:u,startOffset:d}=c;if(c.collapsed&&(u==null?void 0:u.isText())){const h=u.text(),f=h.substring(d);/^\u200b/.test(f)&&(u.text(h.substring(0,d)+f.substring(1)),c.setOffset(u,d,d),this.engine.change.range.select(c))}n=null}t(s),this.engine.ot.submitMutationCache()}};this.onContainer("compositionend",s=>{this.engine.readonly||(this.isComposing=!1,setTimeout(()=>{this.engine.ot.isCache&&i(s)},40))}),this.onContainer("beforeinput",s=>{var v;if(this.engine.readonly)return;const{change:o,card:a,node:c,block:u,list:d}=this.engine;s.data==="@"&&!this.isCardInput(s)&&this.engine.trigger("keydown:at",s)===!1&&(this.engine.ot.submitMutationCache(),s.preventDefault()),o.rangePathBeforeCommand||o.cacheRangeBeforeCommand();const f=o.range.get().cloneRange().shrinkToTextNode().enlargeToElementNode(),{startNode:p}=f;if(Vr&&s.inputType==="deleteCompositionText"&&p.name==="li"&&p.length>0&&!c.isCustomize(p)){const b=p[0].childNodes;b.length===1&&b[0].nodeName!=="BR"&&(p.prepend("<br />"),setTimeout(()=>{const _=p[0].childNodes;_.length===2&&_[0].nodeName==="BR"&&_[1].nodeName==="BR"&&_[0].remove()},0))}if(Gr&&p.name==="li"&&f.startOffset===1&&c.isCustomize(p)&&this.isComposing){const b=p.first(),_=b==null?void 0:b.next(),x=()=>{const w=I("\u200B",null);b==null||b.after(w),f.setOffset(w,1,1),o.range.select(f),n=p};if(_!=null&&_.isText()){const w=_.text();/^\u200b/.test(w)||x()}else(_==null?void 0:_.name)==="br"&&_.remove(),x()}if(f.collapsed||(f.commonAncestorNode.attributes(He)==="body"?a.remove(f.commonAncestorNode):(f.startNode.attributes(He)==="body"&&a.remove(f.startNode),f.endNode.attributes(He)==="body"&&a.remove(f.endNode))),f.startNode.isRoot()){const b=f.getStartOffsetNode();if(b instanceof Element&&li(b)&&!b.querySelector(Ws)&&a.remove(b),!f.collapsed&&f.endNode.isRoot()){const _=f.getEndOffsetNode();_ instanceof Element&&li(_)&&!_.querySelector(Ws)&&a.remove(_)}}if(!f.collapsed&&!this.isComposing){const b=u.closest(f.startNode),_=u.closest(f.endNode);(c.isCustomize(b)||c.isCustomize(_))&&!b.equal(_)&&((v=d.backspaceEvent)==null||v.trigger(new KeyboardEvent("")),c.insertText(s.data||""))}const{inputType:g}=s;this.isComposing&&!g.includes("Composition")&&this.engine.ot.submitMutationCache(),["format","history"].forEach(b=>{if(g.indexOf(b)===0){s.preventDefault();const _=g.substring(b.length).toLowerCase();this.engine.command.queryEnabled(_)&&this.engine.command.execute(_)}})});let r=null;this.onContainer("input",s=>{var c;if(this.engine.readonly||this.isCardInput(s))return;this.engine.isEmpty()?this.engine.showPlaceholder():this.engine.hidePlaceholder();const{change:o,card:a}=this.engine;if(s.target instanceof Element&&Th(s.target)&&a.active&&a.active.root.isBlockCard()&&!a.active.isEditable&&((c=a.active.root.get())==null?void 0:c.isContentEditable)){const u=o.range.get(),d=I("<p><br /></p>");a.active.root.before(d),a.remove(a.active.root),u.select(d,!0),o.range.select(u);return}r&&clearTimeout(r),r=setTimeout(()=>{i(s)},10)})}onSelect(t){const{bindSelect:e}=this.options;e&&!e()||(this.onContainer(ue?"touchstart":"mousedown",n=>{this.isCardInput(n)||(this.isSelecting=!0)}),this.onDocument(ue?"touchend":"mouseup",n=>{!this.isSelecting||(this.isSelecting=!1,window.setTimeout(()=>t(n),10))}),this.onContainer("keydown",()=>{const n=Te.from(this.engine);this.keydownRange=n}),this.onContainer("keyup",n=>{if(!this.engine.readonly&&!this.isCardInput(n)&&(ce("left",n)||ce("right",n)||ce("up",n)||ce("down",n)||n.key==="Meta"||ce("shift+left",n)||ce("shift+right",n)||ce("shift+up",n)||ce("shift+down",n)||ce("ctrl+b",n)||ce("ctrl+f",n)||ce("ctrl+n",n)||ce("ctrl+p",n)||ce("ctrl+a",n)||ce("ctrl+e",n)||ce("home",n)||ce("end",n))){const i=Te.from(this.engine);if(this.keydownRange&&i&&i.equal(this.keydownRange))return;this.isComposing||t(n)}}))}onPaste(t){const{bindPaste:e}=this.options;if(e&&!e())return;let n=!1;this.onContainer("keydown",i=>{this.engine.readonly||((!ce("mod",i)||!ce("shift",i)||!ce("v",i))&&(n=!1),(ce("mod+shift+v",i)||ce("mod+alt+shift+v",i))&&(n=!0))}),this.onDocument("paste",i=>{const r=this.engine.change.range.get();if(!this.engine.container.contains(r.commonAncestorNode)||this.engine.readonly||this.isCardInput(i))return;i.preventDefault();const s=this.engine.clipboard.getData(i),o=n;n=!1,t({...s,isPasteText:o})})}onDrop(t){const{bindDrop:e}=this.options;if(e&&!e())return;let n,i,r;const s=o=>{var u,d;if(!o.target||this.engine.readonly)return;o.stopPropagation(),this.dragoverHelper.setCursor();const a=I(o.target),c=a.attributes("drag-card-trigger");if(n=this.engine.card.find(c||a),n){if((u=n.toolbarModel)==null||u.hideCardToolbar(),i=n.find("img.data-drag-image"),i.length>0)i=this.engine.node.clone(i);else{i=I('<div class="data-drag-image" />');const h=n.root.get();h&&i.css({width:h.clientWidth+"px",height:h.clientHeight+"px"})}i.css({position:"absolute",top:"-99999px",right:"-99999px"}),I(document.body).append(i),(d=o.dataTransfer)==null||d.setDragImage(i[0],0,0)}};this.onRoot("dragstart",s),this.onContainer("dragstart",s),this.onContainer("dragover",o=>{if(this.engine.readonly)return;const{dragoverHelper:a}=this,c=a.getCursor();if(c.length!==0){a.parseEvent(o),r=a.getRange();const u=a.getRect();c.css({height:u.height+"px",top:Math.round(window.pageYOffset+(u.y||0))+"px",left:Math.round(window.pageXOffset+(u.x||0))+"px"})}else this.dragoverHelper.setCursor()}),this.onContainer("dragleave",()=>{this.dragoverHelper.removeCursor()}),this.onContainer("dragend",()=>{this.dragoverHelper.removeCursor(),i&&(i.remove(),i=void 0)}),this.onContainer("drop",o=>{if(this.engine.readonly)return;o.preventDefault(),this.dragoverHelper.removeCursor(),i&&(i.remove(),i=void 0);const a=o.dataTransfer;let c=[];try{a&&a.items&&a.items.length>0?Array.from(a.items).forEach(d=>{if(d.kind==="file"){const h=d.getAsFile();h&&c.push(h)}}):a&&a.files&&a.files.length>0&&(c=Array.from(a.files))}catch{a&&a.files&&a.files.length>0&&(c=Array.from(a.files))}t({event:o,range:r,card:n,files:c}),n=void 0})}onDocument(t,e,n){this.addEvent("document",t,e,n)}onWindow(t,e,n){this.addEvent("window",t,e,n)}onContainer(t,e,n){this.addEvent("container",t,e,n)}onRoot(t,e,n){this.addEvent("root",t,e,n)}addEvent(t,e,n,i){if(this.globalEvents[t]||(this.globalEvents[t]=[]),!this.globalEvents[t].find(r=>r.type===e)){const r=(...s)=>{const o=this.events[t].filter(c=>c.type===e);let a;for(let c=0;c<o.length&&(a=o[c].listener(...s),a!==!1);c++);return a};switch(t){case"container":this.engine.container.on(e,r);break;case"root":this.engine.root.on(e,r);break;case"document":document.addEventListener(e,r);break;case"window":window.addEventListener(e,r);break}this.globalEvents[t].push({type:e,listener:r})}this.events[t]||(this.events[t]=[]),i!==void 0?this.events[t].splice(i,0,{type:e,listener:n}):this.events[t].push({type:e,listener:n})}destroy(){Object.keys(this.globalEvents).forEach(t=>{this.globalEvents[t].forEach(n=>{t==="window"?window.removeEventListener(n.type,n.listener):t==="document"?document.removeEventListener(n.type,n.listener):t==="container"?this.engine.container.off(n.type,n.listener):t==="root"&&this.engine.root.off(n.type,n.listener)})})}}function js(l){return js=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},js(l)}var OK=/^\s+/,FK=/\s+$/;function de(l,t){if(l=l||"",t=t||{},l instanceof de)return l;if(!(this instanceof de))return new de(l,t);var e=BK(l);this._originalInput=l,this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||e.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=e.ok}de.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function(){var t=this.toRgb(),e,n,i,r,s,o;return e=t.r/255,n=t.g/255,i=t.b/255,e<=.03928?r=e/12.92:r=Math.pow((e+.055)/1.055,2.4),n<=.03928?s=n/12.92:s=Math.pow((n+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),.2126*r+.7152*s+.0722*o},setAlpha:function(t){return this._a=Lh(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=yu(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=yu(this._r,this._g,this._b),e=Math.round(t.h*360),n=Math.round(t.s*100),i=Math.round(t.v*100);return this._a==1?"hsv("+e+", "+n+"%, "+i+"%)":"hsva("+e+", "+n+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var t=bu(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=bu(this._r,this._g,this._b),e=Math.round(t.h*360),n=Math.round(t.s*100),i=Math.round(t.l*100);return this._a==1?"hsl("+e+", "+n+"%, "+i+"%)":"hsla("+e+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(t){return _u(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return qK(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(nt(this._r,255)*100)+"%",g:Math.round(nt(this._g,255)*100)+"%",b:Math.round(nt(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(nt(this._r,255)*100)+"%, "+Math.round(nt(this._g,255)*100)+"%, "+Math.round(nt(this._b,255)*100)+"%)":"rgba("+Math.round(nt(this._r,255)*100)+"%, "+Math.round(nt(this._g,255)*100)+"%, "+Math.round(nt(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:QK[_u(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var e="#"+wu(this._r,this._g,this._b,this._a),n=e,i=this._gradientType?"GradientType = 1, ":"";if(t){var r=de(t);n="#"+wu(r._r,r._g,r._b,r._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,i=this._a<1&&this._a>=0,r=!e&&i&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return r?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(n=this.toRgbString()),t==="prgb"&&(n=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(n=this.toHexString()),t==="hex3"&&(n=this.toHexString(!0)),t==="hex4"&&(n=this.toHex8String(!0)),t==="hex8"&&(n=this.toHex8String()),t==="name"&&(n=this.toName()),t==="hsl"&&(n=this.toHslString()),t==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return de(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(jK,arguments)},brighten:function(){return this._applyModification(VK,arguments)},darken:function(){return this._applyModification(GK,arguments)},desaturate:function(){return this._applyModification(HK,arguments)},saturate:function(){return this._applyModification(WK,arguments)},greyscale:function(){return this._applyModification(UK,arguments)},spin:function(){return this._applyModification(ZK,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(YK,arguments)},complement:function(){return this._applyCombination(KK,arguments)},monochromatic:function(){return this._applyCombination(JK,arguments)},splitcomplement:function(){return this._applyCombination(XK,arguments)},triad:function(){return this._applyCombination(xu,[3])},tetrad:function(){return this._applyCombination(xu,[4])}};de.fromRatio=function(l,t){if(js(l)=="object"){var e={};for(var n in l)l.hasOwnProperty(n)&&(n==="a"?e[n]=l[n]:e[n]=Ir(l[n]));l=e}return de(l,t)};function BK(l){var t={r:0,g:0,b:0},e=1,n=null,i=null,r=null,s=!1,o=!1;return typeof l=="string"&&(l=iX(l)),js(l)=="object"&&($n(l.r)&&$n(l.g)&&$n(l.b)?(t=$K(l.r,l.g,l.b),s=!0,o=String(l.r).substr(-1)==="%"?"prgb":"rgb"):$n(l.h)&&$n(l.s)&&$n(l.v)?(n=Ir(l.s),i=Ir(l.v),t=zK(l.h,n,i),s=!0,o="hsv"):$n(l.h)&&$n(l.s)&&$n(l.l)&&(n=Ir(l.s),r=Ir(l.l),t=PK(l.h,n,r),s=!0,o="hsl"),l.hasOwnProperty("a")&&(e=l.a)),e=Lh(e),{ok:s,format:l.format||o,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:e}}function $K(l,t,e){return{r:nt(l,255)*255,g:nt(t,255)*255,b:nt(e,255)*255}}function bu(l,t,e){l=nt(l,255),t=nt(t,255),e=nt(e,255);var n=Math.max(l,t,e),i=Math.min(l,t,e),r,s,o=(n+i)/2;if(n==i)r=s=0;else{var a=n-i;switch(s=o>.5?a/(2-n-i):a/(n+i),n){case l:r=(t-e)/a+(t<e?6:0);break;case t:r=(e-l)/a+2;break;case e:r=(l-t)/a+4;break}r/=6}return{h:r,s,l:o}}function PK(l,t,e){var n,i,r;l=nt(l,360),t=nt(t,100),e=nt(e,100);function s(c,u,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?c+(u-c)*6*d:d<1/2?u:d<2/3?c+(u-c)*(2/3-d)*6:c}if(t===0)n=i=r=e;else{var o=e<.5?e*(1+t):e+t-e*t,a=2*e-o;n=s(a,o,l+1/3),i=s(a,o,l),r=s(a,o,l-1/3)}return{r:n*255,g:i*255,b:r*255}}function yu(l,t,e){l=nt(l,255),t=nt(t,255),e=nt(e,255);var n=Math.max(l,t,e),i=Math.min(l,t,e),r,s,o=n,a=n-i;if(s=n===0?0:a/n,n==i)r=0;else{switch(n){case l:r=(t-e)/a+(t<e?6:0);break;case t:r=(e-l)/a+2;break;case e:r=(l-t)/a+4;break}r/=6}return{h:r,s,v:o}}function zK(l,t,e){l=nt(l,360)*6,t=nt(t,100),e=nt(e,100);var n=Math.floor(l),i=l-n,r=e*(1-t),s=e*(1-i*t),o=e*(1-(1-i)*t),a=n%6,c=[e,s,r,r,o,e][a],u=[o,e,e,s,r,r][a],d=[r,r,o,e,e,s][a];return{r:c*255,g:u*255,b:d*255}}function _u(l,t,e,n){var i=[ln(Math.round(l).toString(16)),ln(Math.round(t).toString(16)),ln(Math.round(e).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function qK(l,t,e,n,i){var r=[ln(Math.round(l).toString(16)),ln(Math.round(t).toString(16)),ln(Math.round(e).toString(16)),ln(Ih(n))];return i&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)&&r[3].charAt(0)==r[3].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0)+r[3].charAt(0):r.join("")}function wu(l,t,e,n){var i=[ln(Ih(n)),ln(Math.round(l).toString(16)),ln(Math.round(t).toString(16)),ln(Math.round(e).toString(16))];return i.join("")}de.equals=function(l,t){return!l||!t?!1:de(l).toRgbString()==de(t).toRgbString()};de.random=function(){return de.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function HK(l,t){t=t===0?0:t||10;var e=de(l).toHsl();return e.s-=t/100,e.s=mo(e.s),de(e)}function WK(l,t){t=t===0?0:t||10;var e=de(l).toHsl();return e.s+=t/100,e.s=mo(e.s),de(e)}function UK(l){return de(l).desaturate(100)}function jK(l,t){t=t===0?0:t||10;var e=de(l).toHsl();return e.l+=t/100,e.l=mo(e.l),de(e)}function VK(l,t){t=t===0?0:t||10;var e=de(l).toRgb();return e.r=Math.max(0,Math.min(255,e.r-Math.round(255*-(t/100)))),e.g=Math.max(0,Math.min(255,e.g-Math.round(255*-(t/100)))),e.b=Math.max(0,Math.min(255,e.b-Math.round(255*-(t/100)))),de(e)}function GK(l,t){t=t===0?0:t||10;var e=de(l).toHsl();return e.l-=t/100,e.l=mo(e.l),de(e)}function ZK(l,t){var e=de(l).toHsl(),n=(e.h+t)%360;return e.h=n<0?360+n:n,de(e)}function KK(l){var t=de(l).toHsl();return t.h=(t.h+180)%360,de(t)}function xu(l,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var e=de(l).toHsl(),n=[de(l)],i=360/t,r=1;r<t;r++)n.push(de({h:(e.h+r*i)%360,s:e.s,l:e.l}));return n}function XK(l){var t=de(l).toHsl(),e=t.h;return[de(l),de({h:(e+72)%360,s:t.s,l:t.l}),de({h:(e+216)%360,s:t.s,l:t.l})]}function YK(l,t,e){t=t||6,e=e||30;var n=de(l).toHsl(),i=360/e,r=[de(l)];for(n.h=(n.h-(i*t>>1)+720)%360;--t;)n.h=(n.h+i)%360,r.push(de(n));return r}function JK(l,t){t=t||6;for(var e=de(l).toHsv(),n=e.h,i=e.s,r=e.v,s=[],o=1/t;t--;)s.push(de({h:n,s:i,v:r})),r=(r+o)%1;return s}de.mix=function(l,t,e){e=e===0?0:e||50;var n=de(l).toRgb(),i=de(t).toRgb(),r=e/100,s={r:(i.r-n.r)*r+n.r,g:(i.g-n.g)*r+n.g,b:(i.b-n.b)*r+n.b,a:(i.a-n.a)*r+n.a};return de(s)};de.readability=function(l,t){var e=de(l),n=de(t);return(Math.max(e.getLuminance(),n.getLuminance())+.05)/(Math.min(e.getLuminance(),n.getLuminance())+.05)};de.isReadable=function(l,t,e){var n=de.readability(l,t),i,r;switch(r=!1,i=rX(e),i.level+i.size){case"AAsmall":case"AAAlarge":r=n>=4.5;break;case"AAlarge":r=n>=3;break;case"AAAsmall":r=n>=7;break}return r};de.mostReadable=function(l,t,e){var n=null,i=0,r,s,o,a;e=e||{},s=e.includeFallbackColors,o=e.level,a=e.size;for(var c=0;c<t.length;c++)r=de.readability(l,t[c]),r>i&&(i=r,n=de(t[c]));return de.isReadable(l,n,{level:o,size:a})||!s?n:(e.includeFallbackColors=!1,de.mostReadable(l,["#fff","#000"],e))};var za=de.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},QK=de.hexNames=eX(za);function eX(l){var t={};for(var e in l)l.hasOwnProperty(e)&&(t[l[e]]=e);return t}function Lh(l){return l=parseFloat(l),(isNaN(l)||l<0||l>1)&&(l=1),l}function nt(l,t){tX(l)&&(l="100%");var e=nX(l);return l=Math.min(t,Math.max(0,parseFloat(l))),e&&(l=parseInt(l*t,10)/100),Math.abs(l-t)<1e-6?1:l%t/parseFloat(t)}function mo(l){return Math.min(1,Math.max(0,l))}function Ht(l){return parseInt(l,16)}function tX(l){return typeof l=="string"&&l.indexOf(".")!=-1&&parseFloat(l)===1}function nX(l){return typeof l=="string"&&l.indexOf("%")!=-1}function ln(l){return l.length==1?"0"+l:""+l}function Ir(l){return l<=1&&(l=l*100+"%"),l}function Ih(l){return Math.round(parseFloat(l)*255).toString(16)}function ku(l){return Ht(l)/255}var tn=function(){var l="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",e="(?:"+t+")|(?:"+l+")",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",i="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{CSS_UNIT:new RegExp(e),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function $n(l){return!!tn.CSS_UNIT.exec(l)}function iX(l){l=l.replace(OK,"").replace(FK,"").toLowerCase();var t=!1;if(za[l])l=za[l],t=!0;else if(l=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var e;return(e=tn.rgb.exec(l))?{r:e[1],g:e[2],b:e[3]}:(e=tn.rgba.exec(l))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=tn.hsl.exec(l))?{h:e[1],s:e[2],l:e[3]}:(e=tn.hsla.exec(l))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=tn.hsv.exec(l))?{h:e[1],s:e[2],v:e[3]}:(e=tn.hsva.exec(l))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=tn.hex8.exec(l))?{r:Ht(e[1]),g:Ht(e[2]),b:Ht(e[3]),a:ku(e[4]),format:t?"name":"hex8"}:(e=tn.hex6.exec(l))?{r:Ht(e[1]),g:Ht(e[2]),b:Ht(e[3]),format:t?"name":"hex"}:(e=tn.hex4.exec(l))?{r:Ht(e[1]+""+e[1]),g:Ht(e[2]+""+e[2]),b:Ht(e[3]+""+e[3]),a:ku(e[4]+""+e[4]),format:t?"name":"hex8"}:(e=tn.hex3.exec(l))?{r:Ht(e[1]+""+e[1]),g:Ht(e[2]+""+e[2]),b:Ht(e[3]+""+e[3]),format:t?"name":"hex"}:!1}function rX(l){var t,e;return l=l||{level:"AA",size:"small"},t=(l.level||"AA").toUpperCase(),e=(l.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),e!=="small"&&e!=="large"&&(e="small"),{level:t,size:e}}class Eu{constructor(t){y(this,"source");this.source=t}toHTML(){let t=dt(this.source);return t=t.replace(/\n/g,"</p><p>").replace(/<p><\/p>/g,"<p><br /></p>").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),t.indexOf("</p><p>")>=0&&(t="<p>".concat(t,"</p>")),t}}const sX=l=>{let t="";for(const e in l){if(e==="style")continue;const n=dt(l[e]);t+=" ".concat(e,'="').concat(n,'"')}return t.trim()},oX=l=>{let t="";for(let e in l){e=e.toLowerCase();let n=dt(l[e]);/^(padding|margin|text-indent)/.test(e)&&Ee(n)===0||(e.endsWith("color")&&(n=de(n).toHexString()),t+=" ".concat(e,": ").concat(n,";"))}return t.trim()};class $t{constructor(t,e,n,i=!0){y(this,"root");y(this,"editor");y(this,"isNormalize",!0);if(this.editor=e,this.isNormalize=i,typeof t=="string"){t=t.replace(/<a\s{0,1000}\/>/gi,"<a></a>"),t=t.replace(/<a(\s[^>]+?)\/>/gi,(o,a)=>"<a".concat(a,"></a>")),t=t==null?void 0:t.replace(/<img .*>/gi,o=>o.replace(/\son[a-zA-Z]{1,20}=/g,"notallow=")),t=t.replace(/<p(>|\s+[^>]*>)/gi,"<paragraph$1").replace(/<\/p(>|\s+[^>]*>)/gi,"</paragraph$1"),t=Oi(t);const s=new DOMParser().parseFromString(t,"text/html").body.innerHTML.replace(/<paragraph(>|\s+[^>]*>)/gi,"<p$1").replace(/<\/paragraph(>|\s+[^>]*>)/gi,"</p$1");this.root=I(`<div>${s}</div>`)}else ft(t)?this.root=t:this.root=I(t);n&&n(this.root)}convert(t,e,n){var a;let i=t.transform(e);const r=[],s=this.editor.node;let o=null;for(;i;){const{rule:c}=i;r.push(c);const{name:u,attributes:d,style:h}=i.node;u!=="card"&&delete d[we],delete d.id;const f=I(`<${u} />`);if(s.setAttributes(f,{...d,style:h}),(a=f.get())==null||a.append(...e.get().childNodes),e.isCard())return e.replaceWith(f),f;if(i.replace?(e.replaceWith(f),e=f):f.each(p=>{const g=e.get();g&&g instanceof Element&&g.append(p)}),(!o||o.length===0)&&(o=f),s.isBlock(f,n)){i=t.transform(f,p=>r.indexOf(p)<0);continue}i=t.transform(e,p=>r.indexOf(p)<0)}return o}normalize(t,e,n){const i=this.editor,r=i.node,s=i.inline;if(!this.isNormalize){if(!n)return;const a=t.find(ut);a.each((u,d)=>{const h=a.eq(d);!h||this.convert(n,h,e)});const c=t.find(`${uo},${yl},${_l}`);c.each((u,d)=>{const h=c.eq(d);!h||this.convert(n,h,e)});return}const o=(a,c="mark")=>{const u=a.attributes(),d=fr(u.style||"");if(delete u.style,Object.keys(u).length===0&&Object.keys(d).length===0)return;const h=Object.keys(u).length,f=Object.keys(d).length,p=a.clone();e.filter(a,u,d,!0),p.removeAttributes(we);const g=Object.keys(u);let m=0;g.forEach(_=>{u[_]&&(m++,p.removeAttributes(_))});let v=0;if(Object.keys(d).forEach(_=>{d[_]&&(v++,p.css(_,""))}),(m===h&&v===f||m===0&&v===0)&&e.getType(p)===c){a.before(p);const _=a.children();p.append(_.length>0?_:c==="block"?"<br />":I("\u200B",null)),a.remove(),a=p;return}return p.attributes("style").trim()===""&&p.removeAttributes("style"),p};t.traverse(a=>{var c;if(!(a[0]===t[0]||["style","script","meta"].includes(a.name))){if(a.isElement()){const u=a.isCard();if(n&&(!e.getType(a)||u)){const d=this.convert(n,a,e);if(d)return u?!0:d}if(u)return;if(r.isMark(a,e)){const d=[];let h=e.getRule(a);if(h){d.push(h),((c=a.get())==null?void 0:c.childNodes.length)===0&&i.mark.repairCursor(a);let f=o(a);if(!f)return;let p=e.getType(f,m=>m.name===f.name&&m.type==="mark"&&d.indexOf(m)<0);if(!p&&n){const m=this.convert(n,f,e);if(m&&m.length>0){const v=a.children();m.append(v.length>0?v:I("\u200B",null)),a.append(f.length===0?m:f.children());return}}let g=a;for(;p==="mark";){const m=g.children();let v=f;for(;;){const b=v.children();if(b.length>0)v=b;else break}if(v.append(m.length>0?m:I("\u200B",null)),g.append(f),g=f,f=o(f),!f)break;if(p=e.getType(f,b=>b.name===f.name&&b.type==="mark"&&d.indexOf(b)<0),!p){if(n){const b=this.convert(n,f,e);if(b&&b.length>0){f=f.length>0?f.children():b,p="mark";continue}}break}if(h=e.getRule(f),!h)break;d.push(h)}}}else if(r.isInline(a))return s.flat(a,e)}else if(a.isText()){const u=a.text();if(/^\n/.test(u)||/^\s/.test(u)){const d=a.get(),h=d.previousSibling,f=d.nextSibling,p=h?e.getType(h):void 0,g=f?e.getType(f):void 0;if(!h&&f&&(!g||g==="block")){a.remove();return}!f&&h&&(!p||p==="block")&&a.remove()}}}})}traverse(t,e=null,n,i,r){var a,c;const s=this.editor.node;let o=t.first();for(;o;){if(["style","script","meta"].includes(o.name)){o=o.next();continue}if(o.isElement()){let u=o.name,d=o.attributes();if(d[le]===Qe){o=o.next();continue}let h=fr(d.style||"");if(delete d.style,["left","right"].indexOf(d[He])>=0){o=o.next();continue}let f=!0,p;if(e&&d[le]!==pi)if(p=e.getType(o),p===void 0){f=!1;const g=o.parent();if(g&&s.isBlock(g,e)&&((a=g.get())==null?void 0:a.childNodes.length)===1&&((c=o.get())==null?void 0:c.childNodes.length)===0){const m=I("<br />");o.before(m),o.remove(),o=m,u=m.name,d={},h={},f=!0}}else e.filter(o,d,h);if(d[He]!=="center"&&i.onOpen&&f&&i.onOpen(o,u,d,h)===!1){o=o.next();continue}(u!=="card"&&(!d[ke]||d[an]==="true")||r)&&this.traverse(o,e,n,i,r),d[He]!=="center"&&i.onClose&&f&&i.onClose(o,u,d,h)}else if(o.isText()){let u=o[0].nodeValue?dt(o[0].nodeValue):"";u===""&&s.isBlock(o.parent(),e||void 0)&&(o.prev()||(u=u.replace(/^[ \n]+/,"")),o.next()||(u=u.replace(/[ \n]+$/,"")));const d=o.prev(),h=o.next();d&&s.isBlock(d,e||void 0)&&h&&s.isBlock(h,e||void 0)&&u.trim()===""&&(u=u.trim()),i.onText&&i.onText(o,u)}o=o.next()}}toValue(t=null,e=null,n=!1,i=!1){const r=[],s=this.editor,o=s.node,a=this.root.clone(!0);t&&this.normalize(a,t,e),s.trigger("parse:value-before",a),this.traverse(a,t,e,{onOpen:(u,d,h,f)=>{var p;if(s.trigger("parse:value",u,h,f,r)===!1)return!1;if(r.push("<"),r.push(d),Object.keys(h).length>0&&r.push(" "+sX(h)),Object.keys(f).length>0){const g=oX(f);g!==""&&(r.push(' style="'),r.push(g),r.push('"'))}o.isVoid(d,t||void 0)&&((p=u.get())==null?void 0:p.childNodes.length)===0?r.push(" />"):r.push(">")},onText:(u,d)=>{n&&d.length>1&&(d=d.replace(/[\u00a0 ]+/g,h=>{const f=[];h=h.replace(/\u00a0/g," ");for(let p=0;p<h.length;p++)f[p]=p%2==0?h[p]:"\xA0";return f.join("")})),r.push(d)},onClose:(u,d)=>{o.isVoid(d,t||void 0)||r.push("</".concat(d,">"))}}),s.trigger("parse:value-after",r),r.length>0&&/^\n+/g.test(r[0])&&(r[0]=r[0].replace(/^\n+/g,"")),r.length>0&&/\n+$/g.test(r[r.length-1])&&(r[r.length-1]=r[r.length-1].replace(/\n+$/g,""));const c=r.join("");return i?Oi(c):c}toHTML(t,e){const n=I("<div />"),i=this.editor,r=i.container.css();return t&&e?(I(t).append(this.root).css(r),n.append(e)):n.append(this.root),i.trigger("parse:html-before",this.root),i.trigger("parse:html",n),i.trigger("parse:html-after",n),n.html()}toDOM(t=null,e){const n=this.toValue(t,e,!1,!0),i=new DOMParser().parseFromString(n,"text/html"),r=i.createDocumentFragment(),s=i.body.childNodes;for(;s.length>0;){const o=s[0];r.appendChild(o)}return r}toText(t=null,e,n=!0){const i=this.root.clone(!0),r=[],s=this.editor;return this.traverse(i,null,null,{onOpen:(o,a,c,u)=>{if(s.trigger("parse:text",o,c,u,r)===!1)return!1;if(a==="br"&&r.push(`
`),n&&o.name==="li"){if(o.hasClass(s.list.CUSTOMZIE_LI_CLASS))return;const d=o.parent(),h=d==null?void 0:d.css("listStyleType");if((d==null?void 0:d.name)==="ol"){const f=d[0].start,p=f||1;r.push(`${iu(h,p)}. `),d.attributes("start",p+1)}else(d==null?void 0:d.name)==="ul"&&r.push(iu(h)+" ")}},onText:(o,a)=>{a=ho(a),a=a.replace(/\u00a0/g," "),r.push(a)},onClose:(o,a)=>{const c=s.node;if(a==="p"||c.isBlock(o,t||s.schema)){const u=Array.from(o.get().childNodes);if(u.length===0||u.some(d=>{if(d instanceof Text)return!1;if(d.nodeName==="BR")return!0;const h=(t||s.schema).getType(d);return!h||h==="block"}))return;r.push(`
`)}}},e),r.join("").trim()}}class aX{constructor(t,e){y(this,"source");y(this,"engine");y(this,"schema");this.source=t,this.engine=e,this.schema=this.engine.schema.clone()}parser(){const t=this.engine.conversion.clone();return this.engine.trigger("paste:schema",this.schema),new $t(this.source,this.engine,n=>{this.engine.trigger("paste:origin",n)}).toDOM(this.schema,t)}getDefaultStyle(t=this.engine.container){return{color:de(t.css("color")).toHexString(),"background-color":de(t.css("background-color")).toHexString(),"font-size":t.css("font-size")}}elementNormalize(t){const e=this.getDefaultStyle(),{inline:n,list:i}=this.engine,r=this.engine.node,s=this.engine.mark,o=this.engine.block,a=[];I(t).traverse(c=>{var w,E,S,R,D,P,O;let u=c.parent();if(!u||c.isCard()||c.fragment===t)return;if(c.isText()){let L=c.text();if(/\u200b/.test(L)){let B=!0;const A=c.next(),F=c.prev(),W=c.parent();(W&&r.isMark(W,this.schema)||W&&r.isInline(W,this.schema)||A&&r.isInline(A,this.schema)||F&&r.isInline(F,this.schema))&&(B=!1),B&&(L=L.replace(/\u200b/g,""),c.text(L))}else if(/^\n(\t)+$/.test(L)){c.remove(),((w=u.get())==null?void 0:w.childNodes.length)===0&&u.remove();return}else if(/^\n$/.test(L)){if(r.isList(u)){c.remove();return}const B=c.next();B&&r.isBlock(B)&&c.remove()}if(r.isList(u)){const B=c.next(),A=c.prev(),F=(G,k)=>{if(r.isCustomize(G)){const C=G.first();if(C&&C.isCard()){const $=C.attributes(ke)||C.attributes(We);$&&i.addCardToCustomize(k,$)}}};let W=null;return(B==null?void 0:B.name)==="li"?(W=B.clone(),F(B,W)):(A==null?void 0:A.name)==="li"?(W=A.clone(),F(A,W)):W=I("<li></li>"),c.before(W),W.append(c),W}return}const d=c.css();for(const L in e){let B=d[L];!B||(L.endsWith("color")&&(B=de(B).toHexString()),B.toLowerCase()===e[L].toLowerCase()&&c.css(L,""))}let h=this.schema.getType(c);if(!h){const L=c.first();return r.unwrap(c),L}r.removeMinusStyle(c,"text-indent"),r.isList(c)&&c.css("padding-left","");let f=c.attributes();for(f.style&&f.style.trim()===""&&c.removeAttributes("style");c.name==="span"&&r.isEmpty(c)&&!(c.children().length>0);){if(u=c.parent(),c.remove(),!u||(c=u,u=c.parent(),!u))return;h=void 0,f=void 0}if(f||(f=c.attributes()),f[We])return;const p=h?h==="block":r.isBlock(c,this.schema),g=r.isVoid(c,this.schema);let m=r.isBlock(u,this.schema);if(p&&f["data-type"]!=="p"&&!g&&!m&&r.html(c)===""){c.remove();return}f["data-type"]==="p"&&c.removeAttributes("data-type"),p&&(u==null?void 0:u.name)==="p"&&(r.unwrap(u),u=c.parent(),(u==null?void 0:u.fragment)===t&&(u=void 0),m=u?r.isBlock(u,this.schema):!1);const v=u?r.isList(u):!1;if(c.name==="li"&&u&&!v){const L=I("<ul />");c.before(L),L.append(c);return}if(r.isList(c)&&u&&r.isList(u)){const L=[],B=[];let A=!0;const F=u.children().toArray();let W=u.clone();const G=()=>{var $,z;return((z=($=W.get())==null?void 0:$.childNodes.length)!=null?z:0)>0?(A?L.push(W):B.push(W),W=u.clone(),!0):!1};F.forEach(($,z)=>{if(!!$){if(A&&$.equal(c)){F.length-1===z?(G(),B.push(c)):(z===0||G(),L.push(c)),A=!1;return}if($.name==="li"){W.append($);return}else G();A?L.push($):B.push($)}}),G();const k=u.attributes(i.INDENT_KEY)||"0";c.attributes(i.INDENT_KEY,k),i.addIndent(c,1);let C=u;return L.forEach($=>{var M;const z=I($);!z||((M=z.get())==null?void 0:M.childNodes.length)===0||(C.after(z),C=z)}),B.forEach($=>{var M;const z=I($);!z||((M=z.get())==null?void 0:M.childNodes.length)===0||(C.after(z),C=z)}),u.remove(),c||void 0}if(c.name!=="li"&&v){if(c.name==="br"){c.remove();return}const L=I("<li />");c.before(L),L.append(c);return}if(r.isList(c)&&(u==null?void 0:u.name)==="li"){const L=u==null?void 0:u.parent();if(!L){r.unwrap(u);return}const B=L.clone(),A=L.clone();let F=!0;L.children().toArray().forEach(M=>{if(!!M){if(F&&M.equal(u)){F=!1;return}F?B.append(M):A.append(M)}});const G=(E=u==null?void 0:u.parent())==null?void 0:E.hasClass("data-list"),k=u==null?void 0:u.children();let C=null,$=null;k.each((M,T)=>{var q,Z;const K=k.eq(T);if(!K||r.isEmptyWithTrim(K)&&!r.isVoid(K))return;const ee=r.isList(K),Y=B[B.length-1];if(ee){const te=((q=I(Y))==null?void 0:q.attributes(i.INDENT_KEY))||"0";K.attributes(i.INDENT_KEY,te),i.addIndent(K,1),B[B.length]=K[0],C=null;return}else if(r.isBlock(M,this.schema)){const te=B.length;B[te]=K[0],B[te+1]=B.clone()[0],C=null;return}if(!C){C=I(G?`<li class="${i.CUSTOMZIE_LI_CLASS}" />`:"<li />");const te=(Z=I(Y))==null?void 0:Z.last();te?te==null||te.after(C):I(Y).append(C)}C.append(M),$||($=C)}),u==null||u.remove();let z=L;return B.each(M=>{var K;const T=I(M);!T||((K=T.get())==null?void 0:K.childNodes.length)===0||(z.after(T),z=T)}),A.each(M=>{var K;const T=I(M);!T||((K=T.get())==null?void 0:K.childNodes.length)===0||(z.after(T),z=T)}),L.remove(),($==null?void 0:$.next())||B.next()||void 0}if(c.name==="p"&&v){const L=I("<li />");return r.replace(c,L),L}if(p&&!g&&r.html(c).trim()===""&&(r.isRootBlock(c,this.schema)||c.name==="li")&&r.html(c,"<br />"),p&&(u==null?void 0:u.name)==="li"){const L=(R=(S=c.get())==null?void 0:S.childNodes)!=null?R:[];if(c.name==="p"){const B=c.next();L.length===0&&!B&&c.append("<br />");const A=c.first();return B&&B.name==="p"&&c.append("<br />"),r.unwrap(c),A}else{const B=u.parent();if(!B)return;const A=B.clone(),F=B.clone();let W=u.prev();for(;W;)A.prepend(W),W=u.prev();let G=u.next();for(;G;)F.append(G),G=u.next();const k=u.clone(),C=u.clone();let $=c.prev();for(;$;)k.prepend($),$=c.prev();let z=c.next();for(;z;)C.append(z),z=c.next();B.after(c),k.first()&&A.append(k),C.first()&&F.prepend(C),A.first()&&B.before(A),F.first()&&c.after(F),B.remove();return}}if(!p&&r.isInline(c)&&!c.isCard()&&!g){const L=c.allChildren().some(B=>r.isVoid(B,this.schema));r.isEmptyWithTrim(c)&&!L?c.remove():n.repairCursor(c)}r.removeSide(c);let b=u;const _=L=>{if(b&&!b.fragment&&r.isBlock(L,this.schema)&&r.isBlock(b,this.schema)&&!this.schema.isAllowIn(b.name,L.name)){const B=L.children();r.unwrap(L),B.each((A,F)=>{_(B.eq(F))})}};for(_(c);c.length>0&&b&&!b.fragment&&r.isBlock(c,this.schema)&&!r.isBlock(b,this.schema);){const L=c.clone();r.unwrap(c),b.before(L),L.append(b),c=L,b=c.parent()}const x=r.isMark(c,this.schema);if(c.length>0&&x){const L=o.closest(c);if(!L.equal(c)){const B=s.findPlugin(c),A=o.findPlugin(L);if(B&&((D=A==null?void 0:A.disableMark)==null?void 0:D.includes(B.name))){const F=c.first();return r.unwrap(c),F||void 0}}}if(x){const L=s.findPlugin(c),B=a.concat();if(B.pop(),L){const A=B.find(F=>{var W;return((W=F.plugin)==null?void 0:W.name)===L.name&&F.node.length>0&&!F.node.equal(c)});if(A){((P=A.node.get())==null?void 0:P.childNodes.length)===1?r.unwrap(A.node):r.unwrap(c);return}}}if(b=u,c.length>0&&b&&r.isMark(b,this.schema)&&x){const L=s.findPlugin(b),B=(O=a[a.length-1])==null?void 0:O.plugin;if(L&&B&&B.mergeLeval>L.mergeLeval){const A=b.clone(!1),F=b.children().toArray(),W=A.clone(),G=A.clone();let k=!0,C=-1;if(F.forEach(($,z)=>{if($.equal(c)){const M=c.children();A.append(M),c.append(A),k=!1,C=z}else k?W.append($):G.append($)}),C>0&&b.before(W),C<F.length-1&&b.after(G),C>-1)return b.before(c),b.remove(),a.splice(a.length-2,1),c}}},void 0,void 0,c=>{if(r.isMark(c)){const u=s.findPlugin(c);c.is_mark=!0,a.push({plugin:u,node:c})}},c=>{c.is_mark&&a.pop()})}normalize(t=!0){const e=this.engine.node;let n=this.parser();this.elementNormalize(n);const i=this.engine.change.range.get(),r=i.commonAncestorNode,s=this.engine.inline.closest(r);if(r.inEditor()&&!s.isCard()&&e.isInline(s,this.schema))return this.removeElementNodes(I(n)),n;if(r.inEditor()&&r.isText()&&i.startContainer===i.endContainer){const u=r[0].nodeValue,d=u==null?void 0:u.substr(0,i.startOffset),h=u==null?void 0:u.substr(i.endOffset);if(/\[.*?\]\($/.test(d||"")&&/^\)/.test(h||""))return this.removeElementNodes(I(n)),n}I(n).traverse(u=>{var h,f;if(u.fragment===n)return;const d=(h=u.get())==null?void 0:h.firstChild;if(u.length>0&&u[0].parentNode&&this.engine.trigger("paste:each",u),u.isText()){const p=u.text();if(/^(\r|\n)+$/.test(p)){const m=u.prev(),v=u.next();(m&&!e.isBlock(m)||v&&!e.isBlock(v)||m&&e.isBlock(m)&&v&&e.isBlock(v)||((f=u.parent())==null?void 0:f.name)==="p")&&u.remove()}const g=/((\n)+)/.exec(p);if(g&&g.index>0&&g.index<p.length-1){const m=u.get().splitText(g.index),v=m.splitText(g[0].length);u.after(m),m.after(v),u.text()||u.remove()}}else u.name==="pre"&&u.find(tr).length>0&&e.unwrap(u);if(u.length===0&&d)return I(d)}),this.engine.trigger("paste:each-after",I(n));const o=e.normalize(I(n));o.fragment&&(n=o.fragment),n.normalize();const c=I(n).find("ul,ol");return c.each((u,d)=>{const h=c.eq(d);h&&e.isList(h)&&this.engine.list.addStart(h)}),this.engine.nodeId.generateAll(I(n),t),n}removeElementNodes(t){t.allChildren().forEach(n=>{n.isElement()&&this.engine.node.unwrap(n)})}}var Ve=(l=>(l.INLINE="inline",l.BLOCK="block",l))(Ve||{}),ui=(l=>(l.CARD_CHANGE="card_change",l.CLICK="click",l.MOUSE_DOWN="mouse_down",l))(ui||{}),ir=(l=>(l.NONE="none",l.BACKGROUND="background",l.BORDER="border",l))(ir||{});class lX{constructor(t){y(this,"engine");y(this,"lastePasteRange");y(this,"prevSelection",null);this.engine=t}repairInput(t,e){const{commonAncestorNode:n}=e,i=this.engine.card.find(n),{node:r,mark:s,change:o}=this.engine;if(i&&i.type===Ve.INLINE)if(i.isLeftCursor(n)){const h=n.closest(St);let f=h.text().replace(/\u200B/g,"");f&&(f=dt(f),e.setStartBefore(i.root),e.collapse(!0),r.html(h,"&#8203;"),r.insertText(f,e),o.apply(e))}else if(i.isRightCursor(n)){const h=n.closest(At);let f=h.text().replace(/\u200B/g,"");if(f){f=dt(f);const p=i.root.next(),g=i.queryMarks?i.queryMarks(!0):[];if(g.length>0){let m=g[g.length-1];m.append(f);for(let v=g.length-2;v>=0;v--)m=g[v].append(m);i.root.after(m),e.select(m,!0).collapse(!1)}else p&&(p.isText()||r.isMark(p))?(e.select(p,!0).collapse(!0),r.insertText(f,e)):(e.setEndAfter(i.root),e.collapse(!1),r.insertText(f,e));r.html(h,"&#8203;"),o.apply(e)}}else o.range.toTrusty(e);let{startNode:a,startOffset:c}=e.cloneRange().shrinkToTextNode();const u=a.parent();if(a.isText()&&u&&r.isMark(u)){let h=a.get(),f=a.text();if(c===f.length&&t.data&&t.inputType.indexOf("insert")===0){let p=u,g=[];for(;p&&r.isMark(p);){const v=s.findPlugin(p);v&&!v.followStyle&&g.push(p),p=p.parent();const b=p==null?void 0:p.parent();if((p==null?void 0:p.next())&&b&&r.isMark(b))break}const m=a.next();g.forEach((v,b)=>{if(u.equal(v)&&m){g.splice(b,1);return}let _=v.next(),x=v;for(;!_&&x;){const E=x.parent();if(E&&r.isBlock(E))break;_=(E==null?void 0:E.next())||null,x=E}let w=_;for(;w&&!w.isText();){if(r.isMark(w)&&s.compare(w,v)){g.splice(b,1);break}w=w.first()}}),g.length>0&&(h.splitText(f.length-t.data.length).remove(),r.isEmpty(u)&&u.remove(),s.unwrap(g.map(b=>b.clone())),r.insertText(f.substr(f.length-t.data.length)),s.merge(),e=o.range.get().cloneRange().shrinkToTextNode(),a=e.startNode,c=e.startOffset,h=a.get(),f=a.text())}else if(t.data&&c===t.data.length&&t.inputType.indexOf("insert")===0){let p=u,g=[];for(;p&&r.isMark(p);){const v=s.findPlugin(p);v&&!v.followStyle&&g.push(p),p=p.parent();const b=p==null?void 0:p.parent();if((p==null?void 0:p.prev())&&b&&r.isMark(b))break}const m=a.prev();g.forEach((v,b)=>{if(u.equal(v)&&m){g.splice(b,1);return}let _=v.prev(),x=v;for(;!_&&x;){const E=x.parent();if(E&&r.isBlock(E))break;_=(E==null?void 0:E.prev())||null,x=E}let w=_;for(;w&&!w.isText();){if(r.isMark(w)&&s.compare(w,v)){g.splice(b,1);break}w=w.last()}}),g.length>0&&(h.splitText(t.data.length),h.remove(),r.isEmpty(u)&&u.remove(),s.unwrap(g.map(v=>v.clone())),r.insertText(t.data===""?"\xA0":t.data),s.merge(),e=o.range.get().cloneRange().shrinkToTextNode(),a=e.startNode,c=e.startOffset,h=a.get(),f=a.text())}f.length>0&&/^\u200B$/g.test(f.substr(0,1))&&(h.splitText(1),h.remove())}const d=a.prev();if(a.isText()&&d&&r.isMark(d)){const h=a.get(),f=a.text();f.length>0&&/^\u200B$/g.test(f.substr(0,1))&&(h.splitText(1),h.remove())}}handleSelectionChange(){var s,o,a,c;const{change:t,container:e,card:n}=this.engine;if(t.isComposing())return;const{window:i}=e,r=i==null?void 0:i.getSelection();if(!(((s=this.prevSelection)==null?void 0:s.anchorNode)===(r==null?void 0:r.anchorNode)&&((o=this.prevSelection)==null?void 0:o.anchorOffset)===(r==null?void 0:r.anchorOffset)&&((a=this.prevSelection)==null?void 0:a.focusNode)===(r==null?void 0:r.focusNode)&&((c=this.prevSelection)==null?void 0:c.focusOffset)===(r==null?void 0:r.focusOffset))&&(this.prevSelection=r?{anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}:null,r&&r.anchorNode)){const u=Te.from(this.engine,r);if(!u.commonAncestorNode.inEditor(e))return;t.onSelect();let d=u.containsCard()||u.commonAncestorNode.closest(ut).length>0&&u.startNode.closest(`${St},${At},${$i}`).length===0,h=u.collapsed;if(!h){const{startNode:f,endNode:p,startOffset:g,endOffset:m}=u,v=f.isElement()&&!f.isCard()?f.children().eq(g):f,b=p.isElement()&&!p.isCard()?p.children().eq(m-1):p;v&&b&&v.isCard()&&v.equal(b)&&(h=!0)}n.each(f=>{const p=f.getCenter();if(p&&p.length>0){let g=r.containsNode?r.containsNode(p[0]):!1;if(!g&&d&&r.focusNode){const v=this.engine.card.find(r.focusNode);v&&(h=!r.anchorNode||v.root.contains(r.anchorNode),h&&f.root.equal(v.root)&&(g=!0)),g&&h&&(d=!1)}const{autoSelected:m}=f.constructor;f.select(g&&(!h||m!==!1))}})}}init(){const{change:t,card:e,clipboard:n}=this.engine;t.event.onInput(o=>{const a=t.range.get();this.repairInput(o,a),t.range.select(a),t.onSelect(a),t.change()}),t.event.onDocument("selectionchange",()=>{this.handleSelectionChange()}),t.event.onSelect(o=>{const a=t.range.get();a.startNode.closest(fi).length!==0&&(a.collapsed&&a.containsCard()&&t.range.toTrusty(a),t.range.select(a),!xs("shift+left",o)&&!xs("shift+right",o)&&!xs("shift+up",o)&&!xs("shift+down",o)&&e.activate(a.commonAncestorNode),t.onSelect(a))}),t.event.onDocument("mousedown",o=>{if(!o.target)return;const a=I(o.target);if(a.closest("body").length===0||a.closest(".am-view").length>0)return;let c=a;for(;c;){const u=c.attributes(le);if(u&&[qn,pi].indexOf(u)<0)return;c=c.parent()}e.activate(a,ui.MOUSE_DOWN,o)}),t.event.onDocument("copy",o=>{const a=t.range.get();!this.engine.container.contains(a.commonAncestorNode)||n.write(o)}),t.event.onDocument("cut",o=>{const a=t.range.get();if(!this.engine.container.contains(a.commonAncestorNode)||this.engine.readonly)return;n.write(o,void 0)&&(o.stopPropagation(),n.cut(),t.change())});const i=o=>{t.cacheRangeBeforeCommand();const a=po(this.engine,"zero");a.enable(["paragraph","html_inline","newline"]);const c=a.parse(o,{});if(c.length!==0)return xl(this.engine,a,c)},r=async o=>{var u;const a=i(o);if(a===null)return;const c=()=>{this.engine.history.saveOp(),t.cacheRangeBeforeCommand(),this.paste(a,this.lastePasteRange,void 0,!1)};if(((u=this.engine.options.markdown)==null?void 0:u.mode)!=="confirm"){c();return}this.engine.messageConfirm("markdown",this.engine.language.get("checkMarkdown","title")).then(()=>{c()}).catch(d=>{d&&this.engine.messageError("markdown",d)})};t.event.onPaste(o=>{const{html:a,text:c,files:u,isPasteText:d}=o;let h="";if(u.length===0)if(d){let f="";c?f=c:a&&(f=new $t(a,this.engine).toText()),h=new Eu(f).toHTML()}else a&&a.indexOf('<meta name="source" content="aomao" />')>-1||a?h=a:c&&(h=new Eu(c).toHTML());if(this.engine.trigger("paste:event",o,h)!==!1&&u.length===0){t.cacheRangeBeforeCommand(),this.paste(h);const f=this.engine.options.markdown||{};if(f.mode!==!1)if(!f.check&&c&&!/^https?:\/\/\S+$/i.test(c.trim())){if(!c)return;if(!a){setTimeout(()=>{r(c)},0);return}const p=c.split(/\r\n|\n/)||"";let g=0,m=0,v=!1;const _=new DOMParser().parseFromString(a,"text/html").querySelectorAll("li"),x=[];_.forEach(w=>{var S,R;const E=(S=w.textContent)!=null?S:"";(((R=w.parentElement)==null?void 0:R.nodeName)==="OL"||/\d\.\s+/.test(E))&&x.push(E)});for(let w=0;w<p.length;w++){const E=p[w];if(!!E.trim()){if(E.startsWith("```")){v?v=!1:(v=!0,m++,g++);continue}v||(g++,/^(#|\*|-|\+|\[ \]|\[x\]|>){1,}\s+/.test(E)?m++:/^\d\.\s+/.test(E)?!x.includes(E)&&!x.includes(E.replace(/^\d\./,"").trim())&&m++:(/^(---|\*\*\*|\+\+\+)/.test(E)||/(\*|~|\^|_|\`|\]\(https?:\/\/)/.test(E))&&m++)}}m>0&&(g===0||m/g>.5)&&setTimeout(()=>{r(c)},0)}else f.check&&f.check(c!=null?c:"",a!=null?a:"").then(p=>{p&&r(p)})}});const s=o=>!o||e.closest(o.commonAncestorContainer);t.event.onDrop(({event:o,range:a,card:c,files:u})=>{if(c){if(o.preventDefault(),s(a))return;const h=c.constructor.cardName,f=c.getValue();this.engine.card.remove(c.root),t.range.select(a),this.engine.card.insert(h,f)}if(u.length>0){if(o.preventDefault(),s(a))return;t.range.select(a),this.engine.trigger("drop:files",u)}})}paste(t,e,n,i=!0,r,s=!0){const{change:o}=this.engine,a=new aX(t,this.engine).normalize(s);this.engine.trigger("paste:before",a),r?r(a,e,void 0,i):o.insert(a,e,c=>{var g;this.engine.trigger("paste:insert",c);const u=c.cloneRange(),{endNode:d}=u;let h="";d.isCard()&&((g=d.get())==null?void 0:g.childNodes.length)===0&&(u.setEndAfter(d),h=d.attributes(we)),this.lastePasteRange=u,c.collapse(!1);const f=c.startNode.closest(`${ut},${tr}`);if(f.length>0){const m=f.attributes();(m[Ct]||m[We])&&c.setStartAfter(f)}const p=c.createSelection();this.engine.card.render(void 0,m=>{if(p.move(),h){const v=this.engine.container.find(`[data-id="${h}"]`);v.length>0&&(u.setEndAfter(v),this.lastePasteRange=u)}c.scrollRangeIntoView(),o.range.select(c),n&&n(m),this.engine.trigger("paste:after")})},i)}}class cX{constructor(t,e={}){y(this,"engine");y(this,"lastBlurRange");y(this,"otpions");this.engine=t,this.otpions=e}setLastBlurRange(t){t!=null&&t.commonAncestorNode.inEditor()?this.lastBlurRange=t:this.lastBlurRange=void 0}toTrusty(t=this.get()){const{commonAncestorNode:e}=t;!e.isEditable()&&!e.inEditor()&&t.select(this.engine.container,!0).shrinkToElementNode().collapse(!1);let n=t.cloneRange();if(n.collapse(!0),this.setCardRang(n),(!t.startNode.equal(n.startNode)||t.startOffset!==n.startOffset)&&t.setStart(n.startContainer,n.startOffset),n=t.cloneRange(),n.collapse(!1),this.setCardRang(n),(!t.endNode.equal(n.endNode)||t.endOffset!==n.endOffset)&&t.setEnd(n.endContainer,n.endOffset),t.collapsed){n=t.cloneRange(),n.enlargeFromTextNode();const i=I(n.startContainer),r=n.startOffset;this.engine.node.isInline(i)&&r===0&&t.setStartBefore(i[0]),this.engine.node.isInline(i)&&r===i[0].childNodes.length&&t.setStartAfter(i[0]),t.collapse(!0)}return t}setCardRang(t){const{startNode:e,startOffset:n}=t,{card:i}=this.engine,r=i.find(e);if(r){const s=r.getCenter().get();if(s&&(!e.isElement()||e[0].parentNode!==r.root[0]||e.attributes(He))){const o=()=>{const a=Te.create(this.engine);return a.select(s,!0),a.comparePoint(e,n)<0};if(r.type==="inline"){t.select(r.root),t.collapse(o());return}o()?i.focusPrevBlock(r,t,!0):i.focusNextBlock(r,t,!0)}}}get(){const{container:t}=this.engine,{window:e}=t;let n=Te.from(this.engine,e,!1);return n||(n=Te.create(this.engine,e.document).select(t,!0).shrinkToElementNode().collapse(!1)),n}select(t,e=!0){var x,w,E,S,R,D,P,O,L,B,A,F,W,G,k,C;const{container:n,inline:i,node:r,change:s}=this.engine,{window:o}=n,a=o==null?void 0:o.getSelection();if(s.isComposing())return;if(t.collapsed){const{startNode:$,startOffset:z}=t;if(($.isElement()&&z===1&&((x=$.get())==null?void 0:x.childNodes.length)===1||z===2&&((w=$.get())==null?void 0:w.childNodes.length)===2&&((E=$.first())==null?void 0:E.isCard()))&&((S=$.last())==null?void 0:S.name)==="br"&&(t.setStart($,z-1),t.collapse(!0)),$.isText()){const M=$.parent();(M==null?void 0:M.attributes(He))==="right"&&z===0?(t.setStart($,1),t.collapse(!0)):(M==null?void 0:M.attributes(He))==="left"&&z===1&&(t.setStart($,0),t.collapse(!0))}}let{startNode:c,endNode:u,startOffset:d,endOffset:h}=t.cloneRange().shrinkToTextNode();const f=c.prev(),p=u.next();if(f&&!f.isCard()&&!r.isVoid(f)&&r.isInline(f)){const $=c.text();/^\u200B/g.test($)&&d===0&&(t.setStart(u,d+1),t.collapsed&&t.collapse(!0))}if(p&&!p.isCard()&&!r.isVoid(p)&&r.isInline(p)){const $=u.text();/\u200B$/g.test($)&&h===$.length&&(t.setEnd(u,h-1),t.collapsed&&t.collapse(!1))}const g=i.closest(c);if(!g.isCard()&&r.isInline(g)&&!r.isVoid(g)){if(c.isText()&&!c.prev()&&((R=c.parent())==null?void 0:R.equal(g))&&d===0){const $=c.text();/^\u200B/g.test($)&&(t.setStart(c,d+1),t.collapsed&&t.collapse(!0))}if(u.isText()&&!u.next()&&((D=u.parent())==null?void 0:D.equal(g))){const $=u.text();h===$.length&&/\u200B$/g.test($)&&(t.setEnd(u,h-1),t.collapsed&&t.collapse(!1))}}if(c=t.startNode,u=t.endNode,c.isText()||u.isText()){const $=t.cloneRange().enlargeFromTextNode();c=$.startNode,u=$.endNode}const m=c.children();r.isCustomize(c)&&d===0&&t.setStart(c,1),r.isCustomize(u)&&h===0&&t.setEnd(u,1);const v=this.engine.ot.isStopped();if(c.name==="p"&&!v){if(m.length===0)c.append("<br />");else if(!Oa&&m.length>1&&m[m.length-2].nodeName!=="BR"&&m[m.length-1].nodeName==="BR"){const $=c.last();$==null||$.remove()}}!t.collapsed&&!v&&u.name==="p"&&((P=u.get())==null?void 0:P.childNodes.length)===0&&u.append("<br />");const b=c.children();if(r.isList(c)&&!v&&(b.length===0||b[0].nodeName==="BR")){const $=I("<p><br /></p>");this.engine.nodeId.create($),c.before($),c.remove(),c=$}if(c.name==="li"&&!v){if(r.isCustomize(c)&&!((O=c.first())!=null&&O.isCard())){const $=(L=c.parent())==null?void 0:L.children().toArray().find(M=>{var T;return(T=M.first())==null?void 0:T.isCard()}),z=(B=$==null?void 0:$.first())==null?void 0:B.attributes(ke);z?this.engine.list.addCardToCustomize(c,z):this.engine.list.unwrapCustomize(c)}m.length===0?c.append("<br />"):!r.isCustomize(c)&&m.length>1&&m[m.length-2].nodeName!=="BR"&&m[m.length-1].nodeName==="BR"?(A=c.last())==null||A.remove():r.isCustomize(c)&&m.length===1?c.append("<br />"):r.isCustomize(c)&&m.length>2&&m[m.length-2].nodeName!=="BR"&&m[m.length-1].nodeName==="BR"&&((F=c.last())==null||F.remove())}if(!t.collapsed&&u.name==="li"&&!v){const $=u.children();$.length===0?u.append("<br />"):!r.isCustomize(u)&&$.length>1&&$[$.length-2].nodeName!=="BR"&&$[$.length-1].nodeName==="BR"?(W=c.last())==null||W.remove():r.isCustomize(u)&&$.length===1?u.append("<br />"):r.isCustomize(u)&&$.length>2&&$[$.length-2].nodeName!=="BR"&&$[$.length-1].nodeName==="BR"&&((G=c.last())==null||G.remove())}c.isEditable()&&!v&&((k=c.get())==null?void 0:k.childNodes.length)===0&&!this.engine.ot.isStopped&&c.html("<p><br /></p>"),a&&(t.collapsed||a.rangeCount>0&&!t.equal(a.getRangeAt(0)))&&((C=t.startNode.get())==null?void 0:C.isConnected)&&(a.removeAllRanges(),a.addRange(t.toRange()));const{onSelect:_}=this.otpions;_&&e&&_(t)}focus(t){var i,r;const e=this.lastBlurRange||this.get();t!==void 0&&e.select(this.engine.container,!0).shrinkToElementNode().collapse(t),this.select(e);const n=e.commonAncestorNode.closest(ze);if((i=n==null?void 0:n.get())==null||i.focus(),n.length>0&&!this.engine.container.equal(n)){const s=new MouseEvent("mousedown");(r=this.engine.container.get())==null||r.dispatchEvent(s),setTimeout(()=>{var a;const o=new MouseEvent("mouseup");(a=this.engine.container.get())==null||a.dispatchEvent(o)},0)}}blur(){var e,n;(e=this.get().commonAncestorNode.closest(ze).get())==null||e.blur(),(n=this.engine.container.get())==null||n.blur(),this.engine.trigger("blur")}}class uX{constructor(t,e={}){y(this,"engine");y(this,"options");y(this,"changeTimer",null);y(this,"event");y(this,"valueCached",null);y(this,"onChange");y(this,"onRealtimeChange");y(this,"onSelect");y(this,"onSetValue");y(this,"rangePathBeforeCommand");y(this,"marks",[]);y(this,"blocks",[]);y(this,"inlines",[]);y(this,"changeTrigger",[]);y(this,"range");y(this,"nativeEvent");this.options=e,this.engine=t,this.event=new IK(t,{}),this.onChange=this.options.onChange||function(){},this.onRealtimeChange=this.options.onRealtimeChange||function(){};let n=null;this.onSelect=i=>{const{mark:r,block:s,inline:o}=t;i=i||this.range.get(),this.marks=r.findMarks(i),this.blocks=s.findBlocks(i),this.inlines=o.findInlines(i),!((n==null?void 0:n.startContainer)===i.startContainer&&(n==null?void 0:n.startOffset)===i.startOffset&&(n==null?void 0:n.endContainer)===i.endContainer&&(n==null?void 0:n.endOffset)===i.endOffset)&&(n={startContainer:i.startContainer,startOffset:i.startOffset,endContainer:i.endContainer,endOffset:i.endOffset},this.options.onSelect&&this.options.onSelect())},this.onSetValue=this.options.onSetValue||function(){},this.range=new cX(t,{onSelect:i=>{this.onSelect(i)}}),this.nativeEvent=new lX(t)}init(){this.nativeEvent.init()}_change(){if(!this.isComposing()){this.engine.card.gc();const t=this.changeTrigger.length===2?"both":this.changeTrigger[0]==="remote"?"remote":"local";this.onChange(t),this.changeTrigger=[]}}change(t,e){var r;const n=t?"remote":"local";let i;if(t)e==null||e.forEach(s=>{if(i=s.closest(ze),i&&i.length>0){const o=this.engine.card.find(i,!0);o!=null&&o.onChange&&(o==null||o.onChange(n,i))}});else{const s=this.range.get(),{startNode:o}=s;if(o.inEditor())i=o.closest(ze);else{const c=o.closest($i).attributes(fo);c&&(i=(r=this.engine.card.find(c))==null?void 0:r.root.closest(ze))}if(i&&i.length>0){const a=this.engine.card.find(i,!0);a!=null&&a.onChange&&(a==null||a.onChange(n,i))}else e==null||e.forEach(a=>{if(i=a.closest(ze),i&&i.length>0){const c=this.engine.card.find(i,!0);c!=null&&c.onChange&&(c==null||c.onChange(n,i))}})}this.onRealtimeChange(n),this.changeTrigger.indexOf(n)<0&&this.changeTrigger.push(n),this.clearChangeTimer(),this.changeTimer=setTimeout(()=>{this._change()},50)}clearChangeTimer(){this.changeTimer&&clearTimeout(this.changeTimer)}isComposing(){return this.event.isComposing}isSelecting(){return this.event.isSelecting}initValue(t,e=!0,n=this.engine.container){var c,u;const i=n.html(),r="<p><br /></p>";if(i===r||(((c=n.get())==null?void 0:c.childNodes.length)||0)>0)return;const o=I(i||r);((u=o.get())==null?void 0:u.childNodes.length)===0&&o.html("<br />"),n.empty().append(o);const a=t||this.range.get();!t&&e&&(a.select(o,!0).collapse(!1),this.apply(a))}setValue(t,e,n){const i=this.range.get(),{schema:r,conversion:s,container:o,history:a,mark:c,card:u}=this.engine;if(t==="")this.engine.container.html(t),this.initValue(void 0,!1),n&&n(0);else{const d=new $t(t,this.engine,m=>{c.removeEmptyMarks(m),m.allChildren("editable").forEach(v=>{e&&e(v)})},!1);o.html(d.toValue(r,s,!1,!0)),u.render(void 0,m=>{n&&n(m)});const h=o.find(uo),f=new go(this.engine,i);h.length>0&&(f.anchor=h,f.focus=h);const p=o.find(yl),g=o.find(_l);p.length>0&&g.length>0&&(f.anchor=p,f.focus=g),f.anchor&&f.focus&&(f.move(),this.range.select(i),this.onSelect()),this.onSetValue(),a.clear()}this.change()}setHtml(t,e){const{card:n,container:i}=this.engine;this.nativeEvent.paste(t,void 0,e,!0,(r,s,o,a)=>{i.empty().append(r),n.render(void 0,c=>{this.initValue(void 0,!1),this.engine.trigger("paste:after"),e&&e(c)}),this.change()},!1)}setMarkdown(t,e){const n=po(this.engine,"zero");n.enable(["paragraph","html_inline","newline"]);const i=n.parse(t,{});if(i.length===0)return;let r=xl(this.engine,n,i);r||(r=t);const{card:s,container:o}=this.engine;this.nativeEvent.paste(r,void 0,e,!0,(a,c,u,d)=>{o.empty().append(a),s.render(void 0,h=>{this.initValue(void 0,!1),this.engine.trigger("paste:after"),e&&e(h)}),this.change()})}getOriginValue(t=this.engine.container){const{schema:e,conversion:n}=this.engine;return new $t(t.clone(!0),this.engine,void 0,!1).toValue(e,n)}getValue(t={}){let e;if(t.ignoreCursor||this.isComposing())e=this.getOriginValue();else{let n=this.range.get(),i;if(!n.inCard()){const r=n.toPath(!0);if(!r)return this.getOriginValue();n=Te.fromPath(this.engine,r,!0),i=n.createSelection()}e=this.getOriginValue(),i==null||i.move()}return e}cacheRangeBeforeCommand(){this.rangePathBeforeCommand=this.range.get().toPath()}getRangePathBeforeCommand(){const t=this.rangePathBeforeCommand;return this.rangePathBeforeCommand=void 0,t}isEmpty(){const{container:t,node:e,schema:n}=this.engine,i=n.getAllowInTags(),r=t.children();return r.length===0||r.length===1&&e.isEmpty(t)&&!t.allChildren().some(s=>i.includes(s.name))}combinText(){hZ(this.engine.container)}apply(t){this.combinText();const{inline:e,mark:n,nodeId:i}=this.engine;if(t){const r=t.createSelection("change-apply");e.findInlines(t).forEach(s=>e.repairCursor(s)),n.findMarks(t).forEach(s=>n.repairCursor(s)),r.move(),t.shrinkToTextNode(),this.range.select(t)}this.change(),i.generateAll(this.engine.container)}insert(t,e,n=()=>{},i=!0){var W,G;const{block:r,list:s,schema:o,mark:a,inline:c}=this.engine,u=this.engine.node;e=e||this.range.toTrusty();const d=r.closest(e.startNode),f=r.closest(e.endNode)[0]===d[0],p=r.isLastOffset(e,"end"),g=o.getCanMergeTags(),m=o.getAllowInTags(),v=d.closest(g.join(",")),b=e.collapsed,_=t.childNodes,x=I(t.firstChild||[]),w=()=>{var M;const C=I(t).first(),$=e.cloneRange().shrinkToElementNode().shrinkToTextNode(),{startNode:z}=$;if(z.inEditor()&&C&&C.name==="p"&&!(C.length===1&&((M=C.first())==null?void 0:M.name)==="br")){if(z.name==="p"&&u.isEmptyWidthChild(z)){const T=C.css();z.css(T)}u.unwrap(C)}};if(!b)this.delete(e,f||!p,i),u.isEmptyWidthChild(e.startNode)&&e.shrinkToElementNode().shrinkToTextNode(),w();else if(w(),e.startNode.isText()){const k=c.closest(e.startNode),C=e.startNode.text();k.length===0&&!k.equal(e.startNode)&&/^\u200B/.test(C)&&e.startNode.text(C.substr(1))}let E;const S=k=>{E&&E.node[0].isConnected&&(k.shrinkToElementNode().setStart(E.node,E.offset),k.enlargeToElementNode()),r.merge(k),s.merge(void 0,k),a.merge(k),c.flat(k),n&&n(k),this.apply(k)};if(u.isList(e.startNode)||e.startNode.closest("li").length>0){const k=e.startNode.children();E={node:e.startNode,offset:k.length===1&&k[0].nodeName==="BR"?0:e.startOffset},s.insert(t,e),S(e);return}if(!x[0]){S(e);return}if(!u.isBlock(x)){if(e.shrinkToElementNode(),_.length>0){const z=e.startNode.children();E={node:e.startNode,offset:z.length===1&&z[0].nodeName==="BR"?0:e.startOffset}}let k=x.next(),C=x;const $=u.insert(x,e);for($&&(e=$);k&&!u.isBlock(k);){e.startContainer.nodeType===Node.TEXT_NODE&&e.enlargeToElementNode().collapse(!1);const z=k.next();C.after(k),C=k,k=z}if(C!==x&&e.select(C,!0).collapse(!1),_.length===0){S(e);return}}const R=e.cloneRange().enlargeToElementNode(!0).collapse(!1),D=R.startContainer.childNodes[e.startOffset===0?0:e.startOffset-1],P=R.startContainer.childNodes[e.startOffset];if(_.length!==0){let k=I(_[_.length-1]);if(k.name==="br"&&(k.remove(),k=I(_[_.length-1])),!E){const M=e.startNode.children();E={node:e.startNode,offset:M.length===1&&M[0].nodeName==="BR"?0:e.startOffset}}let C=I(_[0]),$=null;const z=[];for(;C&&C.length>0;){u.removeSide(C);const M=C.next();if(M||(k=C),$?$.after(C):(u.isInline(e.startNode)&&(e.setStartAfter(e.startNode),e.collapse(!0)),u.insert(C,e,!0),u.isInline(C)&&(e.setEndAfter(C),e.collapse(!1))),(W=C.get())!=null&&W.isConnected&&z.push(C),!u.isBlock(C)&&!(M!=null&&M.isText())?($&&e.select(C,!0).collapse(!1),$=null):$=C,!M&&((G=C.get())==null?void 0:G.isConnected)&&!u.isInline(C)&&e.select(C,!0).collapse(!1),E&&!E.node[0].isConnected){const T=C.parent();T&&(E={node:T,offset:C.index()})}C=M}v[0]&&z.forEach(M=>{g.indexOf(M.name)<0&&M.closest(v.name).length===0&&u.wrap(M,u.clone(v,!1,!1))})}const O=k=>{let C=k.first();if(!C||!u.isBlock(C))return k;for(;m.indexOf(C?C.name:"")>-1;)C=C.first();return C},L=k=>{let C=k.last();if(!C||!u.isBlock(C))return k;for(;m.indexOf(C?C.name:"")>-1;)C=C.last();return C},B=(k,C)=>{if(k.isCard()||x.isCard())return;const $=C.parent(),z=k.parent(),M=$&&!$.isEditable()&&z&&!z.isEditable()&&$.name===z.name;return C.name==="p"&&M||k.name===C.name&&M&&!(k.name==="li"&&!s.isSame(k.parent(),C.parent()))},A=k=>{for(;!k.isEditable();){const C=k.parent();if(k.remove(),!C||!u.isEmpty(C))break;k=C}},F=(k,C)=>{if(k.name===C.name&&k.name==="p"){const $=C.attributes();$[we]&&delete $[we],k.attributes($)}u.isEmptyWidthChild(k)&&!u.isEmptyWidthChild(C)&&(k.get().innerHTML=""),u.isCustomize(k)===u.isCustomize(C)&&s.unwrapCustomize(C)};if(D){const k=O(I(D.nextSibling||[])),C=L(I(D));C.name==="p"&&k.name!==C.name&&B(C,k)&&(F(C,k),u.merge(C,k,!1),A(k))}if(P){const k=L(I(P.previousSibling||[])),C=O(I(P));k&&B(k,C)&&(u.merge(k,C,!1),A(C))}S(e)}paste(t,e,n){this.nativeEvent.paste(t,e,n,!0)}delete(t,e,n=!0){var R,D,P,O,L,B,A,F,W,G,k,C,$;const i=t||this.range.toTrusty();if(i.collapsed){this.isEmpty()&&this.initValue(i),t||this.apply(i);return}const{mark:r,inline:s,card:o}=this.engine,a=this.engine.node,c=this.engine.block;let u=i.cloneRange();u.collapse(!0);const d=n?r.findMarks(u):[];i.enlargeToElementNode();let h=c.closest(i.cloneRange().shrinkToElementNode().shrinkToTextNode().enlargeToElementNode().startNode);if(!h.inEditor()&&!h.isRoot()){this.isEmpty()&&this.initValue(i),t||this.apply(i);return}if(h.isRoot()){let z=h.children().eq(i.startOffset);for(;z!=null&&z.isCard();){const M=z.equal(i.endNode)||z.contains(i.endNode),T=z.next()||void 0,K=o.find(z);if(K?o.removeNode(K):z.remove(),M){z=void 0;break}z=T}if(!z){this.isEmpty()&&this.initValue(i),t||this.apply(i);return}h=z}const{endNode:f,endOffset:p}=i,g=!c.closest(i.startNode).equal(c.closest(f)),m=s.closest(f);if(m.length>0&&((R=f.parent())==null?void 0:R.equal(m))&&f.isText()){const z=f.text();p===z.length-1&&i.setEndAfter(m)}const v=i.cloneRange().shrinkToElementNode().shrinkToTextNode().getEndOffsetNode();i.extractContents();let{startNode:b}=i;if(b.isEditable()&&((D=b.get())==null?void 0:D.childNodes.length)===0&&(b.html("<p><br /></p>"),this.engine.nodeId.generate(b)),b=i.shrinkToElementNode().shrinkToTextNode().enlargeToElementNode().startNode,b.isCard()&&b.find(Ws).length===0&&o.remove(b),i.collapse(!0),b=i.shrinkToElementNode().shrinkToTextNode().enlargeToElementNode().startNode,h.isElement()&&!h.equal(b)&&h.get().childNodes.length===0&&h.remove(),b.isText()||!h.inEditor()){this.isEmpty()&&this.initValue(i),t||this.apply(i);return}let _=!1;if(g&&((P=b.get())==null?void 0:P.childNodes.length)===0){const z=i.createSelection();b.remove(),((L=(O=z.anchor)==null?void 0:O.get())==null?void 0:L.isConnected)&&((A=(B=z.focus)==null?void 0:B.get())==null?void 0:A.isConnected)&&z.move(),_=!0,b=i.startNode}const x=h,w=v&&v.isConnected?b:null;let E=((F=b.get())==null?void 0:F.childNodes.length)===0;if(!E&&b.length>0&&b.inEditor()&&b[0].childNodes.length===1&&((W=b[0].firstChild)==null?void 0:W.nodeType)===Node.ELEMENT_NODE&&a.isCustomize(b)&&((G=b.first())==null?void 0:G.isCard())&&(E=!0),E&&a.isBlock(b)&&b.inEditor()){if(a.isList(b))b.remove();else{let z=a.getBatchAppendHTML(d,"<br />");b.isEditable()&&(z=`<p>${z}</p>`),b.append(I(z));const M=b.find("br"),T=M.parent();T&&a.isMark(T)&&a.replace(M,I("\u200B",null)),i.select(b,!0)}i.shrinkToElementNode().shrinkToTextNode(),i.collapse(!1),this.isEmpty()&&this.initValue(i),t||this.apply(i);return}const S=(z,M,T,K,ee=!1)=>{if(a.isBlock(M)&&!a.isVoid(M)&&!M.isCard()){z.select(M,!0),z.collapse(!1);const Y=z.shrinkToElementNode().shrinkToTextNode().createSelection();let q=T.parent();for(a.merge(M,T);q&&a.isBlock(q)&&a.isEmpty(q);)q.remove(),q=q.parent();Y.move(),z.enlargeToElementNode(!0);const Z=z.getPrevNode(),te=z.getNextNode(),{startNode:se}=z;!Z&&!te&&a.isBlock(se)&&(se.append(I(a.getBatchAppendHTML(K,"<br />"))),z.select(se.find("br"),!0),z.collapse(!1)),Z&&te&&!Z.isCard()&&!te.isCard()&&ee&&S(z,Z,te,K)}};if(x&&w&&w.length>0&&a.isBlock(x)&&a.isBlock(w)&&!x.equal(w)&&!((k=x.parent())!=null&&k.equal(w))&&w.inEditor()&&S(i,x,w,d,e),b.children().each(z=>{const M=I(z);!a.isVoid(M)&&M.isElement()&&a.html(M)===""&&M.remove(),a.isInline(M)&&s.repairCursor(M)}),a.isList(b)&&a.isEmpty(b)&&b.remove(),u=i.cloneRange().shrinkToTextNode(),u.startNode.isText()&&/^\u200B/g.test(u.startNode.text())&&u.startOffset===0){const z=u.startNode.prev();z&&this.engine.node.isInline(z)&&(i.select(z,!0),i.collapse(!1))}a.isBlock(b)&&((C=b.get())==null?void 0:C.childNodes.length)===0&&b.html("<br />"),_&&(a.isBlock(x)&&(($=x.get())==null?void 0:$.childNodes.length)===0&&x.html("<br />"),x.inEditor()&&i.select(x,!0).collapse(!1)),this.isEmpty()&&this.initValue(i),t||this.apply(i)}unwrap(t){const{block:e}=this.engine,n=this.range.get();if(t=t||e.closest(n.startNode),!t.inEditor())return;const i=n.createSelection();this.engine.node.unwrap(t),i.move(),this.range.select(n)}mergeAfterDelete(t){var d,h,f;const{block:e,card:n,list:i,mark:r}=this.engine,s=this.engine.node,o=this.range.get();t=t||e.closest(o.startNode);const a=t.children();if(a.length===0){t.append(I("<br />")),this.apply(o);return}const c=t.first();if(a.length>1&&(c==null?void 0:c.name)==="br"){c==null||c.remove();return}let u=t.prev();if(!u){const p=t.parent();(p==null?void 0:p.inEditor())&&!(p!=null&&p.isEditable())&&this.unwrap(t);return}if(u.isCard()){(a.length===1&&(c==null?void 0:c.name)==="br"||s.isEmpty(t))&&t.remove();const p=n.find(u);if(p){n.focus(p);return}}if(s.isVoid(u)){u.remove();return}if(s.isRootBlock(u)&&s.isEmpty(u)){u.remove();return}if(u.isText()){const p=I("<p />");u.before(p),p.append(u),u=p}if(s.isList(u)&&(u=u.last()),a.length===1&&(c==null?void 0:c.name)==="br"?c==null||c.remove():u&&((d=u.get())==null?void 0:d.childNodes.length)===1&&((h=u.first())==null?void 0:h.name)==="br"&&((f=u.first())==null||f.remove()),!u||u.isText())this.unwrap(t);else{const p=o.createSelection();s.merge(u,t),p.move(),this.range.select(o),r.merge(),i.merge()}}destroy(){this.event.destroy(),this.clearChangeTimer()}}var dX=Mg,fX=function(){return dX.Date.now()},hX=fX,pX=/\s/;function gX(l){for(var t=l.length;t--&&pX.test(l.charAt(t)););return t}var mX=gX,vX=mX,bX=/^\s+/;function yX(l){return l&&l.slice(0,vX(l)+1).replace(bX,"")}var _X=yX,wX=Vf,xX=Qs,kX="[object Symbol]";function EX(l){return typeof l=="symbol"||xX(l)&&wX(l)==kX}var vo=EX,CX=_X,Cu=Bi,SX=vo,Su=0/0,AX=/^[-+]0x[0-9a-f]+$/i,TX=/^0b[01]+$/i,NX=/^0o[0-7]+$/i,DX=parseInt;function RX(l){if(typeof l=="number")return l;if(SX(l))return Su;if(Cu(l)){var t=typeof l.valueOf=="function"?l.valueOf():l;l=Cu(t)?t+"":t}if(typeof l!="string")return l===0?l:+l;l=CX(l);var e=TX.test(l);return e||NX.test(l)?DX(l.slice(2),e?2:8):AX.test(l)?Su:+l}var Oh=RX,MX=Bi,_a=hX,Au=Oh,LX="Expected a function",IX=Math.max,OX=Math.min;function FX(l,t,e){var n,i,r,s,o,a,c=0,u=!1,d=!1,h=!0;if(typeof l!="function")throw new TypeError(LX);t=Au(t)||0,MX(e)&&(u=!!e.leading,d="maxWait"in e,r=d?IX(Au(e.maxWait)||0,t):r,h="trailing"in e?!!e.trailing:h);function f(E){var S=n,R=i;return n=i=void 0,c=E,s=l.apply(R,S),s}function p(E){return c=E,o=setTimeout(v,t),u?f(E):s}function g(E){var S=E-a,R=E-c,D=t-S;return d?OX(D,r-R):D}function m(E){var S=E-a,R=E-c;return a===void 0||S>=t||S<0||d&&R>=r}function v(){var E=_a();if(m(E))return b(E);o=setTimeout(v,g(E))}function b(E){return o=void 0,h&&n?f(E):(n=i=void 0,s)}function _(){o!==void 0&&clearTimeout(o),c=0,n=a=i=o=void 0}function x(){return o===void 0?s:b(_a())}function w(){var E=_a(),S=m(E);if(n=arguments,i=this,a=E,S){if(o===void 0)return p(a);if(d)return clearTimeout(o),o=setTimeout(v,t),f(a)}return o===void 0&&(o=setTimeout(v,t)),s}return w.cancel=_,w.flush=x,w}var bo=FX,Fh={exports:{}};(function(l){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function i(a,c,u){this.fn=a,this.context=c,this.once=u||!1}function r(a,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,d||a,h),p=e?e+c:c;return a._events[p]?a._events[p].fn?a._events[p]=[a._events[p],f]:a._events[p].push(f):(a._events[p]=f,a._eventsCount++),a}function s(a,c){--a._eventsCount===0?a._events=new n:delete a._events[c]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)t.call(u,d)&&c.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=e?e+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},o.prototype.listenerCount=function(c){var u=e?e+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,h,f,p){var g=e?e+c:c;if(!this._events[g])return!1;var m=this._events[g],v=arguments.length,b,_;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,d),!0;case 4:return m.fn.call(m.context,u,d,h),!0;case 5:return m.fn.call(m.context,u,d,h,f),!0;case 6:return m.fn.call(m.context,u,d,h,f,p),!0}for(_=1,b=new Array(v-1);_<v;_++)b[_-1]=arguments[_];m.fn.apply(m.context,b)}else{var x=m.length,w;for(_=0;_<x;_++)switch(m[_].once&&this.removeListener(c,m[_].fn,void 0,!0),v){case 1:m[_].fn.call(m[_].context);break;case 2:m[_].fn.call(m[_].context,u);break;case 3:m[_].fn.call(m[_].context,u,d);break;case 4:m[_].fn.call(m[_].context,u,d,h);break;default:if(!b)for(w=1,b=new Array(v-1);w<v;w++)b[w-1]=arguments[w];m[_].fn.apply(m[_].context,b)}}return!0},o.prototype.on=function(c,u,d){return r(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return r(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,h){var f=e?e+c:c;if(!this._events[f])return this;if(!u)return s(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&s(this,f);else{for(var g=0,m=[],v=p.length;g<v;g++)(p[g].fn!==u||h&&!p[g].once||d&&p[g].context!==d)&&m.push(p[g]);m.length?this._events[f]=m.length===1?m[0]:m:s(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=e?e+c:c,this._events[u]&&s(this,u)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,l.exports=o})(Fh);const zi=Fh.exports;function qa(l){return qa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qa(l)}var Nr,BX={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-",O:"-o-"};function Vs(){if(Nr!==void 0)return Nr;Nr="";var l=document.createElement("p").style,t="Transform";for(var e in BX)e+t in l&&(Nr=e);return Nr}function Bh(){return Vs()?"".concat(Vs(),"TransitionProperty"):"transitionProperty"}function yo(){return Vs()?"".concat(Vs(),"Transform"):"transform"}function Tu(l,t){var e=Bh();e&&(l.style[e]=t,e!=="transitionProperty"&&(l.style.transitionProperty=t))}function wa(l,t){var e=yo();e&&(l.style[e]=t,e!=="transform"&&(l.style.transform=t))}function $X(l){return l.style.transitionProperty||l.style[Bh()]}function PX(l){var t=window.getComputedStyle(l,null),e=t.getPropertyValue("transform")||t.getPropertyValue(yo());if(e&&e!=="none"){var n=e.replace(/[^0-9\-.,]/g,"").split(",");return{x:parseFloat(n[12]||n[4],0),y:parseFloat(n[13]||n[5],0)}}return{x:0,y:0}}var zX=/matrix\((.*)\)/,qX=/matrix3d\((.*)\)/;function HX(l,t){var e=window.getComputedStyle(l,null),n=e.getPropertyValue("transform")||e.getPropertyValue(yo());if(n&&n!=="none"){var i,r=n.match(zX);if(r)r=r[1],i=r.split(",").map(function(o){return parseFloat(o,10)}),i[4]=t.x,i[5]=t.y,wa(l,"matrix(".concat(i.join(","),")"));else{var s=n.match(qX)[1];i=s.split(",").map(function(o){return parseFloat(o,10)}),i[12]=t.x,i[13]=t.y,wa(l,"matrix3d(".concat(i.join(","),")"))}}else wa(l,"translateX(".concat(t.x,"px) translateY(").concat(t.y,"px) translateZ(0)"))}var WX=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,os;function Nu(l){var t=l.style.display;l.style.display="none",l.offsetHeight,l.style.display=t}function rr(l,t,e){var n=e;if(qa(t)==="object"){for(var i in t)t.hasOwnProperty(i)&&rr(l,i,t[i]);return}if(typeof n<"u"){typeof n=="number"&&(n="".concat(n,"px")),l.style[t]=n;return}return os(l,t)}function UX(l){var t,e,n,i=l.ownerDocument,r=i.body,s=i&&i.documentElement;return t=l.getBoundingClientRect(),e=Math.floor(t.left),n=Math.floor(t.top),e-=s.clientLeft||r.clientLeft||0,n-=s.clientTop||r.clientTop||0,{left:e,top:n}}function $h(l,t){var e=l["page".concat(t?"Y":"X","Offset")],n="scroll".concat(t?"Top":"Left");if(typeof e!="number"){var i=l.document;e=i.documentElement[n],typeof e!="number"&&(e=i.body[n])}return e}function Ph(l){return $h(l)}function zh(l){return $h(l,!0)}function Xr(l){var t=UX(l),e=l.ownerDocument,n=e.defaultView||e.parentWindow;return t.left+=Ph(n),t.top+=zh(n),t}function Al(l){return l!=null&&l==l.window}function qh(l){return Al(l)?l.document:l.nodeType===9?l:l.ownerDocument}function jX(l,t,e){var n=e,i="",r=qh(l);return n=n||r.defaultView.getComputedStyle(l,null),n&&(i=n.getPropertyValue(t)||n[t]),i}var VX=new RegExp("^(".concat(WX,")(?!px)[a-z%]+$"),"i"),GX=/^(top|right|bottom|left)$/,xa="currentStyle",ka="runtimeStyle",Ci="left",ZX="px";function KX(l,t){var e=l[xa]&&l[xa][t];if(VX.test(e)&&!GX.test(t)){var n=l.style,i=n[Ci],r=l[ka][Ci];l[ka][Ci]=l[xa][Ci],n[Ci]=t==="fontSize"?"1em":e||0,e=n.pixelLeft+ZX,n[Ci]=i,l[ka][Ci]=r}return e===""?"auto":e}typeof window<"u"&&(os=window.getComputedStyle?jX:KX);function As(l,t){return l==="left"?t.useCssRight?"right":l:t.useCssBottom?"bottom":l}function Du(l){if(l==="left")return"right";if(l==="right")return"left";if(l==="top")return"bottom";if(l==="bottom")return"top"}function Ru(l,t,e){rr(l,"position")==="static"&&(l.style.position="relative");var n=-999,i=-999,r=As("left",e),s=As("top",e),o=Du(r),a=Du(s);r!=="left"&&(n=999),s!=="top"&&(i=999);var c="",u=Xr(l);("left"in t||"top"in t)&&(c=$X(l)||"",Tu(l,"none")),"left"in t&&(l.style[o]="",l.style[r]="".concat(n,"px")),"top"in t&&(l.style[a]="",l.style[s]="".concat(i,"px")),Nu(l);var d=Xr(l),h={};for(var f in t)if(t.hasOwnProperty(f)){var p=As(f,e),g=f==="left"?n:i,m=u[f]-d[f];p===f?h[p]=g+m:h[p]=g-m}rr(l,h),Nu(l),("left"in t||"top"in t)&&Tu(l,c);var v={};for(var b in t)if(t.hasOwnProperty(b)){var _=As(b,e),x=t[b]-u[b];b===_?v[_]=h[_]+x:v[_]=h[_]-x}rr(l,v)}function XX(l,t){var e=Xr(l),n=PX(l),i={x:n.x,y:n.y};"left"in t&&(i.x=n.x+t.left-e.left),"top"in t&&(i.y=n.y+t.top-e.top),HX(l,i)}function YX(l,t,e){if(e.ignoreShake){var n=Xr(l),i=n.left.toFixed(0),r=n.top.toFixed(0),s=t.left.toFixed(0),o=t.top.toFixed(0);if(i===s&&r===o)return}e.useCssRight||e.useCssBottom?Ru(l,t,e):e.useCssTransform&&yo()in document.body.style?XX(l,t):Ru(l,t,e)}function Tl(l,t){for(var e=0;e<l.length;e++)t(l[e])}function Hh(l){return os(l,"boxSizing")==="border-box"}var JX=["margin","border","padding"],Ha=-1,QX=2,Wa=1,eY=0;function tY(l,t,e){var n={},i=l.style,r;for(r in t)t.hasOwnProperty(r)&&(n[r]=i[r],i[r]=t[r]);e.call(l);for(r in t)t.hasOwnProperty(r)&&(i[r]=n[r])}function Or(l,t,e){var n=0,i,r,s;for(r=0;r<t.length;r++)if(i=t[r],i)for(s=0;s<e.length;s++){var o=void 0;i==="border"?o="".concat(i).concat(e[s],"Width"):o=i+e[s],n+=parseFloat(os(l,o))||0}return n}var Cn={getParent:function(t){var e=t;do e.nodeType===11&&e.host?e=e.host:e=e.parentNode;while(e&&e.nodeType!==1&&e.nodeType!==9);return e}};Tl(["Width","Height"],function(l){Cn["doc".concat(l)]=function(t){var e=t.document;return Math.max(e.documentElement["scroll".concat(l)],e.body["scroll".concat(l)],Cn["viewport".concat(l)](e))},Cn["viewport".concat(l)]=function(t){var e="client".concat(l),n=t.document,i=n.body,r=n.documentElement,s=r[e];return n.compatMode==="CSS1Compat"&&s||i&&i[e]||s}});function Mu(l,t,e){var n=e;if(Al(l))return t==="width"?Cn.viewportWidth(l):Cn.viewportHeight(l);if(l.nodeType===9)return t==="width"?Cn.docWidth(l):Cn.docHeight(l);var i=t==="width"?["Left","Right"]:["Top","Bottom"],r=Math.floor(t==="width"?l.getBoundingClientRect().width:l.getBoundingClientRect().height),s=Hh(l),o=0;(r==null||r<=0)&&(r=void 0,o=os(l,t),(o==null||Number(o)<0)&&(o=l.style[t]||0),o=Math.floor(parseFloat(o))||0),n===void 0&&(n=s?Wa:Ha);var a=r!==void 0||s,c=r||o;return n===Ha?a?c-Or(l,["border","padding"],i):o:a?n===Wa?c:c+(n===QX?-Or(l,["border"],i):Or(l,["margin"],i)):o+Or(l,JX.slice(n),i)}var nY={position:"absolute",visibility:"hidden",display:"block"};function Lu(){for(var l=arguments.length,t=new Array(l),e=0;e<l;e++)t[e]=arguments[e];var n,i=t[0];return i.offsetWidth!==0?n=Mu.apply(void 0,t):tY(i,nY,function(){n=Mu.apply(void 0,t)}),n}Tl(["width","height"],function(l){var t=l.charAt(0).toUpperCase()+l.slice(1);Cn["outer".concat(t)]=function(n,i){return n&&Lu(n,l,i?eY:Wa)};var e=l==="width"?["Left","Right"]:["Top","Bottom"];Cn[l]=function(n,i){var r=i;if(r!==void 0){if(n){var s=Hh(n);return s&&(r+=Or(n,["padding","border"],e)),rr(n,l,r)}return}return n&&Lu(n,l,Ha)}});function Wh(l,t){for(var e in t)t.hasOwnProperty(e)&&(l[e]=t[e]);return l}var Ie={getWindow:function(t){if(t&&t.document&&t.setTimeout)return t;var e=t.ownerDocument||t;return e.defaultView||e.parentWindow},getDocument:qh,offset:function(t,e,n){if(typeof e<"u")YX(t,e,n||{});else return Xr(t)},isWindow:Al,each:Tl,css:rr,clone:function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);var i=t.overflow;if(i)for(e in t)t.hasOwnProperty(e)&&(n.overflow[e]=t.overflow[e]);return n},mix:Wh,getWindowScrollLeft:function(t){return Ph(t)},getWindowScrollTop:function(t){return zh(t)},merge:function(){for(var t={},e=0;e<arguments.length;e++)Ie.mix(t,e<0||arguments.length<=e?void 0:arguments[e]);return t},viewportWidth:0,viewportHeight:0};Wh(Ie,Cn);var Ea=Ie.getParent;function Ua(l){if(Ie.isWindow(l)||l.nodeType===9)return null;var t=Ie.getDocument(l),e=t.body,n,i=Ie.css(l,"position"),r=i==="fixed"||i==="absolute";if(!r)return l.nodeName.toLowerCase()==="html"?null:Ea(l);for(n=Ea(l);n&&n!==e&&n.nodeType!==9;n=Ea(n))if(i=Ie.css(n,"position"),i!=="static")return n;return null}var Iu=Ie.getParent;function iY(l){if(Ie.isWindow(l)||l.nodeType===9)return!1;var t=Ie.getDocument(l),e=t.body,n=null;for(n=Iu(l);n&&n!==e&&n!==t;n=Iu(n)){var i=Ie.css(n,"position");if(i==="fixed")return!0}return!1}function Nl(l,t){for(var e={left:0,right:1/0,top:0,bottom:1/0},n=Ua(l),i=Ie.getDocument(l),r=i.defaultView||i.parentWindow,s=i.body,o=i.documentElement;n;){if((navigator.userAgent.indexOf("MSIE")===-1||n.clientWidth!==0)&&n!==s&&n!==o&&Ie.css(n,"overflow")!=="visible"){var a=Ie.offset(n);a.left+=n.clientLeft,a.top+=n.clientTop,e.top=Math.max(e.top,a.top),e.right=Math.min(e.right,a.left+n.clientWidth),e.bottom=Math.min(e.bottom,a.top+n.clientHeight),e.left=Math.max(e.left,a.left)}else if(n===s||n===o)break;n=Ua(n)}var c=null;if(!Ie.isWindow(l)&&l.nodeType!==9){c=l.style.position;var u=Ie.css(l,"position");u==="absolute"&&(l.style.position="fixed")}var d=Ie.getWindowScrollLeft(r),h=Ie.getWindowScrollTop(r),f=Ie.viewportWidth(r),p=Ie.viewportHeight(r),g=o.scrollWidth,m=o.scrollHeight,v=window.getComputedStyle(s);if(v.overflowX==="hidden"&&(g=r.innerWidth),v.overflowY==="hidden"&&(m=r.innerHeight),l.style&&(l.style.position=c),t||iY(l))e.left=Math.max(e.left,d),e.top=Math.max(e.top,h),e.right=Math.min(e.right,d+f),e.bottom=Math.min(e.bottom,h+p);else{var b=Math.max(g,d+f);e.right=Math.min(e.right,b);var _=Math.max(m,h+p);e.bottom=Math.min(e.bottom,_)}return e.top>=0&&e.left>=0&&e.bottom>e.top&&e.right>e.left?e:null}function rY(l,t,e,n){var i=Ie.clone(l),r={width:t.width,height:t.height};return n.adjustX&&i.left<e.left&&(i.left=e.left),n.resizeWidth&&i.left>=e.left&&i.left+r.width>e.right&&(r.width-=i.left+r.width-e.right),n.adjustX&&i.left+r.width>e.right&&(i.left=Math.max(e.right-r.width,e.left)),n.adjustY&&i.top<e.top&&(i.top=e.top),n.resizeHeight&&i.top>=e.top&&i.top+r.height>e.bottom&&(r.height-=i.top+r.height-e.bottom),n.adjustY&&i.top+r.height>e.bottom&&(i.top=Math.max(e.bottom-r.height,e.top)),Ie.mix(i,r)}function Dl(l){var t,e,n;if(!Ie.isWindow(l)&&l.nodeType!==9)t=Ie.offset(l),e=Ie.outerWidth(l),n=Ie.outerHeight(l);else{var i=Ie.getWindow(l);t={left:Ie.getWindowScrollLeft(i),top:Ie.getWindowScrollTop(i)},e=Ie.viewportWidth(i),n=Ie.viewportHeight(i)}return t.width=e,t.height=n,t}function Ou(l,t){var e=t.charAt(0),n=t.charAt(1),i=l.width,r=l.height,s=l.left,o=l.top;return e==="c"?o+=r/2:e==="b"&&(o+=r),n==="c"?s+=i/2:n==="r"&&(s+=i),{left:s,top:o}}function Ts(l,t,e,n,i){var r=Ou(t,e[1]),s=Ou(l,e[0]),o=[s.left-r.left,s.top-r.top];return{left:Math.round(l.left-o[0]+n[0]-i[0]),top:Math.round(l.top-o[1]+n[1]-i[1])}}function Fu(l,t,e){return l.left<e.left||l.left+t.width>e.right}function Bu(l,t,e){return l.top<e.top||l.top+t.height>e.bottom}function sY(l,t,e){return l.left>e.right||l.left+t.width<e.left}function oY(l,t,e){return l.top>e.bottom||l.top+t.height<e.top}function Ns(l,t,e){var n=[];return Ie.each(l,function(i){n.push(i.replace(t,function(r){return e[r]}))}),n}function Ds(l,t){return l[t]=-l[t],l}function $u(l,t){var e;return/%$/.test(l)?e=parseInt(l.substring(0,l.length-1),10)/100*t:e=parseInt(l,10),e||0}function Pu(l,t){l[0]=$u(l[0],t.width),l[1]=$u(l[1],t.height)}function aY(l,t,e,n){var i=e.points,r=e.offset||[0,0],s=e.targetOffset||[0,0],o=e.overflow,a=e.source||l;r=[].concat(r),s=[].concat(s),o=o||{};var c={},u=0,d=!!(o&&o.alwaysByViewport),h=Nl(a,d),f=Dl(a);Pu(r,f),Pu(s,t);var p=Ts(f,t,i,r,s),g=Ie.merge(f,p);if(h&&(o.adjustX||o.adjustY)&&n){if(o.adjustX&&Fu(p,f,h)){var m=Ns(i,/[lr]/gi,{l:"r",r:"l"}),v=Ds(r,0),b=Ds(s,0),_=Ts(f,t,m,v,b);sY(_,f,h)||(u=1,i=m,r=v,s=b)}if(o.adjustY&&Bu(p,f,h)){var x=Ns(i,/[tb]/gi,{t:"b",b:"t"}),w=Ds(r,1),E=Ds(s,1),S=Ts(f,t,x,w,E);oY(S,f,h)||(u=1,i=x,r=w,s=E)}u&&(p=Ts(f,t,i,r,s),Ie.mix(g,p));var R=Fu(p,f,h),D=Bu(p,f,h);if(R||D){var P=i;R&&(P=Ns(i,/[lr]/gi,{l:"r",r:"l"})),D&&(P=Ns(i,/[tb]/gi,{t:"b",b:"t"})),i=P,r=e.offset||[0,0],s=e.targetOffset||[0,0]}c.adjustX=o.adjustX&&R,c.adjustY=o.adjustY&&D,(c.adjustX||c.adjustY)&&(g=rY(p,f,h,c))}return g.width!==f.width&&Ie.css(a,"width",Ie.width(a)+g.width-f.width),g.height!==f.height&&Ie.css(a,"height",Ie.height(a)+g.height-f.height),Ie.offset(a,{left:g.left,top:g.top},{useCssRight:e.useCssRight,useCssBottom:e.useCssBottom,useCssTransform:e.useCssTransform,ignoreShake:e.ignoreShake}),{points:i,offset:r,targetOffset:s,overflow:c}}function lY(l,t){var e=Nl(l,t),n=Dl(l);return!e||n.left+n.width<=e.left||n.top+n.height<=e.top||n.left>=e.right||n.top>=e.bottom}function _o(l,t,e){var n=e.target||t,i=Dl(n),r=!lY(n,e.overflow&&e.overflow.alwaysByViewport);return aY(l,i,e,r)}_o.__getOffsetParent=Ua;_o.__getVisibleRectForElement=Nl;const Kt={adjustX:!0,adjustY:!0},Xt=[0,0],sr={left:{points:["cr","cl"],overflow:Kt,offset:[-4,0],targetOffset:Xt},right:{points:["cl","cr"],overflow:Kt,offset:[4,0],targetOffset:Xt},top:{points:["bc","tc"],overflow:Kt,offset:[0,-4],targetOffset:Xt},bottom:{points:["tc","bc"],overflow:Kt,offset:[0,4],targetOffset:Xt},topLeft:{points:["bl","tl"],overflow:Kt,offset:[0,-4],targetOffset:Xt},leftTop:{points:["tr","tl"],overflow:Kt,offset:[-4,0],targetOffset:Xt},topRight:{points:["br","tr"],overflow:Kt,offset:[0,-4],targetOffset:Xt},rightTop:{points:["tl","tr"],overflow:Kt,offset:[4,0],targetOffset:Xt},bottomRight:{points:["tr","br"],overflow:Kt,offset:[0,4],targetOffset:Xt},rightBottom:{points:["bl","br"],overflow:Kt,offset:[4,0],targetOffset:Xt},bottomLeft:{points:["tl","bl"],overflow:Kt,offset:[0,4],targetOffset:Xt},leftBottom:{points:["br","bl"],overflow:Kt,offset:[-4,0],targetOffset:Xt}};const cY=l=>`
    <div ${le}="tooltip" class="data-tooltip data-tooltip-placement-${l.placement} data-tooltip-hidden" style="transform-origin: 50% 45px 0px;">
        <div class="data-tooltip-content">
            <div class="data-tooltip-arrow"></div>
            <div class="data-tooltip-inner" data-role="tooltip"></div>
        </div>
    </div>`;class Ue{static show(t,e,n={placement:"top"}){Ue.hide();const i=I(cY(n));typeof e=="string"?i.find("[data-role=tooltip]").html(e):i.find("[data-role=tooltip]").append(e),I(document.body).append(i);const s=_o(i.get(),t.get(),{...sr[n.placement]}),o=Object.keys(sr).find(a=>{const c=sr[a].points;return c[0]===s.points[0]&&c[1]===s.points[1]});o!==n.placement&&i.removeClass(`data-tooltip-placement-${n.placement}`).addClass(`data-tooltip-placement-${o}`),i.addClass("data-tooltip-active")}static hide(){I(`div[${le}=tooltip]`).remove()}}const uY=l=>`
    <span class="data-toolbar-item">
        <a class="data-toolbar-btn"${l.disabled?' disabled="disabled"':""} ${l.link?' href="'+l.link+'" target="_blank"':""}>
            ${l.content}
        </a>
    </span>`;class dY{constructor(t){y(this,"options");y(this,"root");this.options=t,this.root=I(uY(t)),t.style&&this.root.attributes("style",t.style),t.class&&this.root.addClass(t.class)}getPlacement(){return(this.root.closest(".data-toolbar").attributes("data-placement")||"top").startsWith("top")?"top":"bottom"}render(t){const{title:e,didMount:n,onClick:i,link:r}=this.options;t.append(this.root),e&&(this.root.on("mouseenter",()=>{const s=this.getPlacement();Ue.show(this.root,typeof e=="function"?e():e,{placement:s})}),this.root.on("mouseleave",()=>{Ue.hide()}),this.root.on("mousedown",()=>{Ue.hide()})),!r&&i&&this.root.find("a").on("click",s=>{s.preventDefault(),s.stopPropagation(),i(s,this.root)}),n&&n(this.root)}}const fY=l=>{let t=!!l.checked;return l.getState&&(t=l.getState()),`
    <div class="data-toolbar-item data-toolbar-dropdown-item data-toolbar-dropdown-switch">
        <span class="data-toolbar-dropdown-item-content"${l.disabled?' disabled="disabled"':""}>${l.content}</span>
        <button type="button"${l.disabled?' disabled="disabled"':""} role="switch" aria-checked="true" class="switch-btn ${t?" switch-checked":""}">
            <div class="switch-handle"></div>
            <span class="switch-inner"></span>
        </button>
    </div>`};class hY{constructor(t){y(this,"options");y(this,"root");y(this,"switch");this.options=t}renderTo(t){this.root=I(fY(this.options)),this.switch=this.root.find(".switch-btn"),t.append(this.root),this.root.on("mousedown",n=>n.preventDefault());const{onClick:e}=this.options;this.root.on("click",n=>{n.stopPropagation(),e&&(e(n,this.root),this.updateSwitch())})}updateSwitch(){var t,e;this.options.getState&&(this.options.getState()?(t=this.switch)==null||t.addClass("switch-checked"):(e=this.switch)==null||e.removeClass("switch-checked"))}}const pY=l=>`
    <div class="data-toolbar-item data-toolbar-dropdown-item data-toolbar-dropdown-btn">
        <span class="data-toolbar-dropdown-item-content"${l.disabled?' disabled="disabled"':""}>
            ${l.content}
        </span>
    </div>`;class gY{constructor(t){y(this,"options");y(this,"root");this.options=t}renderTo(t){this.root=I(pY(this.options)),t.append(this.root);const{onClick:e}=this.options;e&&this.root.on("click",n=>e(n,this.root))}}const mY=l=>`
    <span class="data-toolbar-item data-toolbar-item-dropdown">
        <a class="data-toolbar-btn data-toolbar-dropdown"${l.disabled?' disabled="disabled"':""}>${l.content}</a>
        <div class="dropdown-container"></div>
    </span>`;class vY{constructor(t){y(this,"options");y(this,"root");y(this,"dropdown");y(this,"documentMouseDown",t=>{var e;!this.root||!this.root[0].contains(t.target)&&((e=this.dropdown)==null?void 0:e.hasClass("show"))&&this.hideDropdown()});this.options=t}initToggleEvent(){const t=this.root.find(".data-toolbar-dropdown");t.on("mousedown",e=>{e.preventDefault(),e.stopPropagation()}),t.on("click",e=>{e.stopPropagation(),this.toggleDropdown()}),document.addEventListener("mousedown",this.documentMouseDown,!0)}toggleDropdown(){var t;(t=this.dropdown)!=null&&t.hasClass("show")?this.hideDropdown():this.showDropdown()}showDropdown(){var t;(t=this.dropdown)==null||t.addClass("show")}hideDropdown(){var t;(t=this.dropdown)==null||t.removeClass("show")}getPlacement(){return(this.root.closest(".data-toolbar").attributes("data-placement")||"top").startsWith("top")?"top":"bottom"}renderTooltip(){const{title:t}=this.options;t&&(this.root.on("mouseenter",()=>{const e=this.getPlacement();Ue.show(this.root,typeof t=="function"?t():t,{placement:e})}),this.root.on("mouseleave",()=>{Ue.hide()}),this.root.on("mousedown",()=>{Ue.hide()}))}renderDropdown(){this.dropdown=this.root.find(".dropdown-container");const{items:t}=this.options;t.forEach(e=>{switch(e.type){case"switch":return new hY(e).renderTo(this.dropdown);case"button":return new gY(e).renderTo(this.dropdown)}}),this.dropdown.on("click",e=>{e.stopPropagation(),this.hideDropdown()})}render(t){this.root=I(mY(this.options)),t.append(this.root),this.initToggleEvent(),this.renderTooltip(),this.renderDropdown();const{didMount:e}=this.options;e&&e(this.root)}destroy(){document.removeEventListener("mousedown",this.documentMouseDown,!0)}}const bY=l=>`
    <span class="data-toolbar-item data-toolbar-item-input">
        ${l.prefix?"<span class='data-toolbar-input-prefix'>"+dt(l.prefix)+"</span>":""}<input data-role="input" placeholder="${dt(l.placeholder)}" class="data-toolbar-input" type="input" value="${dt(l.value.toString())}" />${l.suffix?"<span class='data-toolbar-input-suffix'>"+dt(l.suffix)+"</span>":""}
    </span>`;class yY{constructor(t){y(this,"options");y(this,"root");y(this,"onEnter");y(this,"onInput");y(this,"onChange");this.options=t,this.root=I(bY(t)),this.onEnter=t.onEnter||(()=>{}),this.onInput=t.onInput||(()=>{}),this.onChange=t.onChange||(()=>{})}find(t){const e="[data-role=".concat(t,"]");return this.root.find(e)}render(t){const{value:e,didMount:n}=this.options,i=this.find("input"),r=i.get();!r||(r.value=(e!==void 0?e:"").toString(),i.on("keydown",s=>{s.stopPropagation(),ce("enter",s)&&(s.preventDefault(),r.blur(),this.onEnter(r.value))}),i.on("input",()=>{this.onInput(r.value)}),i.on("change",()=>{setTimeout(()=>{this.onChange(r.value)},10)}),t.append(this.root),n&&n(this.root))}}const _Y=l=>{let t=!!l.checked;return l.getState&&(t=l.getState()),`
    <div class="data-toolbar-switch">
        <span class="switch-content"${l.disabled?' disabled="disabled"':""}>${l.content}</span>
        <button type="button" role="switch" aria-checked="true" class="switch-btn ${t?" switch-checked":""}"${l.disabled?' disabled="disabled"':""}>
            <div class="switch-handle"></div>
            <span class="switch-inner"></span>
        </button>
    </div>`};class wY{constructor(t){y(this,"options");y(this,"root");y(this,"switch");this.options=t,this.root=I(_Y(t)),this.switch=this.root.find(".switch-btn"),t.class&&this.root.addClass(t.class)}render(t){const{didMount:e,onClick:n}=this.options;t.append(this.root),this.root.on("mousedown",i=>i.preventDefault()),this.root.on("click",i=>{i.stopPropagation(),n&&(n(i,this.root),this.updateSwitch())}),e&&e(this.root)}updateSwitch(){var t,e;this.options.getState&&(this.options.getState()?(t=this.switch)==null||t.addClass("switch-checked"):(e=this.switch)==null||e.removeClass("switch-checked"))}}const xY=()=>`<div ${le}="ui" class="data-toolbar data-toolbar-active" ${yt}="false"></div>`;class kY{constructor(t){y(this,"options");y(this,"root");y(this,"items",[]);this.options={...t},this.root=I(xY())}getPlacement(){return(this.root.attributes("data-placement")||"top").startsWith("top")?"top":"bottom"}addItems(t){this.options.items.forEach(e=>{let n;if(e.type==="button"&&(n=new dY(e),n.render(t)),e.type==="switch"&&(n=new wY(e),n.render(t)),e.type==="input"){const i=e;n=new yY(i),n.render(t)}if(e.type==="dropdown"&&(n=new vY(e),n.render(t)),e.type==="node"){const i=e,r=i.node;r.addClass("data-toolbar-item");const{title:s}=i;s&&(r.on("mouseenter",()=>{const o=this.getPlacement();Ue.show(r,typeof s=="function"?s():s,{placement:o})}),r.on("mouseleave",()=>{Ue.hide()}),r.on("mousedown",()=>{Ue.hide()})),t.append(r),e.didMount&&e.didMount(r)}n&&this.items.push(n)})}find(t){const e="[data-role=".concat(t,"]");return this.root.find(e)}destroy(){this.root.remove()}hide(){this.root.removeClass("data-toolbar-active")}show(){this.root.addClass("data-toolbar-active")}renderGroup(){return I('<div class="data-toolbar-group"></div>')}render(t){const e=this.renderGroup();return this.root.append(e),this.addItems(e),t&&t.append(this.root),this.root.addClass("data-toolbar-block"),this.root}update(t){this.options=t,this.root.empty();const e=this.renderGroup();this.root.append(e),this.addItems(e)}}const Rs="ot-user-background",Dr="ot-user-cursor",zu="ot-user-cursor-card",Ji="ot-card-mask",Rr="ot-user-cursor-trigger",qu="ot-user-cursor-trigger-active";class EY{constructor(t){y(this,"engine");y(this,"root");y(this,"hideCursorInfoTimeoutMap");this.engine=t,this.root=t.root,this.hideCursorInfoTimeoutMap={}}destroy(){var e;const t=(e=this.engine.scrollNode)!=null?e:this.root;t.find(`.${Rs}`).remove(),t.find(`.${Dr}`).remove(),t.find(`.${Ji}`).remove()}getRectWithRange(t,e){var r;const n=e.getClientRect(),i=(r=t.get())==null?void 0:r.getBoundingClientRect();return new DOMRect(n.left-((i==null?void 0:i.left)||0),n.top-((i==null?void 0:i.top)||0),n.right-n.left,n.bottom-n.top)}isWrapByRange(t){const e=t.cloneRange().collapse(!0).getClientRect(),n=t.cloneRange().collapse(!1).getClientRect();return e.bottom!==n.bottom}drawSubRang(t,e,n,i){const{startOffset:r,startNode:s,endNode:o}=n;let a=n.startOffset;const c=n.endOffset;let u=n.getClientRect().top,d=r;for(;a<c;){n.setStart(n.commonAncestorContainer,a),n.setEnd(n.commonAncestorContainer,a+1);const h=n.getClientRect();if(h.top>u||a===c-1){n.setStart(n.commonAncestorContainer,d),d=a,u=h.top;const f=this.getRectWithRange(t,n);e.clearRect(f),e.drawRect({...f.toJSON(),...i})}a++}n.setStart(s,r),n.setEnd(o,c)}drawBackground(t,e){var m,v,b,_;const{card:n}=this.engine,{uuid:i,color:r}=e,s=de(r);s.setAlpha(.3);let o;const a=s.toRgbString();let c=((m=this.engine.scrollNode)!=null?m:this.root).find(`.${Rs}[${Bn}="${i}"]`);c&&c.length>0?(c.attributes(ma,r.toString()),o=c[0].__canvas,o.clear()):(c=I(`<div class="${Rs}" ${Bn}="${i}" ${ma}="${r}" />`),((v=this.engine.scrollNode)!=null?v:this.root).append(c),o=new oZ({container:c.get()}),c[0].__canvas=o),c.css({position:"absolute",top:0,left:0,"pointer-events":"none"}),c[0].__range=t.cloneRange();const u=(b=this.engine.scrollNode)!=null?b:this.root,d=((_=u.get())==null?void 0:_.clientWidth)||u.width(),h=this.root.height();o.resize(d,h);let f=n.find(t.commonAncestorNode,!0);f&&!f.isCenter(t.commonAncestorNode)&&(f=void 0);const p={fill:a};let g=t.getSubRanges();if((f==null?void 0:f.isEditable)&&f.drawBackground){const x=f.drawBackground(c,t,o);if(x===!1)return[t];if(x)if(Array.isArray(x))g=x;else return x.x<0&&(o.resize(d-x.x,h),c.css("left",`${x.x}px`),x.x=0),o.clearRect(x),o.drawRect({...x.toJSON(),...p}),[t]}else if(f)return[t];return g.forEach(x=>{if(this.isWrapByRange(x))this.drawSubRang(c,o,x,p);else{const w=this.getRectWithRange(c,x);o.clearRect(w),o.drawRect({...w.toJSON(),...p})}}),g}getNodeRect(t,e){var i;const n=t.parent();if(t.isCard()&&(n==null?void 0:n.hasClass(this.engine.list.CUSTOMZIE_LI_CLASS))&&((i=n==null?void 0:n.first())==null?void 0:i.equal(t))&&t.next()&&(t=t.next()),t.isElement()&&(e=t.get().getBoundingClientRect()),t.isText()){const r=Te.create(this.engine).cloneRange();r.select(t,!0),e=r.getClientRect()}return e}getCursorRect(t,e=2){var c,u;const n=((c=this.root.get())==null?void 0:c.getBoundingClientRect())||{top:0,left:0};if(nr(t)){const d=t,{startNode:h}=d;d.shrinkToElementNode();let f=d.getClientRect();if(h.isElement()&&f.height===0){let v=I(h[0].childNodes[d.startOffset]);v&&v.length>0?f=this.getNodeRect(v,f):(v=h.first(),v&&v.length>0&&(f=this.getNodeRect(v,f)))}const p=f.top-(n.top||0),g=f.left-(n.left||0)-e,m=f.height;return{top:p+"px",left:g+"px",height:m>0?m+"px":-1,elementHeight:f.height||0}}const i=t,r=Ee(i.css("outline-width")),s=((u=i.get())==null?void 0:u.getBoundingClientRect())||{top:0,left:0,height:0};let o=s.top-n.top-1,a=s.left-n.left;return r&&(o-=r+1,a-=2),{left:a+"px",top:o+"px",height:0,elementHeight:s.height||0}}setCursorRect(t,e){if(e.height!==-1){if(e.height===0){t.css(e),t.addClass(zu);return}t.css(e),t.removeClass(zu)}else t.remove()}showCursorInfo(t,e){const{uuid:n,color:i}=e;this.hideCursorInfoTimeoutMap[n]&&clearTimeout(this.hideCursorInfoTimeoutMap[n]);const r=t.find(`.${Rr}`),s=t.css("background-color");t.attributes("data-old-background-color",s),r.addClass(`${qu}`),t.css("background-color",i),r.css("background-color",i)}hideCursorInfo(t){const e=t.find(`.${Rr}`),n=t.attributes("data-old-background-color");e.removeClass(`${qu}`),t.css("background-color",n),e.css("background-color",n)}drawCursor(t,e,n){const{uuid:i,name:r,color:s}=e;let o=this.getCursorRect(t),a=this.root.children(`.${Dr}[${Bn}="${i}"]`);if(a&&a.length>0)this.setCursorRect(a,o);else{const c=`
            <div class="${Dr}" ${Bn}="${i}">
                <div class="${Rr}">${dt(r||"")}</div>
            </div>`;a=I(c);const u=a.find(`.${Rr}`);if(o.elementHeight===0){let h=0;const f=()=>{h++,o=this.getCursorRect(t),o.elementHeight<20&&h<=50?setTimeout(()=>{f()},20):this.setCursorRect(a,o)};f()}else this.setCursorRect(a,o);a.on("mouseenter",()=>this.showCursorInfo(a,e));let d=!0;a.on("transitionstart",()=>{d=!1}),a.on("transitionend",()=>{d=!0}),a.on("mouseleave",()=>{d&&this.hideCursorInfo(a)}),a.css("background-color",s),u.css("background-color",s),this.root.append(a)}if(a&&a[0]){a.css("z-index","");const c=this.engine.card.components.find(u=>u.isMaximize);if(c){const u=this.engine.card.closest(nr(t)?t.startNode:t,!0);(!u||!c.root.equal(u))&&a.css("z-index",120)}return a[0].__target=nr(t)?t.toPath(!0):t,n===!1||(this.showCursorInfo(a,e),this.hideCursorInfoTimeoutMap[i]&&clearTimeout(this.hideCursorInfoTimeoutMap[i]),this.hideCursorInfoTimeoutMap[i]=setTimeout(()=>{this.hideCursorInfo(a)},2e3)),a}}drawCard(t,e,n){var a,c;const{language:i}=this.engine,r=((a=this.root.get())==null?void 0:a.getBoundingClientRect())||{left:0,top:0,width:0,height:0};let s=((c=t.get())==null?void 0:c.getBoundingClientRect())||{left:0,top:0,width:0,height:0},o=this.root.children(`.${Ji}[${Bn}="${n.uuid}"]`);if(o&&o.length>0){o[0].__node=t[0],o.css({left:s.left-r.left+"px",top:s.top-r.top+"px"});return}if(o=I(`<div class="${Ji}" ${Bn}="${n.uuid}" />`),o[0].__node=t[0],s.height===0){let u=0;const d=()=>{var h;u++,s=((h=t.get())==null?void 0:h.getBoundingClientRect())||{left:0,top:0,width:0,height:0},s.height<20&&u<=50?setTimeout(()=>{d()},20):o.css({left:s.left-r.left+"px",top:s.top-r.top+"px",width:s.width+"px",height:s.height+"px"})};d()}else o.css({left:s.left-r.left+"px",top:s.top-r.top+"px",width:s.width+"px",height:s.height+"px"});o.on("mouseenter",()=>{this.showCursorInfo(e,n),Ue.show(o,i.get("card","lockAlert").toString(),{placement:"bottomLeft"})}),o.on("mousemove",u=>{I(`div[${le}=tooltip]`).css({left:u.pageX-16+"px",top:u.pageY+32+"px"})}),o.on("mouseleave",()=>{this.hideCursorInfo(e),Ue.hide()}),o.on("click",u=>{u.preventDefault(),u.stopPropagation()}),o.on("mousedown",u=>{u.preventDefault(),u.stopPropagation()}),this.root.append(o)}setCardSelectedByOther(t,e){const{uuid:n,color:i}=e||{};if(i){const r=de(i);r.setAlpha(.3);const s=r.toRgbString();let o;return t.selectedByOther||(o=t.onSelectByOther(!0,{color:i,rgb:s})),t.selectedByOther=n,o}t.selectedByOther&&t.onSelectByOther(!1),t.selectedByOther=!1}setCardActivatedByOther(t,e){if(t.isEditable)return;const{uuid:n,color:i}=e||{};if(i){const r=de(i);r.setAlpha(.3);const s=r.toRgbString();let o;return t.activatedByOther||(o=t.onActivateByOther(!0,{color:i,rgb:s})),t.activatedByOther=n,o}t.activatedByOther&&t.onActivateByOther(!1),t.activatedByOther=!1}drawRange(t,e,n){var c,u;const{card:i}=this.engine,{uuid:r}=e,{commonAncestorNode:s}=t;let o=i.find(s);o&&!o.isCenter(s)&&(o=void 0);const a=[];if(i.each(d=>{d.isEditable||(!o||!d.root.equal(o.root))&&(d.activatedByOther===r&&this.setCardActivatedByOther(d),a.push(r))}),a.length>0&&((u=(c=this.root.get())==null?void 0:c.querySelectorAll(a.map(d=>`.${Ji}[${Bn}="${d}"]`).join(",")))==null||u.forEach(d=>{var h;(h=d.parentNode)==null||h.removeChild(d),Ue.hide()})),o&&!o.isEditable){const d=this.setCardActivatedByOther(o,e)||o.root,h=o.constructor.collab;if(h===void 0||h===!0){const f=this.drawCursor(d,e,n);f&&this.drawCard(d,f,e),this.drawBackground(t,e)}}else{if(o){this.drawBackground(t,e);return}i.each(h=>{const f=h.getCenter();if(f&&f.length>0){if(h.isEditable&&f.contains(t.startNode)&&f.contains(t.endNode)&&(t.startNode.closest(ze).length>0||t.endNode.closest(ze).length>0)){this.setCardSelectedByOther(h);return}t.isPointInRange(f.get(),0)?this.setCardSelectedByOther(h,e):h.selectedByOther===r&&this.setCardSelectedByOther(h)}});const d=i.getSingleSelectedCard(t);if(d){if(d.isEditable){const f=d.getCenter();if(f.contains(t.startNode)&&f.contains(t.endNode)&&(t.startNode.closest(ze).length>0||t.endNode.closest(ze).length>0))return}const h=this.setCardSelectedByOther(d,e)||d.root;this.drawCursor(h,e,n)}else{t.shrinkToElementNode();const h=this.drawBackground(t,e);t.collapsed||(h.forEach(f=>{f.collapsed||(t=f)}),t.shrinkToElementNode(),t.collapse(!1)),this.drawCursor(t,e,n)}}}updateBackgroundPosition(){var t,e,n;(n=(e=(t=this.engine.scrollNode)==null?void 0:t.get())!=null?e:this.root.get())==null||n.querySelectorAll(`.${Rs}`).forEach(i=>{const r=I(i),s=i.__range,o=r.attributes(Bn),a=r.attributes(ma);this.drawBackground(s,{uuid:o,color:a})})}updateCursorPosition(){var t;(t=this.root.get())==null||t.querySelectorAll(`.${Dr}`).forEach(e=>{const n=I(e);let i=e.__target;if(!i){n.remove();return}if(i.name||(i=Te.fromPath(this.engine,i,!0)),i.startContainer||I(i).closest("body").length!==0){const r=this.getCursorRect(i);this.setCursorRect(n,r)}else n.remove()})}updateCardPosition(){var e,n;const t=((e=this.root.get())==null?void 0:e.getBoundingClientRect())||{left:0,top:0};(n=this.root.get())==null||n.querySelectorAll(`.${Ji}`).forEach(i=>{var s;const r=i.__node;if(r!=null&&r.isConnected){const o=r.getBoundingClientRect();i.style.left=o.left-t.left+"px",i.style.top=o.top-t.top+"px"}else(s=i.parentNode)==null||s.removeChild(i)})}updatePosition(){this.updateBackgroundPosition(),this.updateCursorPosition(),this.updateCardPosition()}updateBackgroundAlpha(t){var n;const e=this.getCursorRect(t);(n=this.root.get())==null||n.querySelectorAll(`.${Dr}`).forEach(i=>{const r=i.querySelector(`.${Rr}`),s=i.style.left,o=i.style.top,a=de(i.style.backgroundColor);e.left===s&&e.top===o?a.setAlpha(.3):a.setAlpha(1);const c=a.toRgbString();i.style.backgroundColor=c,r&&(r.style.backgroundColor=c)})}render(t,e,n){const{path:i,uuid:r,active:s}=t;if(i){const o=Te.fromPath(this.engine,i,!0);this.drawRange(o,e,s||n)}else this.remove(r)}remove(t){var e,n,i;(i=(n=(e=this.engine.scrollNode)==null?void 0:e.get())!=null?n:this.root.get())==null||i.querySelectorAll(`[${Bn}="${t}"]`).forEach(r=>{var s;if(r.classList.contains(Ji)){const o=r.__node,a=o?this.engine.card.find(o):null;a&&!a.isEditable&&a.activatedByOther===t&&this.setCardActivatedByOther(a)}(s=r.parentNode)==null||s.removeChild(r)}),this.engine.card.each(r=>{r.isEditable||r.selectedByOther!==t||this.setCardSelectedByOther(r)})}}class CY extends zi{constructor(e){super();y(this,"engine");y(this,"prevRange",null);y(this,"rangeColoring");y(this,"currentRangePath");y(this,"data",new Map);y(this,"current",null);y(this,"handleScroll",e=>{var i,r,s;const n=(i=this.engine.container.get())==null?void 0:i.childNodes;if(!!n){for(const[o,a]of this.data)if(o!==((r=this.current)==null?void 0:r.uuid)&&(s=a.path)!=null&&s.start.id){const c=a.path.start.path[0],u=n.item(c);if(u&&e.equal(u)){this.rangeColoring.updatePosition();break}}}});y(this,"handleMouseDown",()=>{const e=this.engine.container;e.off("mouseup",this.handleMouseUp),e.off("mousemove",this.emitSelectChange),e.on("mouseup",this.handleMouseUp),e.on("mousemove",this.emitSelectChange)});y(this,"handleMouseUp",()=>{const e=this.engine.container;e.off("mouseup",this.handleMouseUp),e.off("mousemove",this.emitSelectChange),setTimeout(()=>{this.emitSelectChange()},10)});y(this,"observer",null);y(this,"emitSelectChange",(e=!1)=>{var r,s;if(this.engine.change.isComposing())return;let n=this.engine.change.range.get();(r=this.observer)==null||r.disconnect();const i=this.engine.card.find(n.commonAncestorContainer,!0);if(i!=null&&i.getSelectionNodes){let o=this.getCardResizeRange(i);o&&(n=o.cloneRange(),this.observer=new ResizeObserver(()=>{var a;o=this.getCardResizeRange(i),o?(this.prevRange={startContainer:o.startContainer,endContainer:o.endContainer,startOffset:o.startOffset,endOffset:o.endOffset},this.onSelectionChange(o,!0,e)):(a=this.observer)==null||a.disconnect()}),this.observer.observe(i.root.get()))}((s=this.prevRange)==null?void 0:s.startContainer)===n.startContainer&&this.prevRange.endContainer===n.endContainer&&this.prevRange.startOffset===n.startOffset&&this.prevRange.endOffset===n.endOffset||(!n.commonAncestorNode.isRoot()&&!n.commonAncestorNode.inEditor()?(this.current&&this.removeAttirbute(this.current.uuid),this.prevRange=null):(this.prevRange={startContainer:n.startContainer,endContainer:n.endContainer,startOffset:n.startOffset,endOffset:n.endOffset},this.onSelectionChange(n,!1,e)))});this.engine=e,this.rangeColoring=new EY(e),e.container.on("keyup",this.emitSelectChange),e.container.on("mousedown",this.handleMouseDown),e.on("scroll",this.handleScroll)}getCardResizeRange(e){var n;if(e!=null&&e.getSelectionNodes){const i=e.getSelectionNodes();if(i.length>0){const r=Te.create(this.engine);r.setStart(i[0],0);const s=i[i.length-1];return r.setEnd(s,s.isText()?s.text().length:((n=s.get())==null?void 0:n.childNodes.length)||0),r}}return null}setCurrent(e){this.current=e}setAttribute(e,n,i=!1){var s;const r=this.data.get(e.uuid);(e.force||!Bt(r||{},e))&&(this.data.set(e.uuid,Object.assign({},e,{active:!r})),e.uuid===((s=this.current)==null?void 0:s.uuid)?(i===!0&&this.rangeColoring.updatePosition(),this.emit("change",e)):this.rangeColoring.render(e,n))}removeAttirbute(e){var n;!this.data.has(e)||(this.data.delete(e),e===((n=this.current)==null?void 0:n.uuid)?this.emit("change",{uuid:e,remove:!0}):this.rangeColoring.remove(e))}getAttribute(e){return this.data.get(e)}onSelectionChange(e,n=!1,i=!1){if(!this.current)return;const{card:r}=this.engine;e=e.cloneRange();const s=r.active;if(s&&!s.isEditable){const c=s.getCenter();if(ci(s.root)){const u=s.root.prev();u?e.select(u,!0).collapse(!1):(e.setStartBefore(s.root),e.collapse(!0))}else c&&c.length>0&&e.select(c.get(),!0)}if(!s&&!e.collapsed){const c=this.engine.card.find(e.startNode,!0);c&&c.type===Ve.BLOCK&&e.setStart(c.getCenter().parent(),1);const u=this.engine.card.find(e.endNode,!0);u&&u.type===Ve.BLOCK&&e.setEnd(u.getCenter().parent(),1)}const o=e.toPath(!0);this.currentRangePath=e.toPath();const a=this.getAttribute(this.current.uuid);this.setAttribute(Object.assign({},a,{path:o,uuid:this.current.uuid,force:n}),this.current,i),this.rangeColoring.updateBackgroundAlpha(e)}refreshAttributes(...e){e.forEach(n=>{const i=this.getAttribute(n.uuid);i&&this.rangeColoring.render(i,n)})}destory(){const e=this.engine.container;e.off("mouseup",this.handleMouseUp),e.off("mousemove",this.emitSelectChange),e.off("keyup",this.emitSelectChange),e.off("mousedown",this.handleMouseDown),this.engine.off("scroll",this.handleScroll)}}var Uh=SY;function SY(l,t,e,n){var i=function(s,o,a,c){t(a,s,o,"left"),t(c,o,s,"right")},r=l.transformX=function(s,o){e(s),e(o);for(var a=[],c=0;c<o.length;c++){for(var u=o[c],d=[],h=0;h<s.length;){var f=[];if(i(s[h],u,d,f),h++,f.length===1)u=f[0];else if(f.length===0){for(var p=h;p<s.length;p++)n(d,s[p]);u=null;break}else{for(var g=r(s.slice(h),f),m=0;m<g[0].length;m++)n(d,g[0][m]);for(var v=0;v<g[1].length;v++)n(a,g[1][v]);u=null;break}}u!=null&&n(a,u),s=d}return[s,a]};l.transform=function(s,o,a){if(!(a==="left"||a==="right"))throw new Error("type must be 'left' or 'right'");return o.length===0?s:s.length===1&&o.length===1?t([],s[0],o[0],a):a==="left"?r(s,o)[0]:r(o,s)[1]}}var jh={exports:{}},gi=jh.exports={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(l){if(l!=null&&typeof l!="string")throw new Error("Initial data must be a string");return l||""}},ja=function(l,t,e){return l.slice(0,t)+e+l.slice(t)},Va=function(l){if(typeof l.p!="number")throw new Error("component missing position field");if(typeof l.i=="string"==(typeof l.d=="string"))throw new Error("component needs an i or d field");if(l.p<0)throw new Error("position cannot be negative")},Gs=function(l){for(var t=0;t<l.length;t++)Va(l[t])};gi.apply=function(l,t){var e;Gs(t);for(var n=0;n<t.length;n++){var i=t[n];if(i.i!=null)l=ja(l,i.p,i.i);else{if(e=l.slice(i.p,i.p+i.d.length),i.d!==e)throw new Error("Delete component '"+i.d+"' does not match deleted text '"+e+"'");l=l.slice(0,i.p)+l.slice(i.p+i.d.length)}}return l};var Pn=gi._append=function(l,t){if(!(t.i===""||t.d===""))if(l.length===0)l.push(t);else{var e=l[l.length-1];e.i!=null&&t.i!=null&&e.p<=t.p&&t.p<=e.p+e.i.length?l[l.length-1]={i:ja(e.i,t.p-e.p,t.i),p:e.p}:e.d!=null&&t.d!=null&&t.p<=e.p&&e.p<=t.p+t.d.length?l[l.length-1]={d:ja(t.d,e.p-t.p,e.d),p:t.p}:l.push(t)}};gi.compose=function(l,t){Gs(l),Gs(t);for(var e=l.slice(),n=0;n<t.length;n++)Pn(e,t[n]);return e};gi.normalize=function(l){var t=[];(l.i!=null||l.p!=null)&&(l=[l]);for(var e=0;e<l.length;e++){var n=l[e];n.p==null&&(n.p=0),Pn(t,n)}return t};var Ga=function(l,t,e){return t.i!=null?t.p<l||t.p===l&&e?l+t.i.length:l:l<=t.p?l:l<=t.p+t.d.length?t.p:l-t.d.length};gi.transformCursor=function(l,t,e){for(var n=e==="right",i=0;i<t.length;i++)l=Ga(l,t[i],n);return l};var AY=gi._tc=function(l,t,e,n){if(Va(t),Va(e),t.i!=null)Pn(l,{i:t.i,p:Ga(t.p,e,n==="right")});else if(e.i!=null){var i=t.d;t.p<e.p&&(Pn(l,{d:i.slice(0,e.p-t.p),p:t.p}),i=i.slice(e.p-t.p)),i!==""&&Pn(l,{d:i,p:t.p+e.i.length})}else if(t.p>=e.p+e.d.length)Pn(l,{d:t.d,p:t.p-e.d.length});else if(t.p+t.d.length<=e.p)Pn(l,t);else{var r={d:"",p:t.p};t.p<e.p&&(r.d=t.d.slice(0,e.p-t.p)),t.p+t.d.length>e.p+e.d.length&&(r.d+=t.d.slice(e.p+e.d.length-t.p));var s=Math.max(t.p,e.p),o=Math.min(t.p+t.d.length,e.p+e.d.length),a=t.d.slice(s-t.p,o-t.p),c=e.d.slice(s-e.p,o-e.p);if(a!==c)throw new Error("Delete ops delete different text in the same region of the document");r.d!==""&&(r.p=Ga(r.p,e),Pn(l,r))}return l},TY=function(l){return l.i!=null?{d:l.i,p:l.p}:{i:l.d,p:l.p}};gi.invert=function(l){l=l.slice().reverse();for(var t=0;t<l.length;t++)l[t]=TY(l[t]);return l};Uh(gi,AY,Gs,Pn);var wo=function(l){return Object.prototype.toString.call(l)=="[object Array]"},NY=function(l){return!!l&&l.constructor===Object},sn=function(l){return JSON.parse(JSON.stringify(l))},Se={name:"json0",uri:"http://sharejs.org/types/JSONv0"},Hn={};Se.registerSubtype=function(l){Hn[l.name]=l};Se.create=function(l){return l===void 0?null:sn(l)};Se.invertComponent=function(l){var t={p:l.p};return l.t&&Hn[l.t]&&(t.t=l.t,t.o=Hn[l.t].invert(l.o)),l.si!==void 0&&(t.sd=l.si),l.sd!==void 0&&(t.si=l.sd),l.oi!==void 0&&(t.od=l.oi),l.od!==void 0&&(t.oi=l.od),l.li!==void 0&&(t.ld=l.li),l.ld!==void 0&&(t.li=l.ld),l.na!==void 0&&(t.na=-l.na),l.lm!==void 0&&(t.lm=l.p[l.p.length-1],t.p=l.p.slice(0,l.p.length-1).concat([l.lm])),t};Se.invert=function(l){for(var t=l.slice().reverse(),e=[],n=0;n<t.length;n++)e.push(Se.invertComponent(t[n]));return e};Se.checkValidOp=function(l){for(var t=0;t<l.length;t++)if(!wo(l[t].p))throw new Error("Missing path")};Se.checkList=function(l){if(!wo(l))throw new Error("Referenced element not a list")};Se.checkObj=function(l){if(!NY(l))throw new Error("Referenced element not an object (it was "+JSON.stringify(l)+")")};function Yr(l){l.t="text0";var t={p:l.p.pop()};l.si!=null&&(t.i=l.si),l.sd!=null&&(t.d=l.sd),l.o=[t]}function Fr(l){l.p.push(l.o[0].p),l.o[0].i!=null&&(l.si=l.o[0].i),l.o[0].d!=null&&(l.sd=l.o[0].d),delete l.t,delete l.o}Se.apply=function(l,t){Se.checkValidOp(t),t=sn(t);for(var e={data:l},n=0;n<t.length;n++){var i=t[n];(i.si!=null||i.sd!=null)&&Yr(i);for(var r=null,s=e,o="data",a=0;a<i.p.length;a++){var c=i.p[a];if(r=s,s=s[o],o=c,r==null)throw new Error("Path invalid")}if(i.t&&i.o!==void 0&&Hn[i.t])s[o]=Hn[i.t].apply(s[o],i.o);else if(i.na!==void 0){if(typeof s[o]!="number")throw new Error("Referenced element not a number");s[o]+=i.na}else if(i.li!==void 0&&i.ld!==void 0)Se.checkList(s),s[o]=i.li;else if(i.li!==void 0)Se.checkList(s),s.splice(o,0,i.li);else if(i.ld!==void 0)Se.checkList(s),s.splice(o,1);else if(i.lm!==void 0){if(Se.checkList(s),i.lm!=o){var u=s[o];s.splice(o,1),s.splice(i.lm,0,u)}}else if(i.oi!==void 0)Se.checkObj(s),s[o]=i.oi;else if(i.od!==void 0)Se.checkObj(s),delete s[o];else throw new Error("invalid / missing instruction in op")}return e.data};Se.shatter=function(l){for(var t=[],e=0;e<l.length;e++)t.push([l[e]]);return t};Se.incrementalApply=function(l,t,e){for(var n=0;n<t.length;n++){var i=[t[n]];l=Se.apply(l,i),e(i,l)}return l};var DY=Se.pathMatches=function(l,t,e){if(l.length!=t.length)return!1;for(var n=0;n<l.length;n++)if(l[n]!==t[n]&&(!e||n!==l.length-1))return!1;return!0};Se.append=function(l,t){if(t=sn(t),l.length===0){l.push(t);return}var e=l[l.length-1];if((t.si!=null||t.sd!=null)&&(e.si!=null||e.sd!=null)&&(Yr(t),Yr(e)),DY(t.p,e.p))if(t.t&&e.t&&t.t===e.t&&Hn[t.t]){if(e.o=Hn[t.t].compose(e.o,t.o),t.si!=null||t.sd!=null){for(var n=t.p,i=0;i<e.o.length-1;i++)t.o=[e.o.pop()],t.p=n.slice(),Fr(t),l.push(t);Fr(e)}}else e.na!=null&&t.na!=null?l[l.length-1]={p:e.p,na:e.na+t.na}:e.li!==void 0&&t.li===void 0&&t.ld===e.li?e.ld!==void 0?delete e.li:l.pop():e.od!==void 0&&e.oi===void 0&&t.oi!==void 0&&t.od===void 0?e.oi=t.oi:e.oi!==void 0&&t.od!==void 0?t.oi!==void 0?e.oi=t.oi:e.od!==void 0?delete e.oi:l.pop():t.lm!==void 0&&t.p[t.p.length-1]===t.lm||l.push(t);else(t.si!=null||t.sd!=null)&&(e.si!=null||e.sd!=null)&&(Fr(t),Fr(e)),l.push(t)};Se.compose=function(l,t){Se.checkValidOp(l),Se.checkValidOp(t);for(var e=sn(l),n=0;n<t.length;n++)Se.append(e,t[n]);return e};Se.normalize=function(l){var t=[];l=wo(l)?l:[l];for(var e=0;e<l.length;e++){var n=l[e];n.p==null&&(n.p=[]),Se.append(t,n)}return t};Se.commonLengthForOps=function(l,t){var e=l.p.length,n=t.p.length;if((l.na!=null||l.t)&&e++,(t.na!=null||t.t)&&n++,e===0)return-1;if(n===0)return null;e--,n--;for(var i=0;i<e;i++){var r=l.p[i];if(i>=n||r!==t.p[i])return null}return e};Se.canOpAffectPath=function(l,t){return Se.commonLengthForOps({p:t},l)!=null};Se.transformComponent=function(l,t,e,n){t=sn(t);var i=Se.commonLengthForOps(e,t),r=Se.commonLengthForOps(t,e),s=t.p.length,o=e.p.length;if((t.na!=null||t.t)&&s++,(e.na!=null||e.t)&&o++,r!=null&&o>s&&t.p[r]==e.p[r]){if(t.ld!==void 0){var a=sn(e);a.p=a.p.slice(s),t.ld=Se.apply(sn(t.ld),[a])}else if(t.od!==void 0){var a=sn(e);a.p=a.p.slice(s),t.od=Se.apply(sn(t.od),[a])}}if(i!=null){var c=s==o,a=e;if((t.si!=null||t.sd!=null)&&(e.si!=null||e.sd!=null)&&(Yr(t),a=sn(e),Yr(a)),a.t&&Hn[a.t]){if(t.t&&t.t===a.t){var u=Hn[t.t].transform(t.o,a.o,n);if(t.si!=null||t.sd!=null)for(var d=t.p,h=0;h<u.length;h++)t.o=[u[h]],t.p=d.slice(),Fr(t),Se.append(l,t);else(!wo(u)||u.length>0)&&(t.o=u,Se.append(l,t));return l}}else if(e.na===void 0){if(e.li!==void 0&&e.ld!==void 0){if(e.p[i]===t.p[i])if(c){if(t.ld!==void 0)if(t.li!==void 0&&n==="left")t.ld=sn(e.li);else return l}else return l}else if(e.li!==void 0)t.li!==void 0&&t.ld===void 0&&c&&t.p[i]===e.p[i]?n==="right"&&t.p[i]++:e.p[i]<=t.p[i]&&t.p[i]++,t.lm!==void 0&&c&&e.p[i]<=t.lm&&t.lm++;else if(e.ld!==void 0){if(t.lm!==void 0&&c){if(e.p[i]===t.p[i])return l;var d=e.p[i],f=t.p[i],p=t.lm;(d<p||d===p&&f<p)&&t.lm--}if(e.p[i]<t.p[i])t.p[i]--;else if(e.p[i]===t.p[i]){if(o<s)return l;if(t.ld!==void 0)if(t.li!==void 0)delete t.ld;else return l}}else if(e.lm!==void 0)if(t.lm!==void 0&&s===o){var f=t.p[i],p=t.lm,g=e.p[i],m=e.lm;if(g!==m)if(f===g)if(n==="left")t.p[i]=m,f===p&&(t.lm=m);else return l;else f>g&&t.p[i]--,f>m?t.p[i]++:f===m&&g>m&&(t.p[i]++,f===p&&t.lm++),(p>g||p===g&&p>f)&&t.lm--,p>m?t.lm++:p===m&&(m>g&&p>f||m<g&&p<f?n==="right"&&t.lm++:p>f?t.lm++:p===g&&t.lm--)}else if(t.li!==void 0&&t.ld===void 0&&c){var f=e.p[i],p=e.lm;d=t.p[i],d>f&&t.p[i]--,d>p&&t.p[i]++}else{var f=e.p[i],p=e.lm;d=t.p[i],d===f?t.p[i]=p:(d>f&&t.p[i]--,(d>p||d===p&&f>p)&&t.p[i]++)}else if(e.oi!==void 0&&e.od!==void 0){if(t.p[i]===e.p[i])if(t.oi!==void 0&&c){if(n==="right")return l;t.od=e.oi}else return l}else if(e.oi!==void 0){if(t.oi!==void 0&&t.p[i]===e.p[i])if(n==="left")Se.append(l,{p:t.p,od:e.oi});else return l}else if(e.od!==void 0&&t.p[i]==e.p[i]){if(!c)return l;if(t.oi!==void 0)delete t.od;else return l}}}return Se.append(l,t),l};Uh(Se,Se.transformComponent,Se.checkValidOp,Se.append);var RY=jh.exports;Se.registerSubtype(RY);var MY=Se,Qi={type:MY};class Hu extends zi{constructor(e){super();y(this,"engine");y(this,"type",null);y(this,"data");this.engine=e,this.create()}create(e=this.engine?An(this.engine.container):[]){this.data=e}apply(e,n){var i;if(e.length>0)try{this.data=Qi.type.apply(this.data,e),n&&n(void 0)}catch(r){n?n(r):(i=this.engine)==null||i.messageError("ot",r)}}submitOp(e,n,i){this.apply(e,i)}destroy(){delete this.data}}class LY{constructor(t){y(this,"engine");y(this,"getElementFromPath",(t,e)=>{ft(t)&&(t=t[0]);const n=e[0];if(n===Fe.ATTRIBUTE)return{startNode:t,startOffset:n,endNode:t,endOffset:n};const i=n-Fe.ELEMENT;if(t instanceof Element&&t.hasAttribute(Ct)){const{card:a}=this.engine,c=a.find(t);c&&(c.getCenter().empty(),a.renderComponent(c))}const r=[];t.childNodes.forEach(a=>{ci(a)||r.push(a)});const s=r[i],o=e[1];return e.length===1||o===Fe.TAG_NAME||o===Fe.ATTRIBUTE||s instanceof Text?{startNode:s,startOffset:i,endNode:t,endOffset:o||0}:this.getElementFromPath(s,e.slice(1))});this.engine=t}fromRemoteAttr(t){var c,u,d,h,f,p,g,m,v,b,_;if(!t)return;const{id:e,leftText:n,rightText:i}=t,r=(c=this.engine.container.get())==null?void 0:c.querySelector(`[${we}="${e}"]`);if(!r)return;const s=r.textContent||"";if(s==="")return{container:r,offset:0};if(s!=null&&s.startsWith(n)){let x=r.firstChild,w=n.length;for(;x&&(x.nodeType!==3||(((u=x.textContent)==null?void 0:u.length)||0)<w);)(((d=x.textContent)==null?void 0:d.length)||0)<w?(w-=((h=x.textContent)==null?void 0:h.length)||0,x=x.nextSibling):x=x.firstChild;return{container:x,offset:w}}if(s!=null&&s.endsWith(i)){let x=i.length,w=r.lastChild;for(;w&&(w.nodeType!==3||(((f=w.textContent)==null?void 0:f.length)||0)<x);)((p=w.textContent)==null?void 0:p.length)||0<x?(x-=((g=w==null?void 0:w.textContent)==null?void 0:g.length)||0,w=w.previousSibling):w=w.lastChild;return{container:w,offset:((m=w==null?void 0:w.textContent)==null?void 0:m.length)||0-x}}let o=0;for(;s[o]===n[o];)o++;let a=r.firstChild;for(;a&&(a.nodeType!==3||(((v=a.textContent)==null?void 0:v.length)||0)<o);)((b=a.textContent)==null?void 0:b.length)||0<o?(o-=((_=a.textContent)==null?void 0:_.length)||0,a=a.nextSibling):a=a.firstChild;return{container:a,offset:o}}getSideText(t,e){const n=this.engine.block.closest(t);if(n.length>0){const i=n.attributes(we),r=Te.create(this.engine),s=Te.create(this.engine);return r.setStart(n[0],0),r.setEnd(t[0],e),s.setStart(t[0],e),s.setEnd(n[0],n[0].childNodes.length),{id:i,leftText:r.toString(),rightText:s.toString()}}}setAttribute(t,e,n,i,r){var c;const{card:s}=this.engine,{startNode:o}=this.getElementFromPath(t,e),a=I(o);if(a&&a.length>0&&!a.isRoot()&&(n=Eh(n),i=ho(i),(c=a.get())==null||c.setAttribute(n,i),a.isCard())){const u=s.find(a);if(!u)return;u.isEditable||s.reRender(u),u.isEditable&&u.onChange&&u.onChange(r?"remote":"local",a)}return a}removeAttribute(t,e,n){var s;const{startNode:i}=this.getElementFromPath(t,e),r=I(i);return r.length>0&&!r.isRoot()&&((s=r.get())==null||s.removeAttribute(n)),r}insertNode(t,e,n,i){var u,d;const{engine:r}=this,{startNode:s,endNode:o}=this.getElementFromPath(t,e),a=I(s),c=I(o);if(c.length>0&&!a.isRoot()&&(!t.isCard()||t.isEditableCard()&&(a.length===0||a.closest(ze).isEditable()))){const h=typeof n=="string"?document.createTextNode(n):Cl(n);a&&a.parent()?(u=c.get())==null||u.insertBefore(h,a.get()):(d=c.get())==null||d.insertBefore(h,null);const f=I(h);return f.isCard()&&f.attributes(Ct,i?"remote":"true"),r.card.render(f),f}}deleteNode(t,e,n){const{card:i}=this.engine,{startNode:r}=this.getElementFromPath(t,e),s=I(r);if(s.length>0&&!s.isRoot()){const o=s.parent();return s.isCard()?n?i.removeRemote(s):i.remove(s,!1):s.remove(),o!=null&&o.isRoot()?void 0:o}}insertText(t,e,n,i){var u;const{startNode:r,endNode:s}=this.getElementFromPath(t,e),o=I(r);if(r&&!o.isText())return;const a=r&&r.nodeValue?r.nodeValue:"",c=a.substring(0,n)+i+a.substring(n);if(r&&r.parentNode===s)r.nodeValue=c;else if(c){const d=document.createTextNode(c);((u=s.firstChild)==null?void 0:u.nodeName)==="BR"&&s.firstChild.remove(),s.insertBefore(d,s.firstChild)}return o}deleteText(t,e,n,i){const{startNode:r}=this.getElementFromPath(t,e),s=I(r);if(!s.isText())return;const o=r&&r.nodeValue?r.nodeValue:"",a=o.substring(0,n)+o.substring(n+i.length);return r.nodeValue=a,s}handleOperation(t,e){let n=t.p,i,r;if(n.length!==0){let s=this.engine.container;if("id"in t&&t.id&&t.bi&&t.bi>-1){const o=this.engine.container.find(`[${we}="${t.id}"]`);o.length>0&&o.inEditor()&&(s=o,n=n.slice(t.bi))}return("si"in t||"sd"in t)&&(r=n[n.length-1],n=n.slice(0,-1)),("oi"in t||"od"in t)&&(i=n[n.length-1].toString(),n=n.slice(0,-1)),"oi"in t?this.setAttribute(s,n,i,t.oi,e):"od"in t?this.removeAttribute(s,n,i):"sd"in t?this.deleteText(s,n,r,t.sd):"si"in t?this.insertText(s,n,r,t.si):"ld"in t?this.deleteNode(s,n,e):"li"in t?this.insertNode(s,n,t.li,e):void 0}}handleRemoteOperations(t){try{const e=this.getRangeRemotePath(),n=[];return t.forEach(i=>{const r=this.handleOperation(i,!0);r&&n.push(r)}),e&&this.engine.isFocus()&&this.setRangeByRemotePath(e),this.engine.change.change(!0,n),n}catch(e){return this.engine.messageError("ot",e),[]}}handleSelfOperations(t){const e=[];return t.forEach(n=>{const i=this.handleOperation(n);i&&e.push(i)}),this.engine.change.change(!1,e),e}setRangeAfterOp(t){const{engine:e}=this;let n,i=t.p;("si"in t||"sd"in t)&&(n=i[i.length-1],i=i.slice(0,-1)),("oi"in t||"od"in t)&&(i=i.slice(0,-1));let r=this.engine.container;if("id"in t&&t.id&&t.bi&&t.bi>-1){const c=this.engine.container.find(`[${we}="${t.id}"]`);c.inEditor()&&(r=c,i=i.slice(t.bi))}const{startNode:s,endNode:o}=this.getElementFromPath(r,i),a=Te.create(this.engine);if("si"in t||"sd"in t){const c=s.data===""?o:s,u=t,d=n+(u.si?u.si.length:0);a.setOffset(c,d,d),e.change.range.select(a);return}a.select(s||o.lastChild||o,!0).shrinkToElementNode().collapse(!1),e.change.range.select(a)}getRangeRemotePath(){var t;try{if(((t=window.getSelection())==null?void 0:t.rangeCount)===0)return;const e=Te.from(this.engine);if(!e||e.inCard())return;e.startNode.isRoot()&&e.shrinkToElementNode();const{startNode:n,startOffset:i,endNode:r,endOffset:s}=e;return{start:this.getSideText(n,i),end:this.getSideText(r,s)}}catch(e){this.engine.messageError("ot",e);return}}setRangeByRemotePath(t){var e;try{const n=window.getSelection(),i=n?(e=Te.from(this.engine,n))==null?void 0:e.cloneRange():void 0;if(!i)return;const{start:r,end:s}=t;let o,a;r&&(o=this.fromRemoteAttr(r)),s&&(a=this.fromRemoteAttr(s)),o&&o.container&&i.setStart(o.container,o.offset),a&&a.container&&i.setEnd(a.container,a.offset),this.engine.change.range.select(i,!1)}catch(n){this.engine.messageError("ot",n)}}setRangeByPath(t){if(t){let{start:e,end:n}=t;if(e&&n){const i=e.path[e.path.length-1],r=n.path[n.path.length-1],s=e.path.slice(),o=n.path.slice();s.pop(),o.pop();const{container:a,change:c}=this.engine,u=e.id?a.find(`[${we}="${e.id}"]`).get():a.getChildByPath(s,f=>!ci(I(f)));if(!u)return;const d=n.id?a.find(`[${we}="${n.id}"]`).get():a.getChildByPath(o,f=>!ci(I(f)));if(!d)return;const h=(f,p)=>{if(f.nodeType===it().TEXT_NODE){const g=f.textContent||"";return g.length<p?g.length:p}else{const g=f.childNodes;return g.length<p?g.length:p}};try{const f=c.range.get();if(u.nodeName==="BR"||this.engine.node.isVoid(u)?f.select(u).collapse(!1):(f.setStart(u,h(u,i)),f.setEnd(d,h(d,r))),!f.collapsed){const p=this.engine.card.find(f.startNode,!0),g=this.engine.card.find(f.endNode,!0);if(p&&g&&(p==null?void 0:p.root.equal(g.root))){let m=f.startNode.closest(ze);m.length===0&&(m=f.startNode.find(ze));let v=f.endNode.closest(ze);v.length===0&&(v=f.endNode.find(ze)),m.length>0&&v.length>0&&!m.equal(v)&&f.collapse(!0)}}c.range.select(f),f.scrollRangeIntoView()}catch(f){this.engine.messageError("ot",f)}}}}}var Br={exports:{}};(function(l){var t=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},e=-1,n=1,i=0;t.Diff=function(r,s){return[r,s]},t.prototype.diff_main=function(r,s,o,a){typeof a>"u"&&(this.Diff_Timeout<=0?a=Number.MAX_VALUE:a=new Date().getTime()+this.Diff_Timeout*1e3);var c=a;if(r==null||s==null)throw new Error("Null input. (diff_main)");if(r==s)return r?[new t.Diff(i,r)]:[];typeof o>"u"&&(o=!0);var u=o,d=this.diff_commonPrefix(r,s),h=r.substring(0,d);r=r.substring(d),s=s.substring(d),d=this.diff_commonSuffix(r,s);var f=r.substring(r.length-d);r=r.substring(0,r.length-d),s=s.substring(0,s.length-d);var p=this.diff_compute_(r,s,u,c);return h&&p.unshift(new t.Diff(i,h)),f&&p.push(new t.Diff(i,f)),this.diff_cleanupMerge(p),p},t.prototype.diff_compute_=function(r,s,o,a){var c;if(!r)return[new t.Diff(n,s)];if(!s)return[new t.Diff(e,r)];var u=r.length>s.length?r:s,d=r.length>s.length?s:r,h=u.indexOf(d);if(h!=-1)return c=[new t.Diff(n,u.substring(0,h)),new t.Diff(i,d),new t.Diff(n,u.substring(h+d.length))],r.length>s.length&&(c[0][0]=c[2][0]=e),c;if(d.length==1)return[new t.Diff(e,r),new t.Diff(n,s)];var f=this.diff_halfMatch_(r,s);if(f){var p=f[0],g=f[1],m=f[2],v=f[3],b=f[4],_=this.diff_main(p,m,o,a),x=this.diff_main(g,v,o,a);return _.concat([new t.Diff(i,b)],x)}return o&&r.length>100&&s.length>100?this.diff_lineMode_(r,s,a):this.diff_bisect_(r,s,a)},t.prototype.diff_lineMode_=function(r,s,o){var a=this.diff_linesToChars_(r,s);r=a.chars1,s=a.chars2;var c=a.lineArray,u=this.diff_main(r,s,!1,o);this.diff_charsToLines_(u,c),this.diff_cleanupSemantic(u),u.push(new t.Diff(i,""));for(var d=0,h=0,f=0,p="",g="";d<u.length;){switch(u[d][0]){case n:f++,g+=u[d][1];break;case e:h++,p+=u[d][1];break;case i:if(h>=1&&f>=1){u.splice(d-h-f,h+f),d=d-h-f;for(var m=this.diff_main(p,g,!1,o),v=m.length-1;v>=0;v--)u.splice(d,0,m[v]);d=d+m.length}f=0,h=0,p="",g="";break}d++}return u.pop(),u},t.prototype.diff_bisect_=function(r,s,o){for(var a=r.length,c=s.length,u=Math.ceil((a+c)/2),d=u,h=2*u,f=new Array(h),p=new Array(h),g=0;g<h;g++)f[g]=-1,p[g]=-1;f[d+1]=0,p[d+1]=0;for(var m=a-c,v=m%2!=0,b=0,_=0,x=0,w=0,E=0;E<u&&!(new Date().getTime()>o);E++){for(var S=-E+b;S<=E-_;S+=2){var R=d+S,D;S==-E||S!=E&&f[R-1]<f[R+1]?D=f[R+1]:D=f[R-1]+1;for(var P=D-S;D<a&&P<c&&r.charAt(D)==s.charAt(P);)D++,P++;if(f[R]=D,D>a)_+=2;else if(P>c)b+=2;else if(v){var O=d+m-S;if(O>=0&&O<h&&p[O]!=-1){var L=a-p[O];if(D>=L)return this.diff_bisectSplit_(r,s,D,P,o)}}}for(var B=-E+x;B<=E-w;B+=2){var O=d+B,L;B==-E||B!=E&&p[O-1]<p[O+1]?L=p[O+1]:L=p[O-1]+1;for(var A=L-B;L<a&&A<c&&r.charAt(a-L-1)==s.charAt(c-A-1);)L++,A++;if(p[O]=L,L>a)w+=2;else if(A>c)x+=2;else if(!v){var R=d+m-B;if(R>=0&&R<h&&f[R]!=-1){var D=f[R],P=d+D-R;if(L=a-L,D>=L)return this.diff_bisectSplit_(r,s,D,P,o)}}}}return[new t.Diff(e,r),new t.Diff(n,s)]},t.prototype.diff_bisectSplit_=function(r,s,o,a,c){var u=r.substring(0,o),d=s.substring(0,a),h=r.substring(o),f=s.substring(a),p=this.diff_main(u,d,!1,c),g=this.diff_main(h,f,!1,c);return p.concat(g)},t.prototype.diff_linesToChars_=function(r,s){var o=[],a={};o[0]="";function c(f){for(var p="",g=0,m=-1,v=o.length;m<f.length-1;){m=f.indexOf(`
`,g),m==-1&&(m=f.length-1);var b=f.substring(g,m+1);(a.hasOwnProperty?a.hasOwnProperty(b):a[b]!==void 0)?p+=String.fromCharCode(a[b]):(v==u&&(b=f.substring(g),m=f.length),p+=String.fromCharCode(v),a[b]=v,o[v++]=b),g=m+1}return p}var u=4e4,d=c(r);u=65535;var h=c(s);return{chars1:d,chars2:h,lineArray:o}},t.prototype.diff_charsToLines_=function(r,s){for(var o=0;o<r.length;o++){for(var a=r[o][1],c=[],u=0;u<a.length;u++)c[u]=s[a.charCodeAt(u)];r[o][1]=c.join("")}},t.prototype.diff_commonPrefix=function(r,s){if(!r||!s||r.charAt(0)!=s.charAt(0))return 0;for(var o=0,a=Math.min(r.length,s.length),c=a,u=0;o<c;)r.substring(u,c)==s.substring(u,c)?(o=c,u=o):a=c,c=Math.floor((a-o)/2+o);return c},t.prototype.diff_commonSuffix=function(r,s){if(!r||!s||r.charAt(r.length-1)!=s.charAt(s.length-1))return 0;for(var o=0,a=Math.min(r.length,s.length),c=a,u=0;o<c;)r.substring(r.length-c,r.length-u)==s.substring(s.length-c,s.length-u)?(o=c,u=o):a=c,c=Math.floor((a-o)/2+o);return c},t.prototype.diff_commonOverlap_=function(r,s){var o=r.length,a=s.length;if(o==0||a==0)return 0;o>a?r=r.substring(o-a):o<a&&(s=s.substring(0,o));var c=Math.min(o,a);if(r==s)return c;for(var u=0,d=1;;){var h=r.substring(c-d),f=s.indexOf(h);if(f==-1)return u;d+=f,(f==0||r.substring(c-d)==s.substring(0,d))&&(u=d,d++)}},t.prototype.diff_halfMatch_=function(r,s){if(this.Diff_Timeout<=0)return null;var o=r.length>s.length?r:s,a=r.length>s.length?s:r;if(o.length<4||a.length*2<o.length)return null;var c=this;function u(_,x,w){for(var E=_.substring(w,w+Math.floor(_.length/4)),S=-1,R="",D,P,O,L;(S=x.indexOf(E,S+1))!=-1;){var B=c.diff_commonPrefix(_.substring(w),x.substring(S)),A=c.diff_commonSuffix(_.substring(0,w),x.substring(0,S));R.length<A+B&&(R=x.substring(S-A,S)+x.substring(S,S+B),D=_.substring(0,w-A),P=_.substring(w+B),O=x.substring(0,S-A),L=x.substring(S+B))}return R.length*2>=_.length?[D,P,O,L,R]:null}var d=u(o,a,Math.ceil(o.length/4)),h=u(o,a,Math.ceil(o.length/2)),f;if(!d&&!h)return null;h?d?f=d[4].length>h[4].length?d:h:f=h:f=d;var p,g,m,v;r.length>s.length?(p=f[0],g=f[1],m=f[2],v=f[3]):(m=f[0],v=f[1],p=f[2],g=f[3]);var b=f[4];return[p,g,m,v,b]},t.prototype.diff_cleanupSemantic=function(r){for(var s=!1,o=[],a=0,c=null,u=0,d=0,h=0,f=0,p=0;u<r.length;)r[u][0]==i?(o[a++]=u,d=f,h=p,f=0,p=0,c=r[u][1]):(r[u][0]==n?f+=r[u][1].length:p+=r[u][1].length,c&&c.length<=Math.max(d,h)&&c.length<=Math.max(f,p)&&(r.splice(o[a-1],0,new t.Diff(e,c)),r[o[a-1]+1][0]=n,a--,a--,u=a>0?o[a-1]:-1,d=0,h=0,f=0,p=0,c=null,s=!0)),u++;for(s&&this.diff_cleanupMerge(r),this.diff_cleanupSemanticLossless(r),u=1;u<r.length;){if(r[u-1][0]==e&&r[u][0]==n){var g=r[u-1][1],m=r[u][1],v=this.diff_commonOverlap_(g,m),b=this.diff_commonOverlap_(m,g);v>=b?(v>=g.length/2||v>=m.length/2)&&(r.splice(u,0,new t.Diff(i,m.substring(0,v))),r[u-1][1]=g.substring(0,g.length-v),r[u+1][1]=m.substring(v),u++):(b>=g.length/2||b>=m.length/2)&&(r.splice(u,0,new t.Diff(i,g.substring(0,b))),r[u-1][0]=n,r[u-1][1]=m.substring(0,m.length-b),r[u+1][0]=e,r[u+1][1]=g.substring(b),u++),u++}u++}},t.prototype.diff_cleanupSemanticLossless=function(r){function s(b,_){if(!b||!_)return 6;var x=b.charAt(b.length-1),w=_.charAt(0),E=x.match(t.nonAlphaNumericRegex_),S=w.match(t.nonAlphaNumericRegex_),R=E&&x.match(t.whitespaceRegex_),D=S&&w.match(t.whitespaceRegex_),P=R&&x.match(t.linebreakRegex_),O=D&&w.match(t.linebreakRegex_),L=P&&b.match(t.blanklineEndRegex_),B=O&&_.match(t.blanklineStartRegex_);return L||B?5:P||O?4:E&&!R&&D?3:R||D?2:E||S?1:0}for(var o=1;o<r.length-1;){if(r[o-1][0]==i&&r[o+1][0]==i){var a=r[o-1][1],c=r[o][1],u=r[o+1][1],d=this.diff_commonSuffix(a,c);if(d){var h=c.substring(c.length-d);a=a.substring(0,a.length-d),c=h+c.substring(0,c.length-d),u=h+u}for(var f=a,p=c,g=u,m=s(a,c)+s(c,u);c.charAt(0)===u.charAt(0);){a+=c.charAt(0),c=c.substring(1)+u.charAt(0),u=u.substring(1);var v=s(a,c)+s(c,u);v>=m&&(m=v,f=a,p=c,g=u)}r[o-1][1]!=f&&(f?r[o-1][1]=f:(r.splice(o-1,1),o--),r[o][1]=p,g?r[o+1][1]=g:(r.splice(o+1,1),o--))}o++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(r){for(var s=!1,o=[],a=0,c=null,u=0,d=!1,h=!1,f=!1,p=!1;u<r.length;)r[u][0]==i?(r[u][1].length<this.Diff_EditCost&&(f||p)?(o[a++]=u,d=f,h=p,c=r[u][1]):(a=0,c=null),f=p=!1):(r[u][0]==e?p=!0:f=!0,c&&(d&&h&&f&&p||c.length<this.Diff_EditCost/2&&d+h+f+p==3)&&(r.splice(o[a-1],0,new t.Diff(e,c)),r[o[a-1]+1][0]=n,a--,c=null,d&&h?(f=p=!0,a=0):(a--,u=a>0?o[a-1]:-1,f=p=!1),s=!0)),u++;s&&this.diff_cleanupMerge(r)},t.prototype.diff_cleanupMerge=function(r){r.push(new t.Diff(i,""));for(var s=0,o=0,a=0,c="",u="",d;s<r.length;)switch(r[s][0]){case n:a++,u+=r[s][1],s++;break;case e:o++,c+=r[s][1],s++;break;case i:o+a>1?(o!==0&&a!==0&&(d=this.diff_commonPrefix(u,c),d!==0&&(s-o-a>0&&r[s-o-a-1][0]==i?r[s-o-a-1][1]+=u.substring(0,d):(r.splice(0,0,new t.Diff(i,u.substring(0,d))),s++),u=u.substring(d),c=c.substring(d)),d=this.diff_commonSuffix(u,c),d!==0&&(r[s][1]=u.substring(u.length-d)+r[s][1],u=u.substring(0,u.length-d),c=c.substring(0,c.length-d))),s-=o+a,r.splice(s,o+a),c.length&&(r.splice(s,0,new t.Diff(e,c)),s++),u.length&&(r.splice(s,0,new t.Diff(n,u)),s++),s++):s!==0&&r[s-1][0]==i?(r[s-1][1]+=r[s][1],r.splice(s,1)):s++,a=0,o=0,c="",u="";break}r[r.length-1][1]===""&&r.pop();var h=!1;for(s=1;s<r.length-1;)r[s-1][0]==i&&r[s+1][0]==i&&(r[s][1].substring(r[s][1].length-r[s-1][1].length)==r[s-1][1]?(r[s][1]=r[s-1][1]+r[s][1].substring(0,r[s][1].length-r[s-1][1].length),r[s+1][1]=r[s-1][1]+r[s+1][1],r.splice(s-1,1),h=!0):r[s][1].substring(0,r[s+1][1].length)==r[s+1][1]&&(r[s-1][1]+=r[s+1][1],r[s][1]=r[s][1].substring(r[s+1][1].length)+r[s+1][1],r.splice(s+1,1),h=!0)),s++;h&&this.diff_cleanupMerge(r)},t.prototype.diff_xIndex=function(r,s){var o=0,a=0,c=0,u=0,d;for(d=0;d<r.length&&(r[d][0]!==n&&(o+=r[d][1].length),r[d][0]!==e&&(a+=r[d][1].length),!(o>s));d++)c=o,u=a;return r.length!=d&&r[d][0]===e?u:u+(s-c)},t.prototype.diff_prettyHtml=function(r){for(var s=[],o=/&/g,a=/</g,c=/>/g,u=/\n/g,d=0;d<r.length;d++){var h=r[d][0],f=r[d][1],p=f.replace(o,"&amp;").replace(a,"&lt;").replace(c,"&gt;").replace(u,"&para;<br>");switch(h){case n:s[d]='<ins style="background:#e6ffe6;">'+p+"</ins>";break;case e:s[d]='<del style="background:#ffe6e6;">'+p+"</del>";break;case i:s[d]="<span>"+p+"</span>";break}}return s.join("")},t.prototype.diff_text1=function(r){for(var s=[],o=0;o<r.length;o++)r[o][0]!==n&&(s[o]=r[o][1]);return s.join("")},t.prototype.diff_text2=function(r){for(var s=[],o=0;o<r.length;o++)r[o][0]!==e&&(s[o]=r[o][1]);return s.join("")},t.prototype.diff_levenshtein=function(r){for(var s=0,o=0,a=0,c=0;c<r.length;c++){var u=r[c][0],d=r[c][1];switch(u){case n:o+=d.length;break;case e:a+=d.length;break;case i:s+=Math.max(o,a),o=0,a=0;break}}return s+=Math.max(o,a),s},t.prototype.diff_toDelta=function(r){for(var s=[],o=0;o<r.length;o++)switch(r[o][0]){case n:s[o]="+"+encodeURI(r[o][1]);break;case e:s[o]="-"+r[o][1].length;break;case i:s[o]="="+r[o][1].length;break}return s.join("	").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(r,s){for(var o=[],a=0,c=0,u=s.split(/\t/g),d=0;d<u.length;d++){var h=u[d].substring(1);switch(u[d].charAt(0)){case"+":try{o[a++]=new t.Diff(n,decodeURI(h))}catch{throw new Error("Illegal escape in diff_fromDelta: "+h)}break;case"-":case"=":var f=parseInt(h,10);if(isNaN(f)||f<0)throw new Error("Invalid number in diff_fromDelta: "+h);var p=r.substring(c,c+=f);u[d].charAt(0)=="="?o[a++]=new t.Diff(i,p):o[a++]=new t.Diff(e,p);break;default:if(u[d])throw new Error("Invalid diff operation in diff_fromDelta: "+u[d])}}if(c!=r.length)throw new Error("Delta length ("+c+") does not equal source text length ("+r.length+").");return o},t.prototype.match_main=function(r,s,o){if(r==null||s==null||o==null)throw new Error("Null input. (match_main)");return o=Math.max(0,Math.min(o,r.length)),r==s?0:r.length?r.substring(o,o+s.length)==s?o:this.match_bitap_(r,s,o):-1},t.prototype.match_bitap_=function(r,s,o){if(s.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var a=this.match_alphabet_(s),c=this;function u(D,P){var O=D/s.length,L=Math.abs(o-P);return c.Match_Distance?O+L/c.Match_Distance:L?1:O}var d=this.Match_Threshold,h=r.indexOf(s,o);h!=-1&&(d=Math.min(u(0,h),d),h=r.lastIndexOf(s,o+s.length),h!=-1&&(d=Math.min(u(0,h),d)));var f=1<<s.length-1;h=-1;for(var p,g,m=s.length+r.length,v,b=0;b<s.length;b++){for(p=0,g=m;p<g;)u(b,o+g)<=d?p=g:m=g,g=Math.floor((m-p)/2+p);m=g;var _=Math.max(1,o-g+1),x=Math.min(o+g,r.length)+s.length,w=Array(x+2);w[x+1]=(1<<b)-1;for(var E=x;E>=_;E--){var S=a[r.charAt(E-1)];if(b===0?w[E]=(w[E+1]<<1|1)&S:w[E]=(w[E+1]<<1|1)&S|((v[E+1]|v[E])<<1|1)|v[E+1],w[E]&f){var R=u(b,E-1);if(R<=d)if(d=R,h=E-1,h>o)_=Math.max(1,2*o-h);else break}}if(u(b+1,o)>d)break;v=w}return h},t.prototype.match_alphabet_=function(r){for(var s={},o=0;o<r.length;o++)s[r.charAt(o)]=0;for(var o=0;o<r.length;o++)s[r.charAt(o)]|=1<<r.length-o-1;return s},t.prototype.patch_addContext_=function(r,s){if(s.length!=0){if(r.start2===null)throw Error("patch not initialized");for(var o=s.substring(r.start2,r.start2+r.length1),a=0;s.indexOf(o)!=s.lastIndexOf(o)&&o.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)a+=this.Patch_Margin,o=s.substring(r.start2-a,r.start2+r.length1+a);a+=this.Patch_Margin;var c=s.substring(r.start2-a,r.start2);c&&r.diffs.unshift(new t.Diff(i,c));var u=s.substring(r.start2+r.length1,r.start2+r.length1+a);u&&r.diffs.push(new t.Diff(i,u)),r.start1-=c.length,r.start2-=c.length,r.length1+=c.length+u.length,r.length2+=c.length+u.length}},t.prototype.patch_make=function(r,s,o){var a,c;if(typeof r=="string"&&typeof s=="string"&&typeof o>"u")a=r,c=this.diff_main(a,s,!0),c.length>2&&(this.diff_cleanupSemantic(c),this.diff_cleanupEfficiency(c));else if(r&&typeof r=="object"&&typeof s>"u"&&typeof o>"u")c=r,a=this.diff_text1(c);else if(typeof r=="string"&&s&&typeof s=="object"&&typeof o>"u")a=r,c=s;else if(typeof r=="string"&&typeof s=="string"&&o&&typeof o=="object")a=r,c=o;else throw new Error("Unknown call format to patch_make.");if(c.length===0)return[];for(var u=[],d=new t.patch_obj,h=0,f=0,p=0,g=a,m=a,v=0;v<c.length;v++){var b=c[v][0],_=c[v][1];switch(!h&&b!==i&&(d.start1=f,d.start2=p),b){case n:d.diffs[h++]=c[v],d.length2+=_.length,m=m.substring(0,p)+_+m.substring(p);break;case e:d.length1+=_.length,d.diffs[h++]=c[v],m=m.substring(0,p)+m.substring(p+_.length);break;case i:_.length<=2*this.Patch_Margin&&h&&c.length!=v+1?(d.diffs[h++]=c[v],d.length1+=_.length,d.length2+=_.length):_.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(d,g),u.push(d),d=new t.patch_obj,h=0,g=m,f=p);break}b!==n&&(f+=_.length),b!==e&&(p+=_.length)}return h&&(this.patch_addContext_(d,g),u.push(d)),u},t.prototype.patch_deepCopy=function(r){for(var s=[],o=0;o<r.length;o++){var a=r[o],c=new t.patch_obj;c.diffs=[];for(var u=0;u<a.diffs.length;u++)c.diffs[u]=new t.Diff(a.diffs[u][0],a.diffs[u][1]);c.start1=a.start1,c.start2=a.start2,c.length1=a.length1,c.length2=a.length2,s[o]=c}return s},t.prototype.patch_apply=function(r,s){if(r.length==0)return[s,[]];r=this.patch_deepCopy(r);var o=this.patch_addPadding(r);s=o+s+o,this.patch_splitMax(r);for(var a=0,c=[],u=0;u<r.length;u++){var d=r[u].start2+a,h=this.diff_text1(r[u].diffs),f,p=-1;if(h.length>this.Match_MaxBits?(f=this.match_main(s,h.substring(0,this.Match_MaxBits),d),f!=-1&&(p=this.match_main(s,h.substring(h.length-this.Match_MaxBits),d+h.length-this.Match_MaxBits),(p==-1||f>=p)&&(f=-1))):f=this.match_main(s,h,d),f==-1)c[u]=!1,a-=r[u].length2-r[u].length1;else{c[u]=!0,a=f-d;var g;if(p==-1?g=s.substring(f,f+h.length):g=s.substring(f,p+this.Match_MaxBits),h==g)s=s.substring(0,f)+this.diff_text2(r[u].diffs)+s.substring(f+h.length);else{var m=this.diff_main(h,g,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(m)/h.length>this.Patch_DeleteThreshold)c[u]=!1;else{this.diff_cleanupSemanticLossless(m);for(var v=0,b,_=0;_<r[u].diffs.length;_++){var x=r[u].diffs[_];x[0]!==i&&(b=this.diff_xIndex(m,v)),x[0]===n?s=s.substring(0,f+b)+x[1]+s.substring(f+b):x[0]===e&&(s=s.substring(0,f+b)+s.substring(f+this.diff_xIndex(m,v+x[1].length))),x[0]!==e&&(v+=x[1].length)}}}}}return s=s.substring(o.length,s.length-o.length),[s,c]},t.prototype.patch_addPadding=function(r){for(var s=this.Patch_Margin,o="",a=1;a<=s;a++)o+=String.fromCharCode(a);for(var a=0;a<r.length;a++)r[a].start1+=s,r[a].start2+=s;var c=r[0],u=c.diffs;if(u.length==0||u[0][0]!=i)u.unshift(new t.Diff(i,o)),c.start1-=s,c.start2-=s,c.length1+=s,c.length2+=s;else if(s>u[0][1].length){var d=s-u[0][1].length;u[0][1]=o.substring(u[0][1].length)+u[0][1],c.start1-=d,c.start2-=d,c.length1+=d,c.length2+=d}if(c=r[r.length-1],u=c.diffs,u.length==0||u[u.length-1][0]!=i)u.push(new t.Diff(i,o)),c.length1+=s,c.length2+=s;else if(s>u[u.length-1][1].length){var d=s-u[u.length-1][1].length;u[u.length-1][1]+=o.substring(0,d),c.length1+=d,c.length2+=d}return o},t.prototype.patch_splitMax=function(r){for(var s=this.Match_MaxBits,o=0;o<r.length;o++)if(!(r[o].length1<=s)){var a=r[o];r.splice(o--,1);for(var c=a.start1,u=a.start2,d="";a.diffs.length!==0;){var h=new t.patch_obj,f=!0;for(h.start1=c-d.length,h.start2=u-d.length,d!==""&&(h.length1=h.length2=d.length,h.diffs.push(new t.Diff(i,d)));a.diffs.length!==0&&h.length1<s-this.Patch_Margin;){var p=a.diffs[0][0],g=a.diffs[0][1];p===n?(h.length2+=g.length,u+=g.length,h.diffs.push(a.diffs.shift()),f=!1):p===e&&h.diffs.length==1&&h.diffs[0][0]==i&&g.length>2*s?(h.length1+=g.length,c+=g.length,f=!1,h.diffs.push(new t.Diff(p,g)),a.diffs.shift()):(g=g.substring(0,s-h.length1-this.Patch_Margin),h.length1+=g.length,c+=g.length,p===i?(h.length2+=g.length,u+=g.length):f=!1,h.diffs.push(new t.Diff(p,g)),g==a.diffs[0][1]?a.diffs.shift():a.diffs[0][1]=a.diffs[0][1].substring(g.length))}d=this.diff_text2(h.diffs),d=d.substring(d.length-this.Patch_Margin);var m=this.diff_text1(a.diffs).substring(0,this.Patch_Margin);m!==""&&(h.length1+=m.length,h.length2+=m.length,h.diffs.length!==0&&h.diffs[h.diffs.length-1][0]===i?h.diffs[h.diffs.length-1][1]+=m:h.diffs.push(new t.Diff(i,m))),f||r.splice(++o,0,h)}}},t.prototype.patch_toText=function(r){for(var s=[],o=0;o<r.length;o++)s[o]=r[o];return s.join("")},t.prototype.patch_fromText=function(r){var s=[];if(!r)return s;for(var o=r.split(`
`),a=0,c=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<o.length;){var u=o[a].match(c);if(!u)throw new Error("Invalid patch string: "+o[a]);var d=new t.patch_obj;for(s.push(d),d.start1=parseInt(u[1],10),u[2]===""?(d.start1--,d.length1=1):u[2]=="0"?d.length1=0:(d.start1--,d.length1=parseInt(u[2],10)),d.start2=parseInt(u[3],10),u[4]===""?(d.start2--,d.length2=1):u[4]=="0"?d.length2=0:(d.start2--,d.length2=parseInt(u[4],10)),a++;a<o.length;){var h=o[a].charAt(0);try{var f=decodeURI(o[a].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+f)}if(h=="-")d.diffs.push(new t.Diff(e,f));else if(h=="+")d.diffs.push(new t.Diff(n,f));else if(h==" ")d.diffs.push(new t.Diff(i,f));else{if(h=="@")break;if(h!=="")throw new Error('Invalid patch mode "'+h+'" in: '+f)}a++}}return s},t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},t.patch_obj.prototype.toString=function(){var r,s;this.length1===0?r=this.start1+",0":this.length1==1?r=this.start1+1:r=this.start1+1+","+this.length1,this.length2===0?s=this.start2+",0":this.length2==1?s=this.start2+1:s=this.start2+1+","+this.length2;for(var o=["@@ -"+r+" +"+s+` @@
`],a,c=0;c<this.diffs.length;c++){switch(this.diffs[c][0]){case n:a="+";break;case e:a="-";break;case i:a=" ";break}o[c+1]=a+encodeURI(this.diffs[c][1])+`
`}return o.join("").replace(/%20/g," ")},l.exports=t,l.exports.diff_match_patch=t,l.exports.DIFF_DELETE=e,l.exports.DIFF_INSERT=n,l.exports.DIFF_EQUAL=i})(Br);class IY extends zi{constructor(e,n){super();y(this,"engine");y(this,"doc");y(this,"dmp");y(this,"timer",null);y(this,"lineStart",!1);y(this,"handleFirstLineText",(e,n,i,r,s,o=!1)=>{const a=[],c=s[0],u=typeof c=="string",d=e==="root"?"":e,h=e==="root"?-1:n;if(u&&r!==c){const f=this.textToOps(i,c,r);for(let p=0;p<f.length;p++)a.push(Object.assign({},f[p],{id:d,bi:h,nl:o}))}for(let f=s.length-1;f>=(u?1:0);f--){const p=s[f],g=i.concat();g[g.length-1]=f+Fe.ELEMENT,a.push({id:d,nl:o,bi:h,p:g,ld:p})}return u||a.push({id:d,nl:o,bi:h,p:i,li:r}),a});y(this,"isLoadingCard",e=>{var n;if(e.length>Fe.ATTRIBUTE&&!Array.isArray(e[1])&&typeof e[1]=="object"){const i=e[Fe.ATTRIBUTE],r=i[ke],s=i[pt],o=i[we];if(r&&s&&o){const a=(n=this.engine.container.get())==null?void 0:n.querySelector(`[${we}="${o}"]`);if(a!=null&&a.getAttribute(Ct))return!0}}return!1});y(this,"handleChildren",(e,n,i,r,s,o=!1)=>{const a=[],c=e==="root"?"":e,u=e==="root"?-1:n;if(r.length===0)for(let d=0;d<s.length;d++)a.push({id:e,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),li:s[d]});else if(s.length===0)for(let d=r.length-1;d>=0;d--)a.push({id:c,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),ld:r[d]});else if(s.length===1&&typeof s[0]=="string")a.push(...this.handleFirstLineText(e,u,i.concat(Fe.ELEMENT),s[0],r,o));else if(s.every(d=>Array.isArray(d)?d[Fe.ATTRIBUTE][we]:!1)&&r.every(d=>Array.isArray(d)?d[Fe.ATTRIBUTE][we]:!1)){for(let d=r.length-1;d>=0;d--){const h=r[d];s.find(p=>p[Fe.ATTRIBUTE][we]===h[Fe.ATTRIBUTE][we])||(a.push({id:c,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),ld:h}),r.splice(d,1))}for(let d=0;d<s.length;d++){const h=s[d],f=r.find(p=>p[Fe.ATTRIBUTE][we]===h[Fe.ATTRIBUTE][we]);if(!f)a.push({id:e,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),li:h}),r.splice(d,0,h);else if(!Bt(h,f)){const p=h[Fe.ATTRIBUTE],g=f[Fe.ATTRIBUTE],m=i.concat(d+Fe.ELEMENT);a.push(...this.handleAttributes(e,u,m,g,p,o)),a.push(...this.handleChildren(e,u,m,f.slice(Fe.ELEMENT),h.slice(Fe.ELEMENT),o))}}}else{if(r.length>s.length)for(let d=r.length-1;d>=s.length;d--)a.push({id:c,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),ld:r[d]});for(let d=0;d<s.length;d++){const h=s[d],f=r[d];if(!f)a.push({id:e,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),li:h});else if(!Bt(h,f))if(typeof h!="string"&&typeof h==typeof f&&h[Fe.TAG_NAME]===f[Fe.TAG_NAME]){const p=h[Fe.ATTRIBUTE],g=f[Fe.ATTRIBUTE],m=i.concat(d+Fe.ELEMENT);a.push(...this.handleAttributes(e,u,m,g,p,o)),a.push(...this.handleChildren(e,u,m,f.slice(Fe.ELEMENT),h.slice(Fe.ELEMENT),o))}else a.push({id:c,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),ld:f}),a.push({id:e,nl:o,bi:u,p:i.concat(d+Fe.ELEMENT),li:h})}}return a});this.engine=e,this.doc=n.doc,this.dmp=new Br.exports.diff_match_patch}setDoc(e){this.doc=e}textToOps(e,n,i){const r=[],s=this.dmp.patch_make(n,i);return Object.keys(s).forEach(o=>{const a=s[o];if(a.start1===null)return;let c=a.start1;a.diffs.forEach(u=>{const[d,h]=u;if(d!==Br.exports.DIFF_DELETE)if(d!==Br.exports.DIFF_INSERT)d===Br.exports.DIFF_EQUAL&&(c+=h.length);else{const f=[];r.push({si:h,p:f.concat([...e],[c])})}else{const f=[];r.unshift({sd:h,p:f.concat([...e],[c])})}})}),r}handleAttributes(e,n,i,r,s,o=!1){const a=[],c=e==="root"?"":e,u=e==="root"?-1:n;return Object.keys(s).forEach(d=>{const h=s[d],f=[...i,Fe.ATTRIBUTE,d];if(!r.hasOwnProperty(d)&&h!==r[d]){a.push({id:c,nl:o,bi:u,p:f,oi:h});return}const p=r[d];if(h!==p){let g=o;if(d===je){const m=at(h),v=this.engine.card.find(m.id);(v==null?void 0:v.writeHistoryOnValueChange)&&v.writeHistoryOnValueChange(m)===!1&&(g=!0)}a.push({id:c,nl:g,bi:u,p:f,od:p,oi:h})}}),Object.keys(r).forEach(d=>{s.hasOwnProperty(d)||a.push({id:c,nl:o,bi:u,p:i.concat(Fe.ATTRIBUTE,d),od:r[d]})}),a}handleMutations(e){var s;let n=[];const i=(s=this.doc)==null?void 0:s.data;if(!i||e.length===0)return;if(i.length===0)n.push(this.engine.container.get());else for(let o=0;o<e.length;o++){const a=e[o];if(!a)continue;const{type:c}=a;let u=a.target;const d=u instanceof Element&&hr(u);if(!(c==="attributes"&&(a.attributeName&&Mh(u,a.attributeName)||d))&&(u instanceof Text&&(u=u.parentElement),!(!u||!u.isConnected||!(u instanceof Element)||ci(u)))){if(d){n=[u];break}if(n.length===0||!n.includes(u)&&n.every(h=>!h.contains(u))){let h=n.length;for(let f=0;f<h;f++)u.contains(n[f])&&(n.splice(f,1),h--,f--);n.push(u)}}}if(n.length===0)return;const r=[];n.forEach(o=>{r.push(...this.diff(o,i))}),r.length>0&&this.emit("ops",r)}diff(e,n=(i=>(i=this.doc)==null?void 0:i.data)()||[]){const r=[];if(!e.isConnected)return[];let s=hr(e)?"root":e.getAttribute(we);if(!s){const p=this.engine.block.closest(I(e),g=>!!g.attributes(we)).get();if(!(p instanceof Element))return[];e=p,s=e.getAttribute(we)}if(!s)return[];const o=An(e);if(!o)return[];const a=s==="root",c=a?n:Sl(n,p=>p[we]===s);if(!c)return[];const{path:u}=c,d=this.isLoadingCard(o);if(s!=="root"){const p=o[Fe.ATTRIBUTE],g=c.attributes;r.push(...this.handleAttributes(s,u.length,u,g,p,d))}const h=o.slice(2),f=Array.isArray(c)?c.slice(2):c.children;return r.push(...this.handleChildren(a?"":s,a?-1:u.length,u!=null?u:[],f,h,d)),r}}const OY={childList:!0,subtree:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0};class FY extends zi{constructor(e,n){super();y(this,"node");y(this,"engine");y(this,"doc");y(this,"isStopped");y(this,"observer");y(this,"producer");y(this,"isCache",!1);y(this,"cache",[]);this.node=e,this.isStopped=!0,this.engine=n.engine,this.doc=n.doc,this.producer=new IY(this.engine,{doc:this.doc}),this.observer=new MutationObserver(i=>{this.isCache&&this.cache.push(...i),!this.isStopped&&!this.isCache&&this.producer.handleMutations(i)}),this.producer.on("ops",i=>{this.onChange(i)})}setDoc(e){this.doc=e,this.producer.setDoc(e)}start(){this.isStopped&&(this.observer.observe(this.node[0],OY),this.isStopped=!1)}stop(){this.isStopped||(this.observer.disconnect(),this.isStopped=!0)}startCache(){this.isCache||(this.cache=[],this.isCache=!0)}submitCache(){this.isCache&&setTimeout(()=>{this.engine.change.isComposing()||(this.isCache=!1,this.cache=this.cache.map(e=>(e.type==="characterData"&&e.target.nodeType===document.TEXT_NODE&&(e["text-data"]=e.target.textContent),e)),this.cache.length>0&&this.producer.handleMutations(this.cache),this.cache=[])},20)}destroyCache(){this.isCache&&setTimeout(()=>{this.isCache=!1,this.cache=[]},20)}getCaches(){return this.cache}onChange(e){this.isStopped||this.emit("onChange",e)}diff(e=this.engine.container.get()){var n;return this.producer.diff(e,(n=this.doc)==null?void 0:n.data)}}class BY extends zi{constructor(e){super();y(this,"engine");y(this,"members");y(this,"currentMember");y(this,"clientId");y(this,"selection");y(this,"consumer");y(this,"mutation");y(this,"doc",null);y(this,"isRemote",!1);y(this,"debounceRefreshAttributes");y(this,"colors",["#597EF7","#73D13D","#FF4D4F","#9254DE","#36CFC9","#FFA940","#F759AB","#40A9FF"]);y(this,"handleChange",e=>{const n=this.engine.trigger("opsChange",e);n&&(e=n),this.submitOps(e);const{history:i,change:r}=this.engine;i.handleSelfOps(e.filter(s=>(s.nl===!0&&s.p[s.p.length-1]===je&&i.handleNLCardValue(s),!s.nl&&!s.p.includes(We)))),this.engine.trigger("ops",e),e.find(s=>("od"in s||"oi"in s)&&s.p.includes(je))&&r.change(!1)});this.engine=e,this.members=[],this.selection=new CY(e),this.consumer=new LY(e),this.mutation=new FY(e.container,{engine:e}),this.mutation.on("onChange",this.handleChange),this.clientId=Zr(8),this.debounceRefreshAttributes=bo(n=>{this.selection.refreshAttributes(...this.members.filter(i=>n.includes(i.uuid)))},200)}get isCache(){var e,n;return(n=(e=this.mutation)==null?void 0:e.isCache)!=null?n:!1}initLocal(){var e;this.doc||(this.stopMutation(),this.doc=new Hu(this.engine),(e=this.mutation)==null||e.setDoc(this.doc),this.engine.readonly||this.startMutation())}initRemote(e,n,i){var s;const r=!this.doc||this.doc.type===null;this.stopMutation(),r||this.doc.destroy(),this.isRemote=!0,this.doc=e,(s=this.mutation)==null||s.setDoc(e),this.syncValue(n),e.on("op",(o,a)=>{if(this.clientId!==a.toString()){const c=TK(o);c.length>0&&(this.apply(c),this.engine.history.handleRemoteOps(c))}}),this.selection.removeAllListeners(),this.selection.on("change",o=>{i&&i(o)}),this.engine.readonly||this.startMutation(),r&&this.emit("load")}submitOps(e){if(!this.doc||e.length===0)return;e.forEach(r=>{var s;r.uid=(s=this.currentMember)==null?void 0:s.uuid});const n=new Hu,i=JSON.parse(JSON.stringify(this.doc.data));n.create(i),n.submitOp(e,null,r=>{if(n.destroy(),!!this.doc){if(r){this.engine.messageError("ot","If there is an error in the collaborative structure, the content of the server will be reset, and the current history will also be cleared.",r,e,i),this.engine.history.clear();const s=[],o=this.doc.data;for(let u=o.length-1;u>1;u--){const d=o[u];s.push({bi:-1,id:"",ld:d,p:[u],nl:void 0})}const a=[],c=An(this.engine.container)||[];for(let u=2;u<c.length;u++){const d=c[u];a.push({bi:-1,id:"",li:d,p:[u],nl:void 0})}this.doc.submitOp(s.concat(a),{source:this.clientId}),this.selection.emitSelectChange(!0);return}this.doc.submitOp(e,{source:this.clientId},s=>{var o,a;s&&(this.engine.messageError("ot","SubmitOps Error:",s,"OPS:",e,"DATA:",(o=this.doc)==null?void 0:o.data),(a=this.doc)==null||a.destroy()),this.selection.emitSelectChange(!0)})}})}diff(e=this.engine.container.get()){var n;return((n=this.mutation)==null?void 0:n.diff(e))||[]}apply(e){this.stopMutation(),this.consumer.handleRemoteOperations(e),this.selection.emitSelectChange();const n=[];e.forEach(i=>{"uid"in i&&n.push(i.uid)}),setTimeout(()=>{this.debounceRefreshAttributes(n)},0),this.startMutation()}syncValue(e){const{doc:n,engine:i}=this;if(!!n){if(n.type&&Array.isArray(n.data)&&n.data.length>2){this.engine.setJsonValue(n.data);return}e&&i.setValue(e),n.on("create",()=>{const r=An(i.container);n.submitOp([{p:[],oi:r}],{source:this.clientId})})}}startMutation(){this.mutation&&this.mutation.start()}stopMutation(){this.mutation&&this.mutation.stop()}isStopped(){var e,n;return(n=(e=this.mutation)==null?void 0:e.isStopped)!=null?n:!1}startMutationCache(){this.mutation&&this.mutation.startCache()}submitMutationCache(){this.mutation&&this.mutation.submitCache()}destroyMutationCache(){this.mutation&&this.mutation.destroyCache()}getCaches(){var e;return((e=this.mutation)==null?void 0:e.getCaches())||[]}getColors(){return this.colors}setColors(e){this.colors=e}setMemberColor(e){let n=e.index||this.members.length+1;n=(n-1)%this.colors.length,e.color=this.colors[n]}getMembers(){return Ut(this.members)}setMembers(e){e=Ut(e),e.forEach(n=>{this.setMemberColor(n)}),this.members=e}addMember(e){e=Ut(e),this.setMemberColor(e),this.members.find(n=>n.uuid===e.uuid)||this.members.push(e)}removeMember(e){e=Ut(e),e.uuid&&(this.members=this.members.filter(n=>n.uuid!==e.uuid),this.selection.removeAttirbute(e.uuid))}setCurrentMember(e){e=Ut(e),this.setMemberColor(e);const n=this.members.find(i=>i.uuid===e.uuid);!n||(this.currentMember=n,this.selection.setCurrent(n))}getCurrentMember(){return this.currentMember}renderSelection(e){Array.isArray(e)||(e=[e]),e.forEach(n=>{if(this.currentMember&&n.uuid===this.currentMember.uuid)return;const i=this.members.find(r=>r.uuid===n.uuid);"remove"in n||!i?this.selection.removeAttirbute(n.uuid):this.selection.setAttribute(n,i)})}destroy(){var e,n;this.doc&&this.doc.destroy(),this.selection.destory(),(e=this.mutation)==null||e.off("onChange",this.handleChange),(n=this.mutation)==null||n.destroyCache(),this.stopMutation(),this.mutation=null}}function $Y(l,t,e,n){for(var i=l.length,r=e+(n?1:-1);n?r--:++r<i;)if(t(l[r],r,l))return r;return-1}var PY=$Y,zY=il,qY=El,HY=1,WY=2;function UY(l,t,e,n){var i=e.length,r=i,s=!n;if(l==null)return!r;for(l=Object(l);i--;){var o=e[i];if(s&&o[2]?o[1]!==l[o[0]]:!(o[0]in l))return!1}for(;++i<r;){o=e[i];var a=o[0],c=l[a],u=o[1];if(s&&o[2]){if(c===void 0&&!(a in l))return!1}else{var d=new zY;if(n)var h=n(c,u,a,l,t,d);if(!(h===void 0?qY(u,c,HY|WY,n,d):h))return!1}}return!0}var jY=UY,VY=Bi;function GY(l){return l===l&&!VY(l)}var Vh=GY,ZY=Vh,KY=Lg;function XY(l){for(var t=KY(l),e=t.length;e--;){var n=t[e],i=l[n];t[e]=[n,i,ZY(i)]}return t}var YY=XY;function JY(l,t){return function(e){return e==null?!1:e[l]===t&&(t!==void 0||l in Object(e))}}var Gh=JY,QY=jY,eJ=YY,tJ=Gh;function nJ(l){var t=eJ(l);return t.length==1&&t[0][2]?tJ(t[0][0],t[0][1]):function(e){return e===l||QY(e,l,t)}}var iJ=nJ,rJ=hi,sJ=vo,oJ=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,aJ=/^\w*$/;function lJ(l,t){if(rJ(l))return!1;var e=typeof l;return e=="number"||e=="symbol"||e=="boolean"||l==null||sJ(l)?!0:aJ.test(l)||!oJ.test(l)||t!=null&&l in Object(t)}var Rl=lJ,Zh=Wf,cJ="Expected a function";function Ml(l,t){if(typeof l!="function"||t!=null&&typeof t!="function")throw new TypeError(cJ);var e=function(){var n=arguments,i=t?t.apply(this,n):n[0],r=e.cache;if(r.has(i))return r.get(i);var s=l.apply(this,n);return e.cache=r.set(i,s)||r,s};return e.cache=new(Ml.Cache||Zh),e}Ml.Cache=Zh;var uJ=Ml,dJ=uJ,fJ=500;function hJ(l){var t=dJ(l,function(n){return e.size===fJ&&e.clear(),n}),e=t.cache;return t}var pJ=hJ,gJ=pJ,mJ=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,vJ=/\\(\\)?/g,bJ=gJ(function(l){var t=[];return l.charCodeAt(0)===46&&t.push(""),l.replace(mJ,function(e,n,i,r){t.push(i?r.replace(vJ,"$1"):n||e)}),t}),yJ=bJ;function _J(l,t){for(var e=-1,n=l==null?0:l.length,i=Array(n);++e<n;)i[e]=t(l[e],e,l);return i}var Kh=_J,Wu=tl,wJ=Kh,xJ=hi,kJ=vo,EJ=1/0,Uu=Wu?Wu.prototype:void 0,ju=Uu?Uu.toString:void 0;function Xh(l){if(typeof l=="string")return l;if(xJ(l))return wJ(l,Xh)+"";if(kJ(l))return ju?ju.call(l):"";var t=l+"";return t=="0"&&1/l==-EJ?"-0":t}var Yh=Xh,CJ=Yh;function SJ(l){return l==null?"":CJ(l)}var Jh=SJ,AJ=hi,TJ=Rl,NJ=yJ,DJ=Jh;function RJ(l,t){return AJ(l)?l:TJ(l,t)?[l]:NJ(DJ(l))}var xo=RJ,MJ=vo,LJ=1/0;function IJ(l){if(typeof l=="string"||MJ(l))return l;var t=l+"";return t=="0"&&1/l==-LJ?"-0":t}var as=IJ,OJ=xo,FJ=as;function BJ(l,t){t=OJ(t,l);for(var e=0,n=t.length;l!=null&&e<n;)l=l[FJ(t[e++])];return e&&e==n?l:void 0}var Ll=BJ,$J=Ll;function PJ(l,t,e){var n=l==null?void 0:$J(l,t);return n===void 0?e:n}var zJ=PJ;function qJ(l,t){return l!=null&&t in Object(l)}var HJ=qJ,WJ=xo,UJ=rl,jJ=hi,VJ=Gf,GJ=Ig,ZJ=as;function KJ(l,t,e){t=WJ(t,l);for(var n=-1,i=t.length,r=!1;++n<i;){var s=ZJ(t[n]);if(!(r=l!=null&&e(l,s)))break;l=l[s]}return r||++n!=i?r:(i=l==null?0:l.length,!!i&&GJ(i)&&VJ(s,i)&&(jJ(l)||UJ(l)))}var XJ=KJ,YJ=HJ,JJ=XJ;function QJ(l,t){return l!=null&&JJ(l,t,YJ)}var eQ=QJ,tQ=El,nQ=zJ,iQ=eQ,rQ=Rl,sQ=Vh,oQ=Gh,aQ=as,lQ=1,cQ=2;function uQ(l,t){return rQ(l)&&sQ(t)?oQ(aQ(l),t):function(e){var n=nQ(e,l);return n===void 0&&n===t?iQ(e,l):tQ(t,n,lQ|cQ)}}var dQ=uQ;function fQ(l){return l}var Il=fQ;function hQ(l){return function(t){return t==null?void 0:t[l]}}var pQ=hQ,gQ=Ll;function mQ(l){return function(t){return gQ(t,l)}}var vQ=mQ,bQ=pQ,yQ=vQ,_Q=Rl,wQ=as;function xQ(l){return _Q(l)?bQ(wQ(l)):yQ(l)}var kQ=xQ,EQ=iJ,CQ=dQ,SQ=Il,AQ=hi,TQ=kQ;function NQ(l){return typeof l=="function"?l:l==null?SQ:typeof l=="object"?AQ(l)?CQ(l[0],l[1]):EQ(l):TQ(l)}var DQ=NQ,RQ=Oh,Vu=1/0,MQ=17976931348623157e292;function LQ(l){if(!l)return l===0?l:0;if(l=RQ(l),l===Vu||l===-Vu){var t=l<0?-1:1;return t*MQ}return l===l?l:0}var IQ=LQ,OQ=IQ;function FQ(l){var t=OQ(l),e=t%1;return t===t?e?t-e:t:0}var Ol=FQ,BQ=PY,$Q=DQ,PQ=Ol,zQ=Math.max,qQ=Math.min;function HQ(l,t,e){var n=l==null?0:l.length;if(!n)return-1;var i=n-1;return e!==void 0&&(i=PQ(e),i=e<0?zQ(n+i,0):qQ(i,n-1)),BQ(l,$Q(t),i,!0)}var WQ=HQ,Ri;class UQ{constructor(t){y(this,"actionOps",[]);y(this,"engine");y(this,"currentAction",{});y(this,"currentActionIndex",0);y(this,"filterEvents",[]);y(this,"selfEvents",[]);rt(this,Ri,void 0);y(this,"lazySave",bo(()=>{this.saveOp()},200));y(this,"handlePath",(t,e,n,i=!0,r=s=>!ci(I(s)))=>{var o;const s=this.engine.container.find(`[${we}="${e}"]`);if(s.length>0&&s.inEditor()){const a=s.getPath(this.engine.container,(o=s.parent())!=null&&o.isRoot()?void 0:r);return(i?a.map(c=>c+2):a).concat(t.slice(n))}return t});this.engine=t}reset(){this.actionOps=[],this.currentAction={},this.currentActionIndex=0}onFilter(t){this.filterEvents.push(t)}onSelf(t){this.selfEvents.push(t)}hasUndo(){return!!this.getUndoOp()}hasRedo(){return!!this.getRedoOp()}undo(){this.saveOp();const t=this.getUndoOp();if(t){let e=!1;this.engine.ot.stopMutation();try{const{ot:n}=this.engine;n.submitOps(t.ops||[]),n.consumer.handleSelfOperations(t.ops),this.currentActionIndex--,e=!0}catch(n){this.reset(),this.engine.messageError("history-undo",n)}this.engine.isEmpty()&&this.engine.change.initValue(),e&&(this.engine.change.getRangePathBeforeCommand(),this.engine.ot.consumer.setRangeByPath(t.startRangePath),this.engine.change.change(),this.engine.trigger("undo")),this.engine.ot.startMutation()}}redo(){this.saveOp();const t=this.getRedoOp();if(t){let e=!1;this.engine.ot.stopMutation();try{const{ot:n}=this.engine;n.submitOps(t.ops||[]),n.consumer.handleSelfOperations(t.ops),this.currentActionIndex++,e=!0}catch(n){this.reset(),this.engine.messageError("history-redo",n)}e&&(this.engine.change.getRangePathBeforeCommand(),this.engine.ot.consumer.setRangeByPath(t.rangePath),this.engine.change.change(),this.engine.trigger("redo")),this.engine.ot.startMutation()}}clear(){setTimeout(()=>{this.reset()},10)}saveOp(){this.currentAction&&this.currentAction.ops&&this.currentAction.ops.length>0&&(this.currentAction.self&&(this.currentAction.rangePath=this.getCurrentRangePath(),this.currentAction.id=Zr(8),this.actionOps.splice(this.currentActionIndex),this.actionOps.push(this.currentAction),this.currentActionIndex=this.actionOps.length,this.engine.trigger("historyChange")),this.currentAction={},this.engine.change.getRangePathBeforeCommand())}handleSelfOps(t){var n;(n=this.currentAction)!=null&&n.self||this.saveOp();let e=!1;if(t.forEach(i=>{var r;if(e=!0,this.filterEvents.some(s=>s(i)))this.actionOps.length>0&&!i.nl&&((r=this.actionOps[this.actionOps.length-1].ops)==null||r.push(i));else{this.currentAction.self=!0,this.currentAction.ops||(this.currentAction.ops=[]),this.currentAction.startRangePath||(this.currentAction.startRangePath=this.getRangePathBeforeCommand());const s=this.currentAction.ops[this.currentAction.ops.length-1];s&&Pa(i,s)?this.currentAction.ops.pop():this.currentAction.ops.push(i)}}),e){let i;if(this.selfEvents.some(r=>(i=r(t),i!==void 0)),ie(this,Ri))return;typeof i=="boolean"?i?this.saveOp():this.currentAction={}:typeof i=="object"?(Ze(this,Ri,i),i.then(r=>{r?this.saveOp():this.currentAction={}}).finally(()=>Ze(this,Ri,void 0))):i===void 0&&this.lazySave()}}handleNLCardValue(t){const e=t.p[t.p.length-1];if(t.nl===!0&&typeof e=="string"&&e===je&&t.oi){const n=t.oi,i=at(n);this.actionOps.forEach(r=>{var s;(s=r.ops)==null||s.forEach(o=>{if(o.p[o.p.length-1]===je&&o.oi){const a=at(o.oi);i.id===a.id&&(o.oi=i)}else o.li&&DK(o.li,a=>at(a[je]).id===i.id?(a[je]=n,!0):!1)})})}}handleRemoteOps(t){this.currentAction.self&&!ie(this,Ri)&&this.saveOp();const e=this.engine.change.range.get();this.actionOps.forEach(n=>{var i;if((i=n.ops)==null||i.forEach(r=>{r.id&&r.bi!==void 0&&(r.p=this.handlePath(r.p,r.id,r.bi))}),n.rangePath){const{start:r,end:s}=n.rangePath;r.id&&r.bi!==void 0&&(r.path=this.handlePath(r.path,r.id,r.bi,!1,e.filterPath(!0))),s.id&&s.bi!==void 0&&(s.path=this.handlePath(s.path,s.id,s.bi,!1,e.filterPath(!0)))}if(n.startRangePath){const{start:r,end:s}=n.startRangePath;r.id&&r.bi!==void 0&&(r.path=this.handlePath(r.path,r.id,r.bi,!1,e.filterPath(!0))),s.id&&s.bi!==void 0&&(s.path=this.handlePath(s.path,s.id,s.bi,!1,e.filterPath(!0)))}}),t.forEach(n=>{this.currentAction.ops||(this.currentAction.ops=[]);const i=this.currentAction.ops[this.currentAction.ops.length-1];i&&Pa(n,i)?this.currentAction.ops.pop():this.currentAction.ops.push(n),this.actionOps.some((r,s)=>{var a,c,u;const o=(a=r.ops)==null?void 0:a.some(d=>Qi.type.canOpAffectPath(n,d.p));if(o){const d=[r];for(let f=s+1;f<this.actionOps.length;f++){const p=this.actionOps[f];if((c=p.ops)==null?void 0:c.some(m=>{var v;return(v=r.ops)==null?void 0:v.some(b=>Qi.type.canOpAffectPath(m,b.p))})){d.push(p);let m=f+1;const v=this.actionOps[m];v&&((u=v.ops)==null?void 0:u.some(b=>{var _;return(_=p.ops)==null?void 0:_.some(x=>Qi.type.canOpAffectPath(b,x.p))}))&&d.push(v)}}const h=this.actionOps.filter(f=>d.find(p=>p.id===f.id)===void 0);return this.actionOps=h,this.currentActionIndex=this.actionOps.length,o}return!1})})}getUndoOp(){const t=this.currentActionIndex-1;if(this.actionOps[t]){let e=Ut(this.actionOps[t]),n=WQ(this.actionOps,r=>r.id==e.id);n!==-1?e=this.actionOps[n]:n=t;const i=Qi.type.invert(e.ops||[]);i.forEach((r,s)=>{const o=(e.ops||[])[i.length-s-1];r.id=o.id,r.bi=o.bi});try{return{self:!0,ops:i,id:e.id,type:"undo",rangePath:e.rangePath,startRangePath:e.startRangePath}}catch(r){this.engine.messageError("history-undo-op",r)}}}getRedoOp(){const t=this.currentActionIndex;if(this.actionOps[t]){let e=Ut(this.actionOps[t]),n=[];e.type==="undo"?(n=Qi.type.invert(e.ops||[]),n.forEach((i,r)=>{const s=(e.ops||[])[n.length-r-1];i.id=s.id,i.bi=s.bi})):n=e.ops;try{return{self:!0,ops:n,id:e.id,type:"redo",rangePath:e.rangePath,startRangePath:e.startRangePath}}catch(i){this.engine.messageError("history-redo-op",i)}}}getCurrentRangePath(){const{ot:t,change:e}=this.engine,n=t.selection.currentRangePath;return n||e.range.get().toPath()}getRangePathBeforeCommand(){return this.engine.change.getRangePathBeforeCommand()||this.getCurrentRangePath()}}Ri=new WeakMap;class jQ{constructor(t){y(this,"engine");y(this,"disabled",!1);this.engine=t,this.engine.container.on("keydown",e=>this.trigger(e))}match(t){Object.keys(this.engine.plugin.components).every(e=>{const n=this.engine.plugin.components[e];if(n.hotkey){const i=n.hotkey(t);let r=!1,s=[];if(typeof i=="string"&&ce(i,t)?r=!0:Array.isArray(i)?i.some(o=>{if(typeof o=="string"){if(ce(o,t))return r=!0,s=[],!0}else{const{key:a,args:c}=o;if(ce(a,t))return r=!0,s=Array.isArray(c)?c:[c],!0}return!1}):typeof i=="object"&&ce(i.key,t)&&(r=!0,s=Array.isArray(i.args)?i.args:[i.args]),r)return t.preventDefault(),this.engine.command.execute(e,...s),!1}return!0})}trigger(t){this.disabled||this.match(t)}enable(){this.disabled=!1}disable(){this.disabled=!0}destroy(){this.engine.container.off("keydown",this.trigger)}}class Dt{constructor(t){y(this,"type","keydown");y(this,"hotkey","");y(this,"listeners",[]);y(this,"engine");this.engine=t}on(t){this.listeners.push(t)}unshiftOn(t){this.listeners.unshift(t)}off(t){for(let e=0;e<this.listeners.length;e++)if(this.listeners[e]===t){this.listeners.splice(e,1);break}}trigger(t){for(let e=0;e<this.listeners.length;e++){const n=this.listeners[e];if(n(t)===!1)break}}destroy(){this.listeners=[]}}class VQ extends Dt{constructor(){super(...arguments);y(this,"type","keydown");y(this,"hotkey","backspace")}trigger(e){const{change:n,container:i}=this.engine,r=n.range.get();if(n.cacheRangeBeforeCommand(),n.isEmpty()){e.preventDefault(),i.empty(),n.initValue();return}const{commonAncestorNode:s}=r,o=this.engine.card.find(s,!0),a=o!=null&&o.isEditable?o!=null&&o.getSelectionNodes?o.getSelectionNodes():[]:[];if(a.length>0){a.forEach(h=>{h.html("<p></br ></p>")}),n.apply(r.cloneRange().select(a[0],!0).collapse(!0));return}const{startNode:c,startOffset:u}=r;if(c.isEditable()){const h=c[0].childNodes[u-1],f=I(h);if(f.name==="br"){e.preventDefault(),f.remove(),n.apply(r);return}}let d=!0;for(let h=0;h<this.listeners.length;h++){const f=this.listeners[h];if(d=f(e),d===!1)break}if(d===!1){this.engine.scrollNode&&r.scrollIntoViewIfNeeded(this.engine.container,this.engine.scrollNode);return}if(r.collapsed){let h;if(this.engine.node.isBlock(c)){const f=c[0].childNodes[u-1];h=I(f)}else c.name==="br"&&(h=c);if((h==null?void 0:h.name)==="br"){const f=h.prev(),p=h.next(),g=p==null?void 0:p.next(),m=f==null?void 0:f.prev();(f==null?void 0:f.name)!=="br"&&(p==null?void 0:p.name)==="br"&&(g==null?void 0:g.name)!=="br"?(e.preventDefault(),h.remove(),p.remove(),n.apply(r.shrinkToTextNode())):(p==null?void 0:p.name)!=="br"&&(f==null?void 0:f.name)==="br"&&(m==null?void 0:m.name)!=="br"&&(e.preventDefault(),h.remove(),f.remove(),n.apply(r.shrinkToTextNode()))}}else{e.preventDefault();const h=c.prev();(h==null?void 0:h.name)==="br"&&h.remove(),n.delete(r);const f=r.startNode.prev();(f==null?void 0:f.isCard())&&f.find(Ws).length===0&&f.remove(),n.apply(r),this.engine.scrollNode&&r.scrollIntoViewIfNeeded(this.engine.container,this.engine.scrollNode);return}}}class GQ extends Dt{constructor(){super(...arguments);y(this,"type","keydown");y(this,"hotkey","delete")}getNext(e){return I(e).isEditable()?null:e.nextSibling?e.nextSibling:e.parentNode===null?null:this.getNext(e.parentNode)}getRange(e,n=!1){var i;if(I(e).isEditable())return null;if(!n){const r=this.getNext(e);if(!r)return null;e=r}for(;e;){const r=I(e);if(r.attributes(ke)){if(!e.ownerDocument)return null;const s=Te.create(this.engine,e.ownerDocument);return s.setStartAfter(e),s.collapse(!0),s}if(this.engine.node.isBlock(r)){if(!e.ownerDocument)return null;const s=Te.create(this.engine,e.ownerDocument);return s.select(r,!0).collapse(!0),s}if(r.name==="br"){if(((i=e.parentNode)==null?void 0:i.childNodes.length)===1||!e.ownerDocument)return null;const s=Te.create(this.engine,e.ownerDocument);return s.setStartAfter(e),s.collapse(!0),s}if(e.nodeType===Node.TEXT_NODE){if(e.data.length===0)return this.getRange(e);if(!e.ownerDocument)return null;const s=Te.create(this.engine,e.ownerDocument);return s.setStart(e,1),s.collapse(!0),s}if(e.childNodes.length===0)return this.getRange(e);e=e.childNodes[0]}return null}trigger(e){var c;const{change:n}=this.engine;n.cacheRangeBeforeCommand();const i=n.range.get();if(!i.collapsed){e.preventDefault(),n.delete();return}const r=this.engine.card.find(i.startNode);let s=!1,o;if(r){if(r.isLeftCursor(i.startNode)){e.preventDefault(),this.engine.card.select(r),n.delete();return}if(!r.isRightCursor(i.startNode))return;o=r.root[0]}else if(i.endContainer.nodeType===Node.TEXT_NODE){if(i.endContainer.data.length>i.endOffset){e.preventDefault();const u=i.cloneRange();u.setEnd(i.endContainer,i.endOffset+1),n.range.select(u),n.delete(),n.range.select(n.range.get().shrinkToTextNode());return}o=i.endContainer}else{if(i.endContainer.nodeType!==Node.ELEMENT_NODE)return;i.endContainer.childNodes.length===0?o=i.endContainer:i.endOffset===0?((i.endContainer.childNodes.length!==1||((c=i.endContainer.firstChild)==null?void 0:c.nodeName)!=="BR")&&(s=!0),o=i.endContainer.childNodes[i.endOffset]):o=i.endContainer.childNodes[i.endOffset-1]}const a=this.getRange(o,s);if(a){e.preventDefault();let{startOffset:u}=i;u===1&&i.startContainer.childNodes.length===1&&i.startContainer.childNodes[0].nodeName==="BR"&&(u=0),a.setStart(i.startContainer,u),n.range.select(a),n.delete()}for(let u=0;u<this.listeners.length;u++){const d=this.listeners[u];if(d(e)===!1)break}}}class ZQ extends Dt{constructor(){super(...arguments);y(this,"type","keydown");y(this,"hotkey","enter")}trigger(e){const{change:n}=this.engine;n.cacheRangeBeforeCommand();const i=n.range.get();this.engine.block.closest(i.endNode).isEditable()&&this.engine.block.wrap("<p />");for(let s=0;s<this.listeners.length;s++){const o=this.listeners[s];if(o(e)===!1)break}this.engine.scrollNode&&this.engine.change.range.get().scrollIntoViewIfNeeded(this.engine.container,this.engine.scrollNode),this.engine.trigger("select")}}class KQ extends Dt{constructor(){super(...arguments);y(this,"type","keydown");y(this,"hotkey","tab")}trigger(e){const{node:n}=this.engine;e.preventDefault(),n.insertText("    ")}}class XQ extends Dt{constructor(){super(...arguments);y(this,"hotkey","shift+tab")}}class YQ extends Dt{constructor(){super(...arguments);y(this,"type","keydown");y(this,"hotkey","shift+enter")}trigger(e){var o,a,c;const{change:n,inline:i,block:r}=this.engine;e.preventDefault(),n.cacheRangeBeforeCommand();const s=n.range.get();if(s.startNode.closest("li").length===0){(o=this.engine.typing.getHandleListener("enter","keydown"))==null||o.trigger(e);return}else{const u=I("<br />");if(i.insert(u,s),r.isLastOffset(s,"end")&&(!u.next()||((a=u.next())==null?void 0:a.name)!=="br")&&(!u.prev()||((c=u.prev())==null?void 0:c.name)!=="br")){const d=u.clone();u.after(d),s.select(d).collapse(!1)}}for(let u=0;u<this.listeners.length;u++){const d=this.listeners[u];if(d(e)===!1)break}n.apply(s),this.engine.scrollNode&&this.engine.change.range.get().scrollIntoViewIfNeeded(this.engine.container,this.engine.scrollNode)}}class JQ extends Dt{constructor(){super(...arguments);y(this,"hotkey",e=>e.key===" ")}}class QQ extends Dt{constructor(){super(...arguments);y(this,"hotkey",e=>e.key==="/"||ce("/",e)||e.keyCode===229&&e.code==="Slash")}}class eee extends Dt{constructor(){super(...arguments);y(this,"hotkey","mod+a")}}class tee extends Dt{constructor(){super(...arguments);y(this,"type","keydown");y(this,"hotkey",e=>ce("left",e)||ce("shift+left",e)||ce("ctrl+a",e)||ce("ctrl+b",e))}}class nee extends Dt{constructor(){super(...arguments);y(this,"type","keydown");y(this,"hotkey",e=>ce("right",e)||ce("shift+right",e)||ce("ctrl+e",e)||ce("ctrl+f",e))}}class iee extends Dt{constructor(){super(...arguments);y(this,"hotkey",e=>ce("up",e)||ce("ctrl+p",e))}}class ree extends Dt{constructor(){super(...arguments);y(this,"hotkey",e=>ce("down",e)||ce("ctrl+n",e))}}const see=[{name:"default",handle:Dt},{name:"enter",handle:ZQ,triggerName:"keydown:enter"},{name:"backspace",handle:VQ,triggerName:"keydown:backspace"},{name:"delete",handle:GQ,triggerName:"keydown:delete"},{name:"tab",handle:KQ,triggerName:"keydown:tab"},{name:"shift-tab",handle:XQ,triggerName:"keydown:shift-tab"},{name:"shift-enter",handle:YQ,triggerName:"keydown:shift-enter"},{name:"space",handle:JQ,triggerName:"keydown:space"},{name:"slash",handle:QQ,triggerName:"keydown:slash"},{name:"all",handle:eee,triggerName:"keydown:all"},{name:"left",handle:tee,triggerName:"keydown:left"},{name:"right",handle:nee,triggerName:"keydown:right"},{name:"up",handle:iee,triggerName:"keydown:up"},{name:"down",handle:ree,triggerName:"keydown:down"}];class ls extends Dt{constructor(){super(...arguments);y(this,"type","keyup")}}class oee extends ls{constructor(){super(...arguments);y(this,"hotkey","enter")}}class aee extends ls{constructor(){super(...arguments);y(this,"type","keyup");y(this,"hotkey","backspace")}trigger(e){const{change:n}=this.engine;if(n.isEmpty()){e.preventDefault();return}let i=!0;for(let r=0;r<this.listeners.length;r++){const s=this.listeners[r];if(i=s(e),i===!1)break}}}class lee extends ls{constructor(){super(...arguments);y(this,"hotkey","tab")}}class cee extends ls{constructor(){super(...arguments);y(this,"hotkey",e=>e.key===" ")}}const uee=[{name:"default",handle:ls},{name:"enter",handle:oee,triggerName:"keyup:enter"},{name:"backspace",handle:aee,triggerName:"keyup:backspace"},{name:"tab",handle:lee,triggerName:"keyup:tab"},{name:"space",handle:cee,triggerName:"keyup:space"}];class dee{constructor(t){y(this,"engine");y(this,"handleListeners",[]);y(this,"bindKeydown",t=>{const{readonly:e,card:n}=this.engine;if(e){ce("mod+a",t)&&t.preventDefault();return}t.target&&n.find(I(t.target))||this.trigger("keydown",t)});y(this,"bindKeyup",t=>{const{readonly:e,card:n}=this.engine;e||t.target&&n.find(I(t.target))||this.trigger("keyup",t)});this.engine=t,see.concat(uee).forEach(n=>{this.addHandleListener(n.name,n.handle,n.triggerName)});const{container:e}=t;e.on("keydown",this.bindKeydown),e.on("keyup",this.bindKeyup)}addHandleListener(t,e,n,i){this.handleListeners.push({name:t,handle:new e(this.engine),triggerName:n,triggerParams:i})}getHandleListener(t,e){var n;return(n=this.handleListeners.find(i=>i.name===t&&i.handle.type===e))==null?void 0:n.handle}removeHandleListener(t,e){for(let n=0;n<this.handleListeners.length;n++)if(this.handleListeners[n].name===t&&this.handleListeners[n].handle.type===e){this.handleListeners[n].handle.destroy(),this.handleListeners.splice(n,1);break}}trigger(t,e){var i;this.handleListeners.filter(({handle:r})=>r.type===t).some(r=>{const{name:s,handle:o,triggerName:a,triggerParams:c}=r;if(s==="default"||!o.hotkey)return!1;if(typeof o.hotkey=="function"?o.hotkey(e):ce(o.hotkey,e)){let u=[e];return typeof c=="function"&&(u=c(this.engine,e)),(!a||this.engine.trigger(a,...u)!==!1)&&o.trigger(e),!0}return!1})===!1&&this.engine.trigger(t+":default",e)!==!1&&((i=this.getHandleListener("default",t))==null||i.trigger(e))}destroy(){const{container:t}=this.engine;this.handleListeners=[],t.off("keydown",this.bindKeydown),t.off("keyup",this.bindKeyup)}}const Fs="data-placeholder",Za="am-engine-placeholder";class fee{constructor(t,e){y(this,"options");y(this,"node");y(this,"_focused",!1);y(this,"_setFocus",()=>{this._focused=!0});y(this,"_setBlur",()=>{this._focused=!1});y(this,"handleClick",t=>{var r,s,o;const{engine:e,autoAppend:n,autoPrepend:i}=this.options;if(t.target&&!e.readonly&&V(e)){const a=I(t.target);if(!a.isEditable())return;const c=I("<p><br /></p>"),u=a.closest(`${ze},${fi}`),d=u.first();d||e.change.initValue(void 0,!0,a);const h=u.last();let f=!1;if(i!==!1&&d&&t.offsetY<(((r=d.get())==null?void 0:r.offsetTop)||0)&&!e.node.isEmptyWidthChild(d)?(u.prepend(c),f=!0):n!==!1&&h&&t.offsetY>(((s=h.get())==null?void 0:s.offsetTop)||0)+(((o=h.get())==null?void 0:o.clientHeight)||0)&&!e.node.isEmptyWidthChild(h)&&(u.append(c),f=!0),f){const p=e.change.range.get();p.select(c,!0).collapse(!1),e.change.apply(p)}}});y(this,"handleFocus",()=>{const{engine:t}=this.options;this.triggerFoucs(),!t.ot.isStopped()&&t.isEmpty()&&t.change.initValue()});y(this,"focusTimeout",null);y(this,"triggerFoucs",()=>{const{engine:t}=this.options;this.focusTimeout&&clearTimeout(this.focusTimeout),this.focusTimeout=setTimeout(()=>{if(this._focused)return;const e=t.change.range.get();(e.commonAncestorNode.isRoot(t.container)||e.commonAncestorNode.inEditor(t.container))&&(t.change.range.setLastBlurRange(),t.trigger("focus"))},0)});y(this,"onInput",t=>{const{engine:e}=this.options;if(e.readonly||t.target&&e.card.find(I(t.target)))return;e.change.range.get().handleBr(!0)});y(this,"onRealtimeChange",()=>{const{engine:t}=this.options;t.isEmpty()?t.showPlaceholder():t.hidePlaceholder()});y(this,"blurTimeout",null);y(this,"docMouseDown",t=>{if(!t.target)return;const e=I(t.target),{engine:n}=this.options;if(this._focused&&e.closest($i).length===0&&!e.inEditor(n.container)){this.blurTimeout&&clearTimeout(this.blurTimeout);const i=n.change.range.get();this.blurTimeout=setTimeout(()=>{n.change.range.get().commonAncestorNode.inEditor(n.container)||(n.change.range.setLastBlurRange(i),n.trigger("blur"))},0)}});this.node=I(t),this.options=e,this._init(),this._focused=document.activeElement!==null&&this.node.equal(document.activeElement);const{engine:n}=e;n.on("blur",this._setBlur),n.on("focus",this._setFocus)}_init(){const{lang:t,tabIndex:e,className:n}=this.options;this.node.attributes({[yt]:"true",role:"textbox",autocorrect:t==="en-US"?"on":"off",autocomplete:"off",spellcheck:t==="en-US"?"true":"false","data-gramm":"false"}),e!==void 0&&this.node.attributes("tabindex",e),this.node.hasClass(pa)||this.node.addClass(pa),ue&&this.node.addClass(aZ),n!==void 0&&(Array.isArray(n)?n:n.split(/\s+/)).forEach(i=>{i.trim()!==""&&this.node.addClass(i)})}init(){const{engine:t}=this.options;this.node.on("input",this.onInput),t.on("realtimeChange",this.onRealtimeChange),this.node.on("click",this.handleClick),document.addEventListener("mousedown",this.docMouseDown),this.node.on(ue?"touchstart":"mousedown",this.triggerFoucs),this.node.on("focus",this.handleFocus)}isFocus(){return this._focused}getNode(){return this.node}setReadonly(t){this.node.attributes(yt,t?"false":"true")}showPlaceholder(){const{placeholder:t}=this.options;t&&(this.node.attributes({[Fs]:t}),this.node.addClass(Za))}hidePlaceholder(){this.node.removeAttributes(Fs),this.node.removeClass(Za)}destroy(){const{className:t,engine:e}=this.options;e.on("blur",this._setBlur),e.on("focus",this._setFocus),e.off("realtimeChange",this.onRealtimeChange),document.removeEventListener("mousedown",this.docMouseDown),this.node.removeAttributes(yt),this.node.removeAttributes("role"),this.node.removeAttributes("autocorrect"),this.node.removeAttributes("autocomplete"),this.node.removeAttributes("spellcheck"),this.node.removeAttributes("data-gramm"),this.node.removeAttributes("tabindex"),this.node.removeAttributes(Fs),this.options.className&&(Array.isArray(t)?t:(t||"").split(/\s+/)).forEach(n=>{n.trim()!==""&&this.node.removeClass(n)}),e.card.closest(this.node)&&this.node.removeClass(pa),this.node.removeAllEvents()}}var hee=Og,pee=nl;function gee(l,t,e){(e!==void 0&&!pee(l[t],e)||e===void 0&&!(t in l))&&hee(l,t,e)}var Qh=gee;function mee(l){return function(t,e,n){for(var i=-1,r=Object(t),s=n(t),o=s.length;o--;){var a=s[l?o:++i];if(e(r[a],a,r)===!1)break}return t}}var vee=mee,bee=vee,yee=bee(),_ee=yee,wee=Zf,xee=Qs;function kee(l){return xee(l)&&wee(l)}var Eee=kee,Cee=Vf,See=Fg,Aee=Qs,Tee="[object Object]",Nee=Function.prototype,Dee=Object.prototype,ep=Nee.toString,Ree=Dee.hasOwnProperty,Mee=ep.call(Object);function Lee(l){if(!Aee(l)||Cee(l)!=Tee)return!1;var t=See(l);if(t===null)return!0;var e=Ree.call(t,"constructor")&&t.constructor;return typeof e=="function"&&e instanceof e&&ep.call(e)==Mee}var tp=Lee;function Iee(l,t){if(!(t==="constructor"&&typeof l[t]=="function")&&t!="__proto__")return l[t]}var np=Iee,Oee=Kf,Fee=Xf;function Bee(l){return Oee(l,Fee(l))}var $ee=Bee,Gu=Qh,Pee=Bg.exports,zee=$g,qee=Pg,Hee=zg,Zu=rl,Ku=hi,Wee=Eee,Uee=Uf.exports,jee=qg,Vee=Bi,Gee=tp,Zee=jf,Xu=np,Kee=$ee;function Xee(l,t,e,n,i,r,s){var o=Xu(l,e),a=Xu(t,e),c=s.get(a);if(c){Gu(l,e,c);return}var u=r?r(o,a,e+"",l,t,s):void 0,d=u===void 0;if(d){var h=Ku(a),f=!h&&Uee(a),p=!h&&!f&&Zee(a);u=a,h||f||p?Ku(o)?u=o:Wee(o)?u=qee(o):f?(d=!1,u=Pee(a,!0)):p?(d=!1,u=zee(a,!0)):u=[]:Gee(a)||Zu(a)?(u=o,Zu(o)?u=Kee(o):(!Vee(o)||jee(o))&&(u=Hee(a))):d=!1}d&&(s.set(a,u),i(u,a,n,r,s),s.delete(a)),Gu(l,e,u)}var Yee=Xee,Jee=il,Qee=Qh,ete=_ee,tte=Yee,nte=Bi,ite=Xf,rte=np;function ip(l,t,e,n,i){l!==t&&ete(t,function(r,s){if(i||(i=new Jee),nte(r))tte(l,t,s,e,ip,n,i);else{var o=n?n(rte(l,s),r,s+"",l,t,i):void 0;o===void 0&&(o=r),Qee(l,s,o)}},ite)}var ste=ip;function ote(l,t,e){switch(e.length){case 0:return l.call(t);case 1:return l.call(t,e[0]);case 2:return l.call(t,e[0],e[1]);case 3:return l.call(t,e[0],e[1],e[2])}return l.apply(t,e)}var ate=ote,lte=ate,Yu=Math.max;function cte(l,t,e){return t=Yu(t===void 0?l.length-1:t,0),function(){for(var n=arguments,i=-1,r=Yu(n.length-t,0),s=Array(r);++i<r;)s[i]=n[t+i];i=-1;for(var o=Array(t+1);++i<t;)o[i]=n[i];return o[t]=e(s),lte(l,this,o)}}var rp=cte;function ute(l){return function(){return l}}var dte=ute,fte=dte,Ju=Hg,hte=Il,pte=Ju?function(l,t){return Ju(l,"toString",{configurable:!0,enumerable:!1,value:fte(t),writable:!0})}:hte,gte=pte,mte=800,vte=16,bte=Date.now;function yte(l){var t=0,e=0;return function(){var n=bte(),i=vte-(n-e);if(e=n,i>0){if(++t>=mte)return arguments[0]}else t=0;return l.apply(void 0,arguments)}}var _te=yte,wte=gte,xte=_te,kte=xte(wte),sp=kte,Ete=Il,Cte=rp,Ste=sp;function Ate(l,t){return Ste(Cte(l,t,Ete),l+"")}var Tte=Ate,Nte=nl,Dte=Zf,Rte=Gf,Mte=Bi;function Lte(l,t,e){if(!Mte(e))return!1;var n=typeof t;return(n=="number"?Dte(e)&&Rte(t,e.length):n=="string"&&t in e)?Nte(e[t],l):!1}var Ite=Lte,Ote=Tte,Fte=Ite;function Bte(l){return Ote(function(t,e){var n=-1,i=e.length,r=i>1?e[i-1]:void 0,s=i>2?e[2]:void 0;for(r=l.length>3&&typeof r=="function"?(i--,r):void 0,s&&Fte(e[0],e[1],s)&&(r=i<3?void 0:r,i=1),t=Object(t);++n<i;){var o=e[n];o&&l(t,o,n,r)}return t})}var $te=Bte,Pte=ste,zte=$te,qte=zte(function(l,t,e){Pte(l,t,e)}),Li=qte;class Hte{constructor(t,e={}){y(this,"data",{});y(this,"locale","zh-CN");this.locale=t,this.data=e}add(t){this.data=Li(this.data,t)}get(...t){const e=(n=0,i)=>{for(let r=n;r<t.length;r++){const s=i[t[r]];return typeof s=="object"?e(r+1,s):s||""}return i};return e(0,this.data[this.locale])}}const Wte={dnd:{title:"Drag to reposition"},copy:{title:"Copy",success:"Copied successfully",error:"Copy error"},delete:{title:"Delete"},copyAnchor:{title:"Copy anchor link"},link:{placeholder:"Please enter a link or anchor and press Enter to confirm",save:"Apply",edit:"Change",delete:"Remove link",open:"Open link",text:"link"},copyContent:{title:"copy content"},maximize:{title:"Maximize",back:"Back to document"},expand:{title:"Embedded preview"},collapse:{title:"Compact display"},card:{lockAlert:"Please wait for the other user to finish editing"},preferences:{title:"Preferences"},download:{title:"Download"},more:{title:"More"},checkMarkdown:{title:"It is detected that the paste content conforms to the Markdown syntax. Do you need to do style conversion?"},searchEmtpy:{title:"No matching card"}},Ute={dnd:{title:"\u62D6\u52A8\u8C03\u6574\u4F4D\u7F6E"},copy:{title:"\u590D\u5236",success:"\u590D\u5236\u6210\u529F",error:"\u590D\u5236\u5931\u8D25"},delete:{title:"\u5220\u9664"},copyAnchor:{title:"\u590D\u5236\u951A\u70B9\u94FE\u63A5"},link:{placeholder:"\u8BF7\u8F93\u5165\u94FE\u63A5\u6216\u951A\u70B9\uFF0C\u56DE\u8F66\u786E\u8BA4",save:"\u4FDD\u5B58",edit:"\u7F16\u8F91",delete:"\u53D6\u6D88\u94FE\u63A5",open:"\u6253\u5F00\u94FE\u63A5",text:"\u94FE\u63A5"},copyContent:{title:"\u590D\u5236\u5185\u5BB9"},maximize:{title:"\u6700\u5927\u5316",back:"\u8FD4\u56DE\u6587\u6863"},expand:{title:"\u5D4C\u5165\u9884\u89C8"},collapse:{title:"\u7D27\u51D1\u5C55\u793A"},card:{lockAlert:"\u8BF7\u7B49\u5F85\u5BF9\u65B9\u7F16\u8F91\u5B8C\u6BD5\u540E\uFF0C\u518D\u8FDB\u5165\u7F16\u8F91"},preferences:{title:"\u8BBE\u7F6E"},download:{title:"\u4E0B\u8F7D"},more:{title:"\u66F4\u591A"},checkMarkdown:{title:"\u68C0\u6D4B\u5230\u7C98\u8D34\u5185\u5BB9\u7B26\u5408 Markdown \u8BED\u6CD5\uFF0C\u662F\u5426\u9700\u8981\u8F6C\u6362\uFF1F"},searchEmtpy:{title:"\u65E0\u5339\u914D\u5361\u7247"}},jte={"en-US":Wte,"zh-CN":Ute};class _t{constructor(t,e){y(this,"editor");y(this,"options");y(this,"kind","plugin");y(this,"name",this.constructor.pluginName);y(this,"disabled");this.editor=t,this.options=e||{};const{disabled:n}=this.options;this.disabled=n}}y(_t,"pluginName");class ko extends _t{constructor(){super(...arguments);y(this,"kind","element");y(this,"sechamCache");y(this,"tagName");y(this,"style");y(this,"attributes");y(this,"variable")}init(){const{schema:e,conversion:n}=this.editor;e.add(this.schema()),this.conversion&&this.conversion().forEach(({from:i,to:r})=>{n.add(i,r)})}setStyle(e,...n){be(e)&&(e=I(e)),this.style&&Object.keys(this.style).forEach(i=>{var s;let r=this.style[i];typeof r=="object"&&(r=r.value),(s=r.match(/@var\d/g))==null||s.forEach(o=>{const a=parseInt(o.replace("@var",""),10);r=r.replace(new RegExp(o,"gm"),n[a]||"")}),e.css(i,r)})}setAttributes(e,...n){be(e)&&(e=I(e)),this.attributes&&Object.keys(this.attributes).forEach(i=>{var s;let r=this.attributes[i];typeof r=="object"&&(r=r.value),(s=r.match(/@var\d/g))==null||s.forEach(o=>{const a=parseInt(o.replace("@var",""),10);r=r.replace(new RegExp(o,"gm"),n[a]||"")}),e.attributes(i,r)})}getStyle(e){be(e)&&(e=I(e));const n={};return this.style&&this.isSelf(e)&&Object.keys(this.style).forEach(i=>{e=e;let r=i.toLowerCase().indexOf("color")>-1?de(e.css(i)||"").toHexString():e.css(i),s=this.style[i];typeof s=="object"&&(r=s.format(r)),r&&(n[i]=r)}),n}getAttributes(e){be(e)&&(e=I(e));const n={};return this.attributes&&this.isSelf(e)&&Object.keys(this.attributes).forEach(i=>{let r=e.attributes(i),s=this.attributes[i];typeof s=="object"&&(r=s.format(r)),r&&(n[i]=r)}),n}isSelf(e){be(e)&&(e=I(e));let n=this.schema();return Array.isArray(n)&&(n=n.find(({name:i})=>i===e.name)),n?(Array.isArray(this.tagName)?this.tagName.indexOf(e.name)>-1:e.name===this.tagName)&&this.editor.schema.checkNode(e,n.attributes):!1}schema(){if(this.sechamCache)return this.sechamCache;let e={};if(this.attributes&&Object.keys(this.attributes).forEach(n=>{var r;let i=this.attributes[n];typeof i=="object"&&(i=i.value),e[n]=i,(r=i.match(/@var\d/g))==null||r.forEach(s=>{if(!this.variable)throw"Please specify the variable type";e[n]=this.variable[s]})}),this.style){const n={};Object.keys(this.style).forEach(i=>{var s;let r=this.style[i];typeof r=="object"&&(r=r.value),(s=r.match(/@var\d/g))==null||s.forEach(o=>{if(!this.variable)throw"Please specify the variable type";n[i]=this.variable[o]})}),e={...e,style:n}}if(this.sechamCache={type:this.kind,attributes:e},typeof this.tagName=="string")this.sechamCache.name=this.tagName.toLowerCase();else if(Array.isArray(this.tagName)){const n=[];this.tagName.forEach(i=>{n.push({...this.sechamCache,name:i})}),this.sechamCache=n}return this.sechamCache}createElement(...e){const n=I(`<${this.tagName} />`);return this.setStyle(n,...e),this.setAttributes(n,...e),n}}const Vte=l=>l.kind==="element";class Fl extends ko{constructor(){super(...arguments);y(this,"kind","block");y(this,"allowIn");y(this,"disableMark");y(this,"canMerge")}schema(){const e=super.schema();return Array.isArray(e)?e.map(n=>({...n,allowIn:this.allowIn})):{...e,allowIn:this.allowIn,canMerge:this.canMerge}}}const op=l=>l.kind==="block";class ap extends ko{constructor(){super(...arguments);y(this,"kind","inline");y(this,"markdown")}execute(...e){const n=this.editor;if(!V(n))return;const i=I(`<${this.tagName} />`);this.setStyle(i,...e),this.setAttributes(i,...e);const{inline:r}=n;(this.isTrigger?this.isTrigger(...e):!this.queryState())?r.wrap(i):r.unwrap()}queryState(){const e=this.editor;if(!V(e))return;const{change:n}=e;if(!this.style&&!this.attributes)return n.inlines.some(r=>r.name===this.tagName);const i=[];return n.inlines.forEach(r=>{i.push(...Object.values(this.getStyle(r))),i.push(...Object.values(this.getAttributes(r)))}),i.length===0?void 0:i}}const Gte=l=>l.kind==="inline";class lp extends Fl{constructor(){super(...arguments);y(this,"cardName");y(this,"isPasteList",!1);y(this,"pasteBefore",e=>{const n=this.editor;if(!this.cardName||!n)return;const{list:i}=n,s=I(e).allChildren();s.forEach(o=>{var a;if(o.name==="li"&&o.hasClass(i.CUSTOMZIE_LI_CLASS))if((a=o.first())!=null&&a.isCard())o.closest("ul").addClass(i.CUSTOMZIE_UL_CLASS);else{o.removeClass(i.CUSTOMZIE_LI_CLASS),o.closest("ul").removeClass(i.CUSTOMZIE_UL_CLASS);return}}),this.isPasteList=s.some(o=>o.name==="li")});y(this,"pasteInsert",()=>{const e=this.editor;if(!this.cardName||!V(e))return;const{change:n,list:i}=e,s=n.range.get().getRootBlock(),o=s==null?void 0:s.next(),a=o==null?void 0:o.find(`li.${i.CUSTOMZIE_LI_CLASS}`);a&&a.length>0&&a.each(c=>{const u=I(c);u.find(`[${ke}=${this.cardName}],[${We}=${this.cardName}]`).length===0&&i.addReadyCardToCustomize(u,this.cardName)})});y(this,"pasteAfter",()=>{var e;this.isPasteList&&((e=this.editor)==null||e.list.merge())})}init(){super.init();const e=this.editor;V(e)&&(e.on("paste:before",this.pasteBefore),e.on("paste:insert",this.pasteInsert),e.on("paste:after",this.pasteAfter))}queryState(){const e=this.editor;return V(e)?e.list.getPluginNameByNodes(e.change.blocks)===this.constructor.pluginName:!1}destroy(){const e=this.editor;V(e)&&(e.off("paste:before",this.pasteBefore),e.off("paste:insert",this.pasteInsert),e.off("paste:after",this.pasteAfter))}}class mi extends ko{constructor(){super(...arguments);y(this,"kind","mark");y(this,"copyOnEnter");y(this,"followStyle",!0);y(this,"combineValueByWrap",!1);y(this,"mergeLeval",1)}execute(...e){const n=this.editor;if(!V(n))return;const{change:i,mark:r}=n,s=this.createElement(...e);if(this.isTrigger?this.isTrigger(...e):!this.queryState()){if(!this.followStyle&&i.range.get().collapsed)return;r.wrap(s)}else r.unwrap(s)}queryState(){const e=this.editor;if(!V(e))return;const{change:n}=e;if(!this.style&&!this.attributes)return n.marks.some(r=>r.name===this.tagName);const i=[];return n.marks.forEach(r=>{i.push(...Object.values(this.getStyle(r))),i.push(...Object.values(this.getAttributes(r)))}),i.length===0?void 0:i}schema(){const e=super.schema();return Array.isArray(e)?e.map(n=>({...n})):{...e}}}const Bl=l=>l.kind==="mark";class Zte{constructor(t){y(this,"data",{});y(this,"components",{});y(this,"editor");this.editor=t}init(t,e){t.forEach(n=>{this.data[n.pluginName]=n;const i=new n(this.editor,e[n.pluginName]);this.components[n.pluginName]=i,i.init&&i.init()})}add(t,e){this.data[t.pluginName]=t,e={...e};const n=this.editor;if(V(n)){const i=new t(n,e);i.init&&i.init(),this.components[t.pluginName]=i}}findPlugin(t){const e=this.components[t];if(!!e)return e}findElementPlugin(t){const e=this.findPlugin(t);if(!!e&&Vte(e))return e}findMarkPlugin(t){const e=this.findPlugin(t);if(!!e&&Bl(e))return e}findInlinePlugin(t){const e=this.findPlugin(t);if(!!e&&Gte(e))return e}findBlockPlugin(t){const e=this.findPlugin(t);if(!!e&&op(e))return e}each(t){Object.keys(this.data).forEach((e,n)=>{t&&t(e,this.data[e],n)})}destroy(){Object.keys(this.components).forEach(t=>{const e=this.components[t];e.destroy&&e.destroy()})}}class Kte{constructor(t){y(this,"editor");this.editor=t}queryEnabled(t){const e=this.editor,n=e.plugin.components[t];if(!n||n.disabled||(!V(e)||e.readonly)&&n.disabled!==!1)return!1;const i=e.card;return i.active?!!((Bl(n)||n.kind==="plugin")&&i.active.executeMark||i.active.isEditable):!0}queryState(t,...e){const n=this.editor,i=n.plugin.components[t];if(i&&i.queryState)try{return i.queryState(e)}catch(r){n.messageError("command-query",r)}}handleExecuteBefore(){let t;const e=this.editor;if(V(e)){t=e.change;const n=t.range.get();if(!n.commonAncestorNode.isRoot()&&!n.commonAncestorNode.inEditor()){const i=n.commonAncestorNode.closest($i);let r;if(i.length>0){const s=i.attributes(fo);if(s){const{card:o}=e;r=o.find(s),r&&o.select(r)}}r||e.focus()}t.cacheRangeBeforeCommand()}return t}execute(t,...e){const n=this.editor,i=n.plugin.components[t];if(i&&i.execute){const r=this.handleExecuteBefore();n.trigger("beforeCommandExecute",t,...e);try{const s=i.execute(...e);return r==null||r.combinText(),r==null||r.onSelect(),n.trigger("afterCommandExecute",t,...e),s}catch(s){n.messageError("command-execute",s)}}}executeMethod(t,e,...n){const i=this.editor,r=i.plugin.components[t];if(r&&r[e])try{const s=V(i)?i.change:null,o=r[e](...n);return s==null||s.combinText(),o}catch(s){i.messageError("command-excute-method",s)}}}const Xte=["blocks","inlines","marks","globals"];class $l{constructor(){y(this,"_all",[]);y(this,"_typeMap",{});y(this,"_invalidKeys",[]);y(this,"_tagMap",{blocks:[],inlines:[],marks:[]});y(this,"data",{blocks:[],inlines:[],marks:[],globals:{}})}add(t){t=Ut(t),Array.isArray(t)||(t=[t]),t.forEach(s=>{Yte(s)?(s.attributes&&Object.keys(s.attributes).forEach(o=>{!this.data.globals[s.type]||(o==="style"?Object.keys(s.attributes.style).forEach(a=>{this.data.globals[s.type][o]&&this.data.globals[s.type][o][a]===s.attributes.style[a]&&delete s.attributes.style[a]}):this.data.globals[s.type][o]===s.attributes[o]&&delete s.attributes[o])}),s.type==="block"?this.data.blocks.push(s):s.type==="inline"?this.data.inlines.push(s):s.type==="mark"&&this.data.marks.push(s)):this.data[`${s.type}s`]&&(this.data.globals[s.type]=Li(Object.assign({},this.data.globals[s.type]),s.attributes))}),this.updateTagMap();const e=s=>{const o=s.attributes||{},a=o.style||{};let c=0,u=0;return Object.keys(o).forEach(d=>{const h=o[d];Ca(h)&&h.required&&c++}),Object.keys(a).forEach(d=>{const h=a[d];Ca(h)&&h.required&&u++}),[c,u]},{blocks:n,marks:i,inlines:r}=this.data;this._all=[...n,...i,...r].sort((s,o)=>{const[a,c]=e(s),[u,d]=e(o);return a>u?-1:a===u?c===d?0:c>d?-1:1:1})}updateTagMap(){this._tagMap.marks=[],this.data.marks.forEach(t=>{this._tagMap.marks.includes(t.name)||this._tagMap.marks.push(t.name)}),this._tagMap.blocks=[],this.data.blocks.forEach(t=>{this._tagMap.blocks.includes(t.name)||this._tagMap.blocks.push(t.name)}),this._tagMap.inlines=[],this.data.inlines.forEach(t=>{this._tagMap.inlines.includes(t.name)||this._tagMap.inlines.push(t.name)})}getTags(t){return this._tagMap[t]}remove(t){let e=this._all.findIndex(i=>Bt(i,t));e>-1&&this._all.splice(e,1);const n=this.data[`${t.type}s`];n&&(e=n.findIndex(i=>Bt(i,t)),e>-1&&n.splice(e,1)),this._typeMap={},this.updateTagMap()}clone(){const t=new $l;return t._all=Ut(this._all),t._typeMap=Ut(this._typeMap),t._tagMap=Ut(this._tagMap),t.data=Ut(this.data),t}find(t){const e=[];return Xte.forEach(n=>{if(n!=="globals"){const i=this.data[n].filter(t);e.push(...i)}}),e}getType(t,e){const n=be(t)?t:t[0];if(!n||n.nodeType!==Node.ELEMENT_NODE)return;let i=n.getAttribute(we);if(i?i=i.split("-")[0]:i=kl(n,!1),this._invalidKeys.includes(i))return;if(!!this._typeMap[i]&&(!e||e(this._typeMap[i])))return this._typeMap[i].type;const r=this.getRule(n,e);return r?this._typeMap[i]=r:this._invalidKeys.push(i),r==null?void 0:r.type}getRule(t,e){const n=be(t)?t:t[0];return e=e||(i=>i.name===n.localName),this._all.find(i=>e(i)&&this.checkNode(n,i.attributes))}checkNode(t,e={}){var s;const n=be(t)?t:t[0];for(const o in e){if(o==="style")continue;const a=e;if(!a[o]||!this.checkValue(a,o,(s=n.getAttribute(o))!=null?s:void 0))return!1}const i=fr(n.getAttribute("style")||""),r=e.style||{};for(const o in r)if(!r[o]||!this.checkValue(r,o,i[o]))return!1;return!0}checkValue(t,e,n,i){if(!t[e])return!1;let r=t[e];if(Ca(r)){if(n===void 0)return!r.required;r=r.value}else if(!i||n===void 0)return!0;if(typeof r=="string"&&r.charAt(0)==="@")switch(r){case"@number":r=/^-?\d+(\.\d+)?$/;break;case"@length":r=/^-?\d+(\.\d+)?(\w*|%)$/;break;case"@color":r=/^(rgb(.+?)|#\w{3,6}|\w+)$/i;break;case"@url":r=Ch;break}return typeof r=="string"?r==="*"?!0:e==="class"?(n||"").split(/\s+/).some(s=>s.trim()===r):r===n:Array.isArray(r)?e==="class"?(n||(n="*"),n.split(/\s+/).every(s=>s.trim()===""?!0:r.indexOf(s.trim())>-1)):r.indexOf(n)>-1:typeof r=="object"&&typeof r.test=="function"?e==="class"?(n||"").split(/\s+/).every(s=>s.trim()===""?!0:r.test(s.trim())):r.test(n||""):typeof r=="function"?r(n):!0}filterStyles(t,e,n){Object.keys(t).forEach(i=>{var r;(!((r=e.attributes)!=null&&r.style)||!this.checkValue(e.attributes.style,i,t[i],!0))&&(n&&n(i,t[i]),delete t[i])})}filterAttributes(t,e,n){Object.keys(t).forEach(i=>{(!e.attributes||!this.checkValue(e.attributes,i,t[i],!0))&&(n&&n(i,t[i]),delete t[i])})}filter(t,e,n,i=!1){const r=this.getRule(t);if(!r)return;const{globals:s}=this.data,o=s[r.type]?r.type:void 0,a=Object.assign({},r,{attributes:Li({},r.attributes,o?s[o]:{})});this.filterAttributes(e,a,i?c=>t.removeAttributes(c):void 0),this.filterStyles(n,a,i?c=>t.css(c,""):void 0)}closest(t){let e=t;return this.data.blocks.forEach(n=>{if(n.name!==t)return;const i=n;i.allowIn&&(i.allowIn.forEach(r=>{this.isAllowIn(r,e)&&(e=r)}),e=this.closest(e))}),e}isAllowIn(t,e){return t==="p"?!1:this.data.blocks.some(n=>{if(n.name!==e)return;const i=n;if(i.allowIn&&i.allowIn.indexOf(t)>-1)return!0})}addAllowIn(t,e="p"){const n=this.data.blocks.find(i=>i.name===e);n.allowIn||(n.allowIn=[]),n.allowIn.includes(t)||n.allowIn.push(t)}getAllowInTags(){const t=[];return this.data.blocks.forEach(e=>{const n=e;n.allowIn&&n.allowIn.forEach(i=>{t.indexOf(i)<0&&t.push(i)})}),t}getCanMergeTags(){const t=[];return this.data.blocks.forEach(e=>{const n=e;n.canMerge===!0&&t.indexOf(n.name)<0&&t.push(n.name)}),t}}const Ca=l=>l.required!==void 0,Yte=l=>!!l.name;class Pl{constructor(t){y(this,"editor");y(this,"data",[]);this.editor=t}getData(){return this.data}clone(){const t=Ut(this.data),e=new Pl(this.editor);return e.data=t,e}add(t,e){this.data.push({from:t,to:e})}transform(t,e){let n=t.name,i=t.attributes(),r=fr(i.style||""),s=!1;delete i.style,t.isCursor()&&(n=i[le].toLowerCase(),i={},r={});const o=this.data.find(a=>{if(e&&!e(a))return;const{from:c,to:u}=a;let d=!1;if(typeof c=="string")d=c===n;else if(typeof c=="function")d=c(n,r,i);else{const h=Object.keys(c);d=h.indexOf(n)>=0&&h.some(f=>{const p=c[f];return Object.keys(p.style||{}).every(g=>{const m=p.style[g];return!!r[g]&&Array.isArray(m)?m.indexOf(r[g])>-1:m===r[g]})&&Object.keys(p.attributes||{}).every(g=>{const m=p.attributes[g];return!!r[g]&&Array.isArray(m)?m.indexOf(r[g])>-1:m===r[g]})})}if(d)if(typeof u=="string")n=u,r={},i={};else{const h=typeof u=="function"?u(n,r,i):u;let f=h;if(h.hasOwnProperty("replace")){const p=h;f=p.node,s=p.replace}n=f.name,r=f.css(),i=f.attributes()}return d});return o?{rule:o,node:{name:n,style:r,attributes:i},replace:s}:void 0}}class Jte{constructor(t){y(this,"engine");this.engine=t}insertNewline(t,e,n){const{change:i}=this.engine,r=I("<p><br /></p>");this.engine.nodeId.generate(r),n?e.root.before(r):e.root.after(r),t.select(r,!0),t.collapse(!1),i.range.select(t)}trigger(t){const{change:e,card:n}=this.engine,i=e.range.get(),r=n.find(i.startNode);if(!r)return!0;if(r.type===Ve.INLINE)i.startNode.closest(St).length>0&&(i.select(r.root),i.collapse(!0),e.range.select(i)),i.startNode.closest(At).length>0&&(i.select(r.root),i.collapse(!1),e.range.select(i));else{if(i.startNode.closest(St).length>0){t.preventDefault();const a=r.root.prev();return!a||a.isCard()?(n.focusPrevBlock(r,i,!0),e.range.select(i)):this.insertNewline(i,r,!0),!1}if(i.startNode.closest(At).length>0){t.preventDefault();const a=r.root.next();return!a||a.isCard()?(n.focusNextBlock(r,i,!0),e.range.select(i)):this.insertNewline(i,r,!1),!1}}return!0}}class Qte{constructor(t){y(this,"engine");this.engine=t}focusPrevBlock(t,e=!1){const{change:n}=this.engine,i=n.range.get();t=t||this.engine.block.closest(i.startNode);let r=t.prev();if(!!r){if(r.isCard()){const s=this.engine.card.find(r);s&&s.focus(i);return}if(this.engine.node.isList(r)&&(r=r.last()),!!r){if(e&&this.engine.node.isEmptyWithTrim(r)){r.remove();return}i.select(r,!0),i.collapse(!1),n.range.select(i.shrinkToTextNode())}}}trigger(t){var r;const{change:e}=this.engine,n=e.range.get().cloneRange().shrinkToElementNode().shrinkToTextNode();if(!n.collapsed)return;const i=this.engine.card.find(n.startNode);if(!i){const s=n.getPrevNode(),o=s==null?void 0:s.parent();if(!t.isDelete&&s&&s.isCard()&&(!o||!this.engine.node.isCustomize(o))){t.preventDefault();const a=n.cloneRange();return a.setStartBefore(s),a.collapse(!0),this.engine.card.remove(s),e.range.select(a.shrinkToTextNode()),a.handleBr(),!1}return!0}if(t.isDelete)return!0;if(i.type===Ve.INLINE){if(n.startNode.closest(St).length>0){const a=i.root.prev();if(a){const c=this.engine.card.find(a);if(c)return this.engine.card.remove(c.id),n.handleBr(),!1;n.select(i.root).collapse(!0)}else return t.preventDefault(),e.mergeAfterDelete(),!1;e.range.select(n)}if(n.startNode.closest(At).length>0){t.preventDefault();const a=n.cloneRange();return a.setStartBefore(i.root),a.collapse(!0),this.engine.card.remove(i.id),e.range.select(a.shrinkToTextNode()),a.handleBr(),!1}}else{if(n.startNode.closest(St).length>0)return t.preventDefault(),(r=i.root.parent())!=null&&r.inEditor()?e.unwrap(i.root.parent()):this.focusPrevBlock(i.root,!0),!1;if(n.startNode.closest(At).length>0)return t.preventDefault(),this.focusPrevBlock(i.root),this.engine.card.remove(i.id,!1),e.isEmpty()&&e.initValue(),!1}return this.engine.trigger("keydown:backspace",t)!==!1}}class ene{constructor(t){y(this,"engine");this.engine=t}inline(t,e){var c,u;const{change:n}=this.engine,i=n.range.get().cloneRange(),{singleSelectable:r}=t.constructor,s=i.commonAncestorNode.closest(St);if(s.length>0)return t.root.prev()?(i.setStartBefore(t.root[0]),i.collapse(!0)):t.focus(i,!0),n.range.select(i),!0;const o=i.commonAncestorNode.closest(At),a=s.length===0&&o.length===0;if(o.length>0||a){if(e.preventDefault(),a)t.select(!1),(c=t.toolbarModel)==null||c.hide(),t.activate(!1);else if(i.collapsed){const d=this.engine.card.find(i.startNode);if(d&&d.onSelectLeft)return d.onSelectLeft(e)}return!a&&r!==!1?this.engine.card.select(t,e):(t.focus(i,!0),t.select(!1),(u=t.toolbarModel)==null||u.hide(),n.range.select(i)),!1}return!0}block(t,e){var c,u;const{change:n,card:i}=this.engine,r=n.range.get(),s=r.commonAncestorNode.closest(St);if(s.length>0)return t.root.prev()?(e.preventDefault(),i.focusPrevBlock(t,r,!1),n.range.select(r),!1):void 0;const o=r.commonAncestorNode.closest(At);if(s.length===0&&o.length===0&&(t.select(!1),(c=t.toolbarModel)==null||c.hide(),t.activate(!1)),o.length>0){if(r.collapsed){const d=i.find(r.startNode);if(d&&d.onSelectLeft)return d.onSelectLeft(e)}return e.preventDefault(),i.select(t,e),!1}return i.getSingleSelectedCard(r)?(e.preventDefault(),t.focus(r,!0),t.select(!1),(u=t.toolbarModel)==null||u.hide(),n.range.select(r),!1):!0}fincPrevCard(t){if(!t.collapsed)return null;const{startNode:e,startOffset:n}=t;if(e.isText()&&n===0){const i=e.prevElement();if(i&&i.isCard())return this.engine.card.find(i)}return null}trigger(t){const{change:e}=this.engine,n=e.range.get(),i=this.engine.card.getSingleCard(n);if(!i){const r=this.fincPrevCard(n);return r?(t.preventDefault(),r.focus(n,!1),e.range.select(n),!1):!0}return ce("shift+left",t)?!1:i.type===Ve.INLINE?this.inline(i,t):this.block(i,t)}}class tne{constructor(t){y(this,"engine");this.engine=t}inline(t,e){var c,u;const{change:n}=this.engine,i=n.range.get(),{singleSelectable:r}=t.constructor,s=i.commonAncestorNode.closest(St),o=i.commonAncestorNode.closest(At),a=s.length===0&&o.length===0;if(s.length>0||a){if(e.preventDefault(),a)t.select(!1),t.activate(!1),(c=t.toolbarModel)==null||c.hide();else if(i.collapsed){const d=this.engine.card.find(i.startNode);if(d&&d.onSelectRight)return d.onSelectRight(e)}return!a&&r!==!1?this.engine.card.select(t,e):(t.focus(i,!1),t.select(!1),(u=t.toolbarModel)==null||u.hide(),n.range.select(i)),!1}return o.length>0&&(t.root.next()?(i.setEndAfter(t.root[0]),i.collapse(!1)):t.focus(i,!1),n.range.select(i)),!0}block(t,e){var c,u;const{change:n,card:i}=this.engine,r=n.range.get(),s=r.commonAncestorNode.closest(St);if(s.length>0){if(r.collapsed){const d=this.engine.card.find(r.startNode);if(d&&d.onSelectRight)return d.onSelectRight(e)}return e.preventDefault(),i.select(t,e),!1}const o=r.commonAncestorNode.closest(At);return s.length===0&&o.length===0&&(t.select(!1),(c=t.toolbarModel)==null||c.hide(),t.activate(!1)),o.length>0?t.root.next()?(e.preventDefault(),i.focusNextBlock(t,r,!1),n.range.select(r),!1):void 0:this.engine.card.getSingleSelectedCard(r)?(e.preventDefault(),t.focus(r,!1),t.select(!1),(u=t.toolbarModel)==null||u.hide(),n.range.select(r),!1):!0}fincNextCard(t){if(!t.collapsed)return null;const{startNode:e,startOffset:n}=t;if(e.isText()&&e.text().length===n){const r=e.nextElement();if(r&&r.isCard())return this.engine.card.find(r)}return null}trigger(t){const{change:e}=this.engine,n=e.range.get(),i=this.engine.card.getSingleCard(n);if(!i){const r=this.fincNextCard(n);return r?(t.preventDefault(),r.focus(n,!0),e.range.select(n),!1):!0}if(!ce("shift+right",t))return i.type===Ve.INLINE?this.inline(i,t):this.block(i,t)}}class nne{constructor(t){y(this,"engine");this.engine=t}inline(t,e){const{change:n,card:i}=this.engine,r=n.range.get();if(t.root.prev())return e.preventDefault(),i.focusPrevBlock(t,r,!1),n.range.select(r),!1}block(t,e){const{change:n,card:i}=this.engine,r=n.range.get();if(t.root.prev())return e.preventDefault(),i.focusPrevBlock(t,r,!1),n.range.select(r),!1}trigger(t){const{change:e,card:n,block:i}=this.engine,r=e.range.get();if(r.collapsed){const a=i.closest(r.startNode).prev();if(a!=null&&a.isCard()){const c=n.find(a);if(c&&c.onSelectUp)return c.onSelectUp(t)}}const s=n.getSingleCard(r);if(!s)return!0;if(!ce("shift+up",t))return s.type===Ve.INLINE?this.inline(s,t):this.block(s,t)}}class ine{constructor(t){y(this,"engine");this.engine=t}inline(t,e){const{change:n,card:i}=this.engine,r=n.range.get();if(t.root.next())return e.preventDefault(),i.focusNextBlock(t,r,!1),n.range.select(r),!1}block(t,e){const{change:n,card:i}=this.engine,r=n.range.get();if(t.root.next())return e.preventDefault(),i.focusNextBlock(t,r,!1),n.range.select(r),!1}trigger(t){const{change:e,block:n,card:i}=this.engine,r=e.range.get(),s=i.getSingleCard(r);if(r.collapsed){const a=n.closest(r.startNode).next();if(a!=null&&a.isCard()){const c=i.find(a);if(c&&c.onSelectDown)return c.onSelectDown(t)}}return!s||ce("shift+down",t)?!0:s.type===Ve.INLINE?this.inline(s,t):this.block(s,t)}}class rne{constructor(t){y(this,"engine");this.engine=t}block(t,e){const{change:n,card:i}=this.engine,r=n.range.get();return r.commonAncestorNode.closest(St).length>0?(!e.metaKey&&!e.ctrlKey&&(i.focusPrevBlock(t,r,!0),n.range.select(r)),!0):(r.commonAncestorNode.closest(At).length>0&&!e.metaKey&&!e.ctrlKey&&(i.focusNextBlock(t,r,!0),n.range.select(r)),!0)}trigger(t){const{change:e}=this.engine,n=e.range.get(),i=this.engine.card.getSingleCard(n);return i&&i.type===Ve.BLOCK?this.block(i,t):!0}}class sne{constructor(t,e=!0){y(this,"classes");y(this,"components");y(this,"lazyRender");y(this,"asyncComponents",[]);y(this,"editor");y(this,"renderTimeout");y(this,"renderAsyncComponents",async()=>{this.renderTimeout&&clearTimeout(this.renderTimeout);const t=this.editor;this.renderTimeout=setTimeout(()=>{this.asyncComponents.concat().forEach(async n=>{var i,r;(n.root.length===0||t.root.inViewport(n.root,!0)&&t.trigger("card:async-render-component",n)!==!1)&&(this.asyncComponents.splice(this.asyncComponents.findIndex(s=>s===n),1),n.root.length>0&&n.loading&&(n.destroy&&n.destroy(),n.getCenter().empty(),this.renderComponent(n),V(t)&&t.readonly&&!t.ot.isRemote&&((i=t.ot.doc)!=null&&i.type?t.ot.doc.data=An(t.container):(r=t.ot.doc)==null||r.create(An(t.container)))))})},50)});this.classes={},this.components=[],this.editor=t,this.lazyRender=e}get active(){return this.components.find(t=>t.activated)}get length(){return this.components.length}init(t){var n,i,r,s,o,a,c,u,d;const e=this.editor;if(V(e)){const{typing:h}=e,f=new Jte(e);(n=h.getHandleListener("enter","keydown"))==null||n.on(x=>f.trigger(x));const p=new Qte(e);(i=h.getHandleListener("backspace","keydown"))==null||i.on(x=>p.trigger(x));const g=new ene(e);(r=h.getHandleListener("left","keydown"))==null||r.on(x=>g.trigger(x));const m=new tne(e);(s=h.getHandleListener("right","keydown"))==null||s.on(x=>m.trigger(x));const v=new nne(e);(o=h.getHandleListener("up","keydown"))==null||o.on(x=>v.trigger(x));const b=new ine(e);(a=h.getHandleListener("down","keydown"))==null||a.on(x=>b.trigger(x));const _=new rne(e);(c=h.getHandleListener("default","keydown"))==null||c.on(x=>_.trigger(x))}t.forEach(h=>{this.classes[h.cardName]=h}),this.lazyRender&&(window.addEventListener("resize",this.renderAsyncComponents),(d=(u=e.scrollNode)==null?void 0:u.get())==null||d.addEventListener("scroll",this.renderAsyncComponents),window.addEventListener("scroll",this.renderAsyncComponents),e.on("card:async-render",this.renderAsyncComponents))}add(t){this.classes[t.cardName]=t}each(t){this.components.every((e,n)=>!(t&&t(e,n)===!1))}closest(t,e){if(be(t)&&(t=I(t)),!t.isCard()){const n=t.closest(ut,i=>{if(!(i&&e?I(i).isRoot():I(i).isEditable()))return i.parentNode||void 0});if(!n||n.length===0)return;t=n}return t}find(t,e){if(typeof t!="string"){const r=this.closest(t,e);if(!r)return;t=r}const n=r=>{be(r)&&(r=I(r));const s=r.attributes(je);return at(s)},i=this.components.filter(r=>typeof t=="string"?r.id===t:r.root.name!==(be(t)?t.nodeName.toString().toLowerCase():t.name)?!1:r.root.equal(t)||r.id===n(t).id);if(i.length!==0)return i[0]}findBlock(t){if(be(t)&&(t=I(t)),!t.get())return;const e=t.parent();if(!e)return;const n=this.find(e);if(!!n)return n.type===Ve.BLOCK?n:this.findBlock(n.root)}getSingleCard(t){let e=this.find(t.commonAncestorNode);return e||(e=this.getSingleSelectedCard(t)),e}getSingleSelectedCard(t){const e=t.findElements();let n=e[0];if(e.length===1&&n){const i=I(n);if(i.isCard())return this.find(i)}}insertNode(t,e,...n){const i=e.type==="inline",r=this.editor;!t.collapsed&&V(r)&&r.change.delete(t),this.gc();const{inline:s,block:o,node:a}=r;let c=[];if(i){if(V(r)&&e.executeMark){c=r.change.marks.map(h=>h.clone());const d=r.card.find(t.startNode);d!=null&&d.queryMarks&&c.push(...d.queryMarks())}s.insert(e.root,t)}else o.insert(e.root,t,d=>{let h=d.parent();for(;h&&!h.isEditable();){d=h;const f=h.parent();if(f&&a.isBlock(f))h=f;else break}return d},!0);this.components.push(e);const u=e.root.parent();return!i&&u&&u.inEditor()&&a.isBlock(u)&&o.unwrap(u,t),this.renderComponent(e,...n),e.focus(t,!1),e.didInsert&&e.didInsert(),c.forEach(d=>{e.executeMark(d,!0)}),e}removeNode(t){t.destroy&&t.destroy(),this.removeComponent(t),t.root.remove()}updateNode(t,e,...n){t.destroy&&t.destroy();const i=t.getCenter();i==null||i.empty(),t.setValue(e),this.renderComponent(t,...n),t.didUpdate&&t.didUpdate()}replaceNode(t,e,n){const i=this.classes[e];if(!i)throw"".concat(e,": This card does not exist");const r=(n==null?void 0:n.type)||i.cardType,s=t.attributes(we),o=Oi(`<card ${s!=null?s:`${we}="${s}"`} type="${r}" name="${e}" value="${Pi(n)}"></card>`),a=I(o);return t.before(a),a.append(t),a}activate(t,e,n){var o,a,c;const i=this.editor;if(!V(i)||i.readonly)return;const r=t.getRoot(),s=this.active;if(!r.get()||i.container.equal(r)){let u=this.find(t);const d=t.closest(ze);if(!u&&d.length>0){const p=d.parent();u=p?this.find(p):void 0}const h=u?this.findBlock(u.root):void 0;if(h&&(u=h),u&&u.isCursor(t))if(d.length>0){const p=d.parent();u=p?this.find(p):void 0}else u=void 0;const f=u&&s&&s.root.equal(u.root);if(s&&!f&&((o=s.toolbarModel)==null||o.hide(),s.select(!1),s.activate(!1)),u){if(u.activatedByOther)return;f?u.isEditable?u.select(!1):e===ui.MOUSE_DOWN&&t.name!=="input"&&u.root.find(".data-drag-image").length===0&&(n==null||n.preventDefault()):(u.constructor.singleSelectable!==!1&&(e!==ui.CLICK||V(i))&&this.select(u,n),!u.isEditable&&u.constructor.autoSelected!==!1&&u.select(!u.isEditable),u.activate(!0),(a=u.toolbarModel)==null||a.show(n)),i.change.onSelect()}}else s&&((c=s.toolbarModel)==null||c.hide(),s.select(!1),s.activate(!1))}select(t,e){const n=this.editor;if(!!V(n)&&t.constructor.singleSelectable!==!1&&(t.type!==Ve.BLOCK||!t.activated)){const i=n.change.range.get().cloneRange();if(i.startNode.closest(ze).length>0&&(!e||e instanceof MouseEvent&&(!e.target||!this.closest(e.target,!1)))||t.isEditable||t.isMaximize)return;e==null||e.preventDefault();const r=t.root,s=r.parent(),o=s.children().toArray().findIndex(a=>a.equal(r));i.setStart(s,o),i.setEnd(s,o+1),n.change.range.select(i)}}focus(t,e=!1){const n=this.editor;if(!V(n))return;const{change:i,container:r,scrollNode:s}=n,o=i.range.get();t.focus(o,e),i.range.select(o),this.activate(o.startNode,ui.MOUSE_DOWN),i.onSelect(),s&&o.scrollIntoViewIfNeeded(r,s)}insert(t,e,...n){const i=this.editor;if(!V(i))throw"Engine not found";const r=this.create(t,{value:e}),s=i.change,o=s.range.toTrusty(),a=this.insertNode(o,r,...n);return s.change(),a}update(t,e,...n){const i=this.editor;if(!V(i))return;const r=i.change,s=this.find(t);if(s){this.updateNode(s,e,...n);const o=r.range.get();s.focus(o,!1),r.change()}}replace(t,e,n,...i){return this.remove(t.root),this.insert(e,n,...i)}remove(t,e=!0){const n=this.editor;if(!V(n))return;const{change:i,list:r,node:s}=n,o=i.range.get(),a=this.find(t);if(!a)return;a.type===Ve.INLINE?(o.setEndAfter(a.root[0]),o.collapse(!1)):this.focusPrevBlock(a,o,e);const c=a.root.parent();this.removeNode(a),r.addBr(o.startNode),c&&s.isEmpty(c)&&!n.ot.isStopped&&(c.isEditable()?(s.html(c,"<p><br /></p>"),o.select(c,!0),o.shrinkToElementNode(),o.collapse(!1)):(s.html(c,"<br />"),o.select(c,!0),o.collapse(!1))),e?i.apply(o):(i.range.select(o),i.change())}removeRemote(t){const e=this.editor;if(!V(e))return;const{node:n}=e,i=this.find(t);if(!i)return;const r=i.root.parent();this.removeNode(i),r&&n.isEmpty(r)&&!e.ot.isStopped&&(r.isEditable()?n.html(r,"<p><br /></p>"):n.html(r,"<br />"))}create(t,e){var d;const n=this.classes[t];if(!n)throw"".concat(t,": This card does not exist");const i=((d=e==null?void 0:e.value)==null?void 0:d.type)||n.cardType;if(["inline","block"].indexOf(i)<0)throw"".concat(t,': the type of card must be "inline", "block"');e!=null&&e.root&&e.root.empty();const r=this.editor,s=new n({editor:r,value:e==null?void 0:e.value,root:e==null?void 0:e.root}),o=s.root;o.attributes(pt,i),o.attributes(ke,t),o.attributes(Ct,"true");const a=i===Ve.INLINE?"span":"div",c=I(`<${a} ${s.isEditable?Nt+"='*'":""}/>`);c.attributes(He,"center");const u=I("<".concat(a," ").concat(He,'="body" />'));return u.append(c),o.append(u),this.createCursor(s),i===Ve.BLOCK&&r.nodeId.generate(s.root),s.init(),s}createCursor(t){const e=this.editor,n=t.constructor,i=n.focus!==void 0?n.focus:V(e)&&!e.readonly,r=t.getCenter();r.removeAttributes(yt);const s=t.root;s.removeAttributes(yt);const o=t.findByKey("left"),a=t.findByKey("right");i?(r.attributes(yt,"false"),o||r.before(I(`<span ${He}="left" ${jr}="true">&#8203;</span>`)),a||r.after(I(`<span ${He}="right" ${jr}="true">&#8203;</span>`))):(o==null||o.remove(),a==null||a.remove(),s.attributes(yt,"false"))}reRender(...t){t.length===0&&(t=this.components),t.forEach(e=>{e.destroy&&e.destroy(),this.createCursor(e),e.init(),this.renderComponent(e)})}render(t,e,n=this.lazyRender){const i=t?t.isCard()?t:t.find(`${tr}`):this.editor.container.find(tr);this.gc();const r=[],s=[];i.toArray().forEach(u=>{s.find(h=>h.equal(u))||s.push(u),u.find(`${ut},${tr}`).toArray().forEach(h=>{if(h.equal(u))return;const f=s.findIndex(p=>p.equal(h));f>-1&&s.splice(f,1)})}),s.forEach(u=>{const d=u.attributes(),h=d[We],f=d[ke],p=h||f;if(this.classes[p]){const g=d[je];let m;f&&(m=this.find(u),m&&m.root.equal(u)&&(m.destroy&&m.destroy(),this.removeComponent(m)),u.attributes(Ct,"true"),d[Ct]="true",u.empty()),m=this.create(p,{value:at(g),root:f?u:void 0}),Object.keys(d).forEach(v=>{(v.indexOf("data-")===0&&v.indexOf("data-card")!==0||v===Ct)&&m.root.attributes(v,d[v])}),h&&(u.replaceWith(m.root),u.remove()),this.components.push(m),r.push(m),h&&m.root.removeAttributes(We)}});let a=!1;const c=V(this.editor)&&this.editor.ot.isRemote;r.forEach(u=>{if(n&&u.constructor.lazyRender&&(!u.isEditable||!c)){if(u.beforeRender){const d=u.beforeRender(),h=u.getCenter();d!==void 0&&h.append(typeof d=="string"?I(d):d)}a=!0,this.asyncComponents.push(u)}else this.renderComponent(u)}),e&&e(r.length),a&&this.renderAsyncComponents()}renderComponent(t,...e){const n=this.editor,i=t.getCenter(),r=t.render(...e);r!==void 0&&i.append(typeof r=="string"?I(r):r),t.contenteditable.length>0&&(i.find(t.contenteditable.join(",")).each(s=>{const o=I(s);o.attributes(yt)!==void 0&&o.attributes(yt,!V(n)||n.readonly?"false":"true"),o.attributes(le,pi),V(n)&&n.normalize(o)}),this.render(i)),t.didRender()}removeComponent(t){this.each((e,n)=>{if(e.root.equal(t.root))return this.components.splice(n,1),!1})}gc(){for(let t=0;t<this.components.length;t++){const e=this.components[t];(!e.root[0]||e.root.closest("body").length===0)&&(e.destroy&&e.destroy(),this.components.splice(t,1),t--)}}destroy(){var e,n;this.gc();const t=this.editor;window.removeEventListener("resize",this.renderAsyncComponents),(n=(e=t.scrollNode)==null?void 0:e.get())==null||n.removeEventListener("scroll",this.renderAsyncComponents),window.removeEventListener("scroll",this.renderAsyncComponents),t.off("card:async-render",this.renderAsyncComponents)}focusPrevBlock(t,e,n){var s;const i=this.editor;if(!V(i))throw"Engine not initialized";let r;if(t.type==="inline"){const o=i.block.closest(t.root);o.isEditable()?r=t.root.prevElement():r=o.prevElement()}else r=t.root.prevElement();if(n){if(!r||r.attributes(ke)){const o=I("<p><br /></p>");t.root.before(o),e.select(o,!0),e.collapse(!1),i.nodeId.generate(o);return}}else{if(!r)return;if(r.attributes(ke)){(s=i.card.find(r))==null||s.focus(e,!1);return}}e.select(r,!0).shrinkToElementNode().shrinkToTextNode().collapse(!1)}focusNextBlock(t,e,n){var s;const i=this.editor;if(!V(i))throw"Engine not initialized";let r;if(t.type==="inline"){const o=i.block.closest(t.root);o.isEditable()?r=t.root.nextElement():r=o.nextElement()}else r=t.root.nextElement();if(n){if(!r||r.attributes(ke)){const o=I("<p><br /></p>");t.root.after(o),e.select(o,!0),e.collapse(!1),i.nodeId.generate(o);return}}else{if(!r)return;if(r.attributes(ke)){(s=i.card.find(r))==null||s.focus(e,!0);return}}e.select(r,!0).shrinkToElementNode().shrinkToTextNode().collapse(!0)}}class one{constructor(t){y(this,"schema");y(this,"rules",{});this.schema=t}init(){this.rules=this.getRules()}getRules(){const t={};return this.schema.data.blocks.forEach(e=>{t[e.name]||(t[e.name]=[]),t[e.name].push(e)}),t}create(t){be(t)&&(t=I(t));const e=kl(t);return t.attributes(we,e),e}generateAll(t,e=!1){const n=this.rules,i=Object.keys(n).join(",");ft(t)&&t.fragment&&(t=t.fragment);const r=be(t)?t:t.get();if(!r||r.nodeType===Node.TEXT_NODE)return;const s=be(t)?t:t.get(),o=s==null?void 0:s.querySelectorAll(i),a=c=>{!e&&c.getAttribute(we)||this.generate(c,e)};s instanceof Element&&i.includes(s.nodeName.toLowerCase())&&a(s),o==null||o.forEach(a)}generate(t,e=!1){if(be(t)&&(t=I(t)),t.isText())return;const i=this.rules[t.name];if(!i||i.length===0||!i.some(s=>this.schema.checkNode(t,s.attributes)))return;const r=t.closest(`${ut},${$i}`,Ba);if(!(r.length>0&&r.attributes(le)===Qe)&&!(!t.isCard()&&r.length>0&&r.isCard()&&!r.isEditableCard())){if(!e){const s=t.attributes(we);if(s)return s}return this.create(t)}}isNeed(t){const n=this.rules[t.name];return!(!n||n.length===0||!n.some(i=>this.schema.checkNode(t,i.attributes)))}}var ane=function(){var l=document.getSelection();if(!l.rangeCount)return function(){};for(var t=document.activeElement,e=[],n=0;n<l.rangeCount;n++)e.push(l.getRangeAt(n));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return l.removeAllRanges(),function(){l.type==="Caret"&&l.removeAllRanges(),l.rangeCount||e.forEach(function(i){l.addRange(i)}),t&&t.focus()}},lne=ane,Qu={"text/plain":"Text","text/html":"Url",default:"Text"},cne="Copy to clipboard: #{key}, Enter";function une(l){var t=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return l.replace(/#{\s*key\s*}/g,t)}function dne(l,t){var e,n,i,r,s,o,a=!1;t||(t={}),e=t.debug||!1;try{i=lne(),r=document.createRange(),s=document.getSelection(),o=document.createElement("span"),o.textContent=l,o.ariaHidden="true",o.style.all="unset",o.style.position="fixed",o.style.top=0,o.style.clip="rect(0, 0, 0, 0)",o.style.whiteSpace="pre",o.style.webkitUserSelect="text",o.style.MozUserSelect="text",o.style.msUserSelect="text",o.style.userSelect="text",o.addEventListener("copy",function(u){if(u.stopPropagation(),t.format)if(u.preventDefault(),typeof u.clipboardData>"u"){e&&console.warn("unable to use e.clipboardData"),e&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var d=Qu[t.format]||Qu.default;window.clipboardData.setData(d,l)}else u.clipboardData.clearData(),u.clipboardData.setData(t.format,l);t.onCopy&&(u.preventDefault(),t.onCopy(u.clipboardData))}),document.body.appendChild(o),r.selectNodeContents(o),s.addRange(r);var c=document.execCommand("copy");if(!c)throw new Error("copy command was unsuccessful");a=!0}catch(u){e&&console.error("unable to copy using execCommand: ",u),e&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",l),t.onCopy&&t.onCopy(window.clipboardData),a=!0}catch(d){e&&console.error("unable to copy using clipboardData: ",d),e&&console.error("falling back to prompt"),n=une("message"in t?t.message:cne),window.prompt(n,l)}}finally{s&&(typeof s.removeRange=="function"?s.removeRange(r):s.removeAllRanges()),o&&document.body.removeChild(o),i()}return a}var ed=dne;const fne=l=>!!l.dataTransfer;class hne{constructor(t){y(this,"editor");this.editor=t}getData(t){const e=fne(t)?t.dataTransfer:t.clipboardData;let n=e==null?void 0:e.getData("text/html"),i=e==null?void 0:e.getData("text"),r=[];try{(e==null?void 0:e.items)&&e.items.length>0?Array.from(e.items).forEach(s=>{let o=s.kind==="file"?s.getAsFile():null;o!==null&&(o.type&&o.type.indexOf("image/png")>-1&&!o.lastModified&&(o=new File([o],"image.png",{type:o.type})),o.ext=i==null?void 0:i.split(".").pop()),o&&r.push(o)}):(e==null?void 0:e.files)&&e.files.length>0&&(r=Array.from(e.files))}catch{(e==null?void 0:e.files)&&e.files.length>0&&(r=Array.from(e.files))}return n===""&&i&&/^.+\.\w+$/.test(i)&&r.length>0?i="":i===""&&n&&/^(<meta.+?>)?<img.+?>$/.test(n)&&r.length>0?n="":(n||i)&&r.length>0&&!(n!=null&&n.startsWith("<img"))&&(n||!/^https(s)?:/.test(i||""))&&(r=[]),{html:n,text:i,files:r}}write(t,e){var s,o;const n=this.editor.getSelectionData(e);if(!n)return;const{html:i,text:r}=n;return t==null||t.preventDefault(),(s=t==null?void 0:t.clipboardData)==null||s.setData("text/html",'<meta name="source" content="aomao" />'+i),(o=t==null?void 0:t.clipboardData)==null||o.setData("text",r),n}copy(t,e=!1){if(typeof t=="string")return/<[^>]+>/g.test(t)?ed(t,{format:"text/html",onCopy:f=>{f.setData("text/plain",new $t(t,this.editor).toText())}}):ed(t,{format:"text/plain"}),!0;const n=this.editor,i=window.getSelection(),r=i&&Te.from(n,i)||Te.create(n),s=r.cloneRange(),o=I(`<div class="${La}" ${le}="${qn}">&#8203;</div>`);o.css({position:"fixed",top:0,clip:"rect(0, 0, 0, 0)"});const a=()=>{o.remove(),i==null||i.removeAllRanges(),i==null||i.addRange(s.toRange())};o.on("copy",h=>{h.stopPropagation(),this.write(h,r),a()}),I(document.body).append(o),o.append(n.node.clone(I(t),!0)),e&&o.traverse(h=>{h.equal(o)||n.trigger("copy",h)}),o.append(I("&#8203;",null));const c=o.first(),u=o.last();r.select(o,!0),r.setStartAfter(c),r.setEndBefore(u),i==null||i.removeAllRanges(),i==null||i.addRange(r.toRange());let d=!1;try{if(d=document.execCommand("copy"),!d)throw"Copy failed"}catch(h){n.messageError("copy","The copy command was not executed successfully ",h),a()}return d}cut(){var s;const t=this.editor,e=Te.from(t);if(!e||!V(t))return;const n=e.commonAncestorNode,i=t.change;i.cacheRangeBeforeCommand(),i.delete(e);const r=t.node.isList(n)?n:n.find("ul,ol");for(let o=0;o<r.length;o++){const a=I(r[o]);a.find("li").each(u=>{var d;(u.innerText===""||Vr&&u.innerText===`
`)&&((d=u.parentNode)==null||d.removeChild(u))}),((s=a.get())==null?void 0:s.childNodes.length)===0&&a.remove()}i.range.select(e)}}function pne(l,t,e){return l===l&&(e!==void 0&&(l=l<=e?l:e),t!==void 0&&(l=l>=t?l:t)),l}var gne=pne,mne=gne,vne=Yh,bne=Ol,yne=Jh;function _ne(l,t,e){return l=yne(l),e=e==null?0:mne(bne(e),0,l.length),t=vne(t),l.slice(e,e+t.length)==t}var wne=_ne;const Ka=(l,t,e,n)=>{let i,r;const s=/\[\]$/;if(Array.isArray(t))for(r=0;r<t.length;r++){const o=t[r];e||s.test(l)?n(l,o):Ka(l+"["+((typeof o>"u"?"undefined":typeof o)=="object"?r:"")+"]",o,e,n)}else if(t.toString()==="[object Object]")for(i in t)t.hasOwnProperty(i)&&Ka(l+"["+i+"]",t[i],e,n);else n(l,t)},td=(l,t)=>l+(/\?/.test(l)?"&":"?")+t,xne=(l,t=!1)=>{let e,n=[];const i=(r,s)=>{typeof s=="function"?s=s():s==null&&(s=""),n[n.length]=encodeURIComponent(r)+"="+encodeURIComponent(s)};if(Array.isArray(l))for(let r=0;r<l.length;r++)i(l[r].name,l[r].value);else for(e in l)l.hasOwnProperty(e)&&Ka(e,l[e],t,i);return n.join("&").replace(/%20/g,"+")},Bs=l=>typeof FormData<"u"&&l instanceof FormData,kne=/^http/,Ene=/(^\w+):\/\//,Cne=/^(20\d|1223)$/,Ms="readyState",nd="Content-Type",id="X-Requested-With",$r="XMLHttpRequest",Ls="XDomainRequest",Qn={traditional:!1,contentType:"application/x-www-form-urlencoded",requestedWith:$r,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},dataFilter:l=>l};class zl{constructor(t){y(this,"options");y(this,"headNode");y(this,"request");y(this,"isAborted",!1);y(this,"isTimeout",!1);y(this,"timeout");y(this,"callbackData");y(this,"callbackPrefix","request_"+new Date);y(this,"uuid",0);y(this,"promise");y(this,"__resolve");y(this,"__reject");var n;typeof t=="string"&&(t={url:t});let{url:e}=t;wne(e,"//")&&(e=window.location.protocol+e),this.options={...Qn,...t,url:e,context:t.context||window,doc:t.doc||it(),jsonpCallback:t.jsonpCallback||"callback",method:t.method||"GET"},this.headNode=(n=this.options.doc)==null?void 0:n.getElementsByTagName("head")[0],this.initPromise(),this.init()}initPromise(){this.promise=new Promise((t,e)=>{this.__resolve=t,this.__reject=e}).catch(()=>{})}init(){const t=()=>{var i;this.isTimeout=!0,(i=this.request)==null||i.abort()};this.timeout&&clearTimeout(this.timeout),this.timeout=void 0,this.options.timeout&&(this.timeout=setTimeout(t,this.options.timeout));const e=(i,r)=>{this.triggerError(i,r)},n=i=>{this.triggerSuccess(i)};this.getRequest(n,e).then(i=>{this.request=i})}abort(){var t;(t=this.request)==null||t.abort()}defaultXHR(){const{context:t,crossOrigin:e}=this.options;if(!!t)if(e===!0){const n=t[$r]?new t[$r]:null;if(n&&"withCredentials"in n)return n;if(t[Ls])return new t[Ls];throw new Error("Browser does not support cross-origin requests")}else return t[$r]?new t[$r]:new t.ActiveXObject("Microsoft.XMLHTTP")}succeed(){var r,s,o;const{url:t,context:e}=this.options,n=Ene.exec(t);let i=n?n[1]:"";return i||(i=(e==null?void 0:e.location.protocol)||""),kne.test(i)?Cne.test(((s=(r=this.request)==null?void 0:r.status)==null?void 0:s.toString())||""):!!((o=this.request)!=null&&o.response)}noop(){}handleReadyState(t,e){if(this.isAborted)return e("Request is aborted",this.request);if(this.isTimeout)return e("Request is aborted: timeout",this.request);this.request&&this.request[Ms]===4&&(this.request.onreadystatechange=this.noop,this.succeed()?t(this.request):e(this.request.statusText,this.request))}setHeaders(t,e){e.Accept=e.Accept||Qn.accept[this.options.type||"*"],!this.options.crossOrigin&&!e[id]&&(e[id]=Qn.requestedWith),!e[nd]&&!Bs(this.options.data)&&(e[nd]=this.options.contentType||Qn.contentType),Object.keys(e).forEach(n=>{t.setRequestHeader(n,e[n])})}setCredentials(t){typeof this.options.withCredentials<"u"&&typeof t.withCredentials<"u"&&(t.withCredentials=!!this.options.withCredentials)}generalCallback(t){this.callbackData=t}getCallbackPrefix(t){return this.callbackPrefix+"_"+t}handleJsonp(t,e,n){var m;const{jsonpCallback:i,jsonpCallbackName:r,doc:s,context:o}=this.options;if(!s||!o)return;const a=this.uuid++,c=i||"callback";let u=r||this.getCallbackPrefix(a);const d=new RegExp("((^|\\?|&)"+c+")=([^&]+)"),h=t.match(d),f=s.createElement("script");let p=0;const g=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return h?h[3]==="?"?t=t.replace(d,"$1="+u):u=h[3]:t=td(t,c+"="+u),o[u]=this.generalCallback,f.type="text/javascript",f.src=t,f.async=!0,typeof f.onreadystatechange<"u"&&!g&&(f.htmlFor=f.id="_request_"+a),f.onload=f.onreadystatechange=()=>{var v;return f[Ms]&&f[Ms]!=="complete"&&f[Ms]!=="loaded"||p?!1:(f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e(this.callbackData),this.callbackData=void 0,(v=this.headNode)==null||v.removeChild(f),p=1,!0)},(m=this.headNode)==null||m.appendChild(f),{abort:()=>{var v;f.onload=f.onreadystatechange=null,n("Request is aborted: timeout"),this.callbackData=void 0,(v=this.headNode)==null||v.removeChild(f),p=1}}}async getRequest(t,e){var m,v;const n=((m=this.options.method)==null?void 0:m.toUpperCase())||"GET",{processData:i,traditional:r,type:s,context:o,xhr:a,async:c,before:u}=this.options;if(!o)return Promise.resolve(void 0);let{url:d}=this.options,h=this.options.data;typeof h=="function"&&(h=await h()),(((v=this.options.contentType)==null?void 0:v.indexOf("json"))||-1)>-1&&typeof h=="object"&&!Bs(h)&&(h=JSON.stringify(h)),h=i!==!1&&h&&typeof h!="string"&&!Bs(h)?xne(h,r||Qn.traditional):h||null;let f,p=!1;if((s==="jsonp"||n==="GET")&&h&&(d=td(d,h),h=null),s==="jsonp")return Promise.resolve(this.handleJsonp(d,t,e));let g=this.options.headers||{};if(typeof g=="function"&&(g=await g()),f=(typeof a=="function"?a(this.options):a)||this.defaultXHR(),!!f)return f.open(n,d,c!==!1),this.setHeaders(f,g),this.setCredentials(f),o[Ls]&&f instanceof o[Ls]?(f.onload=t,f.onerror=function(){e("http error",f)},f.onprogress=this.noop,p=!0):f.onreadystatechange=()=>{this.handleReadyState(t,e)},u&&u(f),p?setTimeout(()=>{f==null||f.send(h)},200):f.send(h),Promise.resolve(f)}getType(t){if(!!t){if(t.match("json"))return"json";if(t.match("javascript"))return"js";if(t.match("text"))return"html";if(t.match("xml"))return"xml"}}triggerSuccess(t){const{dataFilter:e,context:n,success:i}=this.options;if(!n)return;let{type:r}=this.options;const s=(e||Qn.dataFilter)(t.responseText,r);r||(r=t&&this.getType(t.getResponseHeader("Content-Type")));let o=r!=="jsonp"?this.request:t;try{o.responseText=s}catch{}if(s)switch(r){case"json":try{o=n.JSON.parse(s)}catch{return this.triggerError("Could not parse JSON in response",o)}break;case"html":o=s;break;case"xml":o=o.responseXML&&o.responseXML.parseError&&o.responseXML.parseError.errorCode&&o.responseXML.parseError.reason?null:o.responseXML;break}i&&i(o),this.triggerComplete(o),this.__resolve&&this.__resolve(o)}triggerError(t,e){const{error:n}=this.options,i=new Error(t);i.xhr=e,n&&n(i),this.triggerComplete(i),this.__reject&&this.__reject(i)}triggerComplete(t){const{complete:e}=this.options;this.timeout&&clearTimeout(this.timeout),this.timeout=void 0,e&&e(t)}retry(){this.initPromise(),this.init()}then(t,e){var n;return(n=this.promise)==null?void 0:n.then(t,e)}always(t){var e;return(e=this.promise)==null?void 0:e.then(t,t)}fail(t){var e;return(e=this.promise)==null?void 0:e.then(void 0,t)}catch(t){return this.fail(t)}}y(zl,"setup",t=>{Object.keys(t).forEach(e=>{Qn[e]&&(Qn[e]=t[e])})});var cp={exports:{}};/*!
 2020 Jason Mulligan <jason.mulligan@avoidwork.com>
 @version 6.4.0
*/(function(l,t){(function(e,n){l.exports=n()})(is,function(){var e=/^(b|B)$/,n={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},i={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]},r={floor:Math.floor,ceil:Math.ceil};function s(o){var a,c,u,d,h,f,p,g,m,v,b,_,x,w,E,S,R,D,P,O,L,B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},A=[],F=0;if(isNaN(o))throw new TypeError("Invalid number");if(u=B.bits===!0,E=B.unix===!0,_=B.pad===!0,c=B.base||2,x=B.round!==void 0?B.round:E?1:2,p=B.locale!==void 0?B.locale:"",g=B.localeOptions||{},S=B.separator!==void 0?B.separator:"",R=B.spacer!==void 0?B.spacer:E?"":" ",P=B.symbols||{},D=c===2&&B.standard||"jedec",b=B.output||"string",h=B.fullform===!0,f=B.fullforms instanceof Array?B.fullforms:[],a=B.exponent!==void 0?B.exponent:-1,O=r[B.roundingMethod]||Math.round,m=(v=Number(o))<0,d=c>2?1e3:1024,L=isNaN(B.precision)===!1?parseInt(B.precision,10):0,m&&(v=-v),(a===-1||isNaN(a))&&(a=Math.floor(Math.log(v)/Math.log(d)))<0&&(a=0),a>8&&(L>0&&(L+=8-a),a=8),b==="exponent")return a;if(v===0)A[0]=0,w=A[1]=E?"":n[D][u?"bits":"bytes"][a];else{F=v/(c===2?Math.pow(2,10*a):Math.pow(1e3,a)),u&&(F*=8)>=d&&a<8&&(F/=d,a++);var W=Math.pow(10,a>0?x:0);A[0]=O(F*W)/W,A[0]===d&&a<8&&B.exponent===void 0&&(A[0]=1,a++),w=A[1]=c===10&&a===1?u?"kb":"kB":n[D][u?"bits":"bytes"][a],E&&(A[1]=D==="jedec"?A[1].charAt(0):a>0?A[1].replace(/B$/,""):A[1],e.test(A[1])&&(A[0]=Math.floor(A[0]),A[1]=""))}if(m&&(A[0]=-A[0]),L>0&&(A[0]=A[0].toPrecision(L)),A[1]=P[A[1]]||A[1],p===!0?A[0]=A[0].toLocaleString():p.length>0?A[0]=A[0].toLocaleString(p,g):S.length>0&&(A[0]=A[0].toString().replace(".",S)),_&&Number.isInteger(A[0])===!1&&x>0){var G=S||".",k=A[0].toString().split(G),C=k[1]||"",$=C.length,z=x-$;A[0]="".concat(k[0]).concat(G).concat(C.padEnd($+z,"0"))}return h&&(A[1]=f[a]?f[a]:i[D][a]+(u?"bit":"byte")+(A[0]===1?"":"s")),b==="array"?A:b==="object"?{value:A[0],symbol:A[1],exponent:a,unit:w}:A.join(R)}return s.partial=function(o){return function(a){return s(a,o)}},s})})(cp);const rd=cp.exports,sd={"image/jpeg":["jpeg","jpg","jpe"],"image/png":["png"],"image/gif":["gif"],"image/vnd.wap.wbmp":["wbmp"],"image/tiff":["tiff","tiff"],"image/vnd.adobe.photoshop":["psd"],"image/svg+xml":["svg","svgz"],"text/jsx":["jsx"],"text/less":["less"],"text/css":["css"],"text/x-sass":["sass"],"text/x-scss":["scss"],"text/csv":["cvs"],"text/xml":["xml"],"text/x-vcard":["vcf"],"text/x-vcalendar":["vcs"],"text/markdown":["md"],"text/plain":["txt"],"text/richtext":["rtx"],"text/rtf":["rtf"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js"],"text/yaml":["yaml","yml"],"audio/mp3":["mp3"],"audio/mp4":["mp4","mp4a"],"video/mp4":["mp4"],"audio/mpeg":["mpeg","mp2","mp3"],"audio/ogg":["oga"],"audio/wav":["wav"],"audio/wave":["wav"],"audio/webm":["weba"],"video/x-msvideo":["avi"],"video/quicktime":["mov","qt"],"video/ogg":["ogv"],"video/x-sgi-movie":["movie"],"application/rss+xml":["rss"],"application/json":["json"],"application/zip":["zip"],"application/gzip":["gzip"],"application/pdf":["pdf"],"application/postscript":["ai","eps","ps"],"application/msword":["doc","dot"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.ms-fontobject":["eot"],"application/vnd.android.package-archive":["apk"],"application/x-apple-diskimage":["dmg"],"application/x-iwork-keynote-sffkey":["key"],"application/x-iwork-pages-sffpages":["pages"],"application/x-iwork-keynote-sffnumbers":["numbers"],"application/x-iwork-numbers-sffnumbers":["numbers"]},Jr=l=>{var e,n;if(typeof l=="string")return(e=l.split(".").pop())!=null?e:"";let t=sd[l.type]?sd[l.type][0]:"";return!t&&"name"in l&&(t=(n=l.name.split(".").pop())!=null?n:""),t},up=(l,t=dZ?2:10)=>l<1048576?rd(l,{base:t,exponent:1,round:0}):rd(l,{base:t,exponent:2,round:1});class Sne{constructor(t){y(this,"options");y(this,"uploadingFiles",[]);this.options=t}createUid(t){return Date.now()+"-"+t}async request(t,e){for(let n=0;n<t.length;n++){const i=t[n];i.uid||(i.uid=this.createUid(n)),await this.handleBefore(i,t)===!1&&t.splice(n,1)}this.upload(t,e)}async upload(t,e="file"){t.forEach(async n=>{const i=new FormData;i.append(e,n,n.name),n.data&&Object.keys(n.data).forEach(f=>{i.append(f,n.data[f])});const{url:r,onUploading:s,onSuccess:o,onError:a,withCredentials:c,crossOrigin:u,headers:d}=this.options;let h=this.options.data;if(typeof h=="function"&&(h=await h()),h)if(Bs(h))for(const[f,p]of h)i.append(f,p);else Object.keys(h).forEach(f=>{i.append(f,h[f])});await new zl({xhr:()=>{const f=new window.XMLHttpRequest;return f.upload.addEventListener("progress",p=>{p.lengthComputable&&s&&s(n,{percent:parseInt((p.loaded/p.total*100).toString(),10)})},!1),f},url:r,data:i,contentType:this.options.contentType,type:this.options.type||"json",withCredentials:c,crossOrigin:u,headers:d,success:f=>{o&&o(f,n)},error:f=>{a&&a(f,n)},method:"POST",processData:!0})})}async handleBefore(t,e){const{type:n,uid:i,name:r,size:s}=t,o=Jr(t),{onBefore:a}=this.options;return a&&await a(t)===!1?!1:new Promise((c,u)=>{const d=new FileReader;d.addEventListener("load",()=>{this.uploadingFiles[i]={uid:i,src:d.result,name:r,size:s,type:n,ext:o},e.every(h=>!!this.uploadingFiles[h.uid])?Promise.all([...e.map(h=>new Promise(async f=>{this.options.onReady&&await this.options.onReady(this.uploadingFiles[h.uid],h),f(!0)}))]).then(()=>{c(!0)}):c(!0)},!1),d.addEventListener("error",()=>{u(!1)}),d.readAsDataURL(t)})}}class Ane{ajax(t){return new zl(t)}upload(t,e,n){return new Sne(t).request(e,n)}getFiles(t){let{event:e,accept:n,multiple:i}=t||{};n=n||"*",i===!1?i=1:(i===void 0||i===!0)&&(i=100);const r=document.createElement("input");r.type="file",r.accept=n,r.style.display="none",r.multiple=i>1;const s=()=>{r.remove(),document.removeEventListener("mousedown",s)};return new Promise(o=>{const a=()=>{var h;const c=[],u=(h=r.files)!=null?h:[],d=Math.min(u.length,i);for(let f=0;f<d;f++)c.push(u[f]);r.removeEventListener("change",a),s(),o(c)};r.addEventListener("change",a),document.body.appendChild(r),e||(e=document.createEvent("MouseEvents"),e.initEvent("click",!0,!0));try{if(r.dispatchEvent)r.dispatchEvent(e);else if(r.fireEvent)r.fireEvent(e);else throw"";document.addEventListener("mousedown",s)}catch{r.removeEventListener("change",a),s(),o([])}})}}class dp{constructor(t){y(this,"engine");this.engine=t}trigger(t,e){var u,d,h;const{change:n,command:i,list:r,node:s}=this.engine;let o=n.range.get();const a=this.engine.block;if(o.collapsed){const f=a.closest(o.startNode);if(f.name==="li"&&r.isFirst(o))return t.isDelete||(t.preventDefault(),i.execute(r.getPluginNameByNode(f))),!1}else{const{startNode:f,endNode:p}=o,g=a.closest(f),m=a.closest(p);if(g.name==="li"||m.name==="li"){t.preventDefault();const v=o.cloneRange(),b=f.first(),_=f.isCard()?f:b;if(_!=null&&_.isCard()&&r.isEmptyItem(g)){const S=g.parent();g.remove(),S&&s.isCustomize(S)&&((u=S.get())==null?void 0:u.childNodes.length)===0&&S.remove()}const x=g.name==="li"?g.parent():null,w=m.name==="li"?m.parent():null;if(g.name==="li"&&r.isFirst(o)&&v.setStartBefore(g),m.name==="li"&&a.isLastOffset(o,"end")&&v.setEndAfter(m),n.delete(v,e),g.inEditor()&&!g.equal(m)&&m.inEditor()&&m.name==="li"){v.shrinkToElementNode().shrinkToTextNode();const S=v.createSelection();g.append(m.children()),m.remove(),S.move()}g.name==="li"&&s.isCustomize(g)&&((d=g.get())==null?void 0:d.childNodes.length)===0&&g.remove();const E=S=>{var R;if(s.isList(S)){const D=((R=S.get())==null?void 0:R.childNodes)||[];if(D.length==0)S.remove();else if(D.length===1){const P=S.first();P!=null&&P.isCursor()&&(S.after(P),S.remove())}}};return x&&x.length>0&&s.isList(x)&&E(x),w&&w.length>0&&s.isList(w)&&E(w),r.addBr(g),g.equal(m)||r.addBr(m),o.setStart(v.startContainer,v.startOffset),o.collapse(!0),r.merge(),n.isEmpty()&&n.initValue(o),n.apply(o),!1}}if(!a.isFirstOffset(o,"start"))return;let c=a.closest(o.startNode);if(s.isList(c)){const f=c.first();if(!f||f.isText())return t.preventDefault(),n.mergeAfterDelete(c),!1;c=f,o.setStart(c[0],0),o.collapse(!0),n.range.select(o)}if(c.name==="li"){if(s.isCustomize(c))return;t.preventDefault();const f=c.closest("ul");return(h=c.parent())!=null&&h.isEditable()?(n.mergeAfterDelete(c),!1):(f.length>0?i.execute(r.getPluginNameByNode(f)):n.unwrap(c),!1)}return!0}}class Tne{constructor(t){y(this,"engine");y(this,"backspace");this.engine=t,this.backspace=new dp(t)}trigger(t){const{change:e,command:n,list:i}=this.engine;let r=e.range.get();r.shrinkToElementNode();const s=this.engine.block.closest(r.startNode),o=this.engine.block.closest(r.endNode);if(s.name==="li"||o.name==="li"){r.collapsed||(this.backspace.trigger(t,s.name!==o.name),r=e.range.get()),t.preventDefault();const a=i.getPluginNameByNode(s);if(i.isLast(r)&&i.isFirst(r))n.execute(a);else{this.engine.block.split(),r=e.range.get();const c=this.engine.block.closest(r.endNode),u=i.getPlugins().find(d=>a===d.constructor.pluginName);if(!u)return;if(u.cardName){const d=c.prev();d&&(i.addCardToCustomize(d,u.cardName),i.addBr(d)),i.addCardToCustomize(c,u.cardName),i.addBr(c);const h=c.next();h&&(i.addCardToCustomize(h,u.cardName),i.addBr(h))}i.merge(void 0,r),i.addBr(r.startNode.closest("ul")),r.setStart(c,this.engine.node.isCustomize(c)?1:0),r.collapse(!0).shrinkToTextNode(),e.apply(r)}return r.scrollIntoView(),!1}return!0}}class Nne{constructor(t){y(this,"editor");y(this,"CUSTOMZIE_UL_CLASS","data-list");y(this,"CUSTOMZIE_LI_CLASS","data-list-item");y(this,"INDENT_KEY","data-indent");y(this,"STYLE_POSITION_NAME","list-style-position");y(this,"STYLE_POSITION_VALUE","inside");y(this,"backspaceEvent");this.editor=t}init(){var e,n;const t=this.editor;if(V(t)){const i=new Tne(t);(e=t.typing.getHandleListener("enter","keydown"))==null||e.on(r=>i.trigger(r)),this.backspaceEvent=new dp(t),(n=t.typing.getHandleListener("backspace","keydown"))==null||n.on(r=>{var s;return(s=this.backspaceEvent)==null?void 0:s.trigger(r)})}}isEmptyItem(t){const e=t.children().toArray().filter(i=>!i.isCursor()),n=this.editor.node;return t.name==="li"&&(n.isEmpty(t)||(e.length===1?n.isCustomize(t)&&e[0].isCard()||e[0].name==="br":e.length===2&&n.isCustomize(t)&&!!e[0].isCard()&&e[1].name==="br"))}isSame(t,e){if(t.name!==e.name)return!1;const{node:n}=this.editor;if(n.isCustomize(t)!==n.isCustomize(e))return!1;const i=parseInt(t.attributes(this.INDENT_KEY),10)||0,r=parseInt(e.attributes(this.INDENT_KEY),10)||0;return i===r}isSpecifiedType(t,e="ul",n){const{node:i}=this.editor;let r=!0;return t.forEach(s=>{var o;if(!(["li","p"].indexOf(s.name)===-1&&(s.name===e||s.find(e).length>0)))switch(s.name){case"li":if(n){let a=s.first();a!=null&&a.isCursor()&&(a=a.next()),r=r&&i.isCustomize(s)&&((a==null?void 0:a.attributes(ke))||"")===n}else r=r&&!i.isCustomize(s);break;case"p":s.parent()&&((o=s.parent())==null?void 0:o.name)!=="li"&&(r=!1);break;default:r=!1;break}}),r}getPlugins(){const t=[],e=this.editor.plugin;return Object.keys(e.components).forEach(n=>{const i=e.components[n];i.isCurrent&&t.push(i)}),t}getPluginNameByNode(t){let e=t.name;const n=i=>{let r="";return this.getPlugins().some(s=>{if(s.isCurrent(i))return r=s.constructor.pluginName,!0}),r};return this.editor.node.isCustomize(t)?n(t):e==="li"&&t.parent()?n(t.parent()):""}getPluginNameByNodes(t){let e="";for(let n=0;n<t.length;n++){const i=t[n],r=i.parent();let s="";switch(i.name){case"li":case"ul":case"ol":s=this.getPluginNameByNode(t[n]);break;case"p":if(r&&r.name==="li")s=this.getPluginNameByNode(r);else return"";break;default:if(this.editor.node.isBlock(i)&&i.find("ul,ol").length>0)break;return""}if(e&&s&&e!==s)return"";e=s}return e}unwrapCustomize(t){const e=this.editor.node;if(e.isCustomize(t))switch(t.name){case"li":if(e.isCustomize(t)){const n=t.first();n!=null&&n.isCard()&&n.remove()}return t.removeAttributes("class"),t;case"ul":return t.removeAttributes("class"),t;default:return t}return t}unwrap(t,e=I("<p />")){let n=0;const{node:i,schema:r}=this.editor,s=r.data.globals.block||{},o=s.style||{};t.forEach(a=>{if(this.unwrapCustomize(a),i.isList(a)&&(n=parseInt(a.attributes(this.INDENT_KEY),10)||0,i.unwrap(a)),a.name==="li"){const c=i.clone(e,!1,!1);n!==0&&c.css("text-indent",n*2+"em"),a.removeAttributes(this.INDENT_KEY);const u=a.attributes();Object.keys(u).forEach(h=>{h!==we&&h!=="id"&&s[h]&&c.attributes(h,u[h])});const d=a.css();d["text-align"]&&this.addAlign(c,d["text-align"]),delete d["text-align"],d[this.STYLE_POSITION_NAME]="",Object.keys(d).forEach(h=>{o[h]||(d[h]="")}),c.css(d),i.replace(a,c)}})}normalize(t){const e=this.editor;if(!V(e))return[];const{change:n,block:i,node:r}=e;t=t||n.range.get();const s=i.getBlocks(t),o=[];s.forEach((c,u)=>{const d=c.parent();if(c.name==="p"){if((d==null?void 0:d.name)==="li"){u===0&&o.push(d),r.unwrap(c);return}if(d&&["ul","ol"].indexOf(d.name)>-1){c=r.replace(c,I("<li />")),o.push(c);return}}if(c.name==="li"&&(d==null?void 0:d.name)==="li"){u===0&&o.push(d),r.unwrap(c);return}if(["ul","ol"].indexOf(c.name)>-1&&(d==null?void 0:d.name)==="li"){r.unwrap(c);return}o.push(c)});const a=t.endNode.closest("li");return o.some(c=>c[0]===a[0])||o.push(a),o}split(t){const e=this.editor;if(!V(e))return;const{change:n,node:i}=e,r=t||n.range.toTrusty(),s=this.normalize(t);if(s.length>0&&(s[0].name==="li"||s[s.length-1].name==="li")){const o=r.createSelection(),a=s[0],c=s[s.length-1],u=[],d=[];let h,f;if(a.prev()){h=a.parent();let m=0;for(;s[m]&&s[m].name==="li";)u.push(s[m]),m+=1}if(c.next()){f=c.parent();let m=c.next();for(;m&&m.name==="li";)d.push(m),m=m.next()}let p;d.length>0&&f&&(p=i.clone(f,!1,!1),d.forEach(m=>{p==null||p.append(m[0])}),f.after(p));let g;if(u.length>0&&h&&(g=i.clone(h,!1,!1),u.forEach(m=>{g==null||g.append(m[0])}),h.after(g)),h&&f&&f.equal(h)&&h.name==="ol"){const m=(parseInt(h.attributes("start"),10)||1)+h.find("li").length;p.attributes("start",m)}o.move()}t||n.apply(r)}merge(t,e){const n=this.editor;if(!V(n))return;const{change:i,block:r,node:s}=n,o=e||i.range.toTrusty(),a=o.cloneRange(),c=t?void 0:a.shrinkToElementNode().createSelection();if(t=t||r.getBlocks(o),t.forEach(u=>{if(u=u.closest("ul,ol"),!s.isList(u))return;const d=u.prev(),h=u.next();d&&this.isSame(d,u)&&(s.merge(d,u),u=d),h&&this.isSame(h,u)&&s.merge(u,h)}),t=r.getBlocks(o),t.length>0){const u=t[0].closest("ul,ol");this.addStart(u)}c==null||c.move(),!e&&c!==void 0&&i.apply(a)}addStart(t){const e=this.editor;if(!V(e))return;const{change:n,node:i}=e;if(!t){const u=e.block.getBlocks(n.range.get());if(u.length===0)return;t=u[0].closest("ul,ol")}if(!t||!i.isList(t))return;const r=parseInt(t.attributes(this.INDENT_KEY),10)||0;let s=[],o=r,a=t.prev();for(;a&&i.isList(a);){if(a.name==="ol"){const u=parseInt(a.attributes(this.INDENT_KEY),10)||0,d=parseInt(a.attributes("start"),10)||1,h=a.find("li").length;if(u===0){s[u]=d+h;break}u<=o&&(o=u,s[u]=s[u]||d+h)}else o=parseInt(a.attributes(this.INDENT_KEY),10)||0;a=a.prev()}let c=t;for(;c;){if(i.isList(c)){const d=parseInt(c.attributes(this.INDENT_KEY),10)||0,h=parseInt(c.attributes("start"),10),f=c.find("li").length;if(c.name==="ol"){let p=s[d];d>0?(p=p||1,p>1?c.attributes("start",p):c.removeAttributes("start"),s[d]=p+f):p&&p!==h?(p>1?c.attributes("start",p):c.removeAttributes("start"),s[d]=p+f):(s[d]=(h||1)+f,s=s.slice(0,d+1))}}else s=[];const u=c.next();if(!u)break;c=u}}addIndent(t,e,n){this.editor.node.isList(t)&&(e=this.getIndent(t)+(e<0?-1:1),n&&e>n&&(e=n),e<1?t.removeAttributes(this.INDENT_KEY):t.attributes(this.INDENT_KEY,e))}getIndent(t){return this.editor.node.isList(t)&&parseInt(t.attributes(this.INDENT_KEY),10)||0}addAlign(t,e){t.name==="li"&&(e&&e!=="left"?(["center","right"].indexOf(e)>-1&&t.css({[this.STYLE_POSITION_NAME]:this.STYLE_POSITION_VALUE}),t.css({"text-align":e})):t.css({[this.STYLE_POSITION_NAME]:"","text-align":""}))}addCardToCustomize(t,e,n){var d,h,f;if(be(t)&&(t=I(t)),t.name!=="li")return;const i=t.first();if((i==null?void 0:i.isBlockCard())||(i==null?void 0:i.isCard())&&i.attributes(ke)===e)return;const r=this.editor,{card:s}=r,o=s.create(e,{value:n}),a=Te.create(r),c=I("<br />");((h=(d=t.get())==null?void 0:d.childNodes.length)!=null?h:0)>0?(f=t.first())==null||f.before(c):t.append(c),a.select(c,!0),s.insertNode(a,o);const u=t.last();return(u==null?void 0:u.name)==="br"&&u.remove(),o}addReadyCardToCustomize(t,e,n){if(be(t)&&(t=I(t)),t.name!=="li")return;const i=t.first();if((i==null?void 0:i.isBlockCard())||(i==null?void 0:i.isCard())&&i.attributes(ke)===e)return;const r=I("<span />");return t.prepend(r),this.editor.card.replaceNode(r,e,n),r}addBr(t){var n;const e=this.editor.node;if(e.isList(t))t.find("li").each(i=>{this.addBr(I(i))});else if(e.isCustomize(t)){let i=t.last();for(;i!=null&&i.isCursor();)i=i.prev();if(i){const r=t.children();if(r.length===1&&i.isCard()){t.append(I("<br />"));return}if(r.length>2&&i.name==="br"){((n=i.prev())==null?void 0:n.name)!=="br"&&i.remove();return}for(;i;){if(i.equal(t.first())&&(i.isCard()||i.text()==="")){t.append(I("<br />"));return}if(i.type===Node.TEXT_NODE){if(i.text()!=="")return;i=i.prev()}else if(i.type===Node.ELEMENT_NODE){if(!e.isMark(i)||i.text()!=="")return;i=t.prev()}else i=i.prev()}}else t.append(I("<br />"))}}insert(t,e){var P,O,L,B,A,F,W,G,k,C,$,z,M,T,K,ee,Y,q,Z,te,se,fe,J;const n=this.editor;if(!V(n)||t.childNodes.length===0)return;const{change:i,node:r,block:s}=n,o=e||i.range.toTrusty();o.collapsed||i.delete(o,!0,!0);const a=o.cloneRange().shrinkToElementNode();let{startNode:c,startOffset:u}=a,d=c;if(r.isList(c)&&(d=c.children().eq(u)),d=d==null?void 0:d.closest("li",X=>r.isBlock(X)&&X.nodeName!=="LI"?void 0:X.parentElement||void 0),(d==null?void 0:d.length)===0||(d==null?void 0:d.name)!=="li")return;o.shrinkToElementNode().shrinkToTextNode(),s.split(o);const h=o.createSelection("list-insert");this.split(o);const f=X=>{s.merge(X),this.merge(void 0,X),h==null||h.move(),e||i.apply(X)};let p=I(t).toArray().some(X=>r.isBlock(X))?I(t.childNodes[0]):I("<p></p>").append(I(t));const g=o.startNode.closest("ul,ol");if(!g||!r.isList(g)){f(o);return}const m=o.startNode.closest("li");if(r.isCustomize(g)){const X=(O=(P=g.prev())==null?void 0:P.first())==null?void 0:O.first();if(X){const ae=n.card.find(X);ae&&this.addCardToCustomize(m,ae.name,ae.getValue())}}const v=!r.isList(p)||this.isSame(g,p);if(v){for(;r.isBlock(p);){const ae=p.first();if(ae&&r.isBlock(ae)){p=ae;continue}break}const X=(B=(L=m.parent())==null?void 0:L.prev())==null?void 0:B.last();if((X==null?void 0:X.name)==="li"){const ae=X==null?void 0:X.children();ae==null||ae.each((_e,Me)=>{var ge;_e.nodeName==="BR"&&((ge=ae.eq(Me))==null||ge.remove())}),r.isCustomize(p)&&((A=p.first())==null||A.remove()),p.isBlockCard()?(F=X.parent())==null||F.after(p):(X==null||X.append(r.isBlock(p)?p.children():p),X&&this.addBr(X),r.isBlock(p)&&p.remove())}}else{const X=(G=(W=m.parent())==null?void 0:W.prev())==null?void 0:G.last();X&&(r.isEmpty(X)||this.isEmptyItem(X))&&(X.remove(),((C=(k=X.parent())==null?void 0:k.get())==null?void 0:C.childNodes.length)===0&&(($=X.parent())==null||$.remove()))}if(t.childNodes.length===0||t.childNodes.length===1&&r.isList(t.childNodes[0])&&t.childNodes[0].childNodes.length===0){const X=m.parent();if(!p.isBlockCard())r.isCustomize(m)&&((z=m.first())==null||z.remove()),m.find("br").remove(),(T=(M=X==null?void 0:X.prev())==null?void 0:M.last())==null||T.append(m.children()),X==null||X.remove();else if(X){this.isEmptyItem(m)&&((K=X.get())==null?void 0:K.childNodes.length)===1&&X.remove();const ae=[X],_e=p.prev();_e&&r.isList(_e)&&ae.push(_e),this.merge(ae)}f(o);return}let b=o.startNode.closest("li").parent();if(!b){f(o);return}const _=t.childNodes.length;let x=I(t.childNodes[_-1]);const w=(!r.isList(x)||this.isSame(g,x))&&!x.isBlockCard();let E=!1;for(let X=0;X<t.childNodes.length;X++){const ae=I(t.childNodes[X]);if(r.isList(t.childNodes[X])&&!this.isSame(g,ae)||ae.isBlockCard()){E=!0;break}}const S=b.prev(),R=S?[S]:[];for(let X=0;X<(w&&!E?_-1:_);X++){const ae=I(t.childNodes[0]);if(r.isList(ae)){if(((ee=ae.get())==null?void 0:ee.childNodes.length)===0){ae.remove();continue}b.before(ae),R.push(ae)}else{if(E){b==null||b.before(ae);continue}if(r.isBlock(ae)&&ae.allChildren().forEach(_e=>{_e.type!==it().TEXT_NODE&&r.isBlock(_e)&&r.unwrap(_e)}),r.isCustomize(b)){const _e=(Y=b.first())==null?void 0:Y.first();if(_e&&_e.isCard()){const Me=_e.attributes(ke)||_e.attributes("name"),ge=this.toCustomize(ae,Me);ge&&(Array.isArray(ge)?ge:[ge]).forEach($e=>{b==null||b.before($e)})}}else{const _e=this.toNormal(ae,b.name);(Array.isArray(_e)?_e:[_e]).forEach(Me=>{n.node.isList(Me)&&(b==null||b.before(Me))})}}}if(R.length>0&&this.merge(R),!v&&r.isEmptyWidthChild(b)&&b.remove(),t.childNodes.length===0){if(r.isEmpty(m)||this.isEmptyItem(m)){const X=(q=m.parent())==null?void 0:q.prev();m.find("br").remove(),r.isCustomize(m)&&((Z=m.first())==null||Z.remove()),X&&r.isList(X)?(te=X.last())==null||te.append(m.children()):X&&X.append(m.children()),(se=m.parent())==null||se.remove()}f(o);return}for(;r.isBlock(x);){const X=x.last();if(X&&r.isBlock(X)){x=X;continue}break}const D=m;if(D){if(!((fe=x.parent())!=null&&fe.fragment)){let X=D,ae=x.prev();for(;ae&&ae.length>0;){const _e=ae.prev();X.before(ae),X=ae,ae=_e}}if(x.name==="br")x.remove();else{const X=x.children();if(X.each((ae,_e)=>{var Me;ae.nodeName==="BR"&&((Me=X.eq(_e))==null||Me.remove())}),r.isCustomize(D)){if(r.isCustomize(x)){const ae=x.first();ae!=null&&ae.isCard()&&ae.remove()}(J=D.first())==null||J.after(r.isBlock(x)?x.children():x)}else D.prepend(r.isBlock(x)?x.children():x);this.addBr(D),r.isBlock(x)&&x.remove()}}f(o)}blockToItem(t,e,n,i){const r=I("<li></li>"),{node:s,schema:o}=this.editor;if(!s.isList(e))return e;const a=Ee(t.css("text-indent"))/2,c=o.data.globals.block||{},u=t.attributes();Object.keys(u).forEach(f=>{f!==we&&f!=="id"&&c.name&&r.attributes(f,u[f])});const d=c.style||{},h=t.css();return h["text-align"]&&this.addAlign(r,h["text-align"]),delete h["text-align"],delete h[this.STYLE_POSITION_NAME],Object.keys(h).forEach(f=>{d[f]||delete h[f]}),r.css(h),t=s.replace(t,r),n&&(t.addClass(this.CUSTOMZIE_LI_CLASS),this.addCardToCustomize(t,n,i)),a&&e.attributes(this.INDENT_KEY,a),s.wrap(t,e)}toCustomize(t,e,n,i="ul"){var s;const{node:r}=this.editor;if(Array.isArray(t)){let o=[];return t.forEach(a=>{r.isCustomize(a)&&this.unwrapCustomize(a),o=o.concat(this.toCustomize(a,e,n,i))}),o}else{const o=I(`<${i} class="${this.CUSTOMZIE_UL_CLASS}"/>`);switch(t.name){case"li":return t.addClass(this.CUSTOMZIE_LI_CLASS),this.addCardToCustomize(t,e,n),t;case"ul":case"ol":return o.attributes(t.attributes()),t=r.replace(t,o),t;default:if(t.name==="p"||r.isNestedBlock(t)&&!t.isBlockCard()){if(((s=t.parent())==null?void 0:s.name)==="li")return r.unwrap(t),t;t=this.blockToItem(t,o,e,n)}return t}}}toNormal(t,e="ul",n){var r;const{node:i}=this.editor;if(Array.isArray(t)){let s=[];return t.forEach(o=>{const a=this.toNormal(o,e,n);s=s.concat(a)}),s}else{this.unwrapCustomize(t);const s=I("<".concat(e," />"));switch(t.name){case"li":case e:return t;case"ol":case"ul":return s.attributes(t.attributes()),s.name==="ul"&&s.removeAttributes("start"),t=i.replace(t,s),t;default:if(t.name==="p"||i.isNestedBlock(t)&&!t.isBlockCard()){if(((r=t.parent())==null?void 0:r.name)==="li")return i.unwrap(t),t;t=this.blockToItem(t,s),n&&t.attributes("start",n)}return t}}}isFirst(t){const{startNode:e,startOffset:n}=t,i=t.cloneRange(),r=e.name==="li"?e:e.closest("li");if(!r[0])return!1;i.select(r,!0),i.setEnd(e[0],n);const s=i.cloneContents();if(!s.firstChild)return!0;const o=I(s.firstChild),a=I(s.lastChild||[]);if(s.childNodes.length===1&&o.name==="br"||s.childNodes.length===1&&r.hasClass(this.CUSTOMZIE_LI_CLASS)&&o.isCard())return!0;const c=this.editor.node;if(s.childNodes.length===2&&r.hasClass(this.CUSTOMZIE_LI_CLASS)&&o.isCard()&&c.isEmpty(a))return!0;const u=I("<div />");return u.append(s),c.isEmpty(u)}isLast(t){const{endNode:e,endOffset:n}=t,i=t.cloneRange(),r=e.name==="li"?e:e.closest("li");if(!r[0])return!1;i.select(r,!0),i.setStart(e,n);const s=i.cloneContents();if(!s.firstChild)return!0;const o=I(s.firstChild),a=I(s.lastChild||[]);if(s.childNodes.length===1&&o.name==="br"||s.childNodes.length===1&&r.hasClass(this.CUSTOMZIE_LI_CLASS)&&o.isCard())return!0;const c=this.editor.node;if(s.childNodes.length===2&&r.hasClass(this.CUSTOMZIE_LI_CLASS)&&o.isCard()&&c.isEmpty(a))return!0;const u=I("<div />");return u.append(s),c.isEmpty(u)}}class Dne{constructor(t){y(this,"engine");this.engine=t}trigger(t){const{change:e,node:n,block:i}=this.engine,r=e.range.get(),{collapsed:s,endNode:o,startNode:a,startOffset:c,endOffset:u}=r.cloneRange().shrinkToTextNode();if(s){const d=i.closest(a);if(d.length>0&&n.isEmpty(d))return}if(o.type===Node.TEXT_NODE||a.type===Node.TEXT_NODE){if(!s){let h=o.parent();if(h&&o.type===Node.TEXT_NODE&&n.isMark(h)){const p=o.text().substr(u);if(!/^\u200b$/.test(p))return!0;r.setEnd(o,u+1)}return!0}let d=a.parent();if(d&&a.type===Node.TEXT_NODE&&n.isMark(d)){if(c<1)return!0;const f=a.text().substr(c-1,1);if(!/^\u200b$/.test(f))return!0;if(c===1){const p=d.prev();if(p&&!n.isEmpty(p)){const{startNode:g,startOffset:m}=r.cloneRange().select(p,!0).shrinkToTextNode().collapse(!1);r.setStart(g,m-1)}else if(!p&&n.isEmpty(d)){const g=d.parent(),m=d.getIndex();d.remove(),g&&r.setStart(g,m<=0?0:m-1)}}else r.setStart(a,c-1);return!0}if(d=a.prev()||void 0,d&&a.type===Node.TEXT_NODE&&n.isMark(d)){const f=a.text().substr(c-1,1);if(!/^\u200b$/.test(f))return!0;if(c===1){const{startNode:p,startOffset:g}=r.cloneRange().select(d,!0).shrinkToTextNode().collapse(!1);r.setStart(p,g-1)}else r.setStart(a,c>0?c-1:0)}}return!0}}class Rne{constructor(t){y(this,"editor");y(this,"pluginCaches",new Map);y(this,"findSameParent",(t,e)=>{const{node:n}=this.editor;if(n.isMark(t)){let i;if(this.compare(t,e,!0))return!0;if(i=t.parent())return this.findSameParent(i,e)}return!1});this.editor=t}init(){var e;const t=this.editor;if(V(t)){const n=new Dne(t);(e=t.typing.getHandleListener("backspace","keydown"))==null||e.on(i=>n.trigger(i)),t.on("keydown:space",i=>this.triggerMarkdown(i)),t.on("keydown:enter",i=>this.triggerMarkdown(i))}}triggerMarkdown(t){var m;const e=this.editor;if(!V(e)||((m=e.options.markdown)==null?void 0:m.mode)===!1)return;const{change:n}=e;let i=n.range.get();if(!i.collapsed||n.isComposing())return;const{startNode:r,startOffset:s}=i.cloneRange().shrinkToTextNode(),o=r.type===Node.TEXT_NODE?r:r.children().eq(s-1);if(!o)return;const a=i.toPath(),c=o.type===Node.TEXT_NODE?o.text().substr(0,s):o.text(),u=po(e,"zero"),{renderer:d,options:h}=u,f=u.parseInline(c,{});if(f.length===0)return;let p=!1,g="";if(f.forEach(v=>{let b="";const _=v.children||[];_.forEach((x,w)=>{const{type:E}=x;if(e.trigger("markdown-it-token",{token:v,markdown:u,callback:R=>{b+=R}})===!1){p=!0;return}!p&&E!=="text"&&(p=!0),typeof d.rules[E]<"u"?b+=d.rules[E](_,w,h,{},d):b+=d.renderToken(_,w,h)}),g+=b}),p){const v=e.node;t.preventDefault(),i.setStart(o[0],0),i.setEnd(o[0],s),n.paste(g,i),n.rangePathBeforeCommand=a,i.collapse(!1),i.enlargeToElementNode();const b=I(g),_=b.last(),x=b.eq(b.length-1);(v.isMark(b)||_&&v.isMark(_)||x&&v.isMark(x))&&v.insertText("\xA0",i),n.range.select(i)}return!p}findPlugin(t){const{node:e,plugin:n,schema:i}=this.editor;if(t.length===0||!e.isMark(t))return;const s=t.get().cloneNode().outerHTML;let o=this.pluginCaches.get(s);if(o)return o;for(const a in n.components){const c=n.components[a];if(Bl(c)&&t.name===c.tagName){const u=c.schema();if(Array.isArray(u)?u.find(d=>i.checkNode(t,d.attributes)):i.checkNode(t,u.attributes))return this.pluginCaches.set(s,c),c}}return o}closest(t){const e=this.editor.node;let n=t.parent();for(;n&&!n.isEditable()&&!e.isBlock(n);){if(e.isMark(n))return n;const i=n.parent();if(!i)break;n=i}return t}closestNotMark(t){for(;(this.editor.node.isMark(t)||t.isText())&&!t.isEditable();){const e=t.parent();if(!e)break;t=e}return t}compare(t,e,n){if(t.name!==e.name)return!1;const i=t.attributes();delete i.style,delete i[we];const r=e.attributes();delete r.style,delete r[we];const s=t.css(),o=e.css();delete i.class,delete r.class;const a=t.get().className.trim(),c=e.get().className.trim();let u=a!==""?a.split(/\s+/):[],d=c!==""?c.split(/\s+/):[];const{schema:h}=this.editor,f=h.find(g=>g.name===t.name),p=g=>{for(let m=0;m<f.length;m++){const v=f[m];if(v.attributes&&h.checkValue(v.attributes,"class",g.join(" ").trim()))return v.attributes.class.toString()}return g.join(" ").trim()};return n||(u=u.length>0?[p(u)]:[],d=d.length>0?[p(d)]:[]),!(Object.keys(i).length!==Object.keys(r).length||!Object.keys(i).every(g=>n?i[g]===r[g]:!!r[g])||Object.keys(s).length!==Object.keys(o).length||!Object.keys(s).every(g=>n?s[g]===o[g]:!!o[g])||u.length!==d.length||!u.every(g=>d.indexOf(g)!==-1))}contain(t,e){const n=e.attributes(),i=n.style||{};delete n.style;const r=t.attributes(),s=r.style||{};return delete r.style,Object.keys(n).every(o=>!!r[o])&&Object.keys(i).every(o=>!s[o])}unwrapEmptyMarks(t,e){const{node:n}=this.editor;t.allChildren().forEach(r=>{if(n.isEmpty(r)&&n.isMark(r)&&(!e||e(r))){const s=r.children();s.length===1&&s.isText()?r.remove():n.unwrap(r)}})}splitOnCollapsed(t,e,n){var a;if(!t.collapsed)return;t.enlargeFromTextNode(),t.shrinkToElementNode();const{startNode:i}=t,r=i.parent(),s=i.isCard()?i:i.closest(ut),{node:o}=this.editor;if((s.length===0||s.attributes(pt)!=="inline")&&(o.isMark(i)||r&&o.isMark(r))){const c=this.closestNotMark(i),u=t.createSelection(),d=u.getNode(c,"left");let h,f,p=[];if(n){be(n)&&(n=I(n));const D=n.getPath(c.get()),P=c.clone(!0);p=D.slice(1),f=I(P.getChildByPath(D.slice(0,1))),h=u.getNode(P,"right",!1)}else h=u.getNode(c,"right");this.unwrapEmptyMarks(d,D=>!D.isCursor()),this.unwrapEmptyMarks(h,D=>(e&&!Array.isArray(e)&&(e=[e]),!e||e.length===0||!D.isCard()&&e.some(O=>this.compare(D,O))));const g=c.children();g.each((D,P)=>{const O=g.eq(P);O!=null&&O.isCard()||O==null||O.remove()});let m;const v=D=>{D.each((P,O)=>{const L=D.eq(O);if(L!=null&&L.isCard()){m=m?m.next():c.first(),m&&(D[O]=m[0]);return}m?(m.after(P),m=L):(m=L,c.prepend(P))})},b=d.children(),_=b.toArray();v(b);const x=h.children();let w=x.toArray();f&&(n=(a=w.find(D=>D.equal(f)))==null?void 0:a.getChildByPath(p)),v(x),w=x.toArray();let E=I("\u200B",null);if(_.length===1&&_[0].name==="br"&&(_[0].remove(),_.splice(0,1)),w.length===1&&w[0].name==="br"&&(w[0].remove(),w.splice(0,1)),w.filter(D=>!D.isCursor()).length>0){let D=w[0];for(let P=0;P<w.length-1&&(D=w[P],!!D.isCursor());P++);if(o.isEmpty(D)){let P=D.first();for(;P&&!P.isText();)D=P,P=P.first();D.isText()?D.before(E):D.prepend(E)}else{let P=o.isMark(i)?i:i.parent(),O=E;for(e&&!Array.isArray(e)&&(e=[e]);e&&e.length>0&&P&&o.isMark(P);){const L=P.clone();if(!e.some(B=>this.compare(L,B))){const B=E.equal(O);O=o.wrap(O,L),B&&(E=O.first())}P=P.parent()}D.before(O)}t.select(E).collapse(!1)}else _.filter(D=>!D.isCursor()).length>0?(_[_.length-1].after(E),t.select(E).collapse(!1)):t.select(c,!0).collapse(!0);let S=!1;c.children().each(D=>{const P=I(D);if(P.isText()){const{textContent:O}=D;let L=(O==null?void 0:O.replace(/\u200b+/g,"\u200B"))||"";if(O!==L&&(D.textContent=L),S){const B=P.next(),A=P.parent();(!B&&A&&!o.isInline(A)||B&&!o.isInline(B))&&L.startsWith("\u200B")?(L=L.substring(1),L?D.textContent=L:P.remove()):S=!1}L.endsWith("\u200B")&&(S=!0)}else S=!1});const R=o;if(E[0].parentNode){const D=E[0];let P=null,O=0;const L=(B,A)=>{var W,G,k,C,$;const F=z=>A?z.previousSibling:z.nextSibling;for(;B;){if(B.nodeType!==D.nodeType)return;const z=F(B);if(B.textContent===P){if(z&&R.isInline(z)||!z&&B.parentNode&&R.isInline(B.parentNode))break;(W=B.parentNode)==null||W.removeChild(B),B=z}else{if(A)for(;P&&((G=B.textContent)==null?void 0:G.endsWith(P))&&!(z&&R.isInline(z)||!z&&B.parentNode&&R.isInline(B.parentNode));)B.textContent=B.textContent.substring(0,B.textContent.length-O);else for(;P&&((k=B.textContent)==null?void 0:k.startsWith(P))&&!(z&&R.isInline(z)||!z&&B.parentNode&&R.isInline(B.parentNode));)B.textContent=B.textContent.substring(P.length);if(((C=B.textContent)==null?void 0:C.length)!==0)return;($=B.parentNode)==null||$.removeChild(B),B=z}}};if(D.nodeType===Node.TEXT_NODE){const{textContent:B}=D;P=B,O=P.length,L(D.previousSibling,!0),L(D.nextSibling,!1)}}}return n}splitOnExpanded(t,e){if(t.collapsed)return;t.enlargeToElementNode(),t.shrinkToElementNode();const{startNode:n,endNode:i}=t,r=n.isCard()?n:n.closest(ut),s=i.isCard()?i:i.closest(ut);if(!(r.length>0&&r.attributes(pt)==="inline"||s.length>0&&s.attributes(pt)==="inline")){const o=this.closestNotMark(n),a=this.closestNotMark(i);if(!o.equal(a)){const O=t.cloneRange();O.collapse(!0);const L=t.cloneRange();L.collapse(!1);let B,A=O.startOffset,F=L.endOffset;o.contains(a)?(B=this.splitOnCollapsed(O,e,L.endNode),t.setStart(O.startContainer,O.startOffset),B&&L.setOffset(B,F,F),this.splitOnCollapsed(L,e),t.setEnd(L.startContainer,L.startOffset)):(B=this.splitOnCollapsed(L,e,O.startNode),t.setEnd(L.startContainer,L.startOffset),B&&O.setOffset(B,A,A),this.splitOnCollapsed(O,e),t.setStart(O.startContainer,O.startOffset));return}const{node:c}=this.editor,u=n.parent(),d=c.isMark(n)||u&&c.isMark(u),h=i.parent(),f=c.isMark(i)||h&&c.isMark(h);if(!d&&!f)return;let{commonAncestorNode:p}=t;p.isText()&&(p=p.parent());const g=this.closestNotMark(p),m=t.createSelection(),v=m.getNode(g,"left"),b=m.getNode(g),_=m.getNode(g,"right");this.unwrapEmptyMarks(v),this.unwrapEmptyMarks(_);const x=g.children();x.each((O,L)=>{const B=x.eq(L);B!=null&&B.isCard()||B==null||B.remove()});let w;const E=O=>{O.each((L,B)=>{const A=O.eq(B);if(A!=null&&A.isCard()){w=w?w.next():g.first(),w&&(O[B]=w[0]);return}w?(w.after(L),w=A):(w=A,g.prepend(L))})},S=v.children();E(S);const R=b.children(),D=R.toArray();E(R);const P=_.children();E(P),t.setStartBefore(D[0][0]),t.setEndAfter(D[D.length-1][0])}}split(t,e){const n=this.editor;if(!V(n))return;const{change:i}=n,r=t||i.range.toTrusty(),s=it(r.startContainer),o=r.collapsed;if((typeof e=="string"||!Array.isArray(e)&&e&&be(e))&&(e=I(e,s)),o)this.splitOnCollapsed(r,e);else{const a=r.createSelection("mark-split");this.splitOnExpanded(r,e),a.move()}t||i.apply(r)}wrapByNode(t,e,n=this.findPlugin(e),i){var s;const r=this.editor.node;if(r.isMark(t)){((s=t.get())==null?void 0:s.childNodes.length)===0&&t.html("&#8203;");let o=t,a=o.children().toArray(),c=this.findPlugin(o),u=!1;for(;r.isMark(o)&&a.filter(f=>!f.isCursor()).length===1&&n&&c&&n.mergeLeval<=c.mergeLeval;){const f=a.find(p=>!p.isCursor());if(r.isMark(f))o=f,a=o.children().toArray();else if(f.isText())o=f;else break;if(n.name===c.name){u=!0;break}c=this.findPlugin(o)}r.removeZeroWidthSpace(o);let d=o.parent();if(o.isText()||u){let f=!1;for(;d&&r.isMark(d);){if(this.compare(d.clone(),e,!0)){f=!0;break}else if(d.children().toArray().filter(p=>!p.isCursor()).length===1){const p=this.findPlugin(d);if(n&&n===p&&n.combineValueByWrap===!0){r.wrap(d,e,!0),f=!0;break}else if(n&&n===p){r.unwrap(d),f=!1;break}}d=d.parent()}if(f)return!1}return o.allChildren().forEach(f=>{f.type!==it().TEXT_NODE&&r.isMark(f)&&this.findPlugin(f)===n&&!(n!=null&&n.combineValueByWrap)&&r.unwrap(f)}),r.wrap(o,e)}else if(t.name==="br"){const o=t.parent();if(o&&r.isBlock(o)){const a=e.clone(!0);return a.html("&#8203;"),r.replace(t,a),a}}else if(t.isCard()){const o=this.editor.card.find(t);if(o&&o.executeMark)return o.executeMark(e,!0)}else if(t.isText()&&!r.isEmpty(t)){r.removeZeroWidthSpace(t);let o=t.parent(),a=!1;for(;o&&r.isMark(o);){if(this.compare(o.clone(),e,!0)){a=!0;break}else if(o.children().toArray().filter(f=>!f.isCursor()).length===1||i&&i.equal(o)){const f=this.findPlugin(o);if(n&&n===f&&n.combineValueByWrap===!0){r.wrap(o,e,!0),a=!0;break}else if(n&&n===f){const p=r.unwrap(o),g=p.find(m=>!m.isCursor()&&r.isMark(m));g?o=g:p.length>0&&(o=p[0].parent()),a=!1;break}}const h=o.parent();if(h&&r.isMark(o))o=h;else break}if(a)return!1;let c=t.parent(),u=c?this.findPlugin(c):void 0,d=!1;for(;c&&r.isMark(c)&&n&&u&&n.mergeLeval>u.mergeLeval;){d=!0;const h=c.children().toArray(),f=c.clone();h.forEach(p=>{p.isCursor()||p.type===3&&/^\u200b$/.test(p.text()||"")||(t.equal(p)||p.contains(t)?t=r.wrap(r.replace(t,f),e):(p=r.wrap(p,f),r.wrap(p,e)))}),r.unwrap(c),c=this.closest(t)}return d||r.wrap(t,e),t}}wrap(t,e){var m;const n=this.editor,i=V(n)?n.change:void 0;if(!e&&!i)return;const{node:r}=n,s=e||i.range.toTrusty(),o=it(s.startContainer);if(typeof t=="string"||be(t)?t=I(t,o):t=t,!r.isMark(t))return;let{commonAncestorNode:a}=s;a.type===Node.TEXT_NODE&&(a=a.parent());const c=n.card.find(a,!0);let u=c==null?void 0:c.isEditable;const d=u?c!=null&&c.getSelectionNodes?c.getSelectionNodes():[]:[a];d.length===0&&(u=!1,d.push(a));const h=r,f=this.findPlugin(t);if(s.collapsed&&(!u||!(c!=null&&c.getSelectionNodes)||d.length===1)){t.children().toArray().filter(w=>!w.isCursor()).length===0&&t.append(o.createTextNode("\u200B"));const{startNode:v}=s.shrinkToTextNode();let b=v.parent();const _=[];let x=!1;if(v.isText()){let w=!1;for(;b&&h.isMark(b);){if(this.compare(b.clone(),t,!0)){w=!0;break}const E=this.findPlugin(b);if(((m=b.get())==null?void 0:m.childNodes.length)===1){if(f&&f===E&&f.combineValueByWrap===!0){h.wrap(b,t,!0),w=!0;break}else if(f&&f===E){if(this.split(s),s.collapsed){let S=b.parent();for(;S&&h.isMark(S);)t=h.wrap(t,S),S=S.parent()}w=!1;break}}f&&(!E||f.mergeLeval>E.mergeLeval)?_.push(b.clone(!1)):!x&&_.length>0&&(_.push(t.clone(!1)),x=!0),b=b.parent()}if(w)return}if(_.length>0){let w=_[0];w.append(t.children());for(let E=1;E<_.length;E++)w=h.wrap(w,_[E]);t=x?w:h.wrap(w,t),this.split(s)}h.insert(t,s),this.merge(s),s.handleBr(),e||i==null||i.apply(s);return}u||(this.split(s),a=s.commonAncestorNode,a.type===Node.TEXT_NODE&&(a=a.parent()),d[0]=a);const p=u?void 0:s.createSelection();if(p&&!p.anchor&&!p.focus){e||i==null||i.apply(s);return}let g=!!u;if(d.forEach(v=>{v.traverse(b=>{var _;if(t=t,u||!b.equal(p==null?void 0:p.anchor)){if(g){if(!u&&b.equal(p==null?void 0:p.focus))return g=!1,!1;const x=h.isMark(b),w=this.wrapByNode(b,t,f,v);if(w&&typeof w!="boolean"&&x){if(!u&&(p==null?void 0:p.focus)&&w.find(`[data-element="${p.focus.attributes(le)}"]`).equal(p.focus))return g=!1,!1;if((p==null?void 0:p.focus)&&((_=w.next())==null?void 0:_.equal(p.focus)))return g=!1,!1}if(typeof w<"u")return!0}}else g=!0},!0,"editable")}),p==null||p.move(),u){const v=[];d.forEach(b=>{b.allChildren().forEach(_=>{_.isElement()&&r.isMark(_)&&v.push(_)})}),this.mergeMarks(v)}else this.merge(s);e||i==null||i.apply(s)}mergeMarks(t){const{node:e}=this.editor;t.forEach(n=>{const i=n.prev(),r=n.next(),s=n.parent();if(s&&this.findSameParent(s,n)){e.unwrap(n);return}i&&this.compare(i,n,!0)&&(e.merge(i,n),n=i),r&&this.compare(r,n,!0)&&e.merge(n,r);const o=[],a=n.children();a.each((c,u)=>{const d=a.eq(u);d&&!d.isCursor()&&e.isMark(d)&&o.push(d)}),o.length>0&&this.mergeMarks(o)})}merge(t){const e=this.editor;if(!V(e))return;const{change:n}=e,i=t||n.range.toTrusty(),r=this.findMarks(i);if(r.length===0)return;const s=i.shrinkToElementNode().createSelection();this.mergeMarks(r),s.move(),i.handleBr(),t||n.apply(i)}unwrapByNodes(t,e){const n=this.editor,i=n.node;t.forEach(r=>{e=e,!e||!r.isCard()&&(Array.isArray(e)?e:[e]).some(s=>this.compare(r,s))?i.unwrap(r):e?(Array.isArray(e)?e:[e]).forEach(s=>{var c;const o=s.css();Object.keys(o).forEach(u=>{r.css(u,"")});const a=(c=s.get())==null?void 0:c.className.split(/\s+/);if(a){const{schema:u}=n,d=u.find(h=>h.name===r.name);for(let h=0;h<d.length;h++){const f=d[h];a.forEach(p=>{p=p.trim(),p!==""&&f.attributes&&u.checkValue(f.attributes,"class",p)&&r.removeClass(p)})}}}):(r.removeAttributes("class"),r.removeAttributes("style"))})}unwrap(t,e){const n=this.editor;if(!V(n))return;const{change:i,node:r}=n,s=e||i.range.toTrusty(),o=it(s.startContainer)||document;t!==void 0&&!Array.isArray(t)&&(typeof t=="string"||be(t))&&(t=I(t,o));let{commonAncestorNode:a}=s;a.type===Node.TEXT_NODE&&(a=a.parent());const c=n.card.find(a,!0);let u=c==null?void 0:c.isEditable;const d=u?c!=null&&c.getSelectionNodes?c.getSelectionNodes():[]:[a];if(d.length===0&&(u=!1,d.push(a)),u||(this.split(s,s.collapsed?t:void 0),a=s.commonAncestorNode,a.type===Node.TEXT_NODE&&(a=a.parent()),d[0]=a),s.collapsed&&(!u||!(c!=null&&c.getSelectionNodes)||d.length===1)){e||i.apply(s);return}const h=u?void 0:s.createSelection("mark-unwrap");if(h&&!h.has()){this.merge(s),e||i.apply(s);return}const f=[];let p=!!u;if(d.forEach(g=>{g.traverse(m=>{var v,b;if(!(!u&&(m.isText()||!(h!=null&&h.anchor)))){if(u||(h==null?void 0:h.anchor)&&!m.equal(h.anchor)){if(p&&(u||!m.equal(h==null?void 0:h.focus))){if(r.isMark(m)&&!m.isCard()&&(u||s.isPointInRange(m,0)))f.push(m);else if(m.isCard()){const _=n.card.find(m);_&&_.executeMark&&(Array.isArray(t)?t:[t]).forEach(x=>{_.executeMark(x,!1)})}}}else if(!u&&(p=!0,(h==null?void 0:h.anchor)&&m.equal(h.anchor)&&!h.anchor.prev())){let _=h.anchor.parent();for(;_&&!_.isCard()&&r.isMark(_)&&(f.push(_),_=_.parent(),!(_&&((b=(v=_.get())==null?void 0:v.childNodes.length)!=null?b:0)>1)););}}},!0,"editable")}),this.unwrapByNodes(f,t),h==null||h.move(),u){const g=[];d.forEach(m=>{m.allChildren().forEach(v=>{v.isElement()&&r.isMark(v)&&g.push(v)})}),this.mergeMarks(g)}else this.merge(s);e||i.apply(s)}insert(t,e){var o;const n=this.editor;if(!V(n))return;const{change:i,node:r}=n,s=e||i.range.toTrusty();if(typeof t=="string"||be(t)){const a=it(s.startContainer);t=I(t,a)}s.collapsed||i.delete(s),(o=r.insert(t,s))==null||o.handleBr().select(t).collapse(!1),e||i.apply(s)}findMarks(t){const e=this.editor,n=t.cloneRange();if(n.startNode.isRoot()&&n.shrinkToElementNode(),!n.startNode.inEditor()||e.card.find(n.startNode))return[];const{node:i}=e,r=(E,S,R=!1)=>{if(!S.collapsed)return;const{startNode:D,startOffset:P}=S,O=D.findParent();if(!O)return;const L=S.cloneRange();if(L.select(O,!0),R){L.setEnd(D,P),L.enlargeFromTextNode(),L.enlargeToElementNode(!0);const B=D.get().childNodes,{endNode:A,endOffset:F}=L,G=A.get().childNodes.item(F),k=B.item(P)||B.item(P-1);if(!E&&A.type===Node.ELEMENT_NODE&&G&&i.isBlock(G)&&(D.type!==Node.ELEMENT_NODE||!!k&&!i.isBlock(k)))return;L.select(O,!0),L.setStart(A,F),L.shrinkToElementNode(),L.shrinkToTextNode(),S.setStart(L.startContainer,L.startOffset),S.collapse(!0)}else{L.setStart(D,P),L.enlargeFromTextNode(),L.enlargeToElementNode(!0);const B=D.get().childNodes,A=L.startNode,F=L.startOffset,G=A.get().childNodes.item(F),k=B.item(P)||B.item(P-1);if(!E&&A.type===Node.ELEMENT_NODE&&G&&i.isBlock(G)&&(D.type!==Node.ELEMENT_NODE||k&&!i.isBlock(k)))return;L.select(O,!0),L.setEnd(A,F),L.shrinkToElementNode(),L.shrinkToTextNode(),S.setEnd(L.endContainer,L.endOffset),S.collapse(!1)}};if(!n.collapsed){const E=n.cloneRange(),S=n.cloneRange();E.collapse(!0),S.collapse(!1),r(!0,E,!0),r(!0,S),n.setStart(E.startContainer,E.startOffset),n.setEnd(S.startContainer,S.startOffset)}r(!1,n);const s=n.startContainer,o=n.startOffset,a=n.endContainer,c=n.endOffset;let u=s,d=a;s.nodeType===Node.ELEMENT_NODE&&s.childNodes[o]&&(u=s.childNodes[o]||s),a.nodeType===Node.ELEMENT_NODE&&c>0&&a.childNodes[c-1]&&(d=a.childNodes[c-1]||s),n.collapsed&&(u=d);const h=(E,S)=>{E.push(S)},f=i,p=E=>{let S=[];for(;E&&!(E.type===Node.ELEMENT_NODE&&E.isEditable());){if(f.isMark(E)&&!E.attributes(ke)&&!E.attributes(He))S.push(E);else if(E.isCard()){const D=e.card.find(E);D!=null&&D.queryMarks&&S.push(...D.queryMarks())}const R=E.parent();if(!R)break;E=R}return S},g=p(I(u)),{commonAncestorNode:m}=n,v=e.card.find(m,!0);let b=v==null?void 0:v.isEditable;const _=b?v!=null&&v.getSelectionNodes?v.getSelectionNodes():[]:[m];if(_.length===0&&(b=!1,_.push(m)),(!n.collapsed||b)&&(p(I(d)).forEach(E=>h(g,E)),s!==a||b)){let E=!1,S=!1;_.forEach(R=>{R.traverse(D=>{if(S)return!1;if(D[0]!==s){if(E){if(D[0]===a)return S=!0,!1;if(f.isMark(D)&&!D.attributes(ke)&&!D.attributes(He))h(g,D);else if(D.isCard()){const P=e.card.find(D);P!=null&&P.queryMarks&&P.queryMarks().forEach(O=>{h(g,O)})}}}else E=!0},!0,"editable")})}for(var x=0;x<g.length;x++)for(var w=x+1;w<g.length;w++)g[x][0]==g[w][0]&&(g.splice(w,1),w--);return g}removeEmptyMarks(t,e){var i,r;if(t.length===0||t.isEditable()||t.isCard()||t.attributes(le))return;const n=this.editor.node;if(!t.attributes(le)){const s=t.parent();if(((i=t.get())==null?void 0:i.childNodes.length)===1&&((r=t.first())==null?void 0:r.attributes(le))){n.isMark(t)?(t.before(t.first()),t.remove(),s&&this.removeEmptyMarks(s,!0)):e&&n.isBlock(t)&&t.prepend("<br />");return}const o=n.html(t);(o===""||o==="\u200B")&&(n.isMark(t)?(t.remove(),s&&this.removeEmptyMarks(s,!0)):e&&n.isBlock(t)&&n.html(t,"<br />"))}}repairCursor(t){const{node:e}=this.editor;if(t=be(t)?I(t):t,e.isMark(t)&&!t.isCursor()){const i=t.children();i.each((u,d)=>{var f;const h=i.eq(d);if((h==null?void 0:h.isText())&&!((f=h.next())!=null&&f.isCursor())){const p=h.text();if(p.length===1&&/\u200b/.test(p)){h.remove();return}h.text(p.replace(/\u200b/g,""))}});const r=t.children().toArray().filter(u=>!u.isCursor());r.length<2&&(r.length===0||r.length===1&&r[0].isText()&&r[0].text().length===0)&&(r.length>0&&r[0].remove(),t.prepend(I("\u200B",null)));const s=t.next(),o=s==null?void 0:s.next();s&&o&&s.isText()&&/^\u200b$/g.test(s.text())&&!e.isInline(o)&&s.remove();const a=t.prev(),c=a==null?void 0:a.prev();a&&c&&a.isText()&&/^\u200b$/g.test(a.text())&&!e.isInline(c)&&a.remove()}}}class Mne{constructor(t){y(this,"engine");this.engine=t}trigger(t){const{change:e,mark:n,inline:i,node:r}=this.engine,s=e.range.get(),{collapsed:o,endNode:a,startNode:c,startOffset:u}=s.cloneRange().shrinkToTextNode();if(a.type===Node.TEXT_NODE||c.type===Node.TEXT_NODE){if(!o){const h=i.closest(a);if(r.isInline(h)&&!h.isCard()&&r.isEmpty(h)){if(u>1)return!0;let f=a.prev(),p=a.parent();if(p&&r.isInline(p)){if(f)return!0;const m=a.text().substr(0,u);if(!/^\u200b$/.test(m))return!0;const v=h.next(),b=v==null?void 0:v.text();if(v&&v.isText()&&b&&/^\u200b/.test(b))return s.setEnd(v,1),!1}}return r.isInline(h)&&!h.isCard()&&setTimeout(()=>{i.repairCursor(h)},100),!0}let d=i.closest(c);if(r.isInline(d)){if(d.isCard()||u>1)return!0;let h=c.prev(),f=c.parent();if(f&&r.isInline(f)){if(h)return!0;const v=c.text().substr(0,u);if(!/\u200b$/.test(v))return!0}else if(u===0){for(;!h&&f&&!r.isInline(f);)h=f.prev(),f=f==null?void 0:f.parent();if(h&&!h.isText()||h&&!/\u200b$/.test(h.text()))return!0}else return!0;const p=d.prev(),g=p==null?void 0:p.text();if(p&&p.isText()&&g&&/\u200b$/.test(g)){if(s.setStart(p,g.length-1),r.isEmpty(d)){const m=d.next(),v=m==null?void 0:m.text();m&&m.isText()&&v&&/^\u200b/.test(v)&&s.setEnd(m,1)}else s.collapse(!0);return e.range.select(s),!1}return!0}else{let h=c.prev(),f=c.parent(),p;if(h){if(r.isInline(h)&&!h.isCard()){const m=c.text().substr(0,u);if(!/^\u200b$/.test(m))return!0;p=h}}else if(u===0){for(;!h&&f&&!r.isBlock(f);)h=f.prev(),f=f==null?void 0:f.parent();if(h&&!h.isText())return!0;if(h){if(!/^\u200b$/.test(h.text()))return!0;if(h=h.prev(),h&&r.isInline(h))p=h;else return!0}}else return!0;if(p){const g=p.last(),m=g==null?void 0:g.text();if(g&&g.isText()&&m&&/\u200b$/.test(m))return t.preventDefault(),s.setStart(g,m.length-1),s.collapse(!0),e.range.select(s),!1}}}return!0}}class Lne{constructor(t){y(this,"engine");this.engine=t}trigger(t){const{change:e,inline:n,node:i}=this.engine,r=e.range.get().cloneRange().shrinkToTextNode(),{startNode:s,startOffset:o}=r;if(!this.engine.card.getSingleCard(r)&&s.type===Node.TEXT_NODE){const c=n.closest(s);if(i.isInline(c)){if(c.isCard())return;if(o>1)return!0;let u=s.prev(),d=s.parent();if(d&&i.isInline(d)){if(u)return!0;const g=s.text().substr(0,o);if(!/^\u200b$/.test(g))return!0}else if(o===0){for(;!u&&d&&!i.isInline(d);)u=d.prev(),d=d==null?void 0:d.parent();if(u&&!u.isText()||u&&!/^\u200b$/.test(u.text()))return!0}else return!0;const h=c.prev(),f=h==null?void 0:h.text();if(h&&h.isText()&&f&&/\u200b$/.test(f)){t.preventDefault();const{collapsed:p}=r.cloneRange();return r.setStart(h,f.length-1),p&&r.collapse(!0),e.range.select(r),!1}return!0}else{let u=s.prev(),d=s.parent(),h;if(u){if(i.isInline(u)&&!u.isCard()){const p=s.text().substr(0,o);if(!/^\u200b$/.test(p))return!0;h=u}}else if(o===0){for(;!u&&d&&!i.isBlock(d);)u=d.prev(),d=d==null?void 0:d.parent();if(u&&!u.isText())return!0;if(u){if(!/^\u200b$/.test(u.text()))return!0;if(u=u.prev(),u&&i.isInline(u))h=u;else return!0}}else return!0;if(h){t.preventDefault();const f=h.last(),p=f==null?void 0:f.text();if(f&&f.isText()&&p&&/\u200b$/.test(p)){const{collapsed:g}=r.cloneRange();return r.setStart(f,p.length-1),g&&!ce("shift+left",t)&&r.collapse(!0),e.range.select(r),!1}}}}return!0}}class Ine{constructor(t){y(this,"engine");this.engine=t}trigger(t){const{change:e,inline:n,node:i}=this.engine,r=e.range.get().cloneRange().shrinkToTextNode(),{endNode:s,endOffset:o}=r;if(!this.engine.card.getSingleCard(r)&&s.type===Node.TEXT_NODE){const c=n.closest(s),u=s.text();if(i.isInline(c)){if(c.isCard())return;if(o<u.length-1)return!0;let d=s.next(),h=s.parent();if(h&&i.isInline(h)){if(d)return!0;const g=u.substr(o);if(!/^\u200b$/.test(g))return!0}else if(o===u.length||o===u.length-1){for(;!d&&h&&!i.isInline(h);)d=h.next(),h=h==null?void 0:h.parent();if(d&&!d.isText())return!0;if(d){if(!/^\u200b$/.test(d.text()))return!0;if(o===u.length-1){t.preventDefault();const{collapsed:g}=r.cloneRange();return r.setEnd(d,0),g&&r.collapse(!1),e.range.select(r),!1}}}else return!0;const f=c.next(),p=f==null?void 0:f.text();if(f&&f.isText()&&p&&/^\u200b/.test(p)){t.preventDefault();const{collapsed:g}=r.cloneRange();return r.setEnd(f,1),g&&r.collapse(!1),e.range.select(r),!1}return!0}else{let d=s.next(),h=s.parent(),f;if(d){if(i.isInline(d)&&!d.isCard()){const p=u.substr(o);if(!/^\u200b$/.test(p))return!0;f=d}}else if(o===u.length){for(;!d&&h&&!i.isBlock(h);)d=h.next(),h=h==null?void 0:h.parent();if(d&&!d.isText())return!0;if(d){if(!/^\u200b$/.test(d.text()))return!0;if(d=d.next(),d&&i.isInline(d))f=d;else return!0}}else return!0;if(f){t.preventDefault();const p=f.first(),g=p==null?void 0:p.text();if(p&&p.isText()&&g&&/^\u200b/.test(g)){const{collapsed:m}=r.cloneRange();return r.setEnd(p,1),m&&!ce("shift+right",t)&&r.collapse(!1),e.range.select(r),!1}}}}return!0}}class One{constructor(t){y(this,"editor");this.editor=t}init(){var e,n,i;const t=this.editor;if(V(t)){const{typing:r,event:s}=t,o=new Mne(t);(e=r.getHandleListener("backspace","keydown"))==null||e.on(u=>o.trigger(u));const a=new Lne(t);(n=r.getHandleListener("left","keydown"))==null||n.on(u=>a.trigger(u));const c=new Ine(t);(i=r.getHandleListener("right","keydown"))==null||i.on(u=>c.trigger(u))}}repairRange(t){const{change:e,node:n}=this.editor;t=t||e.range.get();const{startNode:i,startOffset:r,endNode:s,endOffset:o,collapsed:a}=t;if(a)return t;const c=this.closest(i);if(c&&n.isInline(c)&&r<=1){let h=!0,f=i;for(;f&&!f.equal(c);){if(f.prev()){h=!1;break}f=f.parent()}if(h){const p=c.prev(),g=(p==null?void 0:p.text())||"";p&&p.isText()&&/\u200B$/g.test(g)&&t.setStart(p,g.length-1)}}const u=this.closest(s),d=u.last();if(u&&n.isInline(u)&&d&&s.equal(d)&&o>=d.text().length-1){let h=!0,f=i;for(;f&&!f.equal(u);){if(f.next()){h=!1;break}f=f.parent()}if(h){const p=u.next(),g=(p==null?void 0:p.text())||"";p&&p.isText()&&/^\u200B/g.test(g)&&t.setEnd(p,1)}}return t}closest(t){const e=this.editor.node;let n=t.parent();for(;n&&!n.isEditable()&&!e.isBlock(n);){if(e.isInline(n))return n;const i=n.parent();if(!i)break;n=i}return t}closestNotInline(t){const e=this.editor.node;for(;(e.isInline(t)||e.isMark(t)||t.isText())&&!t.isEditable();){const n=t.parent();if(!n)break;t=n}return t}wrap(t,e){const n=this.editor;if(!V(n))return;const{change:i,mark:r,node:s}=n,o=e||i.range.toTrusty(),a=it(o.startContainer);if(typeof t=="string"||be(t)?t=I(t,a):t=t,!s.isInline(t))return;if(o.collapsed){this.insert(t,o),e||i.apply(o);return}r.split(o),this.split(o);let{commonAncestorNode:c}=o;if(c.type===Node.TEXT_NODE||s.isMark(c))for(c=c.parent();s.isMark(c);)c=c.parent();const u=o.enlargeToElementNode().createSelection();if(!u.has()){e||i.apply(o);return}let d=!1,h=s.clone(t,!1);const f=[];c.traverse(v=>{if(v.equal(u.anchor)){d=!0;return}else{if(d){if(v.equal(u.focus))return d=!1,!1;if(s.isInline(v))if(v.isCard())f.push(v);else{const b=v.children();s.unwrap(v),v=b}if(s.isMark(v)&&!v.isCard()||v.isText())return s.isEmpty(v)?(v.remove(),!0):(h.parent()||v.before(h),h.append(v),this.repairCursor(h),f.push(h),!0);h[0].childNodes.length!==0&&!!h.parent()&&(h=s.clone(h,!1,!1))}return}});const{anchor:p,focus:g}=u,m=p==null?void 0:p.parent();if(m&&s.isRootBlock(m)&&!p.prev()&&!p.next()&&p.after("<br />"),!p.equal(g)){const v=g==null?void 0:g.parent();v&&s.isRootBlock(v)&&!g.prev()&&!g.next()&&g.before("<br />")}if(u.move(),f.length>0){const v=f[0];if(!v.isCard()){const _=v.first();o.setStart(_,1)}const b=f[f.length-1];if(!b.isCard()){const _=b.last();o.setEnd(_,_.text().length-1)}}e||i.apply(o)}unwrap(t){const e=this.editor;if(!V(e))return;const{change:n,mark:i}=e,r=!t||!nr(t)?n.range.toTrusty():t;this.repairRange(r),i.split(r);const s=t&&!nr(t)?[t]:this.findInlines(r),o=r.createSelection();s.forEach(a=>{let c=a.prev();c&&c.isCursor()&&(c=c.prev());let u=a.next();u&&u.isCursor()&&(u=u.prev());let d=a.first();d&&d.isCursor()&&(d=d.next());const h=(c==null?void 0:c.text())||"",f=(u==null?void 0:u.text())||"",p=(d==null?void 0:d.text())||"";c&&c.isText()&&/\u200B$/g.test(h)&&(/^\u200B$/g.test(h)?c.remove():c.text(h.substr(0,h.length-1))),u&&u.isText()&&/^\u200B/g.test(f)&&(/^\u200B$/g.test(f)?u.remove():u.text(f.substr(1))),d&&d.isText()&&/^\u200B/g.test(p)&&(/^\u200B$/g.test(p)||d.get().splitText(1),d.remove());let g=a.last();g&&g.isCursor()&&(g=g.prev());const m=(g==null?void 0:g.text())||"";g&&g.isText()&&/\u200B$/g.test(m)&&(/^\u200B$/g.test(m)?g.remove():g.get().splitText(m.length-1).remove()),e.node.unwrap(a)}),o.move(),i.merge(r),t||n.apply(r)}insert(t,e){var u,d;const n=this.editor;if(!V(n))return;const{change:i,node:r,mark:s}=n,o=e||i.range.toTrusty(),a=it(o.startContainer);if((typeof t=="string"||be(t))&&(t=I(t,a)),!r.isInline(t))return;o.collapsed||i.delete(o),s.split(o),this.split(o),(u=r.insert(t,o))==null||u.select(t).collapse(!1),t.name!=="br"&&o.handleBr();const c=((d=t.get())==null?void 0:d.childNodes.length)!==0;if(this.repairCursor(t),!t.isCard()&&!r.isVoid(t))if(c){const h=t.next();o.setStart(h,1),o.setEnd(h,1)}else{const h=t.last(),f=h.text();o.setStart(h,f.length-1),o.setEnd(h,f.length-1)}e||i.apply(o)}unwrapEmptyInlines(t,e){const{node:n}=this.editor;t.allChildren().forEach(r=>{n.isEmpty(r)&&n.isInline(r)&&(!e||e(r))&&n.unwrap(r)})}splitOnCollapsed(t,e){var o;if(!t.collapsed)return;t.enlargeFromTextNode(),t.shrinkToElementNode();const{startNode:n}=t,i=n.parent(),{node:r}=this.editor,s=n.isCard()?n:n.closest(ut);if((s.length===0||s.attributes(pt)!=="inline")&&(r.isInline(n)||i&&r.isInline(i))){const a=this.closestNotInline(n),c=t.createSelection(),u=c.getNode(a,"left");let d,h,f=[];if(e){be(e)&&(e=I(e));const w=e.getPath(a.get()),E=a.clone(!0);f=w.slice(1),h=I(E.getChildByPath(w.slice(0,1))),d=c.getNode(E,"right",!1)}else d=c.getNode(a,"right");this.unwrapEmptyInlines(u),this.unwrapEmptyInlines(d);const p=a.children();p.each((w,E)=>{var S,R;(S=p.eq(E))!=null&&S.isCard()||(R=p.eq(E))==null||R.remove()});let g;const m=w=>{w.each((E,S)=>{const R=w.eq(S);if(R!=null&&R.isCard()){g=g?g.next():a.first(),g&&(w[S]=g[0]);return}g?(g.after(E),g=R):(g=R,a.prepend(E))})},v=u.children(),b=v.toArray();m(v);const _=d.children();let x=_.toArray();if(h&&(e=(o=x.find(w=>w.equal(h)))==null?void 0:o.getChildByPath(f)),m(_),x=_.toArray(),b.length===1&&b[0].name==="br"&&(b[0].remove(),b.splice(0,1)),x.length===1&&x[0].name==="br"&&(x[0].remove(),x.splice(0,1)),x.filter(w=>!w.isCursor()).length>0){let w=x[0];for(let E=0;E<x.length-1&&(w=x[E],!!w.isCursor());E++);t.setStartBefore(w),t.collapse(!0)}else if(b.filter(w=>!w.isCursor()).length>0){let w=b[b.length-1];for(let E=b.length-1;E>=0&&(w=b[E],!!w.isCursor());E--);t.setStartAfter(w),t.collapse(!0)}else t.select(a,!0).collapse(!0);a.traverse(w=>{r.isInline(w)&&this.repairCursor(w)})}return t.enlargeToElementNode(!r.isBlock(t.startNode),!1),e}splitOnExpanded(t){if(t.collapsed)return;t.enlargeToElementNode(),t.shrinkToElementNode();const{startNode:e,endNode:n}=t,i=e.isCard()?e:e.closest(ut),r=n.isCard()?n:n.closest(ut);if(!(i.length>0&&i.attributes(pt)==="inline"||r.length>0&&r.attributes(pt)==="inline")){const s=this.closestNotInline(e),o=this.closestNotInline(n);if(!s.equal(o)){const R=t.cloneRange();R.collapse(!0);const D=t.cloneRange();D.collapse(!1);let P,O=R.startOffset,L=D.endOffset;s.contains(o)?(P=this.splitOnCollapsed(R,D.endNode),t.setStart(R.startContainer,R.startOffset),P&&D.setOffset(P,L,L),this.splitOnCollapsed(D),t.setEnd(D.startContainer,D.startOffset)):(P=this.splitOnCollapsed(D,R.startNode),t.setEnd(D.startContainer,D.startOffset),P&&R.setOffset(P,O,O),this.splitOnCollapsed(R),t.setStart(R.startContainer,R.startOffset));return}const{node:a}=this.editor,c=e.parent(),u=a.isInline(e)||c&&a.isInline(c),d=n.parent(),h=a.isInline(n)||d&&a.isInline(d);if(!u&&!h)return;let{commonAncestorNode:f}=t;f.isText()&&(f=f.parent());const p=this.closestNotInline(f),g=t.createSelection(),m=g.getNode(p,"left"),v=g.getNode(p),b=g.getNode(p,"right");this.unwrapEmptyInlines(m),this.unwrapEmptyInlines(b);const _=p.children();_.each((R,D)=>{var P,O;(P=_.eq(D))!=null&&P.isCard()||(O=_.eq(D))==null||O.remove()});let x;const w=R=>{R.each((D,P)=>{var O;if((O=R.eq(P))!=null&&O.isCard()){x=x?x.next():p.first(),x&&(R[P]=x[0]);return}x?(x.after(D),x=R.eq(P)):(x=R.eq(P),p.prepend(D))})};w(m.children());const E=v.children(),S=E.toArray();w(E),w(b.children()),p.traverse(R=>{a.isInline(R)&&this.repairCursor(R)}),t.setStartBefore(S[0][0]),t.setEndAfter(S[S.length-1][0])}}split(t){const e=this.editor;if(!V(e))return;const{change:n}=e,i=t||n.range.toTrusty();i.collapsed?this.splitOnCollapsed(i):this.splitOnExpanded(i),t||n.apply(i)}findInlines(t){const e=this.editor,n=t.cloneRange();if(n.startNode.isRoot()&&n.shrinkToElementNode(),!n.startNode.inEditor()||e.card.find(n.startNode))return[];const i=e.node,r=(_,x,w=!1)=>{if(!x.collapsed)return;const{startNode:E,startOffset:S}=x,R=E.findParent();if(!R)return;const D=x.cloneRange();if(D.select(R,!0),w){D.setEnd(E,S),D.enlargeFromTextNode(),D.enlargeToElementNode(!0);const P=E.children(),{endNode:O,endOffset:L}=D,A=O.children().eq(L),F=P.eq(S)||P.eq(S-1);if(!_&&O.type===Node.ELEMENT_NODE&&A&&i.isBlock(A)&&(E.type!==Node.ELEMENT_NODE||!!F&&!i.isBlock(F)))return;D.select(R,!0),D.setStart(O,L),D.shrinkToElementNode(),D.shrinkToTextNode(),x.setStart(D.startContainer,D.startOffset),x.collapse(!0)}else{D.setStart(E,S),D.enlargeFromTextNode(),D.enlargeToElementNode(!0);const P=E.children(),O=D.startNode,L=D.startOffset,A=O.children().eq(L),F=P.eq(S)||P.eq(S-1);if(!_&&O.type===Node.ELEMENT_NODE&&A&&i.isBlock(A)&&(E.type!==Node.ELEMENT_NODE||F&&!i.isBlock(F)))return;D.select(R,!0),D.setEnd(O,L),D.shrinkToElementNode(),D.shrinkToTextNode(),x.setEnd(D.endContainer,D.endOffset),x.collapse(!1)}};if(!n.collapsed){const _=n.cloneRange(),x=n.cloneRange();_.collapse(!0),x.collapse(!1),r(!0,_,!0),r(!0,x),n.setStart(_.startContainer,_.startOffset),n.setEnd(x.startContainer,x.startOffset)}r(!1,n);const s=n.startContainer,o=n.startOffset,a=n.endContainer,c=n.endOffset;let u=s,d=a;s.nodeType===Node.ELEMENT_NODE&&s.childNodes[o]&&(u=s.childNodes[o]||s),a.nodeType===Node.ELEMENT_NODE&&c>0&&a.childNodes[c-1]&&(d=a.childNodes[c-1]||s),n.collapsed&&(u=d);const h=(_,x)=>{_.some(w=>w[0]===x[0])||_.push(x)},f=_=>{const x=[];for(;_&&!_.isEditable();){i.isInline(_)&&x.push(_);const w=_.parent();if(!w)break;_=w}return x},p=f(I(u)),{commonAncestorNode:g}=n,m=e.card.find(g,!0);let v=m==null?void 0:m.isEditable;const b=v?m!=null&&m.getSelectionNodes?m.getSelectionNodes():[]:[g];if(b.length===0&&(v=!1,b.push(g)),(!n.collapsed||v)&&(f(I(d)).forEach(_=>h(p,_)),s!==a||v)){let _=!1,x=!1;b.forEach(w=>{w.traverse(E=>{if(x)return!1;if(E.equal(s))_=!0;else if(_){if(E.equal(a))return x=!0,!1;i.isInline(E)&&!E.attributes(ke)&&!E.attributes(He)&&h(p,E)}})})}return p}repairCursor(t){const e=this.editor.node;if(be(t)&&(t=I(t)),!e.isInline(t)||t.closest(ut).attributes(an)==="false"||e.isVoid(t)||t.isCard()){const s=t.prev(),o=s!=null&&s.isText()?s.text():void 0;if(o&&/\u200b$/.test(o)){const u=s==null?void 0:s.prev();(!u||!e.isInline(u))&&(o.length===1?s==null||s.remove():s==null||s.text(o.slice(0,-1)))}const a=t.next(),c=a!=null&&a.isText()?a.text():void 0;if(c&&/^\u200b/.test(c)){const u=a==null?void 0:a.next();(!u||!e.isInline(u))&&(c.length===1?a==null||a.remove():a==null||a.text(c.slice(1)))}return}const n=t.children();n.each((s,o)=>{const a=n.eq(o);if(a!=null&&a.isText()){const c=a.text();if(c.length===1&&/\u200b/.test(c)){a.remove();return}a.text(c.replace(/\u200b/g,""))}}),this.repairBoth(t);let i=t.first();i!=null&&i.isCursor()&&(i=i.next()),(!i||i.type!==Node.TEXT_NODE||!/^\u200B/g.test(i.text()))&&(i?i.isText()?i.text("\u200B"+i.text()):i.before(I("\u200B",null)):t.append(I("\u200B",null)));let r=t.last();r!=null&&r.isCursor()&&(r=r.prev()),r&&(/^\u200B$/g.test(t.text())||r.type!==Node.TEXT_NODE||!/\u200B$/g.test(r.text()))&&(r.isText()?r.text(r.text()+"\u200B"):r.after(I("\u200B",null)))}repairBoth(t){var n;const e=this.editor.node;if(be(t)&&(t=I(t)),((n=t.get())==null?void 0:n.parentNode)&&!e.isVoid(t)){const i=I("\u200B",null),r=t.prev(),s=r==null?void 0:r.prev(),o=(r==null?void 0:r.text())||"";!r||!r.isText()||!/\u200B$/g.test(o)||s&&e.isInline(s)&&!/\u200B.*\u200B$/g.test(o)?r&&r.isText()?r.text(o+"\u200B"):t.before(e.clone(i,!0,!1)):r&&r.isText()&&/\u200B\u200B$/g.test(o)&&s&&!e.isInline(s)&&r.text(o.substr(0,o.length-1));const a=t.next(),c=(a==null?void 0:a.text())||"",u=a==null?void 0:a.next();!a||!a.isText()||!/^\u200B/g.test(c)||u&&e.isInline(u)&&!/^\u200B\u200B/g.test(c)?a&&a.isText()?a.text("\u200B"+a.text()):(t.after(e.clone(i,!0,!1)),(a==null?void 0:a.name)==="br"&&a.remove()):a&&a.isText()&&/\u200B\u200B$/g.test(c)&&u&&!e.isInline(u)&&a.text(c.substr(0,c.length-1))}}flat(t,e){const n=this.editor;if(nr(t)){const s=t.cloneRange().shrinkToElementNode().createSelection(),o=this.findInlines(t),a=[];o.forEach(u=>{if(u.isCard())return;const d=this.flat(u);d&&a.push(d)}),s.move();const c=n.node;a.forEach(u=>{var f,p;const d=(f=u.prev())==null?void 0:f.prev(),h=(p=u.next())==null?void 0:p.next();d&&c.isMark(d)&&d.get().childNodes.length===0&&d.remove(),h&&c.isMark(h)&&h.get().childNodes.length===0&&h.remove()});return}if(t.isCard())return;const i=n.node,r=n.mark;if(i.isInline(t,e)&&t.name!=="br"){const s=this.closest(t);if(!s.equal(t)&&i.isInline(s,e))i.unwrap(t);else{let o=r.closest(t),a=t;for(;o&&!o.equal(t)&&i.isMark(o,e);){const c=o.clone(),u=t.clone();o.children().each(h=>{if(h.nodeType===3&&/^\u200b$/.test(h.textContent||""))return;const f=I(h);a.equal(f)||f.contains(a)?(a=i.wrap(i.replace(a,c),u),this.repairBoth(a)):i.wrap(f,c)}),i.unwrap(o),o=r.closest(a)}return a}}}}class Fne{constructor(t){y(this,"engine");this.engine=t}trigger(t){var c,u,d;const{change:e,node:n,list:i}=this.engine,r=e.range.get().shrinkToElementNode().shrinkToTextNode(),s=this.engine.block;let o=s.closest(r.endNode);const a=o.parent();if(a&&a.inEditor()&&n.isBlock(a)){if(a.name==="li"&&o.name==="p"){((c=o.get())==null?void 0:c.childNodes.length)===1&&((u=o.first())==null?void 0:u.name)==="br"&&o.first().remove();const h=r.createSelection();e.unwrap(o),h.move(),o=s.closest(r.endNode)}if(r.collapsed&&(r.startContainer.childNodes.length===1&&((d=r.startContainer.firstChild)==null?void 0:d.nodeName)==="BR"||s.isLastOffset(r,"end")&&s.isFirstOffset(r,"end")))return t.preventDefault(),["li"].indexOf(a.name)>=0?(s.unwrap("<".concat(a.name," />")),s.setBlocks("<".concat(a.name," />"))):(s.unwrap("<".concat(a.name," />")),s.setBlocks("<p />")),!1}if(n.isBlock(o)&&(!a||!n.isList(a))&&!o.isCard())return t.preventDefault(),s.insertOrSplit(r,o),!1;if(o.name!=="li")return!0}}class Bne{constructor(t){y(this,"engine");this.engine=t}trigger(t){const{change:e,node:n,block:i,card:r}=this.engine,s=e.range.get();if(!s.collapsed)return;const o=s.getPrevNode();if(o&&n.isBlock(o)&&n.isEmptyWithTrim(o)){t.preventDefault();const u=o.parent();return o.remove(),u&&this.engine.node.isEmpty(u)&&(u.isEditable()?(this.engine.node.html(u,"<p><br /></p>"),s.select(u,!0).shrinkToElementNode().collapse(!1)):(this.engine.node.html(u,"<br />"),s.select(u,!0).collapse(!1)),e.apply(s)),!1}const a=!!r.closest(s.startNode);if(!a&&!i.isFirstOffset(s,"start")){let u=s.cloneRange().shrinkToElementNode().shrinkToTextNode();u.startContainer.nodeType===Node.TEXT_NODE&&function(d){var m,v,b;const{commonAncestorContainer:h,commonAncestorNode:f}=d,p=f.parent(),g=p==null?void 0:p.attributes();if(d.collapsed&&d.startOffset===1&&d.startContainer===h&&h.nodeType===Node.TEXT_NODE&&(!g||!["left","right"].includes(g[He]))&&(d=d.cloneRange(),(((v=(m=h.parentNode)==null?void 0:m.childNodes)==null?void 0:v.length)||0)<=1&&((b=h.textContent)==null?void 0:b.length)===1)){const{startNode:_,startOffset:x}=d;let w=_.parent();if(w&&n.isMark(w)&&x>0){const S=_.text().substr(x-1,1);if(/^\u200b$/.test(S))if(x===1){const R=w.prev();if(R&&!n.isEmpty(R)){const{startNode:D,startOffset:P}=d.cloneRange().select(R,!0).shrinkToTextNode().collapse(!1);d.setStart(D,P-1)}}else d.setStart(_,x-1)}return d.collapsed&&d.select(h,!0),e.delete(d,!0),e.apply(d),!0}return!1}(u)&&(t.preventDefault(),t.isDelete=!0,e.change());return}const c=i.closest(s.startNode);return!a&&n.isRootBlock(c)?(t.preventDefault(),n.isEmpty(c)&&c.html("<br />"),e.mergeAfterDelete(c),e.change(!1),!1):!0}}class $ne{constructor(t){y(this,"editor");y(this,"pluginCaches",new Map);this.editor=t}init(){var e,n;const t=this.editor;if(V(t)){const{typing:i,event:r}=t,s=new Fne(t);(e=i.getHandleListener("enter","keydown"))==null||e.on(a=>s.trigger(a));const o=new Bne(t);(n=i.getHandleListener("backspace","keydown"))==null||n.on(a=>o.trigger(a)),r.on("keyup:space",a=>this.triggerMarkdown(a)),r.on("keydown:enter",a=>this.triggerMarkdown(a))}}triggerMarkdown(t){var p;const e=this.editor;if(!V(e)||((p=e.options.markdown)==null?void 0:p.mode)===!1)return;const{change:n}=e;let i=n.range.get();if(!i.collapsed||n.isComposing())return;const{startNode:r,startOffset:s}=i,o=r.type===Node.TEXT_NODE?r:r.children().eq(s-1);if(!o)return;const a=this.closest(o);if(!e.node.isRootBlock(a))return;const c=o.text().trimEnd();if(c.replaceAll(/\s|\t|\n|\r\n|\u200b/g,"")==="")return;const u=i.toPath(),d=po(e,"zero"),h=d.parse(c,{});if(h.length===0)return;const f=xl(e,d,h,!1);if(f){const g=a.children();t.preventDefault(),i.select(a,!0),n.paste(f,i);const m=this.closest(i.startNode);return!m.isRoot()&&!m.isCard()&&g.each((v,b)=>{b>0&&m.append(v)}),n.rangePathBeforeCommand=u,n.range.select(i),!1}return!0}findPlugin(t){const{node:e,schema:n,plugin:i}=this.editor;if(t.length===0||!e.isBlock(t))return;const s=t.get().cloneNode().outerHTML;let o=this.pluginCaches.get(s);if(o)return o;for(const a in i.components){const c=i.components[a];if(op(c)&&(!c.tagName||typeof c.tagName=="string"?t.name===c.tagName:c.tagName.indexOf(t.name)>-1)){const u=c.schema();if(Array.isArray(u)?u.find(d=>n.checkNode(t,d.attributes)):n.checkNode(t,u.attributes))return this.pluginCaches.set(s,c),c}}return o}findTop(t,e){const{schema:n,node:i,list:r}=this.editor,s=n.closest(t.name),o=n.closest(e.name);if(s===parent.name||o===e.name)return e;if(n.isAllowIn(t.name,e.name))return t;if(i.isList(t)&&i.isList(e)){const a=parseInt(e.attributes(r.INDENT_KEY),10)||0,c=parseInt(t.attributes(r.INDENT_KEY),10)||0;e.attributes(r.INDENT_KEY,c?c+1:a+1)}return e}closest(t,e=()=>!0){const n=t;for(;t;){if((t.isEditable()||this.editor.node.isBlock(t))&&e(t))return t;const i=t.parent();if(!i)break;t=i}return n}wrap(t,e){var p;const n=this.editor;if(!V(n))return;const{change:i,node:r,schema:s,list:o,mark:a}=n,c=e||i.range.toTrusty(),u=it(c.startContainer);if(typeof t=="string"||be(t)?t=I(t,u):t=t,!r.isBlock(t))return;let d=this.getBlocks(c);const h=this.findPlugin(t);if(d=d.map(g=>{if(!g||g.isCard())return null;const m=t;let v=g==null?void 0:g.parent();for(;v&&!v.isEditable();){g=v;const b=v.parent();if(b&&r.isBlock(b))v=b;else break}return s.isAllowIn(m.name,g.name)?g:this.findPlugin(g)===h?g.children():null}).filter(g=>g!==null),d.length===0){const g=this.closest(c.startNode);if(g.isCard()||g.isEditable()||!s.isAllowIn(t.name,g.name))return;const m=c.createSelection();g.children().each(v=>{t.append(v)}),g.append(t),m.move();return}const f=c.createSelection();(p=d[0])==null||p.before(t),d.forEach(g=>{g&&(h&&g.allChildren().forEach(m=>{var v;if(r.isMark(m)){const b=a.findPlugin(m);if(!b)return;(v=h.disableMark)!=null&&v.indexOf(b.constructor.pluginName)&&r.unwrap(m)}}),t.append(g))}),f.move(),this.merge(c),o.merge(void 0,c),e||i.apply(c)}unwrap(t,e){const n=this.editor;if(!V(n))return;const{change:i,node:r}=n,s=e||i.range.toTrusty(),o=it(s.startContainer);if(typeof t=="string"||be(t)?t=I(t,o):t=t,!r.isBlock(t))return;const a=this.getSiblings(s,t);if(a.length===0)return;const c=a[0].node.parent();if(!(c!=null&&c.inEditor()))return;const u=a.some(m=>m.position==="left"),d=a.some(m=>m.position==="right");let h;if(u){const m=c;h=r.clone(m,!1,!1),m.before(h)}let f;if(d){const m=a[a.length-1].node.parent();m&&(f=r.clone(m,!1,!1),m==null||m.after(f))}const p=s.createSelection(),g=r;a.forEach(m=>{const v=m.position,b=m.node,_=b.parent();v==="left"&&(h==null||h.append(b)),v==="center"&&(_==null?void 0:_.name)===(t==null?void 0:t.name)&&(_==null?void 0:_.inEditor())&&g.unwrap(_),v==="right"&&(f==null||f.append(b))}),h&&h.name==="ol"&&f&&f.name==="ol"&&f.attributes("start",(parseInt(h.attributes("start"),10)||1)+h.find("li").length),p.move(),e||i.apply(s)}getSiblings(t,e){const n=[],i=this.editor.node;if(!i.isBlock(e))return n;const r=(d,h)=>{let f=this.closest(d);for(;f;){const p=f.parent();if(!p||!f.inEditor()||f.text().trim()!==p.text().trim()||p.name===h)break;f=p}return f},s=r(t.startNode,e.name),o=r(t.endNode,e.name),a=s.parent();let c="left",u=a==null?void 0:a.first();for(;u;){if(u=I(u),!i.isBlock(u)||!u.inEditor())return n;u[0]===s[0]&&(c="center"),n.push({position:c,node:u}),u[0]===o[0]&&(c="right"),u=u.next()}return n}split(t){var f,p;const e=this.editor;if(!V(e))return;const{change:n,mark:i,nodeId:r}=e,s=t||n.range.toTrusty();s.collapsed||n.delete(s);const o=this.closest(s.startNode);if(!o.isEditable()&&!o.inEditor())return;if(o.isEditable()){const g=s.getStartOffsetNode();g&&s.select(g,!0).shrinkToElementNode().collapse(!1),t||n.apply(s);return}const a=s.cloneRange();a.shrinkToElementNode().shrinkToTextNode().collapse(!0);const c=i.findMarks(a).filter(g=>{const m=e.mark.findPlugin(g);return(m==null?void 0:m.copyOnEnter)!==!1&&(m==null?void 0:m.followStyle)!==!1}),u=this.getBlockByRange({block:o[0],range:s,isLeft:!1,keepDataId:!0}),d=e.node;u.traverse(g=>{!d.isVoid(g)&&(d.isInline(g)||d.isMark(g))&&d.isEmpty(g)&&g.remove()},!0);const h=g=>d.isBlock(g)&&(g.childNodes.length===0||g.innerText==="");return h(o[0])&&!h(u[0])?r.generate(o,!0):r.generate(u,!0),o.after(u),d.isEmpty(o)&&d.html(o,d.getBatchAppendHTML(c,c.length>0?"&#8203;":"<br />")),d.isEmpty(u)&&d.html(u,d.getBatchAppendHTML(c,c.length>0?"&#8203;":"<br />")),o.children().each(g=>{d.isInline(g)&&e.inline.repairCursor(g)}),u.children().each(g=>{d.isInline(g)&&e.inline.repairCursor(g)}),s.select(u,!0).shrinkToElementNode(),((f=u.get())==null?void 0:f.childNodes.length)===1&&((p=u.first())==null?void 0:p.name)==="br"?s.collapse(!1):s.collapse(!0),t||n.apply(s),u}insert(t,e,n,i=!1){var v,b;const r=this.editor;if(!V(r))return;const{change:s,node:o,list:a,inline:c}=r,u=e||s.range.toTrusty(),d=it(u.startContainer);if(typeof t=="string"||be(t)?t=I(t,d):t=t,!o.isBlock(t))return;u.collapsed||s.delete(u);let h=this.closest(u.startNode);if(!h.isEditable()&&!h.inEditor()){e||s.apply(u);return}if(h.isEditable()){o.insert(t,u,i),u.collapse(!1),e||s.apply(u);return}if(o.isList(u.startNode)||u.startNode.closest("li").length>0){const _=d.createDocumentFragment();_.appendChild(t[0]),a.insert(_,u),e||s.apply(u);return}((v=h.get())==null?void 0:v.childNodes.length)===1&&((b=h.first())==null?void 0:b.name)==="br"&&u.select(h,!0).collapse(!1);const f=u.enlargeToElementNode().createSelection();if(!f.has()){e||s.apply(u);return}h=n?n(h):h;let p=f.getNode(h,"left");p.traverse(_=>{_.equal(p)||o.isBlock(_)&&(o.isEmpty(_)||a.isEmptyItem(_))&&_.remove()});let g=f.getNode(h,"right",!0,_=>{if(_.isCard()){const x=_.parent();if(x&&o.isCustomize(x))return!1}return!0});const m=h.children();if(o.isEmpty(h)||m.each((_,x)=>{var E;const w=m.eq(x);w!=null&&w.isCard()||(E=m.eq(x))==null||E.remove()}),g.traverse(_=>{!_.equal(g)||(o.isBlock(_)&&(o.isEmpty(_)||a.isEmptyItem(_))?_.remove():o.isList(_)&&a.addBr(_))}),g.length>0&&!o.isEmpty(g)&&!a.isEmptyItem(g)){const _=g.clone(!1);r.nodeId.generate(_,!0);const x=g.children();x.each((w,E)=>{var S;if((S=x.eq(E))!=null&&S.isCard()){const R=r.card.find(w);R&&_.append(R.root)}else _.append(w)}),g=_,h.after(_)}if(p.length>0&&!o.isEmpty(p)&&!a.isEmptyItem(p)){let _;(w=>{w.each((E,S)=>{const R=w.eq(S);if(R&&o.isInline(R)&&c.repairCursor(R),R!=null&&R.isCard()){_=_?_.next():h.first(),_&&(w[S]=_[0]);return}_?(_.after(E),_=R):(_=R,h.prepend(E))})})(p.children())}h&&h.length>0&&(u.select(h,!0),u.collapse(!1)),f.focus&&f.focus.remove(),f.anchor&&f.anchor.remove(),o.insert(t,u,i),e||s.apply(u)}setBlocks(t,e){const n=this.editor;if(!V(n))return;const{node:i,schema:r,mark:s}=n,{change:o}=n,a=e||o.range.toTrusty(),c=it(a.startContainer);let u=null,d={};typeof t=="string"?(u=I(t,c),d=u.attributes(),d.style=u.css()):d=t;const h=this.getBlocks(a),{startNode:f}=a;if(f.isEditable()&&h.length===0){if(f.isCard()||f.isEditable())return;const m=u||I("<p></p>");if(!r.isAllowIn(m.name,f.name))return;i.setAttributes(m,d);const v=a.createSelection();f.children().each(E=>{m.append(E)});const b=r.data.globals.block||{},_=f.attributes();Object.keys(_).forEach(E=>{E!==we&&E!=="id"&&b.name&&m.attributes(E,_[E])});const x=b.style||{},w=f.css();Object.keys(w).forEach(E=>{x[E]||delete w[E]}),m.css(w),f.append(m),v.move(),e||o.apply(a);return}const p=u?this.findPlugin(u):void 0,g=a.createSelection();h.forEach(m=>{if(m.attributes(ke))return;if(u){const _=r.data.globals.block||{},x=m.attributes();Object.keys(x).forEach(S=>{S!==we&&S!=="id"&&_.name&&(u==null||u.attributes(S,x[S]))});const w=_.style||{},E=m.css();Object.keys(E).forEach(S=>{w[S]||delete E[S]}),u.css(E)}if(!u||this.findPlugin(m)===p&&m.name===u.name){u&&(d=u.attributes()),i.setAttributes(m,d);return}if(u.name!=="p"&&r.isAllowIn(m.name,u.name))return;p&&m.allChildren().forEach(_=>{if(i.isMark(_)){const x=s.findPlugin(_);if(!x)return;p.disableMark&&p.disableMark.indexOf(x.constructor.pluginName)>-1&&i.unwrap(_)}});const v=i.replace(m,u),b=v.parent();b&&!b.isEditable()&&!r.isAllowIn(b.name,v.name)&&i.unwrap(b)}),g.move(),e||o.apply(a)}merge(t){const e=this.editor;if(!V(e))return;const{change:n,schema:i}=e,r=t||n.range.toTrusty(),s=this.getBlocks(r);if(s.length===0)return;const o=s[0].closest(fi),a=i.getCanMergeTags();if(a.length===0)return;const c=o.find(a.join(","));if(c.length>0){const u=r.createSelection();let d=c.next();for(;d&&a.indexOf(d.name)>0;){const h=d.prev(),f=d.attributes(),p=h==null?void 0:h.attributes();d.name===(h==null?void 0:h.name)&&f.class===(p?p.class:void 0)&&Object.keys(f).join(",")===Object.keys(p||{}).join(",")&&e.node.merge(h,d),d=d.next()}u.move()}t||n.apply(r)}findBlocks(t){var m;const e=this.editor;if(t=t.cloneRange(),t.startNode.isRoot()&&t.shrinkToElementNode(),!t.startNode.inEditor()||((m=e.card.find(t.startNode))==null?void 0:m.type)===Ve.BLOCK)return[];const n=t.startContainer,i=t.startOffset,r=t.endContainer,s=t.endOffset;let o=n,a=r;n.nodeType===Node.ELEMENT_NODE&&n.childNodes[i]&&(o=n.childNodes[i]||n),r.nodeType===Node.ELEMENT_NODE&&s>0&&r.childNodes[s-1]&&(a=r.childNodes[s-1]||n),t.collapsed&&(o=a);const c=(v,b,_)=>{v.some(x=>x[0]===b[0])||(_?v.unshift(b):v.push(b))},u=v=>{const b=[];for(;v&&!v.isEditable();){e.node.isBlock(v)&&b.push(v);const _=v.parent();if(!_)break;v=_}return b},d=this.getBlocks(t);u(I(o)).forEach(v=>c(d,v,!0));const{commonAncestorNode:h}=t,f=e.card.find(h,!0);let p=f==null?void 0:f.isEditable;const g=p?f!=null&&f.getSelectionNodes?f.getSelectionNodes():[]:[];return g.length===0&&(p=!1),(!t.collapsed||p)&&(u(I(a)).forEach(v=>c(d,v)),g.forEach(v=>{v.traverse(b=>{b.isElement()&&!b.isCard()&&e.node.isBlock(b)&&c(d,b)},!0,"editable")})),d}isFirstOffset(t,e){const{startNode:n,endNode:i,startOffset:r,endOffset:s}=t,o=e==="start"?n:i,a=e==="start"?r:s;t=t.cloneRange();const c=this.closest(o);t.select(c,!0),t.setEnd(o[0],a);const u=this.editor;u.node.isBlock(o)||t.enlargeToElementNode();const d=t.cloneContents();if(!d.firstChild)return!0;const{node:h}=u;if(d.childNodes.length===1&&I(d.firstChild).name==="br")return!0;const f=I("<div />");return f.append(d),h.isEmpty(f)}isLastOffset(t,e){const{startNode:n,endNode:i,startOffset:r,endOffset:s}=t,o=e==="start"?n:i,a=e==="start"?r:s;t=t.cloneRange();const c=this.closest(o);t.select(c,!0),t.setStart(o,a);const{node:u}=this.editor;u.isBlock(o)||t.enlargeToElementNode();const d=t.cloneContents();if(!d.firstChild)return!0;const h=I("<div />");return h.append(d),0>=h.find("br").length&&u.isEmpty(h)}getBlocks(t){t=t.cloneRange(),t.shrinkToElementNode(),t.shrinkToTextNode();const e=this.editor,{node:n}=e;let i=this.closest(t.startNode);t.startNode.isRoot()&&(i=I(t.getStartOffsetNode()));let r=this.closest(t.endNode);t.endNode.isRoot()&&(r=I(t.getEndOffsetNode()));const s=this.closest(t.commonAncestorNode),o=[];let a=!1;const{commonAncestorNode:c}=t,u=e.card.find(c,!0);let d=u==null?void 0:u.isEditable;const h=d?u!=null&&u.getSelectionNodes?u.getSelectionNodes():[]:[s];return h.length===0&&(d=!1,h.push(s)),h.forEach(f=>{f.traverse(p=>{const g=I(p);if(g.equal(i)&&(a=!0),(a||d)&&e.node.isBlock(g)&&!g.isCard()&&g.inEditor()&&o.push(g),g.equal(r))return a=!1,!1},!0,"editable")}),o.length>1&&this.isFirstOffset(t,"end")&&!n.isEmpty(r)&&o.pop(),o}getBlockByRange({block:t,range:e,isLeft:n,clone:i=!1,keepDataId:r=!1}){be(t)&&(t=I(t));const s=this.editor,o=Te.create(s,t.document);n?(o.select(t,!0),o.setEnd(e.startContainer,e.startOffset)):(o.select(t,!0),o.setStart(e.endContainer,e.endOffset));const a=i?o.cloneContents():o.extractContents(),c=r?t.clone(!1):s.node.clone(t,!1,!1);return c.append(a),i&&c.find(ut).each(u=>{const d=I(u),h=d.attributes(ke);d.attributes(We,h),d.removeAttributes(ke)}),c}getLeftText(t,e){const n=this.editor;return V(n)?(e=e||n.change.range.get(),this.getBlockByRange({block:t,range:e,isLeft:!0,clone:!0}).text().replace(/\u200B/g,"")):""}removeLeftText(t,e){const n=this.editor;if(!V(n))return;e=e||n.change.range.get(),be(t)&&(t=I(t)),e.createSelection();const i=t.find(uo);let r=!1;t.traverse(s=>{const o=I(s);if(o.equal(i)){i.remove(),r=!0;return}r&&o.isText()&&o.remove()},!1)}flat(t,e){const n=this.editor;if(!V(n))return;const{schema:i,node:r}=n,s=i.getCanMergeTags();let o=t.parent();const a=e.fragment?e[0].parentNode:e.get();for(;o&&a&&o.get()!==a&&o.inEditor();){if(t.isCard())o.before(t);else if(r.isList(o)&&t.name==="li"||s.indexOf(o.name)>-1&&r.isBlock(t)&&o.name!==t.name){const c=r.clone(o,!1,!1);c.append(t),t=c,o.before(t)}else t=r.replace(t,r.clone(this.findTop(o,t),!1,!1)),o.before(t);o.first()||o.remove(),o=t.parent()}}insertEmptyBlock(t,e){const n=this.editor;if(!V(n))return;const{change:i}=n,{blocks:r,marks:s}=i,o=n.node;if(this.insert(e),r[0]){const u=r[0].css();e.css(u)}let a=e.find("br");s.forEach(u=>{const d=n.mark.findPlugin(u);u=o.clone(u,!1,!1),(d==null?void 0:d.copyOnEnter)!==!1&&(d==null?void 0:d.followStyle)!==!1&&(u=o.clone(u,!1,!1),a.before(u),u.append(a),a=u)}),a=e.find("br");const c=a.parent();c&&o.isMark(c)&&(a=o.replace(a,I("\u200B",null))),t.select(a).shrinkToTextNode(),t.collapse(!1),t.scrollIntoView(),i.range.select(t)}insertOrSplit(t,e){var i,r,s;const n=t.cloneRange();if(n.enlargeFromTextNode(),this.isLastOffset(t,"end")||n.endNode.type===Node.ELEMENT_NODE&&(((i=e.get())==null?void 0:i.childNodes.length)||0)>0&&n.endContainer.childNodes[n.endOffset]===((r=e.last())==null?void 0:r.get())&&((s=e.first())==null?void 0:s.name)==="br"){const o=I("<p><br /></p>");if(e.name==="p"){const a=e.attributes();Object.keys(a).forEach(c=>{c!==we&&o.attributes(c,a[c])})}this.insertEmptyBlock(t,o)}else this.split()}}class Pne{constructor(t,e){y(this,"kind","editor");y(this,"options",{lang:"zh-CN",locale:{},plugins:[],cards:[],config:{},iconFonts:"url('//at.alicdn.com/t/font_1456030_lnqmc6a6ca.woff2?t=1638071536645') format('woff2'), url('//at.alicdn.com/t/font_1456030_lnqmc6a6ca.woff?t=1638071536645') format('woff'), url('//at.alicdn.com/t/font_1456030_lnqmc6a6ca.ttf?t=1638071536645') format('truetype')"});y(this,"container");y(this,"language");y(this,"root");y(this,"card");y(this,"plugin");y(this,"node");y(this,"nodeId");y(this,"list");y(this,"mark");y(this,"inline");y(this,"block");y(this,"event");y(this,"schema");y(this,"conversion");y(this,"command");y(this,"clipboard");y(this,"request");y(this,"_scrollNode",null);this.options={...this.options,...e};let{iconFonts:n}=this.options,i=document.querySelector("#am-iconfont");if(!i&&n!==!1){i=document.createElement("style"),i.setAttribute("type","text/css"),i.setAttribute("id","am-iconfont");let s='@font-face { font-family: "data-icon";';Array.isArray(n)&&(n=n.map(o=>`url('${o.url}') format('${o.format}')`).join(",")),s+=`src: ${n};}`,i.innerHTML=s,document.head.appendChild(i)}this.container=I(t),this.container.attributes(le,qn),this.language=new Hte(this.options.lang||"zh-CN",Li(jte,e==null?void 0:e.locale)),this.event=new Ah,this.command=new Kte(this),this.schema=new $l,this.schema.add(_Z),this.conversion=new Pl(this),yZ.forEach(s=>this.conversion.add(s.from,s.to)),this.card=new sne(this,this.options.lazyRender),this.clipboard=new hne(this),this.request=new Ane,this.plugin=new Zte(this),this.node=new kZ(this),this.nodeId=new one(this.schema),this.list=new Nne(this),this.mark=new Rne(this),this.inline=new One(this),this.block=new $ne(this),this.root=I(this.options.root||this.container.parent()||document.body);const r=this.root.css("position");(!r||r==="static")&&this.root.css("position","relative")}get scrollNode(){if(this._scrollNode)return this._scrollNode;const{scrollNode:t}=this.options;let e=t?typeof t=="function"?t():t:null;const n=["auto","scroll"];let i=this.container.parent();for(;!e&&i&&i.length>0&&i.name!=="body";)if(n.includes(i.css("overflow"))||n.includes(i.css("overflow-y"))){e=i.get();break}else i=i.parent();return e===null&&(e=document.documentElement),this._scrollNode=e?I(e):null,this._scrollNode}init(){this.mark.init(),this.inline.init(),this.block.init(),this.list.init();const{plugins:t,cards:e,config:n}=this.options;this.card.init(e!=null?e:[]);const i=typeof n=="function"?n(this):n!=null?n:{};this.plugin.init(t!=null?t:[],i),this.nodeId.init()}setScrollNode(t){this._scrollNode=t?I(t):null}on(t,e,n){return this.event.on(t,e,n),this}off(t,e){return this.event.off(t,e),this}trigger(t,...e){return this.event.trigger(t,...e)}messageSuccess(t,e,...n){console.log(t,`success:${e}`,...n)}messageError(t,e,...n){console.error(t,`error:${e}`,...n)}messageConfirm(t,e,...n){return console.log(t,`confirm:${e}`,...n),Promise.reject(!1)}getSelectionData(t){var v,b,_,x;if(t||(t=(v=Te.from(this))!=null?v:void 0),!t)return;t=t.cloneRange();let e=t.startNode.closest(`[${ke}]`,w=>I(w).isEditable()?void 0:w.parentNode||void 0);if(e.length>0&&!t.collapsed&&t.endOffset===0&&(t.endContainer.previousSibling&&t.setEndAfter(t.endContainer.previousSibling),!t.collapsed&&t.endOffset>0&&t.endContainer.childNodes[t.endOffset-1]===e[0])){const w=t.startNode.closest(`[${He}="center"]`,E=>I(E).isEditable()?void 0:E.parentNode||void 0);w.length>0?t.setEnd(w[0],w[0].childNodes.length):t.setEnd(e[0],e[0].childNodes.length)}let n=t.commonAncestorNode;if(e=n.closest(`[${ke}]`,w=>I(w).isEditable()?void 0:w.parentNode||void 0),e.length>0&&n.closest(`[${He}="center"]`,E=>I(E).isEditable()?void 0:E.parentNode||void 0).length===0&&(t.select(e),n=t.commonAncestorNode),!n.inEditor()&&!n.isRoot()||t.collapsed)return;const i=w=>{if(w.length===0)return{};for(let E=w.length-1;E>0;E--)w[E].appendChild(w[E-1]);return{inner:w[0],outter:w[w.length-1]}};if(e=n.closest(`[${ke}]`,w=>w.parentNode||void 0),e.length>0){const w=this.card.find(e);if(w&&w.getSelectionNodes){const E=w.getSelectionNodes();if(E.length>0){const{inner:S,outter:R}=i(E.map(L=>L[0]));let D=E.map(L=>L.html()).join("");D=new $t(`<div>${D}</div>`,this).toHTML(S,R);const O=new $t(D,this).toText(this.schema,!0);return{html:D,text:O}}}else if(!(w!=null&&w.isEditable))return}const{node:r,list:s}=this;let o;const a=t.startNode.closest("li");if(a&&r.isCustomize(a)){const w=t.endNode.closest("li");if(!a.equal(w)||s.isLast(t)&&s.isFirst(t))if(s.isFirst(t)){const E=a.parent(),S=a.getIndex();E&&t.setStart(E,S<0?0:S)}else{const E=a.parent(),S=t.createSelection(),R=S.getNode(a,"center",!0);if((b=S.anchor)==null||b.remove(),(_=S.focus)==null||_.remove(),V(this)&&this.change.combinText(),R.length>0){let D=!1;R.each((L,B)=>{const A=R.eq(B);if(!D&&(A==null?void 0:A.name)==="li"){D=!0;return}D&&(A==null||A.remove())});const P=a.first(),O=P?this.card.find(P):void 0;O&&(o=R,this.list.addCardToCustomize(o,O.name,O.getValue()),E&&r.wrap(o,E==null?void 0:E.clone()))}}}const c=t.enlargeToElementNode(!0).cloneContents(),u=[];if(n.isText()&&c.childNodes.length===1&&((x=c.firstChild)==null?void 0:x.nodeType)===Node.TEXT_NODE){let w=n.parent();for(;w&&(r.isMark(w)||r.isInline(w));)u.push(w.clone(!1).get()),w=w.parent()}c.querySelectorAll("li").forEach(w=>{var O,L;const E=I(w),S=E.attributes(we);if(!S)return;const R=(O=this.container.get())==null?void 0:O.querySelector(`[${we}=${S}]`);r.isCustomize(E)&&!((L=E.first())!=null&&L.isCard())&&(R==null?void 0:R.firstChild)&&E.prepend(r.clone(I(R.firstChild),!0,!1));let D=R==null?void 0:R.parentElement;D=D?I(D.cloneNode(!1)):null;const P=w.parentElement;R&&D&&r.isList(D)&&(!P||!r.isList(P))&&(D.name==="ol"&&D.removeAttributes("start"),r.wrap(w,D))});const{inner:d,outter:h}=i(u),f=[];c.childNodes.forEach(w=>{const E=I(w);(r.isList(E)||E.name==="li")&&f.push(E)}),this.nodeId.generateAll(I(c),!0),this.list.merge(f);let g=new $t(c,this).toHTML(d,h);const m=new $t(g,this).toText(this.schema,!0);return{html:g,text:m}}destroy(){this.container.removeAttributes(le),this.event.destroy(),this.plugin.destroy(),this.card.destroy(),this.container.empty()}}class zne extends Pne{constructor(e,n){super(e,n);y(this,"_readonly",!1);y(this,"_container");y(this,"kind","engine");y(this,"typing");y(this,"ot");y(this,"change");y(this,"history");y(this,"hotkey");this.options={...this.options,...n},this.history=new UQ(this),this._container=new fee(this.container,{engine:this,lang:this.options.lang,className:this.options.className,tabIndex:this.options.tabIndex,placeholder:this.options.placeholder,autoPrepend:this.options.autoPrepend,autoAppend:this.options.autoAppend}),this.root=I(this.options.root||this.container.parent()||it().body);const i=this.root.css("position");(!i||i==="static")&&this.root.css("position","relative"),this._container.init(),this.change=new uX(this,{onChange:r=>this.trigger("change",r),onSelect:()=>this.trigger("select"),onRealtimeChange:r=>{this.trigger("realtimeChange",r)},onSetValue:()=>this.trigger("afterSetValue")}),this.change.init(),this.typing=new dee(this),this._readonly=this.options.readonly===void 0?!1:this.options.readonly,this._container.setReadonly(this._readonly),this.hotkey=new jQ(this),this.init(),this.ot=new BY(this),this.isEmpty()&&this._container.showPlaceholder(),this.ot.initLocal()}get readonly(){return this._readonly}set readonly(e){this.readonly!==e&&(e?(this.hotkey.disable(),this._container.setReadonly(!0),this.ot.stopMutation()):(this.hotkey.enable(),this._container.setReadonly(!1),this.ot.startMutation()),this._readonly=e,this.card.reRender(),this.trigger("readonly",e))}isFocus(){return this._container.isFocus()}isEmpty(){return this.change.isEmpty()}focus(e){this.change.range.focus(e)}blur(){this.change.range.blur()}getValue(e=!1){const n=this.change.getValue({ignoreCursor:e});return e?go.removeTags(n):n}async getValueAsync(e=!1,n){return new Promise(async(i,r)=>{for(const s in this.plugin.components){const o=this.plugin.components[s],a=await new Promise(c=>{o.waiting?o.waiting(n).then(()=>c(!0)).catch(c):c(!0)});if(typeof a=="object"){r(a);return}}i(this.getValue(e))})}getHtml(){const e=I(this.container[0].cloneNode(!0));return e.removeAttributes(yt),e.removeAttributes("tabindex"),e.removeAttributes("autocorrect"),e.removeAttributes("autocomplete"),e.removeAttributes("spellcheck"),e.removeAttributes("data-gramm"),e.removeAttributes(Fs),e.removeClass(Za),e.removeAttributes("role"),new $t(e,this).toHTML()}initDocOnReadonly(){var e,n;this.readonly&&!this.ot.isRemote&&((e=this.ot.doc)!=null&&e.type?this.ot.doc.data=An(this.container):(n=this.ot.doc)==null||n.create(An(this.container)))}setValue(e,n){return e=this.trigger("beforeSetValue",e)||e,this.change.setValue(e,void 0,n),this.normalize(),this.nodeId.generateAll(this.container),this.initDocOnReadonly(),this}setHtml(e,n){return this.change.setHtml(e,i=>{this.normalize(),this.container.allChildren("editable").forEach(r=>{this.node.isInline(r)?this.inline.repairCursor(r):this.node.isMark(r)&&this.mark.repairCursor(r)}),n&&n(i)}),this.nodeId.generateAll(this.container),this.initDocOnReadonly(),this}setMarkdown(e,n){return this.change.setMarkdown(e,i=>{this.normalize(),this.container.allChildren("editable").forEach(r=>{this.node.isInline(r)?this.inline.repairCursor(r):this.node.isMark(r)&&this.mark.repairCursor(r)}),n&&n(i)}),this.nodeId.generateAll(this.container),this.initDocOnReadonly(),this}setJsonValue(e,n){const i=I(Cl(e)),r=this.node.html(i);return this.change.setValue(r,void 0,n),this.normalize(),this.nodeId.generateAll(this.container),this.initDocOnReadonly(),this}getJsonValue(){return An(this.container)}getText(e){return new $t(this.container,this).toText(this.schema,e)}normalize(e=this.container){let n=I("<p />"),i=e.children();i.each((r,s)=>{const o=i.eq(s);!o||(this.node.isBlock(o)?(n.get().childNodes.length>0&&o.before(n),n=I("<p />")):o.isCursor()||n.append(o))}),n.get().childNodes.length>0&&e.append(n),i=e.children(),i.each((r,s)=>{const o=i.eq(s);if(!!o&&(this.node.removeMinusStyle(o,"text-indent"),this.node.isRootBlock(o))){const a=o.get().childNodes.length;if(a===0)o.append(I("<br />"));else{const c=o.first();a===1&&(c==null?void 0:c.name)==="span"&&[Dn,Tn,Nn].indexOf(c.attributes(le))>=0&&o.prepend(I("<br />"))}}})}showPlaceholder(){this._container.showPlaceholder()}hidePlaceholder(){this._container.hidePlaceholder()}destroy(){this._container.destroy(),this.change.destroy(),this.hotkey.destroy(),this.typing.destroy(),this.ot&&this.ot.destroy(),super.destroy()}}const qne=zne;class Hne{constructor(t,e){y(this,"card");y(this,"node");y(this,"editor");this.editor=t,this.card=e}restore(){this.card.root.removeClass("data-card-block-max"),this.node&&(this.node.remove(),this.node=void 0);const t=this.editor;V(t)&&(t.trigger("card:minimize",this.card),t.history.reset())}maximize(){if(this.node)return;const t=this.editor,{language:e}=t,n=e.get("maximize","back").toString(),i=I(`<div class="card-maximize-header" ${jr}="true" ${le}="${Qe}">
            <div class="header-crumb">
                <a class="split">
                    <span class="data-icon data-icon-arrow-left"></span>
                </a>
                <a>${n}</a>
            </div>
        </div>`);i.on("click",o=>{o.stopPropagation()}),this.card.root.addClass("data-card-block-max"),i.find(".header-crumb").on("click",()=>{this.card.minimize()});const s=this.card.findByKey("body");s==null||s.prepend(i),V(t)&&(t.trigger("card:maximize",this.card),t.history.reset()),this.node=i}}class od{constructor(t,e){y(this,"editor");y(this,"card");y(this,"point");y(this,"options",{});y(this,"component");y(this,"start",!1);y(this,"touchStart",t=>{t.preventDefault(),t.cancelBubble=!0,this.point={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY};const{dragStart:e}=this.options;e&&e(this.point)});y(this,"dragStart",t=>{t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0,this.point={x:t.clientX,y:t.clientY};const{dragStart:e}=this.options;e&&e(this.point)});y(this,"dragMove",t=>{if(this.point){const{dragMove:e}=this.options;e&&e(t.clientY-this.point.y)}});y(this,"touchMove",t=>{if(t.preventDefault(),this.point){const{dragMove:e}=this.options;e&&e(t.targetTouches[0].clientY-this.point.y)}});y(this,"dragEnd",t=>{this.point=void 0;const{dragEnd:e}=this.options;e&&e()});this.editor=t,this.card=e}create(t){this.options=t;const e=I(`<div class="data-card-resize" ${le}="${Qe}" draggable="true"><span class="data-card-resize-btn"><svg viewBox="0 0 3413 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="8px" height="6px"><path d="M341.333333 341.333333h2730.666667a170.666667 170.666667 0 0 0 0-341.333333H341.333333a170.666667 170.666667 0 1 0 0 341.333333zM341.333333 1024h2730.666667a170.666667 170.666667 0 0 0 0-341.333333H341.333333a170.666667 170.666667 0 0 0 0 341.333333z"></path></svg></span></div>`);ue?(e.on("touchstart",this.touchStart),e.on("touchmove",this.touchMove),e.on("touchend",this.dragEnd),e.on("touchcancel",this.dragEnd)):(e.on("dragstart",this.dragStart),document.addEventListener("mousemove",this.dragMove),document.addEventListener("mouseup",this.dragEnd)),e.on("click",n=>{n.stopPropagation()}),this.component=e}render(t=this.card.root,e=80){this.start=!1;let n=0,i=0;const r=this.card;this.create({dragStart:()=>{n=t.height(),this.start=!0,r.onActivate(!1)},dragMove:a=>{this.start&&(i=n+a,i=i<e?e:i,t.css("height",`${i}px`))},dragEnd:()=>{this.start&&(r.setValue({height:t.height()}),this.start=!1,r.onActivate(!0))}});const s=this.component;if(!s)return;r.activated||s.hide(),t.append(s);const o=r.getValue()||{};o.height&&t.css("height",`${o.height}px`)}show(){var t;(t=this.component)==null||t.show()}hide(){var t;this.start||(t=this.component)==null||t.hide()}destroy(){const t=this.component;if(ue){if(!t)return;t.off("touchstart",this.touchStart),t.off("touchmove",this.touchMove),t.off("touchend",this.dragEnd),t.off("touchcancel",this.dragEnd)}else t==null||t.off("dragstart",this.dragStart),document.removeEventListener("mousemove",this.dragMove),document.removeEventListener("mouseup",this.dragEnd);t==null||t.remove()}}class Eo{constructor(t){y(this,"editor");y(this,"container");y(this,"target");y(this,"align","bottomLeft");y(this,"offset",[0,0]);y(this,"root");y(this,"onUpdate");y(this,"updateTimeout");y(this,"observer");y(this,"updateListener",()=>{this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(()=>{this.update()},50)});y(this,"update",(t=!0)=>{if(!this.container||this.container.length===0||!this.target||this.target.length===0)return;const e=_o(this.container.get(),this.target.get(),{...sr[this.align],targetOffset:this.offset});if(this.onUpdate&&t){const n=Object.keys(sr).find(i=>{const r=sr[i].points;return r[0]===e.points[0]&&r[1]===e.points[1]});this.container.attributes("data-placement",n),this.onUpdate({...e,align:n})}});this.editor=t}bind(t,e,n=this.align,i=this.offset,r){var s;if(this.container=t,this.target=e,this.align=n,this.offset=i,this.root=I('<div style="position: absolute; top: 0px; left: 0px; width: 100%;"></div>'),this.root.append(this.container),this.editor.root.append(this.root),this.onUpdate=r,ue||window.addEventListener("scroll",this.updateListener),window.addEventListener("resize",this.updateListener),V(this.editor)&&!ue&&((s=this.editor.scrollNode)==null||s.on("scroll",this.updateListener)),e&&e.length>0){let o={width:e.width(),height:e.height()};typeof ResizeObserver<"u"&&(this.observer=new ResizeObserver(()=>{const a=e.width(),c=e.height();a===o.width&&c===o.height||(o={width:a,height:c},this.updateListener())}),this.observer.observe(e.get()))}this.update()}setOffset(t){this.offset=t}destroy(){var t,e,n;this.onUpdate=void 0,ue||window.removeEventListener("scroll",this.updateListener),window.removeEventListener("resize",this.updateListener),V(this.editor)&&!ue&&((t=this.editor.scrollNode)==null||t.off("scroll",this.updateListener)),(e=this.observer)==null||e.disconnect(),(n=this.root)==null||n.remove()}}const ad=l=>["button","input","dropdown","node","switch"].indexOf(l.type)===-1;class ld{constructor(t,e){y(this,"card");y(this,"toolbar");y(this,"editor");y(this,"offset");y(this,"position");y(this,"hideTimeout",null);y(this,"showTimeout",null);y(this,"defaultAlign","topLeft");y(this,"dndNode",null);y(this,"clearHide",()=>{this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=null});y(this,"clearShow",()=>{this.showTimeout&&clearTimeout(this.showTimeout),this.showTimeout=null});y(this,"enterHide",()=>{this.clearShow(),this.hideTimeout=setTimeout(()=>{var e,n;this.hide(),this.hideTimeout=null;const t=this.toolbar;(e=t==null?void 0:t.root)==null||e.off("mouseenter",this.clearHide),(n=t==null?void 0:t.root)==null||n.off("mouseleave",this.enterHide)},200)});y(this,"enterShow",()=>{this.clearHide(),this.showTimeout=setTimeout(()=>{var e,n;this.showTimeout=null,this.show();const t=this.toolbar;(e=t==null?void 0:t.root)==null||e.on("mouseenter",this.clearHide),(n=t==null?void 0:t.root)==null||n.on("mouseleave",this.enterHide)},200)});this.editor=t,this.card=e,this.position=new Eo(t),this.unbindEnterShow(),(!V(t)||t.readonly)&&this.bindEnterShow()}setDefaultAlign(t){this.defaultAlign=t}bindEnterShow(){this.card.root.on("mouseenter",this.enterShow),this.card.root.on("mouseleave",this.enterHide)}unbindEnterShow(){this.card.root.off("mouseenter",this.enterShow),this.card.root.off("mouseleave",this.enterHide)}setOffset(t){this.offset=t}getContainer(){var t;return(t=this.toolbar)==null?void 0:t.root}getDefaultItem(t){const e=this.editor,{language:n,clipboard:i,card:r}=e;switch(t.type){case"separator":return{key:"separator",type:"node",node:t.node||I('<span class="data-toolbar-item-split"></span>')};case"copy":return{key:"copy",type:"button",content:t.content||'<span class="data-icon data-icon-copy"></span>',title:t.title||n.get("copy","title"),onClick:(s,o)=>{if(t.onClick){t.onClick(s,o);return}i.copy(this.card.root[0],!0)?e.messageSuccess("copy",n.get("copy","success")):e.messageError("copy",n.get("copy","error"))}};case"delete":return{key:"delete",type:"button",content:t.content||'<span class="data-icon data-icon-delete"></span>',title:t.title||n.get("delete","title").toString(),onClick:(s,o)=>{if(t.onClick){t.onClick(s,o);return}r.remove(this.card.root)}};case"maximize":return{key:"maximize",type:"button",content:t.content||'<span class="data-icon data-icon-maximize"></span>',title:t.title||n.get("maximize","title").toString(),onClick:(s,o)=>{if(t.onClick){t.onClick(s,o);return}this.card.maximize()}};case"more":return{key:"more",type:"dropdown",content:t.content||'<span class="data-icon data-icon-more"></span>',title:t.title||n.get("more","title").toString(),items:t.items}}}getItems(){if(!this.card.toolbar)return[[],[]];const t=this.card.toolbar(),e=[];return t.forEach(n=>{if(ad(n))switch(n.type){case"dnd":break;default:const i=this.getDefaultItem(n);i&&e.push(i)}else e.push(n)}),[e,t]}create(){this.hide();const[t,e]=this.getItems();if(t.length>0){const n=e.find(r=>ad(r)&&r.type==="dnd");if(n&&!ue&&n.type==="dnd"){const{root:r,language:s}=this.editor,o=this.createDnd(n.content||'<span class="data-icon data-icon-drag"></span>',n.title||s.get("dnd","title").toString());r.append(o),this.dndNode=o}const i=new kY({items:t});i.root.addClass("data-card-toolbar"),i.root.attributes(fo,this.card.id),i.render(I(document.body)),i.hide(),this.toolbar=i}}update(){var e;const[t]=this.getItems();(e=this.toolbar)==null||e.update({items:t})}hide(){var t;(t=this.dndNode)==null||t.remove(),this.hideCardToolbar()}show(t){this.showCardToolbar(t)}hideCardToolbar(){var t;(t=this.toolbar)==null||t.destroy(),this.position.destroy()}showDnd(){!this.dndNode||this.dndNode.length!==0&&(this.card.isMaximize?this.dndNode.removeClass("data-card-dnd-active"):this.dndNode.length>0&&(this.dndNode.addClass("data-card-dnd-active"),setTimeout(()=>{this.position.bind(this.dndNode,this.card.root,"leftTop",this.offset)})))}showCardToolbar(t){this.create();const e=this.getContainer();if(e&&e.length>0){this.showDnd();const n=this.card;e.addClass("data-toolbar-active"),e.attributes("toolbar-trigger-key",n.constructor.cardName),this.toolbar&&this.toolbar.show();let i=this.defaultAlign;const r=this.position;setTimeout(()=>{r.bind(e,n.isMaximize?n.getCenter().first():n.root,this.defaultAlign,this.offset,s=>{this.offset&&this.offset.length===4&&s.align==="bottomLeft"&&s.align!==i?(r.setOffset([this.offset[2],this.offset[3]]),i=s.align,r.update(!1)):this.offset&&s.align===this.defaultAlign&&s.align!==i&&(r.setOffset(this.offset),i=s.align,r.update(!1)),i=s.align})},10)}}createDnd(t,e){const n=I(`<div ${le}="${Qe}" class="data-card-dnd" draggable="true" dnd-trigger-key="${this.card.constructor.cardName}" drag-card-trigger="${this.card.id}" ${yt}="false">
                <div class="data-card-dnd-trigger">
                    ${t}
                </div>
            </div>`);return n.on("mouseenter",()=>{Ue.show(n,e)}),n.on("mouseleave",()=>{Ue.hide()}),n.on("mousedown",i=>{i.stopPropagation(),Ue.hide(),this.hideCardToolbar()}),n.on("mouseup",()=>{this.showCardToolbar()}),n}destroy(){this.unbindEnterShow(),this.position.destroy()}}class Tt{constructor({editor:t,value:e,root:n}){y(this,"editor");y(this,"root");y(this,"toolbarModel");y(this,"resizeModel");y(this,"activatedByOther",!1);y(this,"selectedByOther",!1);y(this,"contenteditable",[]);y(this,"defaultMaximize");y(this,"isMaximize",!1);y(this,"_id");y(this,"resize");this.editor=t;const i=(e==null?void 0:e.type)||this.constructor.cardType,r=i==="inline"?"span":"div";this.root=n||I("<".concat(r," />")),typeof e=="string"&&(e=at(e)),e=e||{},e.id=this.getId(e.id),this._id=e.id,e.type=i,this.setValue(e),this.defaultMaximize=new Hne(t,this)}get isEditable(){return this.contenteditable.length>0}get activated(){return this.root.hasClass("card-activated")}setActivated(t){t?this.root.addClass("card-activated"):this.root.removeClass("card-activated")}get selected(){return this.root.hasClass("card-selected")}setSelected(t){t?this.root.addClass("card-selected"):this.root.removeClass("card-selected")}get id(){if(this._id)return this._id;const t=this.root.attributes(je);if(!t)return{};const e=at(t);return typeof e=="object"&&(e==null?void 0:e.id)||""}get name(){return this.root.attributes(ke)}get type(){let t=this.root.attributes(pt);if(!t){const e=this.root.attributes(je),n=at(e||"{}");t=(n==null?void 0:n.type)||this.constructor.cardType}return t}set type(t){if(!this.name||t===this.type)return;const e=this.editor.card,n=this.root.attributes(je),i=at(n||"{}"),r=e.replace(this,this.name,{...i,type:t});e.render(r.root),r.activate(!1),e.activate(r.root)}get loading(){return!!this.root.attributes(Ct)}init(){this.root.attributes(an,this.isEditable?"true":"false");const t=this.toolbarModel;t==null||t.hide(),t==null||t.destroy();const e=this.editor;this.toolbar&&(this.toolbarModel=new ld(e,this)),this.resize&&(this.resizeModel=new od(e,this))}getId(t){const e=[];if(this.editor.card.each(i=>{e.push(i.id)}),t&&e.indexOf(t)<0)return t;let n=Zr();for(;e.indexOf(n)>=0;)n=Zr();return n}setValue(t){if(t==null)return;const e=this.root.attributes(je),n=at(e||"{}");n!=null&&n.id&&delete t.id,t={...n,...t},t.type&&(n==null?void 0:n.type)!==t.type&&(this.type=t.type),this.root.attributes(je,Pi(t))}getValue(){const t=this.root.attributes(je);return t?at(t):{}}find(t){return this.root.find(t)}findByKey(t){const e=this.root.first()||I([]);if(t==="body"||e.length===0)return e;const n=e.children();if(["left","center","right"].indexOf(t)>-1)return n.toArray().find(o=>o.attributes(He)===t);const r=this.type===Ve.BLOCK?"div":"span",s=this.find(`${r}[${He}=${t}]`);return s.name===r&&s.attributes(He)===t?s:void 0}activate(t){t?this.activated||(this.setActivated(t),this.onActivate(t)):this.activated&&(this.setActivated(t),this.onActivate(!1))}select(t){!V(this.editor)||this.activatedByOther||(t?!this.selected&&!this.isMaximize&&(this.setSelected(t),this.onSelect(t)):this.selected&&(this.setSelected(t),this.onSelect(!1)))}getCenter(){const t=this.findByKey("center");return t||I([])}isCenter(t){var n;const e=t.closest(this.type===Ve.BLOCK?`div[${He}=center]`:`span[${He}=center]`);return e.length>0&&!!((n=this.findByKey("center"))!=null&&n.equal(e))}isCursor(t){return this.isLeftCursor(t)||this.isRightCursor(t)}isLeftCursor(t){var n;if(t.isElement()&&t.attributes(He)!=="left")return!1;const e=t.closest(St);return e.length>0&&!!((n=this.findByKey("left"))!=null&&n.equal(e))}isRightCursor(t){var n;if(t.isElement()&&t.attributes(He)!=="right")return!1;const e=t.closest(At);return e.length>0&&!!((n=this.findByKey("right"))!=null&&n.equal(e))}focus(t,e){const n=this.findByKey("left"),i=this.findByKey("right");if(!n||n.length===0||!i||i.length===0)return;const r=e?n:i;t.select(r,!0).shrinkToTextNode();const s=r.first();!s||(t.setStart(s,e?0:1),t.collapse(!0),V(this.editor)&&this.editor.change.range.select(t),this.onFocus&&this.onFocus())}maximize(){var t;this.isMaximize=!0,this.defaultMaximize.maximize(),(t=this.toolbarModel)==null||t.show()}minimize(){var t;this.isMaximize=!1,this.defaultMaximize.restore(),(t=this.toolbarModel)==null||t.show()}onSelect(t){const e=this.constructor.selectStyleType;if(e===ir.NONE)return;const n=`data-card-${e}-selected`,i=this.getCenter();t?i.addClass(n):i.removeClass(n)}onSelectByOther(t,e){const n=this.getCenter();this.constructor.selectStyleType===ir.BACKGROUND?n.css("background-color",t?e.rgb:""):n.css("outline",t?"2px solid "+e.color:"");const r="card-selected-other";return t?this.root.addClass(r):this.root.removeClass(r),n}onActivate(t){var e,n;!this.resize||(t?(e=this.resizeModel)==null||e.show():(n=this.resizeModel)==null||n.hide())}onActivateByOther(t,e){return this.onSelectByOther(t,e)}initToolbar(){var t,e;this.toolbar?(this.toolbarModel||(this.toolbarModel=new ld(this.editor,this)),this.activated&&this.toolbarModel.show()):((t=this.toolbarModel)==null||t.hide(),(e=this.toolbarModel)==null||e.destroy(),this.toolbarModel=void 0)}initResize(){var t;if(this.resize){this.resizeModel||(this.resizeModel=new od(this.editor,this));const e=typeof this.resize=="function"?this.resize():this.findByKey("body");e&&e.length>0&&((t=this.resizeModel)==null||t.render(e))}}didUpdate(){this.initResize(),this.initToolbar()}beforeRender(){const t=this.getCenter(),e=I(`<${this.type===Ve.BLOCK?"div":"span"} class="${Ct}" ${le}="${Qe}" />`);e.append('<svg viewBox="0 0 1024 1024" class="data-card-spin" data-icon="loading" width="1em" height="1em" fill="currentColor" aria-hidden="true"> <path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg>'),t.empty().append(e)}didRender(){this.loading&&(this.find(`.${Ct}`).remove(),setTimeout(()=>{this.root.removeAttributes(Ct)},200)),this.initResize(),this.initToolbar(),this.isEditable&&this.editor.nodeId.generateAll(this.getCenter().get())}destroy(){var t,e,n,i;(t=this.toolbarModel)==null||t.hide(),(e=this.toolbarModel)==null||e.destroy(),this.toolbarModel=void 0,(n=this.resizeModel)==null||n.hide(),(i=this.resizeModel)==null||i.destroy(),this.resizeModel=void 0}}y(Tt,"cardName"),y(Tt,"cardType"),y(Tt,"autoActivate"),y(Tt,"autoSelected",!0),y(Tt,"singleSelectable"),y(Tt,"collab",!0),y(Tt,"focus"),y(Tt,"selectStyleType",ir.BORDER),y(Tt,"lazyRender",!1);var Wne=bo,Une=Bi,jne="Expected a function";function Vne(l,t,e){var n=!0,i=!0;if(typeof l!="function")throw new TypeError(jne);return Une(e)&&(n="leading"in e?!!e.leading:n,i="trailing"in e?!!e.trailing:i),Wne(l,t,{leading:n,maxWait:t,trailing:i})}var cd=Vne;class Gne extends zi{constructor(e,n=!0,i=!1,r=!0,s){super();y(this,"container");y(this,"x");y(this,"y");y(this,"shadow");y(this,"scrollBarX");y(this,"slideX");y(this,"slideXDragging");y(this,"scrollBarY");y(this,"slideY");y(this,"slideYDragging");y(this,"shadowLeft");y(this,"shadowRight");y(this,"oWidth",0);y(this,"oHeight",0);y(this,"sWidth",0);y(this,"sHeight",0);y(this,"xWidth",0);y(this,"yHeight",0);y(this,"observer");y(this,"reverse");y(this,"content");y(this,"shadowTimer");y(this,"enableScrollval",!0);y(this,"scrollval");y(this,"isScrolling",!1);y(this,"refresh",()=>{var n,i,r,s,o,a,c,u;const e=this.container.get();if(e){const d=()=>{setTimeout(()=>{this.isScrolling=!1},0)},{scrollTop:h}=e,f=(n=this.content)==null?void 0:n.get(),p=Ee(this.container.css("padding-left")),g=Ee(this.container.css("padding-right")),m=Ee(this.container.css("padding-top")),v=Ee(this.container.css("padding-bottom")),b=f?this.content.width()+p+g:e.scrollWidth,_=f?this.content.height()+m+v:e.scrollHeight;if(this.oWidth=this.getWidth(),this.oHeight=this.container.height()-Ee(this.container.css("border-top-width"))-Ee(this.container.css("border-bottom-width")),this.sWidth=b,this.sHeight=_,this.xWidth=Math.floor(this.oWidth*this.oWidth/b),this.yHeight=Math.floor(this.oHeight*this.oHeight/_),this.x){(i=this.slideX)==null||i.css("width",this.xWidth+"px");const w=Math.round(this.oWidth)-p-g===this.sWidth||f&&Math.round(this.content.width())<=Math.round(this.oWidth-p-g)?"none":"block";(r=this.slideX)==null||r.css("display",w),this.emit("display",w),(s=this.shadowLeft)==null||s.css("display",w),(o=this.shadowRight)==null||o.css("display",w)}if(this.y){(a=this.slideY)==null||a.css("height",this.yHeight+"px");const w=Math.round(this.oHeight)-m-v===this.sHeight||f&&Math.round(this.content.height())<=Math.round(this.oHeight-m-v)?"none":"block";(c=this.slideY)==null||c.css("display",w),this.emit("display",w)}if(this.x&&f&&e.scrollWidth-p-g>this.content.width()){this.isScrolling=!0;let w=e.scrollWidth-p-g-this.content.width();if(this.scrollval){const{onScrollX:E,getScrollLeft:S}=this.scrollval;if(w=S?S(-0)+e.scrollLeft-w:e.scrollLeft-w,w<0&&(w=0),E){const R=E(w);R>0?e.scrollLeft=R:e.scrollLeft=0}this.scroll({left:w})}else e.scrollLeft-=w,d();return}if(this.y&&f&&e.scrollHeight-m-v!==this.content.height()){this.isScrolling=!0,e.scrollTop-=e.scrollHeight-m-v-this.content.height(),d();return}const x=(u=this.scrollval)!=null&&u.getScrollLeft?this.scrollval.getScrollLeft(e.scrollLeft):e.scrollLeft;if(this.scrollval){const{onScrollX:w}=this.scrollval;if(w){this.isScrolling=!0;const E=w(x);E>0?e.scrollLeft=E:e.scrollLeft=0,d()}this.scroll({left:x})}else this.reRenderX(x);this.reRenderY(h)}});y(this,"scroll",e=>{var r,s;let n=0,i=0;if(!this.scrollval&&e instanceof Event){const{scrollTop:o,scrollLeft:a}=e.target;n=o,i=a}else if(!(e instanceof Event))e.top===void 0&&(e.top=((r=this.container.get())==null?void 0:r.scrollTop)||0),e.left===void 0&&(e.left=((s=this.container.get())==null?void 0:s.scrollLeft)||0),n=e.top,i=e.left;else{if(this.isScrolling)return;this.refresh();return}this.reRenderX(i),this.reRenderY(n)});y(this,"wheelXScroll",cd(e=>{var c,u;e.preventDefault();const n=(xn?e.wheelDeltaX:e.wheelDelta/120||-e.detail)>0?"up":"down",i=this.container.get();if(!i)return;const r=this.container.width(),s=(c=this.scrollval)!=null&&c.getOffsetWidth?this.scrollval.getOffsetWidth(r):r,o=Math.max(s/(xn?20-Math.abs(e.wheelDelta):8),20);let a=((u=this.scrollval)!=null&&u.getScrollLeft?this.scrollval.getScrollLeft(i.scrollLeft):i.scrollLeft)+(n==="up"?-o:o);if(a=n==="up"?Math.max(0,a):Math.min(a,this.sWidth-this.oWidth),this.scrollval){const{onScrollX:d}=this.scrollval;if(d){const h=d(a);h>0?i.scrollLeft=h:i.scrollLeft=0}this.scroll({left:a})}else i.scrollLeft=a},xn?50:0,{trailing:!0}));y(this,"wheelYScroll",cd(e=>{e.preventDefault();const n=(xn?e.wheelDeltaX:e.wheelDelta/120||-e.detail)>0?"up":"down",i=this.container.get();if(!i)return;const r=this.container.height(),s=Math.max(r/(xn?20-Math.abs(e.wheelDelta):8),20);let o=i.scrollTop+(n==="up"?-s:s);o=n==="up"?Math.max(0,o):Math.min(o,this.sHeight-this.oHeight),i.scrollTop=o},xn?100:0,{trailing:!0}));y(this,"bindWheelScroll",e=>{if(!this.enableScrollval)return;this.x&&e.wheelDeltaX!==e.wheelDeltaY&&Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)?this.slideX&&this.slideX.css("display")!=="none"&&this.wheelXScroll(e):this.y&&e.wheelDeltaY!==0&&this.slideY&&this.slideY.css("display")!=="none"&&this.wheelYScroll(e)});y(this,"bindContainerTouchX",e=>{!e.target||!this.enableScrollval||I(e.target).hasClass("data-scrollbar-trigger")||(this.reverse=!0,this.scrollXStart(e))});y(this,"bindContainerTouchY",e=>{!e.target||!this.enableScrollval||I(e.target).hasClass("data-scrollbar-trigger")||(this.reverse=!0,this.scrollYStart(e))});y(this,"getEventClientOffset",e=>e instanceof MouseEvent?{x:e.clientX,y:e.clientY}:{x:e.touches[0].clientX,y:e.touches[0].clientY});y(this,"scrollX",e=>{var n;if(this.slideXDragging){const{point:i,position:r}=this.slideXDragging,s=this.getEventClientOffset(e);let o=this.reverse?r-(s.x-i):r+(s.x-i);o=Math.max(0,Math.min(o,this.oWidth-this.xWidth)),(n=this.slideX)==null||n.css("left",o+"px");let a=o/(this.oWidth-this.xWidth);a=Math.min(1,a);const c=this.container.get(),u=(this.sWidth-this.oWidth)*a;if(this.scrollval){const{onScrollX:d}=this.scrollval;if(d){const h=d(u);h>0?c.scrollLeft=h:c.scrollLeft=0}this.scroll({left:u})}else c.scrollLeft=u}});y(this,"scrollY",e=>{var n;if(this.slideYDragging){const{point:i,position:r}=this.slideYDragging,s=this.getEventClientOffset(e);let o=this.reverse?r-(s.y-i):r+(s.y-i);o=Math.max(0,Math.min(o,this.oHeight-this.yHeight)),(n=this.slideY)==null||n.css("top",o+"px");let a=o/(this.oHeight-this.yHeight);a=Math.min(1,a),this.container.get().scrollTop=(this.sHeight-this.oHeight)*a}});y(this,"scrollXEnd",()=>{this.slideXDragging=void 0,this.reverse=!1,document.body.removeEventListener(ue?"touchmove":"mousemove",this.scrollX),document.body.removeEventListener(ue?"touchend":"mouseup",this.scrollXEnd),this.container.removeClass("scrolling")});y(this,"scrollYEnd",()=>{this.slideYDragging=void 0,document.body.removeEventListener(ue?"touchmove":"mousemove",this.scrollY),document.body.removeEventListener(ue?"touchend":"mouseup",this.scrollYEnd),this.container.removeClass("scrolling")});y(this,"scrollXStart",e=>{var i;const n=this.getEventClientOffset(e);this.container.addClass("scrolling"),this.slideXDragging={point:n.x,position:parseInt(((i=this.slideX)==null?void 0:i.css("left"))||"0")},document.body.addEventListener(ue?"touchmove":"mousemove",this.scrollX),document.body.addEventListener(ue?"touchend":"mouseup",this.scrollXEnd)});y(this,"scrollYStart",e=>{var i;const n=this.getEventClientOffset(e);this.container.addClass("scrolling"),this.slideYDragging={point:n.y,position:parseInt(((i=this.slideY)==null?void 0:i.css("top"))||"0")},document.body.addEventListener(ue?"touchmove":"mousemove",this.scrollY),document.body.addEventListener(ue?"touchend":"mouseup",this.scrollYEnd)});y(this,"bindXScrollEvent",()=>{var e;this.x&&((e=this.slideX)==null||e.on(ue?"touchstart":"mousedown",this.scrollXStart))});y(this,"bindYScrollEvent",()=>{var e;this.y&&((e=this.slideY)==null||e.on(ue?"touchstart":"mousedown",this.scrollYStart))});y(this,"reRenderShadow",e=>{var n,i;if(this.shadow){const r=this.container.get();r&&((n=this.shadowLeft)==null||n.css("left",(this.scrollval?r.scrollLeft:e)+"px")),(i=this.shadowRight)==null||i.css("left",e+this.oWidth-4+"px")}});y(this,"reRenderX",e=>{var n,i,r;if(this.x){(n=this.scrollBarX)==null||n.css("left",e+"px");const s=this.sWidth-this.oWidth;let o=s<=0?0:e/s;o=Math.min(1,o),(i=this.slideX)==null||i.css("left",(this.oWidth-this.xWidth)*o+"px"),this.emit("change",{x:e,y:Ee(((r=this.scrollBarY)==null?void 0:r.css("top"))||"0")}),this.oWidth=this.getWidth(),this.reRenderShadow(e)}});y(this,"reRenderY",e=>{var n,i,r;if(this.y){(n=this.scrollBarY)==null||n.css("top",e+"px");const s=this.sHeight-this.oHeight;let o=s<=0?0:e/s;o=Math.min(1,o),(i=this.slideY)==null||i.css("top",(this.oHeight-this.yHeight)*o+"px"),this.emit("change",{x:Ee(((r=this.scrollBarX)==null?void 0:r.css("left"))||"0"),y:e})}});this.container=be(e)?I(e):e,this.x=n,this.y=i,this.shadow=r,this.scrollval=s,this.init()}setContentNode(e){this.content=e&&(be(e)?I(e):e)}init(){const e=this.container.children();let n=!1;e.each(i=>{!n&&I(i).hasClass("data-scrollbar")&&(n=!0)}),n||(this.container.css("position","relative"),this.container.addClass("data-scrollable"),this.x&&(this.scrollBarX=I(`<div ${le}="${Qe}" class="data-scrollbar data-scrollbar-x"><div class="data-scrollbar-trigger"></div></div>`),this.slideX=this.scrollBarX.find(".data-scrollbar-trigger"),this.container.append(this.scrollBarX),this.container.addClass("scroll-x")),this.y&&(this.scrollBarY=I(`<div ${le}="${Qe}" class="data-scrollbar data-scrollbar-y"><div class="data-scrollbar-trigger"></div></div>`),this.slideY=this.scrollBarY.find(".data-scrollbar-trigger"),this.container.append(this.scrollBarY),this.container.addClass("scroll-y")),this.shadow&&(this.shadowLeft=I(`<div ${le}="${Qe}" class="scrollbar-shadow-left"></div>`),this.shadowRight=I(`<div ${le}="${Qe}" class="scrollbar-shadow-right"></div>`),this.container.append(this.shadowLeft),this.container.append(this.shadowRight)),this.refresh(),this.bindEvents())}getWidth(){var r;if(!this.container.get())return 0;const n=this.container.width();return(r=this.scrollval)!=null&&r.getOffsetWidth?this.scrollval.getOffsetWidth(n):n}enableScroll(){this.enableScrollval=!0}disableScroll(){this.enableScrollval=!1}bindEvents(){ue?(this.x&&this.container.on("touchstart",this.bindContainerTouchX),this.y&&this.container.on("touchstart",this.bindContainerTouchY)):this.container.on(Oa?"DOMMouseScroll":"mousewheel",this.bindWheelScroll),this.container.on("scroll",this.scroll),this.container.get()&&(window.addEventListener("resize",this.refresh),this.bindXScrollEvent(),this.bindYScrollEvent())}destroy(){var e,n,i,r,s,o,a;(e=this.slideX)==null||e.off(ue?"touchstart":"mousedown",this.scrollXStart),(n=this.slideY)==null||n.off(ue?"touchstart":"mousedown",this.scrollYStart),ue?(this.x&&this.container.off("touchstart",this.bindContainerTouchX),this.y&&this.container.off("touchstart",this.bindContainerTouchY)):this.container.off(Oa?"DOMMouseScroll":"mousewheel",this.bindWheelScroll),this.container.off("scroll",this.scroll),this.container.removeClass("data-scrollable"),this.x&&((i=this.scrollBarX)==null||i.remove(),this.container.removeClass("scroll-x")),this.y&&((r=this.scrollBarY)==null||r.remove(),this.container.removeClass("scroll-y")),this.shadow&&((s=this.shadowLeft)==null||s.remove(),(o=this.shadowRight)==null||o.remove()),(a=this.observer)==null||a.disconnect(),window.removeEventListener("resize",this.refresh),window.removeEventListener("scroll",this.refresh)}}class fp{constructor(t){y(this,"options");y(this,"root");y(this,"image");y(this,"resizerNumber");y(this,"point",{x:0,y:0});y(this,"position");y(this,"size");y(this,"maxWidth");y(this,"resizing",!1);y(this,"onMouseMove",t=>{t.preventDefault(),t.stopPropagation();const{clientX:e,clientY:n}=window.TouchEvent&&t instanceof TouchEvent?t.touches[0]:t;if(e!==this.point.x||n!==this.point.y){const i=this.point.x-e,r=this.point.y-n;this.updateSize(i,r)}this.resizing=!0});y(this,"onMouseUp",t=>{var s;t.preventDefault(),t.stopPropagation();const e=this.root.get();if(!e)return;const{clientWidth:n,clientHeight:i}=e;this.size={width:n,height:i},this.resizerNumber.removeClass(`data-resizer-number-${this.position}`),this.resizerNumber.removeClass("data-resizer-number-active"),this.position=void 0,this.resizing=!1,this.root.removeClass("data-resizing"),document.removeEventListener(ue?"touchmove":"mousemove",this.onMouseMove),document.removeEventListener(ue?"touchend":"mouseup",this.onMouseUp);const{onChange:r}=this.options;r&&r(this.size),(s=this.image)==null||s.hide()});var i;this.options=t,this.root=I(this.renderTemplate(t.imgUrl)),t.imgUrl&&(this.image=this.root.find("img")),(i=this.image)==null||i.hide(),this.resizerNumber=this.root.find(".data-resizer-number");const{width:e,height:n}=this.options;this.size={width:e,height:n},this.maxWidth=this.options.maxWidth}renderTemplate(t){return`
			<span class="data-resizer">
				${t?`<img src="${t}">`:""}
				<span class="data-resizer-holder data-resizer-holder-right-top"></span>
				<span class="data-resizer-holder data-resizer-holder-right-bottom"></span>
				<span class="data-resizer-holder data-resizer-holder-left-bottom"></span>
				<span class="data-resizer-holder data-resizer-holder-left-top"></span>
				<span class="data-resizer-number"></span>
			</span>`}onMouseDown(t,e){var n;this.resizing||(t.preventDefault(),t.stopPropagation(),this.root.css("top",["right-top","left-top"].indexOf(e)>-1?"auto":0),this.root.css("left",["left-top","left-bottom"].indexOf(e)>-1?"auto":0),this.root.css("bottom",["right-bottom","left-bottom"].indexOf(e)>-1?"auto":0),this.root.css("right",["right-top","right-bottom"].indexOf(e)>-1?"auto":0),this.point={x:window.TouchEvent&&t instanceof TouchEvent?t.touches[0].clientX:t.clientX,y:window.TouchEvent&&t instanceof TouchEvent?t.touches[0].clientY:t.clientY},this.position=e,this.resizing=!0,this.root.addClass("data-resizing"),this.resizerNumber.addClass(`data-resizer-number-${this.position}`),this.resizerNumber.addClass("data-resizer-number-active"),(n=this.image)==null||n.show(),document.addEventListener(ue?"touchmove":"mousemove",this.onMouseMove),document.addEventListener(ue?"touchend":"mouseup",this.onMouseUp))}updateSize(t,e){["right-top","right-bottom"].indexOf(this.position||"")>-1?t=this.size.width-t:t=this.size.width+t,this.setSize(t,e)}setSize(t,e){t<24&&(t=24);const{rate:n}=this.options;t>this.maxWidth&&(t=this.maxWidth),e=t*n,e<24&&(e=24,t=e/n),t=Math.round(t),e=Math.round(e),this.root.css({width:t+"px",height:e+"px"}),this.resizerNumber.html(`${t}\xB7${e}`)}on(t,e){this.root.on(t,e)}off(t,e){this.root.off(t,e)}render(){const{width:t,height:e}=this.options;return this.setSize(t,e),this.root.find(".data-resizer-holder-right-top").on(ue?"touchstart":"mousedown",n=>this.onMouseDown(n,"right-top")),this.root.find(".data-resizer-holder-right-bottom").on(ue?"touchstart":"mousedown",n=>this.onMouseDown(n,"right-bottom")),this.root.find(".data-resizer-holder-left-bottom").on(ue?"touchstart":"mousedown",n=>this.onMouseDown(n,"left-bottom")),this.root.find(".data-resizer-holder-left-top").on(ue?"touchstart":"mousedown",n=>this.onMouseDown(n,"left-top")),this.root}destroy(){this.root.remove(),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}}function Zne(l){var t=l==null?0:l.length;return t?l[t-1]:void 0}var Kne=Zne;function Xne(l,t,e){var n=-1,i=l.length;t<0&&(t=-t>i?0:i+t),e=e>i?i:e,e<0&&(e+=i),i=t>e?0:e-t>>>0,t>>>=0;for(var r=Array(i);++n<i;)r[n]=l[n+t];return r}var Yne=Xne,Jne=Ll,Qne=Yne;function eie(l,t){return t.length<2?l:Jne(l,Qne(t,0,-1))}var tie=eie,nie=xo,iie=Kne,rie=tie,sie=as;function oie(l,t){return t=nie(t,l),l=rie(l,t),l==null||delete l[sie(iie(t))]}var aie=oie,lie=tp;function cie(l){return lie(l)?void 0:l}var uie=cie,ud=tl,die=rl,fie=hi,dd=ud?ud.isConcatSpreadable:void 0;function hie(l){return fie(l)||die(l)||!!(dd&&l&&l[dd])}var pie=hie,gie=Wg,mie=pie;function hp(l,t,e,n,i){var r=-1,s=l.length;for(e||(e=mie),i||(i=[]);++r<s;){var o=l[r];t>0&&e(o)?t>1?hp(o,t-1,e,n,i):gie(i,o):n||(i[i.length]=o)}return i}var vie=hp,bie=vie;function yie(l){var t=l==null?0:l.length;return t?bie(l,1):[]}var _ie=yie,wie=_ie,xie=rp,kie=sp;function Eie(l){return kie(xie(l,void 0,wie),l+"")}var Cie=Eie,Sie=Kh,Aie=jg,Tie=aie,Nie=xo,Die=Kf,Rie=uie,Mie=Cie,Lie=Ug,Iie=1,Oie=2,Fie=4,Bie=Mie(function(l,t){var e={};if(l==null)return e;var n=!1;t=Sie(t,function(r){return r=Nie(r,l),n||(n=r.length>1),r}),Die(l,Lie(l),e),n&&(e=Aie(e,Iie|Oie|Fie,Rie));for(var i=t.length;i--;)Tie(e,t[i]);return e}),$ie=Bie;const Ti=$ie,ht={engine:Object,name:{type:String,required:!0},icon:String,content:[String,Function],title:String,placement:String,hotkey:[String,Object],command:Object,autoExecute:{type:[Boolean,void 0],default:void 0},className:String,active:{type:[Boolean,void 0],default:void 0},disabled:{type:[Boolean,void 0],default:void 0},onClick:Function,onMouseDown:Function,onMouseEnter:Function,onMouseLevel:Function},Pie={engine:Object,name:{type:String,required:!0},direction:String,items:{type:Array,required:!0},values:{type:[String,Array,Number],required:!0},className:String,onSelect:Function,hasDot:{type:[Boolean,void 0],default:void 0}},zie={engine:Object,name:{type:String,required:!0},values:[String,Array,Number],items:{type:Array,default:[]},icon:String,placement:String,content:[String,Function],title:String,disabled:{type:[Boolean,void 0],default:void 0},single:{type:[Boolean,void 0],default:void 0},className:String,direction:String,onSelect:Function,hasArrow:{type:[Boolean,void 0],default:void 0},hasDot:{type:[Boolean,void 0],default:void 0}},qr={engine:{type:Object,required:!0},color:{type:String,required:!0},active:Boolean,setStroke:{type:[Boolean,void 0],default:void 0},onSelect:Function},Xa={engine:qr.engine,colors:{type:Array,required:!0},setStroke:qr.setStroke,onSelect:qr.onSelect},pp={engine:Xa.engine,colors:Array,defaultColor:{type:String,required:!0},defaultActiveColor:{type:String,required:!0},setStroke:Xa.setStroke,onSelect:qr.onSelect,placement:String},qie={engine:ht.engine,name:ht.name,content:{type:[String,Function],required:!0},buttonTitle:String,dropdownTitle:String,command:ht.command,autoExecute:ht.autoExecute,disabled:ht.disabled,...Ti(pp,"engine")},Qr={name:ht.name,engine:ht.engine,icon:ht.icon,title:ht.title,search:String,description:ht.content,disabled:ht.disabled,prompt:[String,Function,Object],command:ht.command,autoExecute:ht.autoExecute,className:ht.className,placement:ht.placement,onClick:Function,onMouseDown:Function},Ya={engine:ht.engine,title:String,items:{type:Array,required:!0},onSelect:Qr.onClick},Hie={engine:Ya.engine,header:String,groups:{type:Array,required:!0},disabled:ht.disabled,className:Qr.className,icon:Qr.icon,content:ht.content,onSelect:Ya.onSelect},Wie={engine:{type:Object,required:!0},items:{type:Array,default:[]},popup:{type:[Boolean,void 0],default:void 0},icon:Qr.icon,content:ht.content},Uie={engine:{type:Object,required:!0},items:{type:Array,default:[]},className:String,popup:{type:[Boolean,void 0],default:void 0},onLoad:Function},gp=(l,t,e)=>{const n=l==null?void 0:l.plugin.components[t];if(n&&n.hotkey){let i=n.hotkey();if(i){if(Array.isArray(i))if(e){const r=i.findIndex(s=>typeof s=="object"&&s.args===e);i=i[r>-1?r:0]}else i=i[0];return typeof i=="object"&&(i=i.key),i}}},Sa={},jie=l=>{if(typeof l!="string")return console.log("Font name is not legal !"),!1;if(Sa[l]!==void 0)return Sa[l];let t;const e=document.body,n=document.createElement("span");n.innerHTML=Array(10).join("wi"),n.style.cssText=["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;");const i=c=>(n.style.fontFamily=c,e.appendChild(n),t=n.clientWidth,e.removeChild(n),t),r=i("monospace"),s=i("serif"),o=i("sans-serif"),a=r!==i(l+",monospace")||o!==i(l+",sans-serif")||s!==i(l+",serif");return Sa[l]=a,a},Vie=mt({name:"am-button",components:{ATooltip:pr},props:ht,setup(l){const t=xe();let e=l.hotkey;l.engine&&(e===!0||e===void 0)&&(e=gp(l.engine,l.command&&!Array.isArray(l.command)?l.command.name:l.name)),typeof e=="string"&&e!==""&&(e=Sh(e));const n=xe(!1);return{iconIsHtml:/^<.*>/.test((l.icon||"").trim()),isMobile:ue,visible:n,hotkeyText:e,element:t}},data(){return{visible:!1}},methods:{triggerMouseDown(l){l.preventDefault(),!this.disabled&&(this.onMouseDown&&this.onMouseDown(l,this.engine),this.visible=!1)},triggerMouseEnter(l){this.onMouseEnter&&this.onMouseEnter(l,this.engine),this.visible=!0},triggerMouseLeave(l){this.onMouseLevel&&this.onMouseLevel(l,this.engine),this.visible=!1},triggerClick(l){const t=l.target.nodeName;if(t!=="INPUT"&&t!=="TEXTAREA"&&l.preventDefault(),!this.disabled&&!(this.onClick&&this.onClick(l,this.engine)===!1)&&this.autoExecute!==!1){let e=this.name,n=[];this.command&&(Array.isArray(this.command)?n=this.command:(e=this.command.name,n=this.command.args)),this.engine&&this.engine.command.execute(e,...n)}}}});const Gie={key:0,class:"toolbar-tooltip-title"},Zie=["innerHTML"],Kie=["innerHTML"];function Xie(l,t,e,n,i,r){const s=pr;return oe(),Je(s,{placement:l.placement||"bottom",visible:(!!l.title||!!l.hotkeyText)&&!l.isMobile?l.visible:!1,"content-class":(!!l.title||!!l.hotkeyText)&&!l.isMobile?"":"prompt-popover-hide","arrow-class":(!!l.title||!!l.hotkeyText)&&!l.isMobile?"":"prompt-popover-hide"},{content:Be(()=>[l.title?(oe(),pe("div",Gie,Et(l.title),1)):Re("",!0),l.hotkeyText?(oe(),pe("div",{key:1,class:"toolbar-tooltip-hotkey",innerHTML:l.hotkeyText},null,8,Zie)):Re("",!0)]),default:Be(()=>[Ne("button",{class:lt(["toolbar-button",l.className,{"toolbar-button-active":l.active,"toolbar-button-disabled":l.disabled}]),ref:"element",onClick:t[0]||(t[0]=(...o)=>l.triggerClick&&l.triggerClick(...o)),onMousedown:t[1]||(t[1]=(...o)=>l.triggerMouseDown&&l.triggerMouseDown(...o)),onMouseenter:t[2]||(t[2]=(...o)=>l.triggerMouseEnter&&l.triggerMouseEnter(...o)),onMouseleave:t[3]||(t[3]=(...o)=>l.triggerMouseLeave&&l.triggerMouseLeave(...o))},[di(l.$slots,"icon",{},()=>[l.iconIsHtml?(oe(),pe("span",{key:0,innerHTML:l.icon},null,8,Kie)):Re("",!0),!l.iconIsHtml&&l.icon?(oe(),pe("span",{key:1,class:lt(`data-icon data-icon-${l.icon}`)},null,2)):Re("",!0)]),di(l.$slots,"default",{},()=>[Pr(Et(typeof l.content=="function"?l.content(l.engine):l.content),1)])],34)]),_:3},8,["placement","visible","content-class","arrow-class"])}const Co=gt(Vie,[["render",Xie]]),Yie=l=>{const t=xe(!1);return Fi(()=>{if(l.value&&ue){const e=l.value.getBoundingClientRect();t.value=e.left>window.visualViewport.width/2}}),t},ql=Yie,Jie=mt({name:"gf-dropdown-list",components:{ATooltip:pr},props:Pie,setup(l){const t=xe(""),e=xe(null),n=r=>{const{command:s,key:o}=r;let{hotkey:a}=r;return l.engine&&(a===!0||a===void 0)&&(a=gp(l.engine,s&&!Array.isArray(s)?s.name:l.name,o)),typeof a=="string"&&a!==""&&(a=Sh(a)),a},i={};return l.items.forEach(r=>{i[r.key]=n(r)}),Fi(()=>{if(e.value&&l.engine&&l.engine.scrollNode){const r=e.value,s=l.engine.scrollNode.get();if(!s)return;const o=r.getBoundingClientRect(),a=s.getBoundingClientRect();o.top<a.top&&(t.value="bottom"),o.bottom>a.bottom&&(t.value="top")}}),{element:e,isMobile:ue,hotkeys:i,placement:t}},methods:{triggerSelect(l,t){l.preventDefault(),l.stopPropagation();const e=this.items.find(r=>r.key===t);if(!e||e.disabled)return;const{autoExecute:n,command:i}=e;if(!(this.onSelect&&this.onSelect(l,t,this.engine)===!1)&&n!==!1){let r=this.name,s=[t];i&&(Array.isArray(i)?s=s.concat(i):(r=i.name,s=s.concat(i.args))),this.engine&&this.engine.command.execute(r,...s)}}}}),Qie={key:0,class:"toolbar-tooltip-title"},ere=["innerHTML"],tre=["onClick"],nre={key:0,class:"data-icon data-icon-dot"},ire=["innerHTML"],rre=["onClick"],sre={key:0,class:"data-icon data-icon-dot"},ore=["innerHTML"];function are(l,t,e,n,i,r){const s=pr;return oe(),pe("div",{ref:"element",class:lt(["toolbar-dropdown-list",`toolbar-dropdown-${l.direction||"vertical"}`,{[`toolbar-dropdown-placement-${l.placement}`]:!!l.placement},{"toolbar-dropdown-dot":l.hasDot!==!1},l.className])},[(oe(!0),pe(kt,null,Jt(l.items,({key:o,placement:a,title:c,content:u,className:d,icon:h,disabled:f})=>(oe(),pe(kt,null,[(!!c||!!l.hotkeys[o])&&!l.isMobile?(oe(),Je(s,{key:0,position:a||"right"},{content:Be(()=>[c?(oe(),pe("div",Qie,Et(c),1)):Re("",!0),l.hotkeys[o]?(oe(),pe("div",{key:1,class:"toolbar-tooltip-hotkey",innerHTML:l.hotkeys[o]},null,8,ere)):Re("",!0)]),default:Be(()=>[Ne("a",{class:lt(["toolbar-dropdown-list-item",d,{"toolbar-dropdown-list-item-disabled":f}]),onClick:p=>l.triggerSelect(p,o)},[(typeof l.values=="string"&&l.values===o||Array.isArray(l.values)&&l.values.indexOf(o)>-1)&&l.direction!=="horizontal"&&l.hasDot!==!1?(oe(),pe("span",nre)):Re("",!0),di(l.$slots,"icon",{},()=>[h?(oe(),pe("span",{key:0,class:lt(["data-icon",`data-icon-${h}`])},null,2)):Re("",!0)]),Ne("div",{innerHTML:typeof u=="function"?u(l.engine):u},null,8,ire)],10,tre)]),_:2},1032,["position"])):(oe(),pe("a",{key:1,class:lt(["toolbar-dropdown-list-item",d,{"toolbar-dropdown-list-item-disabled":f}]),onClick:p=>l.triggerSelect(p,o)},[(typeof l.values=="string"&&l.values===o||Array.isArray(l.values)&&l.values.indexOf(o)>-1)&&l.direction!=="horizontal"&&l.hasDot!==!1?(oe(),pe("span",sre)):Re("",!0),di(l.$slots,"icon",{},()=>[h?(oe(),pe("span",{key:0,class:lt(["data-icon",`data-icon-${h}`])},null,2)):Re("",!0)]),Ne("div",{innerHTML:typeof u=="function"?u(l.engine):u},null,8,ore)],10,rre))],64))),256))],2)}const lre=gt(Jie,[["render",are]]),cre=mt({name:"am-dropdown",components:{AmButton:Co,AmDropdownList:lre},props:zie,setup(l,t){const e=xe("");let n=xe(void 0);const i=xe(!1),r=xe(void 0),s=xe(null),o=ql(s),a=p=>{l.single!==!1&&(p=Array.isArray(p)&&p.length>0?p[0]:p);const g=l.items.find(v=>typeof p=="string"&&v.key===p||Array.isArray(p)&&p.indexOf(v.key)>-1),m=l.items.length>0?l.items.find(v=>v.isDefault===!0)||l.items[0]:null;g?t.slots.default?n.value=g:typeof l.content=="function"?n.value={icon:l.icon,content:l.content(l.engine)}:Array.isArray(p)&&p.length>1?n.value={icon:l.icon,content:l.content}:n.value={icon:g.icon,content:typeof g.content=="function"?g.content(l.engine):g.content}:l.icon||l.content?(!Array.isArray(p)||p.length<1)&&(n.value={icon:l.icon,content:typeof l.content=="function"?l.content(l.engine):l.content}):m&&(n.value={icon:m.icon,content:typeof m.content=="function"?m.content(l.engine):m.content}),e.value=p||(l.icon||l.content?"":m?m.key:"")},c=p=>{p.preventDefault()},u=p=>{p.preventDefault(),!l.disabled&&(i.value?h():d())},d=()=>{i.value=!0},h=p=>{p&&r.value&&r.value.element&&r.value.element.contains(p.target)||(i.value=!1)},f=(p,g)=>{h(),l.onSelect&&l.onSelect(p,g,l.engine)};return a(l.values),Ps(()=>({...l}),p=>a(p.values)),Ps(()=>i.value,(p,g)=>{p?document.addEventListener("click",h):document.removeEventListener("click",h)}),{buttonRef:s,isRight:o,buttonContent:n,valuesVar:e,triggerMouseDown:c,triggerClick:u,show:d,hide:h,triggerSelect:f,visible:i,targetRef:r}}});const ure=["innerHTML"],dre={key:0,class:"data-icon data-icon-arrow"};function fre(l,t,e,n,i,r){const s=ct("am-button"),o=ct("am-dropdown-list");return oe(),pe("div",{class:lt(["toolbar-dropdown",{"toolbar-dropdown-right":l.isRight},l.className]),ref:"buttonRef",onClick:t[0]||(t[0]=(...a)=>l.triggerClick&&l.triggerClick(...a)),onMousedown:t[1]||(t[1]=(...a)=>l.triggerMouseDown&&l.triggerMouseDown(...a))},[Ne("div",{class:lt(["toolbar-dropdown-trigger",{"toolbar-dropdown-trigger-active":l.visible,"toolbar-dropdown-trigger-arrow":l.hasArrow!==!1}])},[Ge(s,{name:l.name,title:l.title,active:l.visible,disabled:l.disabled,placement:l.placement,ref:"targetRef"},{default:Be(()=>[di(l.$slots,"default",{item:l.content},()=>[l.buttonContent&&l.buttonContent.icon?(oe(),pe("span",{key:0,class:lt(["data-icon",`data-icon-${l.buttonContent.icon}`])},null,2)):Re("",!0),l.buttonContent&&!l.buttonContent.icon&&l.buttonContent.content?(oe(),pe("span",{key:1,class:"toolbar-dropdown-button-text",innerHTML:l.buttonContent.content},null,8,ure)):Re("",!0)]),l.hasArrow!==!1?(oe(),pe("span",dre)):Re("",!0)]),_:3},8,["name","title","active","disabled","placement"])],2),l.visible?(oe(),Je(o,{key:0,hasDot:l.hasDot,engine:l.engine,direction:l.direction,name:l.name,items:l.items,values:l.valuesVar,"on-select":l.triggerSelect},null,8,["hasDot","engine","direction","name","items","values","on-select"])):Re("",!0)],34)}const hre=gt(cre,[["render",fre]]);class cn{}y(cn,"colors"),y(cn,"_map"),y(cn,"getStroke"),y(cn,"getColors");cn.colors=[["#000000","#262626","#595959","#8C8C8C","#BFBFBF","#D9D9D9","#E9E9E9","#F5F5F5","#FAFAFA","#FFFFFF"],["#F5222D","#FA541C","#FA8C16","#FADB14","#52C41A","#13C2C2","#1890FF","#2F54EB","#722ED1","#EB2F96"],["#FFE8E6","#FFECE0","#FFEFD1","#FCFCCA","#E4F7D2","#D3F5F0","#D4EEFC","#DEE8FC","#EFE1FA","#FAE1EB"],["#FFA39E","#FFBB96","#FFD591","#FFFB8F","#B7EB8F","#87E8DE","#91D5FF","#ADC6FF","#D3ADF7","#FFADD2"],["#FF4D4F","#FF7A45","#FFA940","#FFEC3D","#73D13D","#36CFC9","#40A9FF","#597EF7","#9254DE","#F759AB"],["#CF1322","#D4380D","#D46B08","#D4B106","#389E0D","#08979C","#096DD9","#1D39C4","#531DAB","#C41D7F"],["#820014","#871400","#873800","#614700","#135200","#00474F","#003A8C","#061178","#22075E","#780650"]];cn._map=function(){let l={};const t=cn.colors;for(let e=0,n=t.length;e<n;e++){const i=t[e];for(let r=0,s=i.length;r<s;r++){const o=t[e][r];l[o]={y:e,x:r}}}return l}();cn.getStroke=function(l){const t=cn._map[l];return t&&(t.y===2||t.y===3&&t.x>2&&t.x<5)?this.colors[4][t.x]:l};cn.getColors=function(){return this.colors};const Zs=cn,pre=mt({name:"am-color-plicker-item",props:qr,setup(l){const t=i=>{i.preventDefault(),i.stopPropagation(),l.onSelect&&l.onSelect(l.color,i)},e=l.color==="transparent";return{title:l.engine.language.get("toolbar","colorPicker",l.color.toUpperCase()),special:e,triggerSelect:t}},data(){const l=this.toState(this.color||"#FFFFFF"),t=["#ffffff","#fafafa","transparent"].indexOf(l.hex)>=0;return{state:l,needBorder:t,styles:this.getStyles(l)}},computed:{refreshStyles(){return this.getStyles()}},methods:{getContrastingColor(l){return l.hex==="transparent"?"rgba(0,0,0,0.4)":(l.rgb.r*299+l.rgb.g*587+l.rgb.b*114)/1e3>=210?"#8C8C8C":"#FFFFFF"},toState(l,t){const e=l.hex?de(l.hex):de(l),n=e.toHsl(),i=e.toHsv(),r=e.toRgb(),s=e.toHex();n.s===0&&(n.h=t||0,i.h=t||0);const o=s==="000000"&&r.a===0;return{hsl:n,hex:o?"transparent":"#".concat(s),rgb:r,hsv:i,oldHue:l.h||t||n.h,source:l.source}},getStyles(l){return{check:{fill:this.getContrastingColor(l||this.state),display:this.active?"block":"none"},block:{backgroundColor:this.color,border:this.setStroke?"1px solid ".concat(Zs.getStroke(this.color)):void 0}}}}}),gre=["title"],mre=Ne("path",{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},null,-1),vre=[mre];function bre(l,t,e,n,i,r){return oe(),pe("span",{class:lt(["colorpicker-group-item",{"colorpicker-group-item-border":l.needBorder,"colorpicker-group-item-active":l.active,"colorpicker-group-item-special":l.special}]),onClick:t[0]||(t[0]=(...s)=>l.triggerSelect&&l.triggerSelect(...s)),title:l.title},[Ne("span",{style:zn(l.refreshStyles.block)},[(oe(),pe("svg",{style:zn(l.refreshStyles.check),viewBox:"0 0 18 18"},vre,4))],4)],10,gre)}const mp=gt(pre,[["render",bre]]),yre=mt({name:"am-color-plicker-group",components:{AmColorPickerItem:mp},props:Xa}),_re={class:"colorpicker-group"};function wre(l,t,e,n,i,r){const s=ct("am-color-picker-item");return oe(),pe("span",_re,[(oe(!0),pe(kt,null,Jt(l.colors,o=>(oe(),Je(s,{engine:l.engine,color:o.value,active:o.active,key:o.value,"on-select":l.onSelect,"set-stroke":l.setStroke},null,8,["engine","color","active","on-select","set-stroke"]))),128))])}const xre=gt(yre,[["render",wre]]),kre=mt({name:"am-color-picker",components:{AmColorPickerItem:mp,AmColorPickerGroup:xre},props:pp,setup(l,t){const e=(s,o)=>s.map(a=>a.map(c=>{const u=typeof c=="string"?c:c.value;return{value:u,active:o===u}})),n=xe(e(l.colors||Zs.getColors(),l.defaultActiveColor)),i=(s,o)=>{n.value=e(n.value,s),l.onSelect&&l.onSelect(s,o)},r=l.engine.language.get("toolbar","colorPicker",l.defaultColor==="transparent"?"nonFillText":"defaultText");return{colors:n,triggerSelect:i,text:r}},methods:{triggerMouseDown(l){l.target.tagName!=="INPUT"&&l.preventDefault()}}});const Ere={class:"colorpicker-default-text"};function Cre(l,t,e,n,i,r){const s=ct("am-color-picker-item"),o=ct("am-color-picker-group");return oe(),pe("div",{class:"colorpicker-board",onMousedown:t[1]||(t[1]=(...a)=>l.triggerMouseDown&&l.triggerMouseDown(...a))},[Ne("div",{class:"colorpicker-default",onClick:t[0]||(t[0]=a=>l.triggerSelect(l.defaultColor,a))},[Ge(s,{engine:l.engine,color:l.defaultColor,"active-colors":[],"on-select":l.triggerSelect},null,8,["engine","color","on-select"]),Ne("span",Ere,Et(l.text),1)]),(oe(!0),pe(kt,null,Jt(l.colors,(a,c)=>(oe(),Je(o,{engine:l.engine,colors:a,key:c,"on-select":l.triggerSelect,"set-stroke":l.setStroke},null,8,["engine","colors","on-select","set-stroke"]))),128))],32)}const Sre=gt(kre,[["render",Cre]]),Are=mt({name:"am-color",components:{AmButton:Co,AmColorPicker:Sre},props:qie,setup(l){const t=xe(!1),e=xe(null),n=ql(e),i=xe(void 0),r=xe(l.defaultActiveColor),s=()=>typeof l.content=="string"?l.content:l.content(r.value,Zs.getStroke(r.value),l.disabled),o=xe(s()),a=f=>{f.preventDefault(),t.value?u():c()},c=()=>{t.value=!0},u=f=>{f&&i.value&&i.value.element&&i.value.element.contains(f.target)||(t.value=!1)};Ps(()=>t.value,(f,p)=>{f?document.addEventListener("click",u):document.removeEventListener("click",u)});const d=f=>{h(r.value,f)},h=(f,p)=>{if(u(),r.value=f,o.value=typeof l.content=="string"?l.content:l.content(f,Zs.getStroke(f),l.disabled),l.autoExecute!==!1){let g=l.name,m=[f,l.defaultColor];l.command&&(Array.isArray(l.command)?m=l.command:(g=l.command.name,m=l.command.args)),l.engine&&l.engine.command.execute(g,...m)}l.onSelect&&l.onSelect(f,p)};return Js(()=>document.removeEventListener("click",u)),Ps(()=>({...l}),()=>o.value=s()),{buttonRef:e,isRight:n,visible:t,buttonContent:o,currentColor:r,triggerSelect:h,triggerClick:d,toggleDropdown:a,targetRef:i}}});const Tre=["innerHTML"],Nre=Ne("span",{class:"colorpicker-button-dropdown-empty"},null,-1),Dre=Ne("span",{class:"data-icon data-icon-arrow"},null,-1),Rre={key:0,class:"toolbar-dropdown-list","data-element":"ui"};function Mre(l,t,e,n,i,r){const s=ct("am-button"),o=ct("am-color-picker");return oe(),pe("div",{class:lt(["toolbar-dropdown","colorpicker-button",{"toolbar-dropdown-right":l.isRight}]),ref:"buttonRef"},[Ne("div",{class:lt(["toolbar-dropdown-trigger colorpicker-button-group",{"colorpicker-button-group-active":l.visible}])},[Ge(s,{class:"colorpicker-button-text",name:l.name,title:l.buttonTitle,"on-click":l.triggerClick,disabled:l.disabled,placement:l.placement},{default:Be(()=>[Ne("span",{innerHTML:l.buttonContent},null,8,Tre)]),_:1},8,["name","title","on-click","disabled","placement"]),Ge(s,{class:"colorpicker-button-dropdown toolbar-dropdown-trigger-arrow",name:l.name,title:l.dropdownTitle,"on-click":l.toggleDropdown,disabled:l.disabled,placement:l.placement,ref:"targetRef"},{icon:Be(()=>[Nre]),default:Be(()=>[Dre]),_:1},8,["name","title","on-click","disabled","placement"])],2),l.visible?(oe(),pe("div",Rre,[Ge(o,{engine:l.engine,colors:l.colors,"default-active-color":l.currentColor,"default-color":l.defaultColor,"on-select":l.triggerSelect,"set-stroke":l.setStroke},null,8,["engine","colors","default-active-color","default-color","on-select","set-stroke"])])):Re("",!0)],2)}const Lre=gt(Are,[["render",Mre]]),Ire=mt({name:"am-collapse-item",components:{APopover:Qa},props:Qr,setup(l){const t=xe(!1),e=s=>{s.preventDefault(),l.onMouseDown&&l.onMouseDown(s,l.engine)},n=s=>{if(l.disabled)return;const o=s.target.nodeName;if(o!=="INPUT"&&o!=="TEXTAREA"&&s.preventDefault(),!(l.onClick&&l.onClick(s,l.name,l.engine)===!1)&&l.autoExecute!==!1){let a=l.name,c=[];l.command&&(Array.isArray(l.command)?c=l.command:(a=l.command.name,c=l.command.args)),l.engine&&l.engine.command.execute(a,...c)}},i=()=>{t.value=!l.disabled},r=()=>{t.value=!1};return{iconIsHtml:/^<.*>/.test((l.icon||"").trim()),active:t,disabled:l.disabled,handleClick:n,handleMouseDown:e,triggerMouseEnter:i,triggerMouseLeave:r,h:Pf}}});const Ore=["innerHTML"],Fre={key:0,class:"toolbar-collapse-item-text"},Bre={class:"toolbar-collapse-item-title"},$re={key:0,class:"toolbar-collapse-item-description"};function Pre(l,t,e,n,i,r){const s=Qa;return oe(),Je(s,{position:l.placement||"right","content-class":l.prompt?"":"prompt-popover-hide","arrow-class":l.prompt?"":"prompt-popover-hide"},{content:Be(()=>[(oe(),Je(cg(l.prompt)))]),default:Be(()=>[Ne("div",{class:lt(["toolbar-collapse-item",{"toolbar-collapse-item-active":l.active},{"toolbar-collapse-item-disabled":l.disabled},l.className]),onMouseenter:t[0]||(t[0]=(...o)=>l.triggerMouseEnter&&l.triggerMouseEnter(...o)),onMouseleave:t[1]||(t[1]=(...o)=>l.triggerMouseLeave&&l.triggerMouseLeave(...o)),onClick:t[2]||(t[2]=(...o)=>l.handleClick&&l.handleClick(...o)),onMousedown:t[3]||(t[3]=(...o)=>l.handleMouseDown&&l.handleMouseDown(...o))},[di(l.$slots,"icon",{},()=>[l.iconIsHtml?(oe(),pe("span",{key:0,innerHTML:l.icon},null,8,Ore)):Re("",!0),!l.iconIsHtml&&l.icon?(oe(),pe("span",{key:1,class:lt(`data-icon data-icon-${l.icon}`)},null,2)):Re("",!0)]),l.title?(oe(),pe("div",Fre,[Ne("div",Bre,Et(l.title),1),l.description?(oe(),pe("div",$re,Et(typeof l.description=="function"?l.description():l.description),1)):Re("",!0)])):Re("",!0)],34)]),_:3},8,["position","content-class","arrow-class"])}const zre=gt(Ire,[["render",Pre]]),qre=mt({name:"am-collapse-group",components:{AmCollapseItem:zre},props:Ya,setup(l){return{omit:Ti,onClick:(e,n,i)=>{let r;const s=l.items.find(o=>o.name===n);return s&&s.onClick&&(r=s.onClick(e,n,i)),l.onSelect&&l.onSelect(e,n,i),r}}}}),Hre={class:"toolbar-collapse-group"},Wre={key:0,class:"toolbar-collapse-group-title"};function Ure(l,t,e,n,i,r){const s=ct("am-collapse-item");return oe(),pe("div",Hre,[l.title?(oe(),pe("div",Wre,Et(l.title),1)):Re("",!0),(oe(!0),pe(kt,null,Jt(l.items,o=>(oe(),Je(s,Yt({key:o.name,engine:l.engine},{...l.omit(o,"onClick","onDisabled")},{"on-click":l.onClick}),null,16,["engine","on-click"]))),128))])}const jre=gt(qre,[["render",Ure]]),Vre=mt({name:"am-collapse",components:{AmButton:Co,AmCollapseGroup:jre},props:Hie,setup(l){const t=!(l.icon||l.content),e=xe(t),n=xe(null),i=ql(n);Js(()=>{t&&document.removeEventListener("click",s)});const r=()=>{e.value=!0,setTimeout(()=>{document.addEventListener("click",s)},10)},s=c=>{document.removeEventListener("click",s),e.value=!1};return{isCustomize:t,visible:e,collapse:n,isRight:i,triggerClick:()=>{e.value?s():r()},triggerSelect:(c,u)=>{s(),l.onSelect&&l.onSelect(c,u)}}}});const Gre={key:1,class:"toolbar-dropdown-list","data-element":"ui"},Zre=["innerHTML"],Kre={class:"toolbar-collapse-content"};function Xre(l,t,e,n,i,r){const s=ct("am-button"),o=ct("am-collapse-group");return oe(),pe("div",{class:lt(["toolbar-dropdown toolbar-collapse",{"toolbar-dropdown-right":l.isRight},l.className]),ref:"collapse"},[l.isCustomize?Re("",!0):(oe(),Je(s,{key:0,name:"collapse",icon:l.icon,content:l.content,"on-click":l.triggerClick,active:l.visible,disabled:l.disabled},null,8,["icon","content","on-click","active","disabled"])),l.visible?(oe(),pe("div",Gre,[di(l.$slots,"header",{},()=>[l.header?(oe(),pe("div",{key:0,class:"toolbar-collapse-header",innerHTML:l.header},null,8,Zre)):Re("",!0)]),Ne("div",Kre,[(oe(!0),pe(kt,null,Jt(l.groups,(a,c)=>(oe(),Je(o,Yt({key:c,engine:l.engine},a,{"on-select":l.triggerSelect}),null,16,["engine","on-select"]))),128))])])):Re("",!0)],2)}const vp=gt(Vre,[["render",Xre]]),Yre=mt({name:"am-group",components:{AmButton:Co,AmDropdown:hre,AmColor:Lre,AmCollapse:vp,AmPopover:Qa},props:Wie,setup(){return{isMobile:ue}},methods:{getPopupContainer:()=>document.querySelector(".data-toolbar-popup-wrapper")||document.querySelector(".editor-toolbar")||document.body}});const Jre={key:0,class:"editor-toolbar-group"},Qre={key:1,class:"editor-toolbar-group"};function ese(l,t,e,n,i,r){const s=ct("am-button"),o=ct("am-dropdown"),a=ct("am-color"),c=ct("am-collapse"),u=ct("am-popover");return oe(),pe(kt,null,[!!l.icon||!!l.content?(oe(),pe("div",Jre,[Ge(u,{"get-popup-container":l.getPopupContainer,"overlay-class-name":"editor-toolbar-popover","arrow-point-at-center":!0,placement:l.isMobile?"topRight":void 0},{content:Be(()=>[Ne("div",{class:lt(["editor-toolbar",{"editor-toolbar-mobile":l.isMobile&&!l.popup,"editor-toolbar-popup":l.popup}]),"data-element":"ui"},[(oe(!0),pe(kt,null,Jt(l.items,(d,h)=>(oe(),pe(kt,{key:h},[d.type==="button"?(oe(),Je(s,Yt({key:h},d,{placement:"top",engine:l.engine}),null,16,["engine"])):Re("",!0),d.type==="dropdown"?(oe(),Je(o,Yt({key:h},d,{placement:"top",engine:l.engine}),null,16,["engine"])):Re("",!0),d.type==="color"?(oe(),Je(a,Yt({key:h},d,{placement:"top",engine:l.engine}),null,16,["engine"])):Re("",!0),d.type==="collapse"?(oe(),Je(c,Yt({key:h},d,{engine:l.engine}),null,16,["engine"])):Re("",!0)],64))),128))],2)]),default:Be(()=>[Ge(s,{name:"group-popover",icon:l.icon,content:l.content},null,8,["icon","content"])]),_:1},8,["get-popup-container","placement"])])):Re("",!0),!l.icon&&!l.content?(oe(),pe("div",Qre,[(oe(!0),pe(kt,null,Jt(l.items,(d,h)=>(oe(),pe(kt,{key:h},[d.type==="button"?(oe(),Je(s,Yt({key:h},d,{engine:l.engine}),null,16,["engine"])):Re("",!0),d.type==="dropdown"?(oe(),Je(o,Yt({key:h},d,{engine:l.engine}),null,16,["engine"])):Re("",!0),d.type==="color"?(oe(),Je(a,Yt({key:h},d,{engine:l.engine}),null,16,["engine"])):Re("",!0),d.type==="collapse"?(oe(),Je(c,Yt({key:h},d,{engine:l.engine}),null,16,["engine"])):Re("",!0)],64))),128))])):Re("",!0)],64)}const tse=gt(Yre,[["render",ese]]),nse={toolbar:{collapse:{title:`Type <code>${xn?"\u2318":"Ctrl"}</code> + <code>/</code> to quickly insert a card`},undo:{title:"Undo"},redo:{title:"Redo"},paintformat:{title:"Format brush"},removeformat:{title:"Clear format"},heading:{title:"Text and title",p:"Text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},fontfamily:{title:"Font family",notInstalled:"The font may not be installed",items:{default:"Default",arial:"Arial",comicSansMS:"Comic Sans MS",courierNew:"Courier New",georgia:"Georgia",helvetica:"Helvetica",impact:"Impact",timesNewRoman:"Times New Roman",trebuchetMS:"Trebuchet MS",verdana:"Verdana",fangSong:"FangSong",stFangsong:"STFangsong",stSong:"STSong",stKaiti:"STKaiti",simSun:"SimSum",microsoftYaHei:"Microsoft YaHei",kaiTi:"KaiTi",kaitiSC:"KaiTi SC",simHei:"SimHei",heitiSC:"Heiti SC",fzHei:"FZHeiTi",fzKai:"FZKaiTi",fzFangSong:"FZFangSong"}},fontsize:{title:"Font size"},fontcolor:{title:"Font color",more:"More colors"},backcolor:{title:"Background color",more:"More colors"},bold:{title:"Bold"},italic:{title:"Italic"},strikethrough:{title:"Strikethrough"},underline:{title:"Underline"},moremark:{title:"More text styles",sup:"Sup",sub:"Sub",code:"Inline code"},alignment:{title:"Alignment",left:"Align left",center:"Align center",right:"Align right",justify:"Align justify"},unorderedlist:{title:"Unordered list"},orderedlist:{title:"Ordered list"},tasklist:{title:"Task list"},indent:{title:"Ident",in:"Increase indent",out:"Reduce indent"},"line-height":{title:"Line height",default:"Default"},link:{title:"Insert Link"},quote:{title:"Insert reference"},hr:{title:"Insert dividing line"},colorPicker:{defaultText:"Default Color",nonFillText:"No fill color","#000000":"Black","#262626":"Dark Gray 3","#595959":"Dark Gray 2","#8C8C8C":"Dark Gray 1","#BFBFBF":"Gray","#D9D9D9":"Light Gray 4","#E9E9E9":"Light Gray 3","#F5F5F5":"Light Gray 2","#FAFAFA":"Light Gray 1","#FFFFFF":"White","#F5222D":"Red","#FA541C":"Chinese Red","#FA8C16":"Orange","#FADB14":"Yellow","#52C41A":"Green","#13C2C2":"Cyan","#1890FF":"Light Blue","#2F54EB":"Blue","#722ED1":"Purple","#EB2F96":"Magenta","#FFE8E6":"Red 1","#FFECE0":"Chinese Red 1","#FFEFD1":"Orange 1","#FCFCCA":"Yellow 1","#E4F7D2":"Green 1","#D3F5F0":"Cyan 1","#D4EEFC":"Light Blue 1","#DEE8FC":"Blue 1","#EFE1FA":"Purple 1","#FAE1EB":"Magenta 1","#FFA39E":"Red 2","#FFBB96":"Chinese Red 2","#FFD591":"Orange 2","#FFFB8F":"Yellow 2","#B7EB8F":"Green 2","#87E8DE":"Cyan 2","#91D5FF":"Light Blue 2","#ADC6FF":"Blue 2","#D3ADF7":"Purple 2","#FFADD2":"Magenta 2","#FF4D4F":"Red 3","#FF7A45":"Chinese Red 3","#FFA940":"Orange 3","#FFEC3D":"Yellow 3","#73D13D":"Green 3","#36CFC9":"Cyan 3","#40A9FF":"Light Blue 3","#597EF7":"Blue 3","#9254DE":"Purple 3","#F759AB":"Magenta 3","#CF1322":"Red 4","#D4380D":"Chinese Red 4","#D46B08":"Orange 4","#D4B106":"Yellow 4","#389E0D":"Green 4","#08979C":"Cyan 4","#096DD9":"Light Blue 4","#1D39C4":"Blue 4","#531DAB":"Purple 4","#C41D7F":"Magenta 4","#820014":"Red 5","#871400":"Chinese Red 5","#873800":"Orange 5","#614700":"Yellow 5","#135200":"Green 5","#00474F":"Cyan 5","#003A8C":"Light Blue 5","#061178":"Blue 5","#22075E":"Purple 5","#780650":"Magenta 5"},component:{placeholder:"Card name"},image:{title:"Image"},codeblock:{title:"Codeblock"},table:{title:"Table"},file:{title:"File"},video:{title:"Video"},imgattachment:{title:"Image Manager"},math:{title:"Formula"},status:{title:"Status"},mind:{title:"Mind Map"},commonlyUsed:{title:"Commonly used"},searchEmtpy:{title:"No matching card"}}},ise={toolbar:{collapse:{title:`\u8F93\u5165  <code>${xn?"\u2318":"Ctrl"}</code> + <code>/</code>  \u5FEB\u901F\u63D2\u5165\u5361\u7247`},undo:{title:"\u64A4\u9500"},redo:{title:"\u91CD\u505A"},paintformat:{title:"\u683C\u5F0F\u5237"},removeformat:{title:"\u6E05\u9664\u683C\u5F0F"},heading:{title:"\u6B63\u6587\u4E0E\u6807\u9898",p:"\u6B63\u6587",h1:"\u6807\u9898 1",h2:"\u6807\u9898 2",h3:"\u6807\u9898 3",h4:"\u6807\u9898 4",h5:"\u6807\u9898 5",h6:"\u6807\u9898 6"},fontfamily:{title:"\u5B57\u4F53",notInstalled:"\u53EF\u80FD\u672A\u5B89\u88C5\u8BE5\u5B57\u4F53",items:{default:"\u9ED8\u8BA4",arial:"Arial",comicSansMS:"Comic Sans MS",courierNew:"Courier New",georgia:"Georgia",helvetica:"Helvetica",impact:"Impact",timesNewRoman:"Times New Roman",trebuchetMS:"Trebuchet MS",verdana:"Verdana",fangSong:"\u4EFF\u5B8B",stFangsong:"\u534E\u6587\u4EFF\u5B8B",stSong:"\u534E\u6587\u5B8B\u4F53",stKaiti:"\u534E\u6587\u6977\u4F53",simSun:"\u5B8B\u4F53",microsoftYaHei:"\u5FAE\u8F6F\u96C5\u9ED1",kaiTi:"\u6977\u4F53",kaitiSC:"\u6977\u4F53-\u7B80",simHei:"\u9ED1\u4F53",heitiSC:"\u9ED1\u4F53-\u7B80",fzHei:"\u65B9\u6B63\u9ED1\u4F53",fzKai:"\u65B9\u6B63\u6977\u4F53",fzFangSong:"\u65B9\u6B63\u4EFF\u5B8B"}},fontsize:{title:"\u5B57\u53F7"},fontcolor:{title:"\u5B57\u4F53\u989C\u8272",more:"\u66F4\u591A\u989C\u8272"},backcolor:{title:"\u80CC\u666F\u989C\u8272",more:"\u66F4\u591A\u989C\u8272"},bold:{title:"\u7C97\u4F53"},italic:{title:"\u659C\u4F53"},strikethrough:{title:"\u5220\u9664\u7EBF"},underline:{title:"\u4E0B\u5212\u7EBF"},moremark:{title:"\u66F4\u591A\u6587\u672C\u6837\u5F0F",sup:"\u4E0A\u6807",sub:"\u4E0B\u6807",code:"\u884C\u5185\u4EE3\u7801"},alignment:{title:"\u5BF9\u9F50\u65B9\u5F0F",left:"\u5DE6\u5BF9\u9F50",center:"\u5C45\u4E2D\u5BF9\u9F50",right:"\u53F3\u5BF9\u9F50",justify:"\u4E24\u7AEF\u5BF9\u9F50"},unorderedlist:{title:"\u65E0\u5E8F\u5217\u8868"},orderedlist:{title:"\u6709\u5E8F\u5217\u8868"},tasklist:{title:"\u4EFB\u52A1\u5217\u8868"},indent:{title:"\u7F29\u8FDB",in:"\u589E\u52A0\u7F29\u8FDB",out:"\u51CF\u5C11\u7F29\u8FDB"},"line-height":{title:"\u884C\u9AD8",default:"\u9ED8\u8BA4"},link:{title:"\u94FE\u63A5"},quote:{title:"\u63D2\u5165\u5F15\u7528"},hr:{title:"\u63D2\u5165\u5206\u5272\u7EBF"},colorPicker:{defaultText:"\u9ED8\u8BA4",nonFillText:"\u65E0\u586B\u5145\u8272","#000000":"\u9ED1\u8272","#262626":"\u6DF1\u7070 3","#595959":"\u6DF1\u7070 2","#8C8C8C":"\u6DF1\u7070 1","#BFBFBF":"\u7070\u8272","#D9D9D9":"\u6D45\u7070 4","#E9E9E9":"\u6D45\u7070 3","#F5F5F5":"\u6D45\u7070 2","#FAFAFA":"\u6D45\u7070 1","#FFFFFF":"\u767D\u8272","#F5222D":"\u7EA2\u8272","#FA541C":"\u6731\u7EA2","#FA8C16":"\u6A59\u8272","#FADB14":"\u9EC4\u8272","#52C41A":"\u7EFF\u8272","#13C2C2":"\u9752\u8272","#1890FF":"\u6D45\u84DD","#2F54EB":"\u84DD\u8272","#722ED1":"\u7D2B\u8272","#EB2F96":"\u73AB\u7EA2","#FFE8E6":"\u7EA2\u8272 1","#FFECE0":"\u6731\u7EA2 1","#FFEFD1":"\u6A59\u8272 1","#FCFCCA":"\u9EC4\u8272 1","#E4F7D2":"\u7EFF\u8272 1","#D3F5F0":"\u9752\u8272 1","#D4EEFC":"\u6D45\u84DD 1","#DEE8FC":"\u84DD\u8272 1","#EFE1FA":"\u7D2B\u8272 1","#FAE1EB":"\u73AB\u7EA2 1","#FFA39E":"\u7EA2\u8272 2","#FFBB96":"\u6731\u7EA2 2","#FFD591":"\u6A59\u8272 2","#FFFB8F":"\u9EC4\u8272 2","#B7EB8F":"\u7EFF\u8272 2","#87E8DE":"\u9752\u8272 2","#91D5FF":"\u6D45\u84DD 2","#ADC6FF":"\u84DD\u8272 2","#D3ADF7":"\u7D2B\u8272 2","#FFADD2":"\u73AB\u7EA2 2","#FF4D4F":"\u7EA2\u8272 3","#FF7A45":"\u6731\u7EA2 3","#FFA940":"\u6A59\u8272 3","#FFEC3D":"\u9EC4\u8272 3","#73D13D":"\u7EFF\u8272 3","#36CFC9":"\u9752\u8272 3","#40A9FF":"\u6D45\u84DD 3","#597EF7":"\u84DD\u8272 3","#9254DE":"\u7D2B\u8272 3","#F759AB":"\u73AB\u7EA2 3","#CF1322":"\u7EA2\u8272 4","#D4380D":"\u6731\u7EA2 4","#D46B08":"\u6A59\u8272 4","#D4B106":"\u9EC4\u8272 4","#389E0D":"\u7EFF\u8272 4","#08979C":"\u9752\u8272 4","#096DD9":"\u6D45\u84DD 4","#1D39C4":"\u84DD\u8272 4","#531DAB":"\u7D2B\u8272 4","#C41D7F":"\u73AB\u7EA2 4","#820014":"\u7EA2\u8272 5","#871400":"\u6731\u7EA2 5","#873800":"\u6A59\u8272 5","#614700":"\u9EC4\u8272 5","#135200":"\u7EFF\u8272 5","#00474F":"\u9752\u8272 5","#003A8C":"\u6D45\u84DD 5","#061178":"\u84DD\u8272 5","#22075E":"\u7D2B\u8272 5","#780650":"\u73AB\u7EA2 5"},component:{placeholder:"\u5361\u7247\u540D\u79F0"},image:{title:"\u56FE\u7247"},codeblock:{title:"\u4EE3\u7801\u5757"},table:{title:"\u8868\u683C"},file:{title:"\u9644\u4EF6"},video:{title:"\u89C6\u9891"},math:{title:"\u516C\u5F0F"},imgattachment:{title:"\u56FE\u7247\u7BA1\u7406\u5668"},status:{title:"\u72B6\u6001"},mind:{title:"\u8111\u56FE"},commonlyUsed:{title:"\u5E38\u7528"},searchEmtpy:{title:"\u65E0\u5339\u914D\u5361\u7247"}}},bp={"en-US":nse,"zh-CN":ise},rse=mt({name:"gf-table",props:{maxRows:Number,maxCols:Number,minRows:Number,minCols:Number,onSelect:Function},setup(l){const t=xe(l.maxRows||10),e=xe(l.maxCols||10),n=xe(l.minRows||4),i=xe(l.minCols||4),r=xe(4),s=xe(4),o=xe(0),a=xe(0);return{maxRows:t,maxCols:e,minRows:n,minCols:i,currentRows:r,currentCols:s,selectedRows:o,selectedCols:a}},methods:{triggerMouseDown(l){l.preventDefault()},triggerSelect(l,t,e){this.onSelect&&this.onSelect(l,t+1,e+1)},triggerHover(l,t){const e=Math.max(this.minRows,Math.min(this.maxRows,l+2)),n=Math.max(this.minCols,Math.min(this.maxCols,t+2));this.currentRows=e,this.currentCols=n,this.selectedRows=l+1,this.selectedCols=t+1}}});const sse={"data-element":"ui",class:"data-toolbar-table-selector"},ose=["onClick","onMouseover"],ase={class:"data-toolbar-table-selector-info"};function lse(l,t,e,n,i,r){return oe(),pe("div",sse,[(oe(!0),pe(kt,null,Jt(l.currentRows,s=>(oe(),pe("div",{class:"data-toolbar-table-selector-tr",key:s},[(oe(!0),pe(kt,null,Jt(l.currentCols,o=>(oe(),pe("div",{class:lt([{"data-toolbar-table-selector-td":!0},{actived:s-1<l.selectedRows&&o-1<l.selectedCols}]),key:{col:o},onClick:a=>l.triggerSelect(a,s-1,o-1),onMousedown:t[0]||(t[0]=a=>l.triggerMouseDown(a)),onMouseover:a=>l.triggerHover(s-1,o-1)},null,42,ose))),128))]))),128)),Ne("div",ase,Et(l.selectedRows===void 0?0:l.selectedRows)+"x"+Et(l.selectedCols===void 0?0:l.selectedCols),1)])}const cse=gt(rse,[["render",lse]]),yp=[{key:"default",value:""},{key:"arial",value:"Arial"},{key:"comicSansMS",value:'"Comic Sans MS"'},{key:"courierNew",value:'"Courier New"'},{key:"georgia",value:"Georgia"},{key:"helvetica",value:"Helvetica"},{key:"impact",value:"Impact"},{key:"timesNewRoman",value:'"Times New Roman"'},{key:"trebuchetMS",value:'"Trebuchet MS"'},{key:"verdana",value:"Verdana"},{key:"fangSong",value:"FangSong, \u4EFF\u5B8B, FZFangSong-Z02S, STFangsong, fangsong"},{key:"stFangsong",value:"STFangsong, \u534E\u6587\u4EFF\u5B8B, FangSong, FZFangSong-Z02S, fangsong"},{key:"stSong",value:'STSong, \u534E\u6587\u5B8B\u4F53, SimSun, "Songti SC", NSimSun, serif'},{key:"stKaiti",value:'STKaiti, \u534E\u6587\u6977\u4F53, KaiTi, "Kaiti SC", cursive'},{key:"simSun",value:'SimSun, \u5B8B\u4F53, "Songti SC", NSimSun, STSong, serif'},{key:"microsoftYaHei",value:'"Microsoft YaHei", \u5FAE\u8F6F\u96C5\u9ED1, "PingFang SC", SimHei, STHeiti, sans-serif'},{key:"kaiTi",value:'KaiTi, \u6977\u4F53, STKaiti, "Kaiti SC", cursive'},{key:"kaitiSC",value:'"Kaiti SC"'},{key:"simHei",value:'SimHei, \u9ED1\u4F53, "Microsoft YaHei", "PingFang SC", STHeiti, sans-serif'},{key:"heitiSC",value:'"Heiti SC"'},{key:"fzHei",value:"FZHei-B01S"},{key:"fzKai",value:"FZKai-Z03S"},{key:"fzFangSong",value:"FZFangSong-Z02S"}],use=(l,t)=>l.map(({key:e,value:n})=>{const i=e!=="default"?!n.split(",").some(r=>jie(r.trim())):!1;return{key:n,faimlyName:t?t[e]:e,content:`<span style="font-family: ${n}">${t?t[e]:e}</span>`,hotkey:!1,disabled:i,title:i?t&&t.notInstalled||"The font may not be installed":void 0}});const _p=l=>{const t=l.language.get("toolbar"),e=l.container.css("font-size");return[{type:"collapse",header:t.collapse.title,icon:"collapse",groups:[{items:[{name:"image-uploader",icon:`<span>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										width="24"
										height="24"
									>
										<g fill="none" fill-rule="evenodd">
											<rect
												stroke="#E8E8E8"
												strokeWidth=".667"
												fill="#FFF"
												x=".333"
												y=".333"
												width="23.333"
												height="23.333"
												rx="1.333"
											/>
											<g fill-rule="nonzero">
												<path
													d="M8.625 8a1.126 1.126 0 010 2.25 1.126 1.126 0 010-2.25z"
													fill="#FFD666"
												/>
												<path
													d="M17.95 14.88a.144.144 0 01-.092.033H6.14a.139.139 0 01-.14-.137.14.14 0 01.033-.089l2.981-3.45a.143.143 0 01.198-.018c.005.005.012.01.017.017l1.74 2.016 2.767-3.203a.143.143 0 01.198-.017l.018.017 4.018 4.64a.137.137 0 01-.02.191z"
													fill="#CCC"
												/>
												<path
													d="M17.91 14.88a.144.144 0 01-.092.033H9.333l4.363-4.864a.143.143 0 01.198-.017l.018.017 4.018 4.64a.137.137 0 01-.02.191z"
													fill="#737373"
												/>
											</g>
										</g>
									</svg>
								</span>`,title:t.image.title,search:"\u56FE\u7247,tupian,image,img"},{name:"codeblock",icon:`<span>
									<svg
										xmlns="http://www.w3.org/2000/svg"
										width="24"
										height="24"
									>
										<g fill="none" fill-rule="evenodd">
											<rect
												stroke="#E8E8E8"
												fill="#FFF"
												x=".5"
												y=".5"
												width="23"
												height="23"
												rx="2"
											/>
											<path
												d="M19.331 11.815c-.407-.22-.665-.678-.665-1.181V8.062c0-.202-.148-.367-.33-.367h-.933a.153.153 0 01-.153-.153v-.64c0-.084.068-.152.153-.152h.933c.651 0 1.18.588 1.18 1.312v2.572c0 .14.072.269.186.33l.843.455c.05.026.08.078.08.134v.894c0 .056-.03.108-.08.134l-.843.455a.373.373 0 00-.186.33v2.572c0 .724-.529 1.312-1.18 1.312h-.933a.153.153 0 01-.153-.153v-.64c0-.084.068-.152.153-.152h.933c.182 0 .33-.165.33-.367v-2.572c0-.503.258-.961.665-1.18l.344-.186-.344-.185zM5.044 11.815c.407-.22.665-.678.665-1.181V8.062c0-.202.148-.367.33-.367h.933a.153.153 0 00.153-.153v-.64a.153.153 0 00-.153-.152H6.04c-.651 0-1.18.588-1.18 1.312v2.572c0 .14-.072.269-.186.33l-.843.455a.153.153 0 00-.08.134v.894c0 .056.03.108.08.134l.843.455c.114.061.186.19.186.33v2.572c0 .724.529 1.312 1.18 1.312h.933a.153.153 0 00.153-.153v-.64a.153.153 0 00-.153-.152H6.04c-.182 0-.33-.165-.33-.367v-2.572c0-.503-.258-.961-.665-1.18L4.7 12l.344-.185z"
												fill="#595959"
												fill-rule="nonzero"
											/>
											<path
												fill="#1890FF"
												opacity=".25"
												d="M8.25 8.25h7.5v1.125h-7.5z"
											/>
											<path
												fill="#D2E8DB"
												d="M8.25 10.5h4.5v1.125h-4.5z"
											/>
											<path
												fill="#E0E0E0"
												d="M8.25 12.75h4.5v1.125h-4.5zM8.25 15h6v1.125h-6z"
											/>
										</g>
									</svg>
								</span>`,title:t.codeblock.title,search:"\u4EE3\u7801\u5757,daimakuai,code"},{name:"table",command:{name:"table",args:[3,3]},placement:"rt",onDisabled:()=>!!l.card.active||!l.command.queryEnabled("table"),prompt:!!l.card.active||!l.command.queryEnabled("table")?void 0:Pf(cse,{onSelect:(n,i,r)=>{l.command.execute("table",i,r)}}),icon:`<span><svg
									width="24px"
									height="24px"
									view-box="0 0 24 24"
									version="1.1"
									xmlns="http://www.w3.org/2000/svg"
								>
									<g
										stroke="none"
										strokeWidth="1"
										fill="none"
										fill-rule="evenodd"
									>
										<g transform="translate(-16.000000, -93.000000)">
											<g>
												<g transform="translate(16.000000, 53.000000)">
													<g transform="translate(0.000000, 40.000000)">
														<g>
															<rect
																stroke="#E8E8E8"
																strokeWidth="0.666666667"
																fill="#FFFFFF"
																x="0.333333333"
																y="0.333333333"
																width="23.3333333"
																height="23.3333333"
																rx="1.33333333"
															></rect>
															<g transform="translate(5.250000, 6.750000)">
																<path
																	d="M0.75,0 L3.75,0 L3.75,10.5 L0.75,10.5 C0.335786438,10.5 5.07265313e-17,10.1642136 0,9.75 L0,0.75 C-5.07265313e-17,0.335786438 0.335786438,7.6089797e-17 0.75,0 Z"
																	id="Rectangle"
																	fill="#F0F0F0"
																></path>
																<path
																	d="M0.25,2.75 L13.25,2.75 L13.25,0.75 C13.25,0.473857625 13.0261424,0.25 12.75,0.25 L0.75,0.25 C0.473857625,0.25 0.25,0.473857625 0.25,0.75 L0.25,2.75 Z"
																	id="Rectangle"
																	stroke="#595959"
																	strokeWidth="0.5"
																	fill-opacity="0.15"
																	fill="#25B864"
																></path>
																<rect
																	id="Rectangle"
																	fill="#E8E8E8"
																	x="0"
																	y="5.25"
																	width="13.5"
																	height="1"
																></rect>
																<rect
																	id="Rectangle-Copy"
																	fill="#E8E8E8"
																	x="0"
																	y="7.5"
																	width="13.5"
																	height="1"
																></rect>
																<rect
																	id="Rectangle"
																	fill="#E8E8E8"
																	x="6.75"
																	y="0"
																	width="1"
																	height="10.5"
																></rect>
																<rect
																	id="Rectangle-Copy-5"
																	fill="#E8E8E8"
																	x="9.75"
																	y="0"
																	width="1"
																	height="10.5"
																></rect>
																<rect
																	id="Rectangle"
																	stroke="#737373"
																	strokeWidth="0.75"
																	x="0.375"
																	y="0.375"
																	width="12.75"
																	height="9.75"
																	rx="0.75"
																></rect>
																<path
																	d="M3.5,10.25 L3.5,0.25 L0.75,0.25 C0.473857625,0.25 0.25,0.473857625 0.25,0.75 L0.25,9.75 C0.25,10.0261424 0.473857625,10.25 0.75,10.25 L3.5,10.25 Z"
																	id="Rectangle"
																	stroke="#737373"
																	strokeWidth="0.5"
																></path>
																<path
																	d="M0.25,2.75 L13.25,2.75 L13.25,0.75 C13.25,0.473857625 13.0261424,0.25 12.75,0.25 L0.75,0.25 C0.473857625,0.25 0.25,0.473857625 0.25,0.75 L0.25,2.75 Z"
																	id="Rectangle"
																	stroke="#737373"
																	strokeWidth="0.5"
																></path>
															</g>
														</g>
													</g>
												</g>
											</g>
										</g>
									</g>
								</svg></span>`,title:t.table.title,search:"biaoge,table"},{name:"file-uploader",icon:`<span>
									<svg
										width="24"
										height="24"
										xmlns="http://www.w3.org/2000/svg"
									>
										<g fill="none" fill-rule="evenodd">
											<rect
												stroke="#E8E8E8"
												fill="#FFF"
												x=".5"
												y=".5"
												width="23"
												height="23"
												rx="2"
											/>
											<path
												fill="#E0E0E0"
												d="M11.25 15h8.25v1.125h-8.25zM14.25 11.25h5.25v1.125h-5.25zM14.25 8.25h5.25v1.125h-5.25z"
											/>
											<path
												d="M11.216 8.324a2.593 2.593 0 00-3.791 0l-2.896 3.04a.108.108 0 00-.029.074c0 .028.01.055.029.075l.41.43c.038.041.101.041.14 0l2.896-3.04a1.841 1.841 0 012.69 0c.36.378.557.88.557 1.413 0 .534-.197 1.035-.557 1.413l-2.95 3.1-.48.502c-.446.47-1.173.47-1.62 0a1.226 1.226 0 01-.335-.851c0-.322.119-.624.335-.851l2.928-3.075a.382.382 0 01.276-.12h.001c.105 0 .201.043.274.12.075.078.115.18.115.29a.416.416 0 01-.115.288l-2.393 2.512a.108.108 0 00-.029.075c0 .028.01.054.03.074l.409.43c.038.041.102.041.14 0l2.392-2.513c.221-.232.342-.54.342-.867 0-.328-.122-.637-.342-.868a1.131 1.131 0 00-1.653 0l-.284.3-2.642 2.776a2.06 2.06 0 00-.564 1.43c0 .54.2 1.047.564 1.428.376.394.868.591 1.36.591.494 0 .986-.197 1.361-.591l3.43-3.602c.505-.532.785-1.24.785-1.991a2.867 2.867 0 00-.784-1.992z"
												fill="#595959"
											/>
										</g>
									</svg>
								</span>`,title:t.file.title,search:"\u9644\u4EF6,\u6587\u4EF6,fujian,wenjian,file"},{name:"video-uploader",icon:`<span>
									<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                        <g stroke="none" strokeWidth="1" fill="none" fill-rule="evenodd">
                                            <g transform="translate(-16.000000, -641.000000)">
                                                <g>
                                                    <g transform="translate(16.000000, 641.000000)">
                                                        <g>
                                                            <rect stroke="#E8E8E8" fill="#FFFFFF" x="0.5" y="0.5" width="23" height="23" rx="2"/>
                                                            <g transform="translate(6.000000, 6.000000)" fill-rule="nonzero">
                                                                <rect fill="#000000" opacity="0" x="0" y="0" width="12" height="12"/>
                                                                <path d="M6,0.75 C3.10078125,0.75 0.75,3.10078125 0.75,6 C0.75,8.89921875 3.10078125,11.25 6,11.25 C8.89921875,11.25 11.25,8.89921875 11.25,6 C11.25,3.10078125 8.89921875,0.75 6,0.75 Z M6,10.359375 C3.59296875,10.359375 1.640625,8.40703125 1.640625,6 C1.640625,3.59296875 3.59296875,1.640625 6,1.640625 C8.40703125,1.640625 10.359375,3.59296875 10.359375,6 C10.359375,8.40703125 8.40703125,10.359375 6,10.359375 Z" id="Shape" fill="#595959"/>
                                                                <path d="M7.93963415,5.8884912 L5.23140244,4.02687575 C5.13445122,3.96020395 5,4.02514402 5,4.13857268 L5,7.86180356 C5,7.97523223 5.13536585,8.03930643 5.23140244,7.97350049 L7.93963415,6.11188505 C8.02012195,6.05646952 8.02012195,5.94390673 7.93963415,5.8884912 Z" id="Shape" fill="#71D19A"/>
                                                            </g>
                                                        </g>
                                                    </g>
                                                </g>
                                            </g>
                                        </g>
                                    </svg>
								</span>`,title:t.video.title,search:"\u89C6\u9891,MP4,shipin,video"},{name:"imgattachment",icon:`<span>
							<svg t="1705737872248" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19363" width="24" height="24"><path d="M955.392 872.96H71.168c-23.552 0-42.752-16.896-42.752-37.888V214.784c0-20.992 19.2-37.888 42.752-37.888h884.224c23.552 0 42.752 16.896 42.752 37.888v620.032c0 20.992-19.2 38.144-42.752 38.144z" fill="#FFE9B4" p-id="19364"></path><path d="M513.792 430.08H28.416V154.112c0-29.952 19.2-54.272 42.752-54.272h332.288c18.944 0 35.584 15.616 40.96 38.656L513.792 430.08z" fill="#FFB02C" p-id="19365"></path><path d="M843.776 807.424h-645.12c-44.544 0-80.64-29.696-80.64-66.304V309.504c0-36.608 36.096-66.304 80.64-66.304h645.12c44.544 0 80.64 29.696 80.64 66.304v431.36c0 36.864-36.096 66.56-80.64 66.56z" fill="#D2F4FF" p-id="19366"></path><path d="M873.472 609.792l-33.28-40.192-202.752-202.496c-16.128-16.128-42.24-16.128-58.624 0l-114.432 113.92c-2.304 2.304-4.352 2.56-5.632 2.56-1.28 0-3.84-0.512-5.632-2.56l-31.488-30.976c-16.128-16.128-42.24-16.128-58.624 0L243.2 570.112l-33.28 40.192v95.232c0 36.608 29.696 66.304 66.304 66.304h530.944c36.608 0 66.304-29.696 66.304-66.304v-95.744" fill="#16C4AF" p-id="19367"></path><path d="M280.576 344.064c0 22.784 18.688 41.472 41.472 41.472s41.472-18.688 41.472-41.472-18.688-41.472-41.472-41.472c-22.784 0-41.472 18.432-41.472 41.472z" fill="#E5404F" p-id="19368"></path><path d="M652.288 739.072H346.624c-9.728 0-17.408-7.936-17.408-17.408s7.936-17.408 17.408-17.408h305.664c9.728 0 17.408 7.936 17.408 17.408s-7.936 17.408-17.408 17.408zM499.456 657.92h-152.832c-9.728 0-17.408-7.936-17.408-17.408s7.936-17.408 17.408-17.408h152.832c9.728 0 17.408 7.936 17.408 17.408s-7.936 17.408-17.408 17.408z" fill="#0B9682" p-id="19369"></path><path d="M950.784 929.28H70.656c-23.552 0-42.496-15.616-42.496-35.072V439.552c0-19.456 18.944-35.072 42.496-35.072h880.128c23.552 0 42.496 15.616 42.496 35.072v454.4c0 19.456-19.2 35.328-42.496 35.328z" fill="#FFCA28" p-id="19370"></path><path d="M343.04 593.92H138.24c-14.08 0-25.6-11.52-25.6-25.6s11.52-25.6 25.6-25.6h204.8c14.08 0 25.6 11.52 25.6 25.6s-11.52 25.6-25.6 25.6zM465.92 721.92H138.24c-14.08 0-25.6-11.52-25.6-25.6s11.52-25.6 25.6-25.6h327.68c14.08 0 25.6 11.52 25.6 25.6s-11.52 25.6-25.6 25.6z" fill="#FFFFFF" p-id="19371"></path></svg>
								</span>`,title:t.imgattachment.title,search:"\u9644\u4EF6\u7BA1\u7406\u5668,imgattachment"}]}]},{type:"button",name:"undo",icon:"undo",title:t.undo.title,onDisabled:()=>!l.command.queryState("undo")||!l.command.queryEnabled("undo"),onActive:()=>!1},{type:"button",name:"redo",icon:"redo",title:t.redo.title,onDisabled:()=>!l.command.queryState("redo")||!l.command.queryEnabled("redo"),onActive:()=>!1},{type:"button",name:"paintformat",icon:"paintformat",title:t.paintformat.title},{type:"button",name:"removeformat",icon:"clean",title:t.removeformat.title},{type:"dropdown",name:"heading",className:"toolbar-dropdown-heading",title:t.heading.title,items:[{key:"p",className:"heading-item-p",content:t.heading.p},{key:"h1",className:"heading-item-h1",content:t.heading.h1},{key:"h2",className:"heading-item-h2",content:t.heading.h2},{key:"h3",className:"heading-item-h3",content:t.heading.h3},{key:"h4",className:"heading-item-h4",content:t.heading.h4},{key:"h5",className:"heading-item-h5",content:t.heading.h5},{key:"h6",className:"heading-item-h6",content:t.heading.h6}]},{type:"dropdown",name:"fontsize",className:"toolbar-dropdown-fontsize",title:t.fontsize.title,items:[{key:"12px",content:"12px",hotkey:!1},{key:"13px",content:"13px",hotkey:!1},{key:"14px",content:"14px",hotkey:!1},{key:"15px",content:"15px",hotkey:!1},{key:"16px",content:"16px",hotkey:!1},{key:"19px",content:"19px",hotkey:!1},{key:"22px",content:"22px",hotkey:!1},{key:"24px",content:"24px",hotkey:!1},{key:"29px",content:"29px",hotkey:!1},{key:"32px",content:"32px",hotkey:!1},{key:"40px",content:"40px",hotkey:!1},{key:"48px",content:"48px",hotkey:!1}].map(n=>n.key===e?{...n,isDefault:!0}:n),onDisabled:()=>{const n=l.command.queryState("heading")||"p";return/^h\d$/.test(n)||!l.command.queryEnabled("fontsize")}},{type:"dropdown",name:"fontfamily",className:"toolbar-dropdown-fontfamily",title:t.fontfamily.title,items:use(yp,{...t.fontfamily.items,notInstalled:t.fontfamily.notInstalled}),onActive:n=>{var s;const i=l.command.queryState("fontfamily");if(!i||!Array.isArray(i)||i.length===0)return"";const r=i[0].split(",").map(o=>o.replace(/"/g,"").trim().toLowerCase());return((s=n.find(o=>r.indexOf(o.faimlyName.trim().toLowerCase())>-1))==null?void 0:s.key)||""}},{type:"button",name:"bold",icon:"bold",title:t.bold.title,onDisabled:()=>{const n=l.command.queryState("heading")||"p";return/^h\d$/.test(n)||!l.command.queryEnabled("bold")}},{type:"button",name:"italic",icon:"italic",title:t.italic.title},{type:"button",name:"strikethrough",icon:"strikethrough",title:t.strikethrough.title},{type:"button",name:"underline",icon:"underline",title:t.underline.title},{type:"dropdown",name:"moremark",icon:"moremark",single:!1,title:t.moremark.title,items:[{key:"sup",icon:"sup",content:t.moremark.sup,disabled:!l.command.queryEnabled("sup"),command:{name:"sup",args:[]}},{key:"sub",icon:"sub",disabled:!l.command.queryEnabled("sub"),content:t.moremark.sub,command:{name:"sub",args:[]}},{key:"code",icon:"code",disabled:!l.command.queryEnabled("code"),content:t.moremark.code,command:{name:"code",args:[]}}],onDisabled:()=>{const n=[];return l.command.queryEnabled("sup")===!0&&n.push("sup"),l.command.queryEnabled("sub")===!0&&n.push("sub"),l.command.queryEnabled("code")===!0&&n.push("code"),n.length===0},onActive:()=>{const n=[];return l.command.queryState("sup")===!0&&n.push("sup"),l.command.queryState("sub")===!0&&n.push("sub"),l.command.queryState("code")===!0&&n.push("code"),n}},{type:"color",name:"fontcolor",defaultColor:"#262626",defaultActiveColor:"#F5222D",buttonTitle:t.fontcolor.title,dropdownTitle:t.fontcolor.more,content:(n,i,r)=>(r===!0&&(n="#BFBFBF",i="#BFBFBF"),`<svg
						width="16px"
						height="16px"
						viewBox="0 0 16 16"
						style="margin-bottom: -2"
					>
						<title>color-font</title>
						<desc>Created with Sketch.</desc>
						<g
							id="color-font"
							stroke="none"
							strokeWidth="1"
							fill="none"
							fill-rule="evenodd"
						>
							<rect
								id="Rectangle-55"
								stroke=${i}
								strokeWidth="0.5"
								fill=${n}
								x="2"
								y="12.75"
								width="12"
								height="1.5"
								rx="0.125"
							/>
							<path
								d="M5.29102819,11.25 L3.96365715,11.25 C3.87952002,11.25 3.8113134,11.1817934 3.8113134,11.0976562 C3.8113134,11.08076 3.81412419,11.0639814 3.81963067,11.0480076 L7.0756112,1.60269506 C7.09679504,1.5412426 7.15463644,1.5 7.21963767,1.5 L8.81868806,1.5 C8.883726,1.5 8.94159158,1.54128846 8.96274706,1.60278951 L12.2118,11.048102 C12.239168,11.1276636 12.1968568,11.2143472 12.1172952,11.2417152 C12.1013495,11.2472004 12.0846037,11.25 12.067741,11.25 L10.6761419,11.25 C10.6099165,11.25 10.5512771,11.2072154 10.531066,11.1441494 L9.69970662,8.55 L6.27433466,8.55 L5.43599205,11.1444975 C5.41567115,11.2073865 5.35711879,11.25 5.29102819,11.25 Z M8.02635163,3.18571429 L7.96199183,3.18571429 L6.63904023,7.30714286 L9.33500105,7.30714286 L8.02635163,3.18571429 Z"
								id="A"
								fill="#595959"
							/>
						</g>
					</svg>`)},{type:"color",name:"backcolor",defaultColor:"transparent",defaultActiveColor:"#FADB14",buttonTitle:t.backcolor.title,dropdownTitle:t.backcolor.more,content:(n,i,r)=>(r===!0&&(n="#BFBFBF",i="#BFBFBF"),`<svg
                    width="16px"
                    height="16px"
                    viewBox="0 0 16 16"
                    style="margin-bottom: -2"
					>
                    <g stroke="none" strokeWidth="1" fill="none" fill-rule="evenodd">
                    <rect stroke="${i}" strokeWidth="0.5" fill="${n}" x="2" y="12.75" width="12" height="1.5" rx="0.125"></rect>
                    <g transform="translate(2.781250, 1.375000)" fill-rule="nonzero"><path fill="#595959" d="M2.86079849,6.64817222 L2.05713835,5.84451208 C2.00832281,5.79569655 2.00832281,5.71655092 2.05713835,5.66773539 L3.61029491,4.11457882 L3.11963835,3.62392225 C3.07082281,3.57510672 3.07082281,3.49596109 3.11963835,3.44714556 L6.47839556,0.0883883476 C6.52721109,0.0395728112 6.60635672,0.0395728112 6.65517225,0.0883883476 L11.5165314,4.94974747 C11.5653469,4.998563 11.5653469,5.07770863 11.5165314,5.12652416 L8.15777416,8.48528137 C8.10895863,8.53409691 8.029813,8.53409691 7.98099747,8.48528137 L7.38889678,7.89318068 L5.83574021,9.44633725 C5.78692467,9.49515278 5.70777905,9.49515278 5.65896351,9.44633725 L5.0267407,8.81411444 L4.48856529,9.35326519 C4.39477378,9.44720966 4.26747335,9.5 4.13472392,9.5 L0.608857988,9.5 C0.470786801,9.5 0.358857988,9.38807119 0.358857988,9.25 C0.358857988,9.18363253 0.385247413,9.11998865 0.432210608,9.07309408 L2.86079849,6.64817222 Z M6.56678391,1.67937861 L4.71062861,3.53553391 L8.06938582,6.89429112 L9.92554112,5.03813582 L6.56678391,1.67937861 Z M3.64812861,5.75612373 L5.74735186,7.85534699 L6.54284699,7.05985186 L4.44362373,4.96062861 L3.64812861,5.75612373 Z" id="Combined-Shape"></path></g></g>
					</svg>`)},{type:"dropdown",name:"alignment",title:t.alignment.title,items:[{key:"left",icon:"align-left",content:t.alignment.left},{key:"center",icon:"align-center",content:t.alignment.center},{key:"right",icon:"align-right",content:t.alignment.right},{key:"justify",icon:"align-justify",content:t.alignment.justify}]},{type:"button",name:"unorderedlist",icon:"unordered-list",title:t.unorderedlist.title},{type:"button",name:"orderedlist",icon:"ordered-list",title:t.orderedlist.title},{type:"button",name:"tasklist",icon:"task-list",title:t.tasklist.title},{type:"dropdown",name:"indent",icon:"indent",hasDot:!1,title:t.indent.title,items:[{key:"in",icon:"indent",content:t.indent.in},{key:"out",icon:"outdent",content:t.indent.out}]},{type:"dropdown",name:"line-height",content:()=>'<span class="data-icon data-icon-line-height"></span>',title:t["line-height"].title,items:[{key:"default",content:t["line-height"].default},{key:"1",content:"1"},{key:"1.15",content:"1.15"},{key:"1.5",content:"1.5"},{key:"2",content:"2"},{key:"2.5",content:"2.5"},{key:"3",content:"3"}]},{type:"button",name:"link",icon:"link",command:{name:"link",args:["_blank"]},title:t.link.title,onDisabled:()=>{const{card:n}=l,i=V(l)?l.change.range.get():Te.from(l);if(!i)return!l.command.queryEnabled("link");const r=n.find(i.startNode);return!!r&&!r.isCursor(i.startNode)||i.containsCard()||!l.command.queryEnabled("link")}},{type:"button",name:"quote",icon:"quote",title:t.quote.title},{type:"button",name:"hr",icon:"hr",title:t.hr.title}]},dse=mt({name:"am-toolbar",components:{AmGroup:tse},props:Uie,setup(l){let t=xe([]);const e=()=>{!l.engine.isFocus()||l.engine.readonly||(r.value&&clearTimeout(r.value),r.value=setTimeout(()=>{const h=i.value,f=h.getBoundingClientRect(),p=Ee(getComputedStyle(h).borderTopWidth),g=Ee(getComputedStyle(h).borderBottomWidth),m=f.height||0;s.top=Math.max(document.body.scrollTop,document.documentElement.scrollTop)+(window.visualViewport.height||0)-m+p+g},10))},n=()=>{ue&&e();const h=[],f=_p(l.engine);l.items.forEach(p=>{const g={items:[]};Array.isArray(p)||(g.icon=p.icon,g.content=p.content,p=p.items),p.forEach(m=>{let v;if(typeof m=="string"){const b=f.find(_=>m==="collapse"?_.type===m:_.type!=="collapse"&&_.name===m);b&&(v=b)}else{const b=f.find(_=>m.type==="collapse"?_.type===m.type:_.type!=="collapse"&&_.name===m.name);if(m.type==="collapse"){const _={...Li(Ti({...b},"groups"),Ti({...m},"groups")),groups:[]};m.groups.forEach(x=>{const w=[];x.items.forEach(E=>{let S;b.groups.some(R=>R.items.some(D=>{const P=D.name===(typeof E=="string"?E:E.name);return P&&(S={...D,...typeof E=="string"?{}:E}),P})),S?w.push(S):typeof E=="object"&&w.push(E)}),w.length>0&&_.groups.push({...Ti(x,"itmes"),items:w})}),v=_.groups.length>0?_:void 0}else m.type==="dropdown"?(v=b?Li(b,Ti({...m},"type","items")):{...m},v.items=m.items):v=b?Li(b,Ti({...m},"type")):{...m}}v&&(v.type==="button"?v.onActive?v.active=v.onActive():l.engine.command.queryEnabled(v.name)&&(v.active=l.engine.command.queryState(v.name)):v.type==="dropdown"&&(v.onActive?v.values=v.onActive(v.items):v.values=l.engine.command.queryState(v.name)),v.type!=="collapse"?v.disabled=v.onDisabled?v.onDisabled():!l.engine.command.queryEnabled(v.name):(v.groups.forEach(b=>b.items.forEach(_=>{_.disabled=_.onDisabled?_.onDisabled():!l.engine.command.queryEnabled(_.name)})),v.disabled=!v.groups.some(b=>b.items.some(_=>!_.disabled))),g.items.push(v))}),g.items.length>0&&h.push(g)}),t.value=h},i=xe(null),r=xe(null),s=ug({top:0});let o;const a=()=>{s.top=-120,clearTimeout(o),o=setTimeout(()=>{e()},200)},c=()=>{l.engine.readonly?a():e()};let u;const d=()=>{clearTimeout(u),u=setTimeout(()=>{n()},100)};return Fi(()=>{l.engine.language.add(bp),l.engine.on("select",d),l.engine.on("change",d),l.engine.on("blur",d),l.engine.on("focus",d),l.engine.on("historyChange",d),ue?(l.engine.on("readonly",c),l.engine.on("blur",a),l.engine.isFocus()||a(),document.addEventListener("scroll",e),visualViewport.addEventListener("resize",e),visualViewport.addEventListener("scroll",e)):l.engine.on("readonly",d),d()}),Js(()=>{l.engine.off("select",d),l.engine.off("change",d),l.engine.off("readonly",d),l.engine.off("blur",d),l.engine.off("focus",d),l.engine.off("historyChange",d),ue?(l.engine.off("readonly",c),l.engine.off("blur",a),document.removeEventListener("scroll",e),visualViewport.removeEventListener("resize",e),visualViewport.removeEventListener("scroll",e)):l.engine.off("readonly",d)}),{toolbarRef:i,mobileView:s,isMobile:ue,groups:t}},methods:{preventDefault(l){l.preventDefault()},triggerMouseDown(){},triggerMouseOver(l){this.preventDefault(l)},triggerMouseMove(l){this.preventDefault(l)},triggerContextMenu(l){this.preventDefault(l)}}});const fse={class:"editor-toolbar-content"};function hse(l,t,e,n,i,r){const s=ct("am-group");return oe(),pe("div",{ref:"toolbarRef",class:lt(["editor-toolbar",l.className,{"editor-toolbar-mobile":l.isMobile&&!l.popup,"editor-toolbar-popup":l.popup}]),style:zn(l.isMobile?{top:`${l.mobileView.top}px`}:{}),"data-element":"ui",onMousedown:t[0]||(t[0]=(...o)=>l.triggerMouseDown&&l.triggerMouseDown(...o)),onMouseover:t[1]||(t[1]=(...o)=>l.triggerMouseOver&&l.triggerMouseOver(...o)),onMousemove:t[2]||(t[2]=(...o)=>l.triggerMouseMove&&l.triggerMouseMove(...o)),onContextmenu:t[3]||(t[3]=(...o)=>l.triggerContextMenu&&l.triggerContextMenu(...o))},[Ne("div",fse,[(oe(!0),pe(kt,null,Jt(l.groups,(o,a)=>(oe(),Je(s,Yt({key:a,engine:l.engine,popup:l.popup},o),null,16,["engine","popup"]))),128))])],38)}const Hr=gt(dse,[["render",hse]]);var ii={exports:{}};(function(l){(function(t){var e,n={},i={16:!1,18:!1,17:!1,91:!1},r="all",s={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91},o={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},a=function(A){return o[A]||A.toUpperCase().charCodeAt(0)},c=[];for(e=1;e<20;e++)o["f"+e]=111+e;function u(A,F){for(var W=A.length;W--;)if(A[W]===F)return W;return-1}function d(A,F){if(A.length!=F.length)return!1;for(var W=0;W<A.length;W++)if(A[W]!==F[W])return!1;return!0}var h={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function f(A){for(e in i)i[e]=A[h[e]]}function p(A){var F,W,G,k,C,$;if(F=A.keyCode,u(c,F)==-1&&c.push(F),(F==93||F==224)&&(F=91),F in i){i[F]=!0;for(G in s)s[G]==F&&(v[G]=!0);return}if(f(A),!!v.filter.call(this,A)&&F in n){for($=S(),k=0;k<n[F].length;k++)if(W=n[F][k],W.scope==$||W.scope=="all"){C=W.mods.length>0;for(G in i)(!i[G]&&u(W.mods,+G)>-1||i[G]&&u(W.mods,+G)==-1)&&(C=!1);(W.mods.length==0&&!i[16]&&!i[18]&&!i[17]&&!i[91]||C)&&W.method(A,W)===!1&&(A.preventDefault?A.preventDefault():A.returnValue=!1,A.stopPropagation&&A.stopPropagation(),A.cancelBubble&&(A.cancelBubble=!0))}}}function g(A){var F=A.keyCode,W,G=u(c,F);if(G>=0&&c.splice(G,1),(F==93||F==224)&&(F=91),F in i){i[F]=!1;for(W in s)s[W]==F&&(v[W]=!1)}}function m(){for(e in i)i[e]=!1;for(e in s)v[e]=!1}function v(A,F,W){var G,k;G=D(A),W===void 0&&(W=F,F="all");for(var C=0;C<G.length;C++)k=[],A=G[C].split("+"),A.length>1&&(k=P(A),A=[A[A.length-1]]),A=A[0],A=a(A),A in n||(n[A]=[]),n[A].push({shortcut:G[C],scope:F,method:W,key:G[C],mods:k})}function b(A,F){var W,G,k=[],C,$,z;for(W=D(A),$=0;$<W.length;$++){if(G=W[$].split("+"),G.length>1&&(k=P(G),A=G[G.length-1]),A=a(A),F===void 0&&(F=S()),!n[A])return;for(C=0;C<n[A].length;C++)z=n[A][C],z.scope===F&&d(z.mods,k)&&(n[A][C]={})}}function _(A){return typeof A=="string"&&(A=a(A)),u(c,A)!=-1}function x(){return c.slice(0)}function w(A){var F=(A.target||A.srcElement).tagName;return!(F=="INPUT"||F=="SELECT"||F=="TEXTAREA")}for(e in s)v[e]=!1;function E(A){r=A||"all"}function S(){return r||"all"}function R(A){var F,W,G;for(F in n)for(W=n[F],G=0;G<W.length;)W[G].scope===A?W.splice(G,1):G++}function D(A){var F;return A=A.replace(/\s/g,""),F=A.split(","),F[F.length-1]==""&&(F[F.length-2]+=","),F}function P(A){for(var F=A.slice(0,A.length-1),W=0;W<F.length;W++)F[W]=s[F[W]];return F}function O(A,F,W){A.addEventListener?A.addEventListener(F,W,!1):A.attachEvent&&A.attachEvent("on"+F,function(){W(window.event)})}O(document,"keydown",function(A){p(A)}),O(document,"keyup",g),O(window,"focus",m);var L=t.key;function B(){var A=t.key;return t.key=L,A}t.key=v,t.key.setScope=E,t.key.getScope=S,t.key.deleteScope=R,t.key.filter=w,t.key.isPressed=_,t.key.getPressedKeyCodes=x,t.key.noConflict=B,t.key.unbind=b,l.exports=v})(is)})(ii);const Is=ii.exports;var or;class pse{constructor(t,e){y(this,"engine");y(this,"root");y(this,"otpions");y(this,"vm");rt(this,or,void 0);y(this,"SCOPE_NAME","data-toolbar-component");y(this,"handlePreventDefault",t=>{var e;if(((e=this.root)==null?void 0:e.closest("body").length)!==0)return t.preventDefault(),!1});this.otpions=e,this.engine=t,Ze(this,or,new Eo(t))}select(t){var e,n,i;(e=this.root)==null||e.find(".toolbar-collapse-item-active").removeClass("toolbar-collapse-item-active"),(i=(n=this.root)==null?void 0:n.find(".toolbar-collapse-item").eq(t))==null||i.addClass("toolbar-collapse-item-active")}scroll(t){if(!this.root)return;const e=this.root.find(".toolbar-collapse-item").toArray();let n=this.root.find(".toolbar-collapse-item-active");const i=e.findIndex(a=>a.equal(n));let r=t==="up"?i-1:i+1;r<0&&(r=e.length-1),r>=e.length&&(r=0),n=e[r],this.select(r);let s=0;this.root.find(".toolbar-collapse-group-title,.toolbar-collapse-item").each(a=>{if(n.equal(a))return!1;s+=a.clientHeight});const o=this.root.get();o.scrollTop=s-o.clientHeight/2}unbindEvents(){ii.exports.deleteScope(this.SCOPE_NAME),ii.exports.unbind("enter",this.SCOPE_NAME),ii.exports.unbind("up",this.SCOPE_NAME),ii.exports.unbind("down",this.SCOPE_NAME),ii.exports.unbind("esc",this.SCOPE_NAME),this.engine.off("keydown:enter",this.handlePreventDefault)}bindEvents(){this.unbindEvents(),ii.exports.setScope(this.SCOPE_NAME),Is("enter",this.SCOPE_NAME,t=>{var n,i,r;if(((n=this.root)==null?void 0:n.closest("body").length)===0)return;t.preventDefault();const e=(i=this.root)==null?void 0:i.find(".toolbar-collapse-item-active");(r=e==null?void 0:e.get())==null||r.click()}),Is("up",this.SCOPE_NAME,t=>{var e;((e=this.root)==null?void 0:e.closest("body").length)!==0&&(t.preventDefault(),this.scroll("up"))}),Is("down",this.SCOPE_NAME,t=>{var e;((e=this.root)==null?void 0:e.closest("body").length)!==0&&(t.preventDefault(),this.scroll("down"))}),Is("esc",this.SCOPE_NAME,t=>{t.preventDefault(),this.unbindEvents();const{onCancel:e}=this.otpions;e&&e()}),this.engine.on("keydown:enter",this.handlePreventDefault)}remove(){var t;!this.root||this.root.length===0||((t=ie(this,or))==null||t.destroy(),this.vm&&this.vm.unmount(),this.root.remove(),this.root=void 0)}render(t,e,n){var s;this.unbindEvents(),this.remove(),this.root=I('<div class="data-toolbar-component-list" />'),t.append(this.root);const i=this.root.get(),{onSelect:r}=this.otpions;n.length>0?(this.vm=dr(vp,{engine:this.engine,groups:n,onSelect:r}),this.vm.mount(i)):this.root.append(`<div class="data-toolbar-component-list-empty">${this.engine.language.get("toolbar","searchEmtpy","title")}</div>`),this.select(0),this.bindEvents(),(s=ie(this,or))==null||s.bind(this.root,e)}}or=new WeakMap;var ot,vn,ar,nn,Mi,Wt;class gse{constructor(t,e={}){rt(this,ot,void 0);rt(this,vn,void 0);rt(this,ar,{left:0,top:-9999});rt(this,nn,"bottom");rt(this,Mi,{});rt(this,Wt,void 0);y(this,"onSelect",()=>{var d;const t=(d=Te.from(ie(this,ot)))==null?void 0:d.cloneRange().shrinkToTextNode(),e=window.getSelection();if(!t||!e||!e.focusNode||t.collapsed||ie(this,ot).card.getSingleSelectedCard(t)||!t.commonAncestorNode.inEditor(ie(this,ot).container)&&!t.commonAncestorNode.isRoot(ie(this,ot).container)){this.hide();return}const n=t.startNode.next();if((n==null?void 0:n.isElement())&&Math.abs(t.endOffset-t.startOffset)===1&&ie(this,ot).card.closest(n)){this.hide();return}const i=t.startNode.prev();if((i==null?void 0:i.isElement())&&Math.abs(t.startOffset-t.endOffset)===1&&ie(this,ot).card.closest(i)){this.hide();return}const r=t.getSubRanges();if(r.length===0||ie(this,ot).card.active&&!ie(this,ot).card.active.isEditable){this.hide();return}const s=r[0],o=r[r.length-1],a=s.cloneRange().collapse(!0).getBoundingClientRect(),c=o.cloneRange().collapse(!1).getBoundingClientRect();let u;this.showContent(()=>{var b,_,x;if(u=(b=ie(this,vn).get())==null?void 0:b.getBoundingClientRect(),!u){this.hide();return}Ze(this,nn,o.startNode.equal(e.focusNode)&&(!s.startNode.equal(e.focusNode)||e.focusOffset>e.anchorOffset)?"bottom":"top");const h=12;let f=ie(this,nn)==="bottom"?c:a;ie(this,nn)==="top"&&f.top-u.height-h<window.innerHeight-(((_=ie(this,ot).scrollNode)==null?void 0:_.height())||0)?Ze(this,nn,"bottom"):ie(this,nn)==="bottom"&&f.bottom+u.height+h>window.innerHeight&&Ze(this,nn,"top"),f=ie(this,nn)==="bottom"?c:a;const p=(x=ie(this,ot).scrollNode)==null?void 0:x.get(),g=p==null?void 0:p.getBoundingClientRect(),m=ie(this,nn)==="top"?f.top-u.height-h-((g==null?void 0:g.top)||0)+((p==null?void 0:p.scrollTop)||0):f.bottom+h-((g==null?void 0:g.top)||0)+((p==null?void 0:p.scrollTop)||0);let v=f.left-((g==null?void 0:g.left)||0)+((p==null?void 0:p.scrollLeft)||0)+f.width-u.width/2;v<0&&(v=16),Ze(this,ar,{left:v,top:m}),ie(this,vn).css({left:`${ie(this,ar).left}px`,top:`${ie(this,ar).top}px`})})});y(this,"hide",t=>{if(t!=null&&t.target){const e=I(t.target);if(e.closest(".data-toolbar-popup-wrapper").length>0||e.closest($i).length>0)return}ie(this,vn).css({left:"0px",top:"-9999px"})});var n,i;Ze(this,Mi,e),Ze(this,ot,t),Ze(this,vn,I('<div class="data-toolbar-popup-wrapper"></div>')),(((n=ie(this,ot).scrollNode)==null?void 0:n.get())||document.body).appendChild(ie(this,vn)[0]),V(t)?ie(this,ot).on("selectEnd",this.onSelect):document.addEventListener("selectionchange",this.onSelect),ue||window.addEventListener("scroll",this.onSelect),window.addEventListener("resize",this.onSelect),(i=ie(this,ot).scrollNode)==null||i.on("scroll",this.onSelect),document.addEventListener("mousedown",this.hide)}showContent(t){var i,r;const e=ie(this,ot).trigger("toolbar-render",ie(this,Mi));if(!e&&(ie(this,Mi).items||[]).length===0){(i=ie(this,Wt))==null||i.unmount(),Ze(this,Wt,void 0),this.hide();return}let n=Hr;typeof e=="object"&&((r=ie(this,Wt))==null||r.unmount(),Ze(this,Wt,void 0),n=e),ie(this,Wt)||(Ze(this,Wt,dr(n,{...ie(this,Mi),engine:ie(this,ot),popup:!0})),ie(this,Wt).mount(ie(this,vn).get())),setTimeout(()=>{t&&t()},200)}destroy(){var t;ie(this,vn).remove(),V(ie(this,ot))?ie(this,ot).off("select",this.onSelect):document.removeEventListener("selectionchange",this.onSelect),ue||window.removeEventListener("scroll",this.onSelect),window.removeEventListener("resize",this.onSelect),(t=ie(this,ot).scrollNode)==null||t.off("scroll",this.onSelect),document.removeEventListener("mousedown",this.hide),ie(this,Wt)&&(ie(this,Wt).unmount(),Ze(this,Wt,void 0))}}ot=new WeakMap,vn=new WeakMap,ar=new WeakMap,nn=new WeakMap,Mi=new WeakMap,Wt=new WeakMap;var bn,es;class Ja extends Tt{constructor(){super(...arguments);y(this,"keyword");y(this,"placeholder");y(this,"component");rt(this,bn,void 0);rt(this,es,void 0)}static get cardName(){return"toolbar"}static get cardType(){return Ve.INLINE}static get singleSelectable(){return!1}static get autoSelected(){return!1}init(){const e=this.editor;!V(e)||Ia||(this.component=new pse(e,{onCancel:()=>{this.changeToText()},onSelect:()=>{this.remove()}}))}setData(e){Ze(this,es,e)}getData(){const e=this.editor;if(!V(e))return[];const n=[],r=_p(e).find(({type:c})=>c==="collapse");let s=[];r&&(s=r.groups);const o=[];s.forEach(c=>{o.push(...c.items)});const a=this.getValue();return(ie(this,es)||(a?a.data:[])||[]).forEach(c=>{const u=c.title,d=[];c.items.forEach(h=>{let f=h;typeof h!="string"&&(f=h.name);const p=o.find(g=>g.name===f);p?d.push({...p,...typeof h!="string"?h:{},disabled:p.onDisabled?p.onDisabled():!e.command.queryEnabled(f)}):typeof h=="object"&&d.push(h)}),n.push({title:u,items:d})}),n}search(e){const n=[];typeof e=="string"&&(e=e.toLowerCase()),ie(this,bn)||Ze(this,bn,[]),ie(this,bn).forEach(r=>{r.items.forEach(s=>{s.search&&s.search.toLowerCase().indexOf(e)>=0&&(n.find(({name:o})=>o===s.name)||n.push({...s}))})});const i=[];return n.length>0&&i.push({title:"",items:n}),i}remove(){var n;const e=this.editor;!V(e)||((n=this.component)==null||n.remove(),e.card.remove(this.id))}changeToText(){var i,r;const e=this.editor;if(!this.root.inEditor()||!V(e))return;const n=((r=(i=this.keyword)==null?void 0:i.get())==null?void 0:r.innerText)||"";this.remove(),e.node.insertText(n)}destroy(){const e=this.component;e==null||e.unbindEvents(),e==null||e.remove()}activate(e){var n;super.activate(e),e||((n=this.component)==null||n.unbindEvents(),this.changeToText())}handleInput(){var c,u;const e=this.editor;if(!V(e))return;const{change:n,card:i}=e;if(n.isComposing())return;const r=((u=(c=this.keyword)==null?void 0:c.get())==null?void 0:u.innerText.replace(/[\r\n]/g,""))||"",s=this.component;if(r===""){s==null||s.remove(),i.remove(this.id);return}const o=r.substr(1);if(o===""){s==null||s.render(e.root,this.root,ie(this,bn)||[]);return}const a=this.search(o);s==null||s.render(e.root,this.root,a)}resetPlaceHolder(){var e,n,i,r;((n=(e=this.keyword)==null?void 0:e.get())==null?void 0:n.innerText)==="/"?(i=this.placeholder)==null||i.show():(r=this.placeholder)==null||r.hide()}render(e){var a,c,u;this.setData(e);const n=this.editor;if(!V(n)||Ia)return;const i=n.language.get("toolbar","component");this.root.attributes("data-transient","true"),this.root.attributes(yt,"false");const r=I(`<span class="data-toolbar-component-keyword" ${yt}="true">/</span><span class="data-toolbar-component-placeholder">${i.placeholder}</span>`),s=this.getCenter();s.empty().append(r),this.keyword=s.find(".data-toolbar-component-keyword"),this.placeholder=s.find(".data-toolbar-component-placeholder"),(a=this.keyword)==null||a.on("keydown",d=>{ce("enter",d)&&d.preventDefault()});const o=Date.now();(c=this.keyword)==null||c.on("input",()=>{var d,h,f;if(this.resetPlaceHolder(),Date.now()-o<200){const p=(d=this.keyword)==null?void 0:d.first();if(p&&p.isText()&&p[0].nodeValue==="/\u3001"||((h=p==null?void 0:p.get())==null?void 0:h.nodeValue)==="//"){const g=(f=p.get())==null?void 0:f.splitText(1);g==null||g.remove()}}setTimeout(()=>{this.handleInput()},10)}),ie(this,bn)||Ze(this,bn,this.getData()),(u=this.component)==null||u.render(n.root,this.root,ie(this,bn))}}bn=new WeakMap,es=new WeakMap;const mse=l=>[{title:l.language.get("toolbar","commonlyUsed","title"),items:["image-uploader","codeblock","table","file-uploader","video-uploader","imgattachment","math","status"]}];class vse extends _t{constructor(){super(...arguments);y(this,"popup");y(this,"paserValue",e=>!(e.isCard()&&e.attributes("name")===Ja.cardName));y(this,"onSlash",e=>{const n=this.editor;if(!V(n))return;const{change:i}=n;let r=i.range.get();const s=n.block.closest(r.startNode),o=s.text().trim();if(o==="/"&&Vr&&s.empty(),o===""||o==="/"&&Vr||e.ctrlKey||e.metaKey){if(this.options.config===!1)return;if(r=i.range.get(),r.collapsed){e.preventDefault();const a=this.options.config||mse(n),c=n.card.insert(Ja.cardName,{},a);c.setData(a),n.card.activate(c.root),r=i.range.get();const u=c.find(".data-toolbar-component-keyword");r.select(u,!0),r.collapse(!1),i.range.select(r)}}})}static get pluginName(){return"toolbar"}init(){const e=this.editor;V(e)&&(e.on("keydown:slash",this.onSlash),e.on("parse:value",this.paserValue)),e.language.add(bp),this.options.popup&&(this.popup=new gse(e,{items:this.options.popup.items}))}execute(...e){throw new Error("Method not implemented.")}destroy(){var n;(n=this.popup)==null||n.destroy();const e=this.editor;e.off("keydown:slash",this.onSlash),e.off("parse:value",this.paserValue)}}Hr.install=l=>{l.component(Hr.name,Hr)};const bse=mt({name:"am-loading",components:{},props:{text:String,loading:Boolean}});function yse(l,t,e,n,i,r){const s=dg;return oe(),Je(s,{class:"loading",tip:l.text,loading:l.loading,size:32},{default:Be(()=>[di(l.$slots,"default")]),_:3},8,["tip","loading"])}const _se=gt(bse,[["render",yse]]),fd="keydown:backspace";class wse extends ko{constructor(){super(...arguments);y(this,"kind","block");y(this,"style",{"text-align":"@var0","list-style-position":"@var1"});y(this,"variable",{"@var0":["center","right","justify"],"@var1":["outside","inside"]});y(this,"onBackspace",e=>{const n=this.editor;if(!V(n))return;const{change:i,block:r}=n,s=i.range.get();if(r.isLastOffset(s,"end")||!r.isFirstOffset(s,"start")||i.blocks.length>1)return;const o=n.command,a=this.queryState();if(a==="center")return e.preventDefault(),o.execute(this.constructor.pluginName,"left"),!1;if(a==="right")return e.preventDefault(),o.execute(this.constructor.pluginName,"center"),!1})}static get pluginName(){return"alignment"}init(){super.init(),this.editor.on(fd,this.onBackspace)}execute(e){const n=this.editor;if(!V(n)||n.readonly)return;const{change:i,block:r}=n;r.setBlocks({style:{"text-align":!e||["left"].indexOf(e)>-1?"":e}}),i.blocks.forEach(s=>{s.name==="li"&&n.list.addAlign(s,e)})}queryState(){const e=this.editor;if(!V(e))return;const{change:n,schema:i}=e,r=n.blocks;if(r.length===0)return;let s=r[0];i.getAllowInTags().indexOf(s.name)>-1&&(s=r[1]||s.first()||s);let a=s.css("text-align");return a==="start"&&(a="left"),a==="end"&&(a="right"),a}hotkey(){var s,o,a,c;const e=((s=this.options.hotkey)==null?void 0:s.left)||"mod+shift+l",n=((o=this.options.hotkey)==null?void 0:o.center)||"mod+shift+c",i=((a=this.options.hotkey)==null?void 0:a.right)||"mod+shift+r",r=((c=this.options.hotkey)==null?void 0:c.justify)||"mod+shift+j";return[{key:e,args:"left"},{key:n,args:"center"},{key:i,args:"right"},{key:r,args:"justify"}]}destroy(){this.editor.off(fd,this.onBackspace)}}class xse extends mi{constructor(){super(...arguments);y(this,"mergeLeval",2);y(this,"tagName","span");y(this,"style",{"background-color":"@var0"});y(this,"variable",{"@var0":{required:!0,value:"@color"}})}static get pluginName(){return"backcolor"}schema(){const e=super.schema();return e.attributes.style.background="@color",e}conversion(){return[{from:(e,n)=>e===this.tagName&&!!n.background,to:(e,n,i)=>{const r=I(`<${e} />`),s=n.background;return delete n.background,n["background-color"]=s,r.css(n),Object.keys(i).forEach(o=>{r.attributes(o,i[o])}),r}}]}isTrigger(e,n){return n===void 0||e!==n}hotkey(){return this.options.hotkey||[]}}const hd="markdown-it";class kse extends mi{constructor(){super(...arguments);y(this,"tagName","strong");y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("emphasis")})}static get pluginName(){return"bold"}init(){super.init();const e=this.editor;V(e)&&e.on(hd,this.markdownIt)}hotkey(){return this.options.hotkey||"mod+b"}conversion(){return[{from:{span:{style:{"font-weight":["bold","700"]}}},to:this.tagName},{from:"b",to:this.tagName}]}destroy(){this.editor.off(hd,this.markdownIt)}}const pd="parse:html",gd="markdown-it";class Ese extends ap{constructor(){super(...arguments);y(this,"tagName","code");y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("backticks")});y(this,"parseHtml",e=>{e.find(this.tagName).css({"font-family":"monospace","font-size":"inherit","background-color":"rgba(0,0,0,.06)",padding:"0 2px","border-radius":"6px","line-height":"inherit","overflow-wrap":"break-word","text-indent":"0"})})}static get pluginName(){return"code"}init(){super.init();const e=this.editor;e.on(pd,this.parseHtml),V(e)&&e.on(gd,this.markdownIt)}hotkey(){return this.options.hotkey||"mod+e"}destroy(){const e=this.editor;e.off(pd,this.parseHtml),e.off(gd,this.markdownIt)}}class Cse extends mi{constructor(){super(...arguments);y(this,"mergeLeval",3);y(this,"tagName","span");y(this,"style",{color:"@var0"});y(this,"variable",{"@var0":{required:!0,value:"@color"}})}static get pluginName(){return"fontcolor"}isTrigger(e,n){return n===void 0||e!==n}hotkey(){return this.options.hotkey||[]}}const md="paste:each";var ri;class wp extends mi{constructor(){super(...arguments);y(this,"tagName","span");rt(this,ri,"font-family");y(this,"style",{[ie(this,ri)]:"@var0"});y(this,"variable",{"@var0":{required:!0,value:"*"}});y(this,"pasteEach",e=>{if(e.name===this.tagName){const i=e.css()[ie(this,ri)];if(!i)return;const{filter:r}=this.options;if(r){const o=r(i);o===!1?e.css(ie(this,ri),""):typeof o=="string"&&e.css(ie(this,ri),o)}else e.css(ie(this,ri),"");const s=this.editor.node;s.isMark(e)||s.unwrap(e)}})}static get pluginName(){return"fontfamily"}init(){super.init();const e=this.editor;V(e)&&e.on(md,this.pasteEach)}isTrigger(e){return this.queryState()?!!e:!0}execute(e){const n=this.editor;if(!V(n))return;const{change:i,mark:r}=n,s=I(`<${this.tagName} />`),o=this.queryState();if(e&&(!o||e!==o[0])){if(this.setStyle(s,e),!this.followStyle&&i.range.get().collapsed)return;r.wrap(s);return}o&&(this.setStyle(s,o[0]),r.unwrap(s))}hotkey(){return this.options.hotkey||[]}destroy(){const e=this.editor;V(e)&&e.off(md,this.pasteEach)}}ri=new WeakMap;const vd="paste:each";var si;class xp extends mi{constructor(){super(...arguments);y(this,"mergeLeval",4);y(this,"tagName","span");y(this,"style",{"font-size":"@var0"});y(this,"variable",{"@var0":{required:!0,value:/[\d\.]+(pt|px)$/}});rt(this,si,"font-size");y(this,"defaultSize",this.options.defaultSize||this.editor.container.css("font-size")||"14px");y(this,"pasteEach",e=>{if(e.name===this.tagName){const n=e.css(ie(this,si));if(!n)return;const i=this.convertToPX(n);if(n.endsWith("pt")&&e.css(ie(this,si),i),i!==this.defaultSize){const{filter:r}=this.options;if(r){const o=r(i);o===!1?e.css(ie(this,si),""):typeof o=="string"&&e.css(ie(this,si),o)}else e.css(ie(this,si),"");const s=this.editor.node;s.isMark(e)||s.unwrap(e)}}})}static get pluginName(){return"fontsize"}init(){super.init();const e=this.editor;V(e)&&e.on(vd,this.pasteEach),this.options.defaultSize&&e.container.css("font-size",this.defaultSize)}isTrigger(e,n=this.defaultSize){return e!==n}hotkey(){return this.options.hotkey||[]}convertToPX(e){const n=/([\d\.]+)(pt|px)$/i.exec(e);return n&&n[2]==="pt"?String(Math.round(parseInt(n[1],10)*96/72))+"px":e}destroy(){const e=this.editor;V(e)&&e.off(vd,this.pasteEach)}}si=new WeakMap;class Sse extends Fl{constructor(){super(...arguments);y(this,"attributes",{id:"@var0"});y(this,"variable",{"@var0":/^[\w\.\-]+$/});y(this,"tagName",["h1","h2","h3","h4","h5","h6"].filter(e=>!this.options.enableTypes||this.options.enableTypes.indexOf(e)>-1));y(this,"allowIn",["blockquote","$root"]);y(this,"disableMark",this.options.disableMark||["fontsize","bold"]);y(this,"closureRef",{current:{block:null}});y(this,"onRender",e=>{const n=this.editor,{language:i}=n,r=I(e);this.tagName.length!==0&&r.find(this.tagName.join(",")).each(s=>{const o=I(s),a=o.attributes("id");if(a){o.find(".data-anchor-button").remove(),Ue.hide();const c=I(`<a class="data-anchor-button" ${le}="${Qe}"><span class="data-icon data-icon-${o.name}"></span></a>`);o.height()!==24&&c.css({top:(o.height()-24)/2+"px"}),c.on("mouseenter",()=>{Ue.show(c,i.get("copyAnchor","title").toString())}),c.on("mouseleave",()=>{Ue.hide()}),c.on("click",u=>{u.preventDefault(),u.stopPropagation();const d=this.options.anchorCopy?this.options.anchorCopy(a):window.location.href+"/"+a;n.clipboard.copy(d)?n.messageSuccess("copy",i.get("copy","success").toString()):n.messageError("copy",i.get("copy","error").toString())}),o.prepend(c)}})});y(this,"updateId",()=>{this.tagName.length!==0&&this.editor.container.find(this.tagName.join(",")).each(e=>{var r;const n=I(e);if(!((r=n.parent())!=null&&r.isEditable())){n.removeAttributes("id");return}let i=n.attributes("id");(!i||I(`[id="${i}"]`).length>1)&&(i=n.attributes(we)||kl(n),n.attributes("id",i))})});y(this,"realtimeChange",()=>{this.updateId(),this.showAnchor()});y(this,"updateAnchorPosition",()=>{var h;const e=this.editor;if(!V(e))return;const{change:n,root:i}=e,r=i.find(".data-anchor-button");if(r.length===0)return;const o=n.range.get().startNode.closest("h1,h2,h3,h4,h5,h6");if(o.length===0){r.remove(),Ue.hide();return}const a=((h=i.get())==null?void 0:h.getBoundingClientRect())||{left:0,top:0},c=o.get().getBoundingClientRect(),u=Math.round(c.left-a.left-r.get().clientWidth-1),d=Math.round(c.top-a.top+c.height/2-r.get().clientHeight/2);r.css({top:`${d}px`,left:`${u}px`})});y(this,"showAnchor",()=>{var g,m;const e=this.editor;if(!V(e)||this.tagName.length===0||this.options.showAnchor===!1)return;const{change:n,root:i,clipboard:r,language:s,card:o}=e,a=n.range.get();let c=i.find(".data-anchor-button");const u=a.startNode.closest(this.tagName.join(","));if(this.closureRef.current.block=u,(u.length===0||c.length>0&&c.find(".data-icon-".concat(u.name)).length===0||!e.isFocus())&&(c.remove(),Ue.hide()),u.length===0||o.closest(u,!0)||!e.isFocus()||!((g=u.parent())!=null&&g.isEditable()))return;if(c.find(".data-icon-".concat(u.name)).length>0){this.updateAnchorPosition();return}c=I(`<span class="data-anchor-button" ${le}="${Qe}"><span class="data-icon data-icon-${u.name}"></span></span>`),i.append(c);const d=((m=i.get())==null?void 0:m.getBoundingClientRect())||{left:0,top:0},h=u.get().getBoundingClientRect(),f=Math.round(h.left-d.left-c.get().clientWidth-1),p=Math.round(h.top-d.top+h.height/2-c.get().clientHeight/2);c.css({top:`${p}px`,left:`${f}px`}),c.addClass("data-anchor-button-active"),c.on("mouseenter",()=>{Ue.show(c,s.get("copyAnchor","title").toString())}),c.on("mouseleave",()=>{Ue.hide()}),c.on("click",v=>{if(v.preventDefault(),v.stopPropagation(),!this.closureRef.current.block)return;const b=this.closureRef.current.block.attributes("id"),_=this.options.anchorCopy?this.options.anchorCopy(b):window.location.href+"/"+b;r.copy(_)?e.messageSuccess("copy",s.get("copy","success").toString()):e.messageError("copy",s.get("copy","error").toString())})});y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("heading")});y(this,"onBackspace",e=>{var u;const n=this.editor;if(!V(n))return;const{change:i,node:r}=n,s=i.range.get();if(!s.collapsed)return;const o=n.block;if(!o.isFirstOffset(s,"start"))return;const a=o.closest(s.startNode);if(this.tagName.indexOf(a.name)>-1&&r.isEmptyWithTrim(a)&&((u=a.parent())==null?void 0:u.isEditable()))return e.preventDefault(),o.setBlocks("<p />"),!1;const c=a.parent();if(this.tagName.indexOf(a.name)>-1&&(!c||!r.isBlock(c)))return e.preventDefault(),i.mergeAfterDelete(a),!1})}static get pluginName(){return"heading"}init(){super.init();const e=this.editor;if(V(e))e.on("keydown:backspace",this.onBackspace),e.on("markdown-it",this.markdownIt),e.on("setValue",this.updateId),e.on("realtimeChange",this.realtimeChange),e.on("select",this.showAnchor),e.on("blur",this.showAnchor),window.addEventListener("resize",this.updateAnchorPosition);else{if(this.options.showAnchor===!1)return;e.on("render",this.onRender)}}execute(e){const n=this.editor;if(!V(n))return;(!e||e===this.queryState())&&(e="p");const{enableTypes:i}=this.options;if(e!=="p"&&i&&i.indexOf(e)<0)return;const{list:r,block:s}=n;r.split(),s.setBlocks(`<${e} />`)}queryState(){const e=this.editor;if(!V(e))return;const{change:n}=e,i=n.blocks;return i.length===0?"":this.tagName.find(s=>i.some(o=>o.name===s))||""}hotkey(){var c,u,d,h,f,p;const e=((c=this.options.hotkey)==null?void 0:c.h1)||"mod+opt+1",n=((u=this.options.hotkey)==null?void 0:u.h2)||"mod+opt+2",i=((d=this.options.hotkey)==null?void 0:d.h3)||"mod+opt+3",r=((h=this.options.hotkey)==null?void 0:h.h4)||"mod+opt+4",s=((f=this.options.hotkey)==null?void 0:f.h5)||"mod+opt+5",o=((p=this.options.hotkey)==null?void 0:p.h6)||"mod+opt+6",{enableTypes:a}=this.options;return[{key:e,args:"h1"},{key:n,args:"h2"},{key:i,args:"h3"},{key:r,args:"h4"},{key:s,args:"h5"},{key:o,args:"h6"}].filter(g=>!a||a.indexOf(g.key)>-1)}destroy(){const e=this.editor;V(e)?(e.off("keydown:backspace",this.onBackspace),e.off("markdown-it",this.markdownIt),e.off("setValue",this.updateId),e.off("realtimeChange",this.realtimeChange),e.off("select",this.showAnchor),e.off("blur",this.showAnchor),window.removeEventListener("resize",this.updateAnchorPosition)):e.off("render",this.onRender)}}const bt="text-indent",bd="keydown:backspace",yd="keydown:tab",_d="keydown:shift-tab",wd="paste:each";class Ase extends _t{constructor(){super(...arguments);y(this,"onBackspace",e=>{const n=this.editor;if(!V(n))return;const{change:i,list:r,node:s}=n,o=n.block;let a=i.range.get();const c=o.closest(a.startNode);if(!s.isBlock(c))return;const u=c.parent();let d=i.blocks;if(u&&s.isBlock(u)&&(d=d.filter(h=>!h.equal(u))),c.name==="li"){if(a.collapsed&&!r.isFirst(a))return;if(!a.collapsed)return}else{if((a.collapsed&&o.isLastOffset(a,"end")||!o.isFirstOffset(a,"start"))&&!s.isEmptyWidthChild(c)||d.length>1)return;if(!a.collapsed)return}if(this.queryState())return e.preventDefault(),n.command.execute(this.constructor.pluginName,"out"),!1});y(this,"onTab",e=>{const n=this.editor;if(!V(n))return;const{change:i,list:r,block:s}=n,o=i.range.get();if(o.collapsed&&r.isFirst(o))return e.preventDefault(),n.command.execute(this.constructor.pluginName,"in"),!1;if(!o.collapsed||s.isFirstOffset(o,"start"))return e.preventDefault(),n.command.execute(this.constructor.pluginName,"in",!0),!1});y(this,"onShiftTab",e=>{const n=this.editor;if(!!V(n))return e.preventDefault(),n.command.execute(this.constructor.pluginName,"out"),!1});y(this,"pasteEach",e=>{const n=this.editor;if(e.isElement()&&!e.isCard()&&n.node.isBlock(e)){const r=e.css()[bt];if(!!r&&r.endsWith("pt")){const s=this.convertToPX(r);if(s){const o=this.options.maxPadding||50;let a=Ee(s),c=e.width();c=c===0?n.root.width():c;let u=e.css("font-size");u=!u||u.endsWith("em")?n.root.css("font-size"):u,u.endsWith("em")&&(u=I(document.body).css("font-size")),u.endsWith("px")||(u="16px");const d=c>0?c/Ee(u):o;a=Math.min(s.endsWith("px")?a/Ee(u):a,o,d),a<=0?e.css(bt,""):e.css(bt,ga(a>0?a:0,"em"))}}}})}static get pluginName(){return"indent"}init(){const e=this.editor;e.schema.add(this.schema()),this.conversion().forEach(({from:n,to:i})=>{e.conversion.add(n,i)}),e.on(bd,this.onBackspace),e.on(yd,this.onTab),e.on(_d,this.onShiftTab),V(e)&&e.on(wd,this.pasteEach)}execute(e="in"){const n=this.editor;if(!V(n))return;const{change:i,list:r,block:s}=n;r.split();const o=i.range.get(),a=s.findBlocks(o);if(!a)return;const c=this.options.maxPadding||50;a.forEach(u=>{this.addPadding(u,e==="in"?2:-2,c)}),r.merge()}queryState(){const e=this.editor;if(!V(e))return;const{change:n,list:i,node:r}=e,s=n.range.get();if(!s.startNode.inEditor())return 0;const o=e.block.closest(s.startNode);return o.name==="li"?i.getIndent(o.closest("ul,ol")):r.isRootBlock(o)||r.isNestedBlock(o)?Ee(o.css(bt)):0}addPadding(e,n,i){const r=this.editor,{list:s,node:o}=r;if(e.name!=="li"){if(o.isList(e))s.addIndent(e,n,i);else if(o.isRootBlock(e)||o.isNestedBlock(e))if(n>0)if(Ee(e.css(bt))){const a=e.css(bt);let c=Ee(a)+n,u=e.width();u=u===0?r.root.width():u;let d=e.css("font-size");d=!d||d.endsWith("em")?r.root.css("font-size"):d,d.endsWith("em")&&(d=I(document.body).css("font-size")),d.endsWith("px")||(d="16px");const h=u>0?u/Ee(d):i;c=Math.min(a.endsWith("px")?c/Ee(d):c,i,h),c<=0?e.css(bt,""):e.css(bt,ga(c>0?c:0,"em"))}else e.css(bt,`${n}em`);else{const a=e.css(bt),c=Ee(a)+n;c<=0?e.css(bt,""):e.css(bt,ga(c>0?c:0,"em"))}}}hotkey(){var i,r;const e=((i=this.options.hotkey)==null?void 0:i.in)||"mod+]",n=((r=this.options.hotkey)==null?void 0:r.out)||"mod+[";return[{key:e,args:"in"},{key:n,args:"out"}]}schema(){return{type:"block",attributes:{style:{[bt]:"@length"}}}}conversion(){return[{from:(e,n,i)=>!!n["padding-left"]||!!i[bt],to:(e,n,i)=>{const r=I(`<${e} />`);let s=n["padding-left"]||i[bt];if(s.endsWith("pt")&&(s=this.convertToPX(s)),s.endsWith("px")){let o=n["font-size"];o=!o||o.endsWith("em")?this.editor.root.css("font-size"):o,o.endsWith("em")&&(o=I(document.body).css("font-size")),o.endsWith("px")||(o="16px");const a=Ee(s)/Ee(o);n[bt]=`${a}em`}else s.endsWith("em")&&(n[bt]=s);return delete n["padding-left"],delete i[bt],r.css(n),Object.keys(i).forEach(o=>{r.attributes(o,i[o])}),r}}]}convertToPX(e){const n=/([\d\.]+)(pt|px)$/i.exec(e);return n&&n[2]==="pt"?String(Math.round(parseInt(n[1],10)*96/72))+"px":e}destroy(){const e=this.editor;e.off(bd,this.onBackspace),e.off(yd,this.onTab),e.off(_d,this.onShiftTab),V(e)&&e.off(wd,this.pasteEach)}}const xd="markdown-it";class kp extends mi{constructor(){super(...arguments);y(this,"tagName","em");y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("emphasis")})}static get pluginName(){return"italic"}init(){super.init();const e=this.editor;V(e)&&e.on(xd,this.markdownIt)}hotkey(){return this.options.hotkey||"mod+i"}conversion(){return[{from:{span:{style:{"font-style":"italic"}}},to:this.tagName},{from:"i",to:this.tagName}]}destroy(){this.editor.off(xd,this.markdownIt)}}var Ep={exports:{}};/*! PhotoSwipe - v4.1.3 - 2019-01-08
* http://photoswipe.com
* Copyright (c) 2019 Dmitry Semenov; */(function(l,t){(function(e,n){l.exports=n()})(is,function(){var e=function(n,i,r,s){var o={features:null,bind:function(N,H,U,j){var ne=(j?"remove":"add")+"EventListener";H=H.split(" ");for(var re=0;re<H.length;re++)H[re]&&N[ne](H[re],U,!1)},isArray:function(N){return N instanceof Array},createEl:function(N,H){var U=document.createElement(H||"div");return N&&(U.className=N),U},getScrollY:function(){var N=window.pageYOffset;return N!==void 0?N:document.documentElement.scrollTop},unbind:function(N,H,U){o.bind(N,H,U,!0)},removeClass:function(N,H){var U=new RegExp("(\\s|^)"+H+"(\\s|$)");N.className=N.className.replace(U," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(N,H){o.hasClass(N,H)||(N.className+=(N.className?" ":"")+H)},hasClass:function(N,H){return N.className&&new RegExp("(^|\\s)"+H+"(\\s|$)").test(N.className)},getChildByClass:function(N,H){for(var U=N.firstChild;U;){if(o.hasClass(U,H))return U;U=U.nextSibling}},arraySearch:function(N,H,U){for(var j=N.length;j--;)if(N[j][U]===H)return j;return-1},extend:function(N,H,U){for(var j in H)if(H.hasOwnProperty(j)){if(U&&N.hasOwnProperty(j))continue;N[j]=H[j]}},easing:{sine:{out:function(N){return Math.sin(N*(Math.PI/2))},inOut:function(N){return-(Math.cos(Math.PI*N)-1)/2}},cubic:{out:function(N){return--N*N*N+1}}},detectFeatures:function(){if(o.features)return o.features;var N=o.createEl(),H=N.style,U="",j={};if(j.oldIE=document.all&&!document.addEventListener,j.touch="ontouchstart"in window,window.requestAnimationFrame&&(j.raf=window.requestAnimationFrame,j.caf=window.cancelAnimationFrame),j.pointerEvent=!!window.PointerEvent||navigator.msPointerEnabled,!j.pointerEvent){var ne=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var re=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);re&&re.length>0&&(re=parseInt(re[1],10),re>=1&&re<8&&(j.isOldIOSPhone=!0))}var ye=ne.match(/Android\s([0-9\.]*)/),Oe=ye?ye[1]:0;Oe=parseFloat(Oe),Oe>=1&&(Oe<4.4&&(j.isOldAndroid=!0),j.androidVersion=Oe),j.isMobileOpera=/opera mini|opera mobi/i.test(ne)}for(var Ae=["transform","perspective","animationName"],Pe=["","webkit","Moz","ms","O"],vt,gn,Fn=0;Fn<4;Fn++){U=Pe[Fn];for(var Ki=0;Ki<3;Ki++)vt=Ae[Ki],gn=U+(U?vt.charAt(0).toUpperCase()+vt.slice(1):vt),!j[vt]&&gn in H&&(j[vt]=gn);U&&!j.raf&&(U=U.toLowerCase(),j.raf=window[U+"RequestAnimationFrame"],j.raf&&(j.caf=window[U+"CancelAnimationFrame"]||window[U+"CancelRequestAnimationFrame"]))}if(!j.raf){var Tr=0;j.raf=function(mn){var Xo=new Date().getTime(),Yo=Math.max(0,16-(Xo-Tr)),ig=window.setTimeout(function(){mn(Xo+Yo)},Yo);return Tr=Xo+Yo,ig},j.caf=function(mn){clearTimeout(mn)}}return j.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,o.features=j,j}};o.detectFeatures(),o.features.oldIE&&(o.bind=function(N,H,U,j){H=H.split(" ");for(var ne=(j?"detach":"attach")+"Event",re,ye=function(){U.handleEvent.call(U)},Oe=0;Oe<H.length;Oe++)if(re=H[Oe],re)if(typeof U=="object"&&U.handleEvent){if(!j)U["oldIE"+re]=ye;else if(!U["oldIE"+re])return!1;N[ne]("on"+re,U["oldIE"+re])}else N[ne]("on"+re,U)});var a=this,c=25,u=3,d={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(N){return N.tagName==="A"},getDoubleTapZoom:function(N,H){return N||H.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};o.extend(d,s);var h=function(){return{x:0,y:0}},f,p,g,m,v,b,_=h(),x=h(),w=h(),E,S,R,D={},P,O,L,B,A,F,W=0,G={},k=h(),C,$,z=0,M,T,K,ee,Y,q,Z=!0,te,se=[],fe,J,X,ae,_e,Me,ge,$e={},qe=!1,Ye,wt=function(N,H){o.extend(a,H.publicMethods),se.push(N)},Rt=function(N){var H=zt();return N>H-1?N-H:N<0?H+N:N},Ln={},tt=function(N,H){return Ln[N]||(Ln[N]=[]),Ln[N].push(H)},Le=function(N){var H=Ln[N];if(H){var U=Array.prototype.slice.call(arguments);U.shift();for(var j=0;j<H.length;j++)H[j].apply(a,U)}},he=function(){return new Date().getTime()},ve=function(N){ps=N,a.bg.style.opacity=N*d.bgOpacity},me=function(N,H,U,j,ne){(!qe||ne&&ne!==a.currItem)&&(j=j/(ne?ne.fitRatio:a.currItem.fitRatio)),N[Y]=L+H+"px, "+U+"px"+B+" scale("+j+")"},Ce=function(N){hn&&(N&&(P>a.currItem.fitRatio?qe||(ki(a.currItem,!1,!0),qe=!0):qe&&(ki(a.currItem),qe=!1)),me(hn,w.x,w.y,P))},et=function(N){N.container&&me(N.container.style,N.initialPosition.x,N.initialPosition.y,N.initialZoomLevel,N)},Vt=function(N,H){H[Y]=L+N+"px, 0px"+B},qi=function(N,H){if(!d.loop&&H){var U=m+(k.x*W-N)/k.x,j=Math.round(N-On.x);(U<0&&j>0||U>=zt()-1&&j<0)&&(N=On.x+j*d.mainScrollEndFriction)}On.x=N,Vt(N,v)},Ao=function(N,H){var U=Er[N]-G[N];return x[N]+_[N]+U-U*(H/O)},Mt=function(N,H){N.x=H.x,N.y=H.y,H.id&&(N.id=H.id)},Ul=function(N){N.x=Math.round(N.x),N.y=Math.round(N.y)},To=null,No=function(){To&&(o.unbind(document,"mousemove",No),o.addClass(n,"pswp--has_mouse"),d.mouseUsed=!0,Le("mouseUsed")),To=setTimeout(function(){To=null},100)},Ip=function(){o.bind(document,"keydown",a),ge.transform&&o.bind(a.scrollWrap,"click",a),d.mouseUsed||o.bind(document,"mousemove",No),o.bind(window,"resize scroll orientationchange",a),Le("bindEvents")},Op=function(){o.unbind(window,"resize scroll orientationchange",a),o.unbind(window,"scroll",R.scroll),o.unbind(document,"keydown",a),o.unbind(document,"mousemove",No),ge.transform&&o.unbind(a.scrollWrap,"click",a),fn&&o.unbind(window,E,a),clearTimeout(Ye),Le("unbindEvents")},Do=function(N,H){var U=Sr(a.currItem,D,N);return H&&(De=U),U},jl=function(N){return N||(N=a.currItem),N.initialZoomLevel},Vl=function(N){return N||(N=a.currItem),N.w>0?d.maxSpreadZoom:1},Gl=function(N,H,U,j){return j===a.currItem.initialZoomLevel?(U[N]=a.currItem.initialPosition[N],!0):(U[N]=Ao(N,j),U[N]>H.min[N]?(U[N]=H.min[N],!0):U[N]<H.max[N]?(U[N]=H.max[N],!0):!1)},Fp=function(){if(Y){var N=ge.perspective&&!te;L="translate"+(N?"3d(":"("),B=ge.perspective?", 0px)":")";return}Y="left",o.addClass(n,"pswp--ie"),Vt=function(H,U){U.left=H+"px"},et=function(H){var U=H.fitRatio>1?1:H.fitRatio,j=H.container.style,ne=U*H.w,re=U*H.h;j.width=ne+"px",j.height=re+"px",j.left=H.initialPosition.x+"px",j.top=H.initialPosition.y+"px"},Ce=function(){if(hn){var H=hn,U=a.currItem,j=U.fitRatio>1?1:U.fitRatio,ne=j*U.w,re=j*U.h;H.width=ne+"px",H.height=re+"px",H.left=w.x+"px",H.top=w.y+"px"}}},Bp=function(N){var H="";d.escKey&&N.keyCode===27?H="close":d.arrowKeys&&(N.keyCode===37?H="prev":N.keyCode===39&&(H="next")),H&&!N.ctrlKey&&!N.altKey&&!N.shiftKey&&!N.metaKey&&(N.preventDefault?N.preventDefault():N.returnValue=!1,a[H]())},$p=function(N){!N||(ji||_i||Ft||xr)&&(N.preventDefault(),N.stopPropagation())},Zl=function(){a.setScrollOffset(0,o.getScrollY())},Pt={},Hi=0,br=function(N){Pt[N]&&(Pt[N].raf&&J(Pt[N].raf),Hi--,delete Pt[N])},Ro=function(N){Pt[N]&&br(N),Pt[N]||(Hi++,Pt[N]={})},yr=function(){for(var N in Pt)Pt.hasOwnProperty(N)&&br(N)},_r=function(N,H,U,j,ne,re,ye){var Oe=he(),Ae;Ro(N);var Pe=function(){if(Pt[N]){if(Ae=he()-Oe,Ae>=j){br(N),re(U),ye&&ye();return}re((U-H)*ne(Ae/j)+H),Pt[N].raf=fe(Pe)}};Pe()},Pp={shout:Le,listen:tt,viewportSize:D,options:d,isMainScrollAnimating:function(){return Ft},getZoomLevel:function(){return P},getCurrentIndex:function(){return m},isDragging:function(){return fn},isZooming:function(){return In},setScrollOffset:function(N,H){G.x=N,Me=G.y=H,Le("updateScrollOffset",G)},applyZoomPan:function(N,H,U,j){w.x=H,w.y=U,P=N,Ce(j)},init:function(){if(!(f||p)){var N;a.framework=o,a.template=n,a.bg=o.getChildByClass(n,"pswp__bg"),X=n.className,f=!0,ge=o.detectFeatures(),fe=ge.raf,J=ge.caf,Y=ge.transform,_e=ge.oldIE,a.scrollWrap=o.getChildByClass(n,"pswp__scroll-wrap"),a.container=o.getChildByClass(a.scrollWrap,"pswp__container"),v=a.container.style,a.itemHolders=C=[{el:a.container.children[0],wrap:0,index:-1},{el:a.container.children[1],wrap:0,index:-1},{el:a.container.children[2],wrap:0,index:-1}],C[0].el.style.display=C[2].el.style.display="none",Fp(),R={resize:a.updateSize,orientationchange:function(){clearTimeout(Ye),Ye=setTimeout(function(){D.x!==a.scrollWrap.clientWidth&&a.updateSize()},500)},scroll:Zl,keydown:Bp,click:$p};var H=ge.isOldIOSPhone||ge.isOldAndroid||ge.isMobileOpera;for((!ge.animationName||!ge.transform||H)&&(d.showAnimationDuration=d.hideAnimationDuration=0),N=0;N<se.length;N++)a["init"+se[N]]();if(i){var U=a.ui=new i(a,o);U.init()}Le("firstUpdate"),m=m||d.index||0,(isNaN(m)||m<0||m>=zt())&&(m=0),a.currItem=Xn(m),(ge.isOldIOSPhone||ge.isOldAndroid)&&(Z=!1),n.setAttribute("aria-hidden","false"),d.modal&&(Z?n.style.position="fixed":(n.style.position="absolute",n.style.top=o.getScrollY()+"px")),Me===void 0&&(Le("initialLayout"),Me=ae=o.getScrollY());var j="pswp--open ";for(d.mainClass&&(j+=d.mainClass+" "),d.showHideOpacity&&(j+="pswp--animate_opacity "),j+=te?"pswp--touch":"pswp--notouch",j+=ge.animationName?" pswp--css_animation":"",j+=ge.svg?" pswp--svg":"",o.addClass(n,j),a.updateSize(),b=-1,z=null,N=0;N<u;N++)Vt((N+b)*k.x,C[N].el.style);_e||o.bind(a.scrollWrap,S,a),tt("initialZoomInEnd",function(){a.setContent(C[0],m-1),a.setContent(C[2],m+1),C[0].el.style.display=C[2].el.style.display="block",d.focus&&n.focus(),Ip()}),a.setContent(C[1],m),a.updateCurrItem(),Le("afterInit"),Z||(A=setInterval(function(){!Hi&&!fn&&!In&&P===a.currItem.initialZoomLevel&&a.updateSize()},1e3)),o.addClass(n,"pswp--visible")}},close:function(){!f||(f=!1,p=!0,Le("close"),Op(),oc(a.currItem,null,!0,a.destroy))},destroy:function(){Le("destroy"),wi&&clearTimeout(wi),n.setAttribute("aria-hidden","true"),n.className=X,A&&clearInterval(A),o.unbind(a.scrollWrap,S,a),o.unbind(window,"scroll",a),Bo(),yr(),Ln=null},panTo:function(N,H,U){U||(N>De.min.x?N=De.min.x:N<De.max.x&&(N=De.max.x),H>De.min.y?H=De.min.y:H<De.max.y&&(H=De.max.y)),w.x=N,w.y=H,Ce()},handleEvent:function(N){N=N||window.event,R[N.type]&&R[N.type](N)},goTo:function(N){N=Rt(N);var H=N-m;z=H,m=N,a.currItem=Xn(m),W-=H,qi(k.x*W),yr(),Ft=!1,a.updateCurrItem()},next:function(){a.goTo(m+1)},prev:function(){a.goTo(m-1)},updateCurrZoomItem:function(N){if(N&&Le("beforeChange",0),C[1].el.children.length){var H=C[1].el.children[0];o.hasClass(H,"pswp__zoom-wrap")?hn=H.style:hn=null}else hn=null;De=a.currItem.bounds,O=P=a.currItem.initialZoomLevel,w.x=De.center.x,w.y=De.center.y,N&&Le("afterChange")},invalidateCurrItems:function(){F=!0;for(var N=0;N<u;N++)C[N].item&&(C[N].item.needsUpdate=!0)},updateCurrItem:function(N){if(z!==0){var H=Math.abs(z),U;if(!(N&&H<2)){a.currItem=Xn(m),qe=!1,Le("beforeChange",z),H>=u&&(b+=z+(z>0?-u:u),H=u);for(var j=0;j<H;j++)z>0?(U=C.shift(),C[u-1]=U,b++,Vt((b+2)*k.x,U.el.style),a.setContent(U,m-H+j+1+1)):(U=C.pop(),C.unshift(U),b--,Vt(b*k.x,U.el.style),a.setContent(U,m+H-j-1-1));if(hn&&Math.abs(z)===1){var ne=Xn($);ne.initialZoomLevel!==P&&(Sr(ne,D),ki(ne),et(ne))}z=0,a.updateCurrZoomItem(),$=m,Le("afterChange")}}},updateSize:function(N){if(!Z&&d.modal){var H=o.getScrollY();if(Me!==H&&(n.style.top=H+"px",Me=H),!N&&$e.x===window.innerWidth&&$e.y===window.innerHeight)return;$e.x=window.innerWidth,$e.y=window.innerHeight,n.style.height=$e.y+"px"}if(D.x=a.scrollWrap.clientWidth,D.y=a.scrollWrap.clientHeight,Zl(),k.x=D.x+Math.round(D.x*d.spacing),k.y=D.y,qi(k.x*W),Le("beforeResize"),b!==void 0){for(var U,j,ne,re=0;re<u;re++)U=C[re],Vt((re+b)*k.x,U.el.style),ne=m+re-1,d.loop&&zt()>2&&(ne=Rt(ne)),j=Xn(ne),j&&(F||j.needsUpdate||!j.bounds)?(a.cleanSlide(j),a.setContent(U,ne),re===1&&(a.currItem=j,a.updateCurrZoomItem(!0)),j.needsUpdate=!1):U.index===-1&&ne>=0&&a.setContent(U,ne),j&&j.container&&(Sr(j,D),ki(j),et(j));F=!1}O=P=a.currItem.initialZoomLevel,De=a.currItem.bounds,De&&(w.x=De.center.x,w.y=De.center.y,Ce(!0)),Le("resize")},zoomTo:function(N,H,U,j,ne){H&&(O=P,Er.x=Math.abs(H.x)-w.x,Er.y=Math.abs(H.y)-w.y,Mt(x,w));var re=Do(N,!1),ye={};Gl("x",re,ye,N),Gl("y",re,ye,N);var Oe=P,Ae={x:w.x,y:w.y};Ul(ye);var Pe=function(vt){vt===1?(P=N,w.x=ye.x,w.y=ye.y):(P=(N-Oe)*vt+Oe,w.x=(ye.x-Ae.x)*vt+Ae.x,w.y=(ye.y-Ae.y)*vt+Ae.y),ne&&ne(vt),Ce(vt===1)};U?_r("customZoomTo",0,1,U,j||o.easing.sine.inOut,Pe):Pe(1)}},Kl=30,Mo=10,Xl,cs,Lt={},vi={},It={},Ot={},Wi={},jn=[],bi={},wr,yi=[],Ui={},Lo,xr,kr,us=0,ds=h(),Io=0,fn,Oo,_i,ji,fs,Vn,Gt,In,Yl,De,On=h(),hn,Ft,Er=h(),Vi=h(),Gn,Fo,hs,ps,gs,zp=function(N,H){return N.x===H.x&&N.y===H.y},qp=function(N,H){return Math.abs(N.x-H.x)<c&&Math.abs(N.y-H.y)<c},Jl=function(N,H){return Ui.x=Math.abs(N.x-H.x),Ui.y=Math.abs(N.y-H.y),Math.sqrt(Ui.x*Ui.x+Ui.y*Ui.y)},Bo=function(){fs&&(J(fs),fs=null)},Ql=function(){fn&&(fs=fe(Ql),Gp())},Hp=function(){return!(d.scaleMode==="fit"&&P===a.currItem.initialZoomLevel)},ec=function(N,H){return!N||N===document||N.getAttribute("class")&&N.getAttribute("class").indexOf("pswp__scroll-wrap")>-1?!1:H(N)?N:ec(N.parentNode,H)},$o={},tc=function(N,H){return $o.prevent=!ec(N.target,d.isClickableElement),Le("preventDragEvent",N,H,$o),$o.prevent},nc=function(N,H){return H.x=N.pageX,H.y=N.pageY,H.id=N.identifier,H},ic=function(N,H,U){U.x=(N.x+H.x)*.5,U.y=(N.y+H.y)*.5},Wp=function(N,H,U){if(N-cs>50){var j=yi.length>2?yi.shift():{};j.x=H,j.y=U,yi.push(j),cs=N}},rc=function(){var N=w.y-a.currItem.initialPosition.y;return 1-Math.abs(N/(D.y/2))},Cr={},Up={},Zn=[],ms,Po=function(N){for(;Zn.length>0;)Zn.pop();return q?(ms=0,jn.forEach(function(H){ms===0?Zn[0]=H:ms===1&&(Zn[1]=H),ms++})):N.type.indexOf("touch")>-1?N.touches&&N.touches.length>0&&(Zn[0]=nc(N.touches[0],Cr),N.touches.length>1&&(Zn[1]=nc(N.touches[1],Up))):(Cr.x=N.pageX,Cr.y=N.pageY,Cr.id="",Zn[0]=Cr),Zn},sc=function(N,H){var U,j=w[N]+H[N],ne,re=H[N]>0,ye=On.x+H.x,Oe=On.x-bi.x,Ae,Pe;if(j>De.min[N]||j<De.max[N]?U=d.panEndFriction:U=1,j=w[N]+H[N]*U,(d.allowPanToNext||P===a.currItem.initialZoomLevel)&&(hn?Gn==="h"&&N==="x"&&!_i&&(re?(j>De.min[N]&&(U=d.panEndFriction,De.min[N]-j,ne=De.min[N]-x[N]),(ne<=0||Oe<0)&&zt()>1?(Pe=ye,Oe<0&&ye>bi.x&&(Pe=bi.x)):De.min.x!==De.max.x&&(Ae=j)):(j<De.max[N]&&(U=d.panEndFriction,j-De.max[N],ne=x[N]-De.max[N]),(ne<=0||Oe>0)&&zt()>1?(Pe=ye,Oe>0&&ye<bi.x&&(Pe=bi.x)):De.min.x!==De.max.x&&(Ae=j))):Pe=ye,N==="x"))return Pe!==void 0&&(qi(Pe,!0),Pe===bi.x?Vn=!1:Vn=!0),De.min.x!==De.max.x&&(Ae!==void 0?w.x=Ae:Vn||(w.x+=H.x*U)),Pe!==void 0;Ft||Vn||P>a.currItem.fitRatio&&(w[N]+=H[N]*U)},jp=function(N){if(!(N.type==="mousedown"&&N.button>0)){if(Gi){N.preventDefault();return}if(!(kr&&N.type==="mousedown")){if(tc(N,!0)&&N.preventDefault(),Le("pointerDown"),q){var H=o.arraySearch(jn,N.pointerId,"id");H<0&&(H=jn.length),jn[H]={x:N.pageX,y:N.pageY,id:N.pointerId}}var U=Po(N),j=U.length;Gt=null,yr(),(!fn||j===1)&&(fn=Fo=!0,o.bind(window,E,a),Lo=gs=hs=xr=Vn=ji=Oo=_i=!1,Gn=null,Le("firstTouchStart",U),Mt(x,w),_.x=_.y=0,Mt(Ot,U[0]),Mt(Wi,Ot),bi.x=k.x*W,yi=[{x:Ot.x,y:Ot.y}],cs=Xl=he(),Do(P,!0),Bo(),Ql()),!In&&j>1&&!Ft&&!Vn&&(O=P,_i=!1,In=Oo=!0,_.y=_.x=0,Mt(x,w),Mt(Lt,U[0]),Mt(vi,U[1]),ic(Lt,vi,Vi),Er.x=Math.abs(Vi.x)-w.x,Er.y=Math.abs(Vi.y)-w.y,Yl=Jl(Lt,vi))}}},Vp=function(N){if(N.preventDefault(),q){var H=o.arraySearch(jn,N.pointerId,"id");if(H>-1){var U=jn[H];U.x=N.pageX,U.y=N.pageY}}if(fn){var j=Po(N);if(!Gn&&!ji&&!In)if(On.x!==k.x*W)Gn="h";else{var ne=Math.abs(j[0].x-Ot.x)-Math.abs(j[0].y-Ot.y);Math.abs(ne)>=Mo&&(Gn=ne>0?"h":"v",Gt=j)}else Gt=j}},Gp=function(){if(!!Gt){var N=Gt.length;if(N!==0)if(Mt(Lt,Gt[0]),It.x=Lt.x-Ot.x,It.y=Lt.y-Ot.y,In&&N>1){if(Ot.x=Lt.x,Ot.y=Lt.y,!It.x&&!It.y&&zp(Gt[1],vi))return;Mt(vi,Gt[1]),_i||(_i=!0,Le("zoomGestureStarted"));var H=Jl(Lt,vi),U=Jp(H);U>a.currItem.initialZoomLevel+a.currItem.initialZoomLevel/15&&(gs=!0);var j=1,ne=jl(),re=Vl();if(U<ne)if(d.pinchToClose&&!gs&&O<=a.currItem.initialZoomLevel){var ye=ne-U,Oe=1-ye/(ne/1.2);ve(Oe),Le("onPinchClose",Oe),hs=!0}else j=(ne-U)/ne,j>1&&(j=1),U=ne-j*(ne/3);else U>re&&(j=(U-re)/(ne*6),j>1&&(j=1),U=re+j*ne);j<0&&(j=0),ic(Lt,vi,ds),_.x+=ds.x-Vi.x,_.y+=ds.y-Vi.y,Mt(Vi,ds),w.x=Ao("x",U),w.y=Ao("y",U),Lo=U>P,P=U,Ce()}else{if(!Gn||(Fo&&(Fo=!1,Math.abs(It.x)>=Mo&&(It.x-=Gt[0].x-Wi.x),Math.abs(It.y)>=Mo&&(It.y-=Gt[0].y-Wi.y)),Ot.x=Lt.x,Ot.y=Lt.y,It.x===0&&It.y===0))return;if(Gn==="v"&&d.closeOnVerticalDrag&&!Hp()){_.y+=It.y,w.y+=It.y;var Ae=rc();xr=!0,Le("onVerticalDrag",Ae),ve(Ae),Ce();return}Wp(he(),Lt.x,Lt.y),ji=!0,De=a.currItem.bounds;var Pe=sc("x",It);Pe||(sc("y",It),Ul(w),Ce())}}},Zp=function(N){if(ge.isOldAndroid){if(kr&&N.type==="mouseup")return;N.type.indexOf("touch")>-1&&(clearTimeout(kr),kr=setTimeout(function(){kr=0},600))}Le("pointerUp"),tc(N,!1)&&N.preventDefault();var H;if(q){var U=o.arraySearch(jn,N.pointerId,"id");if(U>-1)if(H=jn.splice(U,1)[0],navigator.msPointerEnabled){var j={4:"mouse",2:"touch",3:"pen"};H.type=j[N.pointerType],H.type||(H.type=N.pointerType||"mouse")}else H.type=N.pointerType||"mouse"}var ne=Po(N),re,ye=ne.length;if(N.type==="mouseup"&&(ye=0),ye===2)return Gt=null,!0;ye===1&&Mt(Wi,ne[0]),ye===0&&!Gn&&!Ft&&(H||(N.type==="mouseup"?H={x:N.pageX,y:N.pageY,type:"mouse"}:N.changedTouches&&N.changedTouches[0]&&(H={x:N.changedTouches[0].pageX,y:N.changedTouches[0].pageY,type:"touch"})),Le("touchRelease",N,H));var Oe=-1;if(ye===0&&(fn=!1,o.unbind(window,E,a),Bo(),In?Oe=0:Io!==-1&&(Oe=he()-Io)),Io=ye===1?he():-1,Oe!==-1&&Oe<150?re="zoom":re="swipe",In&&ye<2&&(In=!1,ye===1&&(re="zoomPointerUp"),Le("zoomGestureEnded")),Gt=null,!(!ji&&!_i&&!Ft&&!xr)){if(yr(),wr||(wr=Kp()),wr.calculateSwipeSpeed("x"),xr){var Ae=rc();if(Ae<d.verticalDragRange)a.close();else{var Pe=w.y,vt=ps;_r("verticalDrag",0,1,300,o.easing.cubic.out,function(Fn){w.y=(a.currItem.initialPosition.y-Pe)*Fn+Pe,ve((1-vt)*Fn+vt),Ce()}),Le("onVerticalDrag",1)}return}if((Vn||Ft)&&ye===0){var gn=Yp(re,wr);if(gn)return;re="zoomPointerUp"}if(!Ft){if(re!=="swipe"){Qp();return}!Vn&&P>a.currItem.fitRatio&&Xp(wr)}}},Kp=function(){var N,H,U={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(j){yi.length>1?(N=he()-cs+50,H=yi[yi.length-2][j]):(N=he()-Xl,H=Wi[j]),U.lastFlickOffset[j]=Ot[j]-H,U.lastFlickDist[j]=Math.abs(U.lastFlickOffset[j]),U.lastFlickDist[j]>20?U.lastFlickSpeed[j]=U.lastFlickOffset[j]/N:U.lastFlickSpeed[j]=0,Math.abs(U.lastFlickSpeed[j])<.1&&(U.lastFlickSpeed[j]=0),U.slowDownRatio[j]=.95,U.slowDownRatioReverse[j]=1-U.slowDownRatio[j],U.speedDecelerationRatio[j]=1},calculateOverBoundsAnimOffset:function(j,ne){U.backAnimStarted[j]||(w[j]>De.min[j]?U.backAnimDestination[j]=De.min[j]:w[j]<De.max[j]&&(U.backAnimDestination[j]=De.max[j]),U.backAnimDestination[j]!==void 0&&(U.slowDownRatio[j]=.7,U.slowDownRatioReverse[j]=1-U.slowDownRatio[j],U.speedDecelerationRatioAbs[j]<.05&&(U.lastFlickSpeed[j]=0,U.backAnimStarted[j]=!0,_r("bounceZoomPan"+j,w[j],U.backAnimDestination[j],ne||300,o.easing.sine.out,function(re){w[j]=re,Ce()}))))},calculateAnimOffset:function(j){U.backAnimStarted[j]||(U.speedDecelerationRatio[j]=U.speedDecelerationRatio[j]*(U.slowDownRatio[j]+U.slowDownRatioReverse[j]-U.slowDownRatioReverse[j]*U.timeDiff/10),U.speedDecelerationRatioAbs[j]=Math.abs(U.lastFlickSpeed[j]*U.speedDecelerationRatio[j]),U.distanceOffset[j]=U.lastFlickSpeed[j]*U.speedDecelerationRatio[j]*U.timeDiff,w[j]+=U.distanceOffset[j])},panAnimLoop:function(){if(Pt.zoomPan&&(Pt.zoomPan.raf=fe(U.panAnimLoop),U.now=he(),U.timeDiff=U.now-U.lastNow,U.lastNow=U.now,U.calculateAnimOffset("x"),U.calculateAnimOffset("y"),Ce(),U.calculateOverBoundsAnimOffset("x"),U.calculateOverBoundsAnimOffset("y"),U.speedDecelerationRatioAbs.x<.05&&U.speedDecelerationRatioAbs.y<.05)){w.x=Math.round(w.x),w.y=Math.round(w.y),Ce(),br("zoomPan");return}}};return U},Xp=function(N){if(N.calculateSwipeSpeed("y"),De=a.currItem.bounds,N.backAnimDestination={},N.backAnimStarted={},Math.abs(N.lastFlickSpeed.x)<=.05&&Math.abs(N.lastFlickSpeed.y)<=.05)return N.speedDecelerationRatioAbs.x=N.speedDecelerationRatioAbs.y=0,N.calculateOverBoundsAnimOffset("x"),N.calculateOverBoundsAnimOffset("y"),!0;Ro("zoomPan"),N.lastNow=he(),N.panAnimLoop()},Yp=function(N,H){var U;Ft||(us=m);var j;if(N==="swipe"){var ne=Ot.x-Wi.x,re=H.lastFlickDist.x<10;ne>Kl&&(re||H.lastFlickOffset.x>20)?j=-1:ne<-Kl&&(re||H.lastFlickOffset.x<-20)&&(j=1)}var ye;j&&(m+=j,m<0?(m=d.loop?zt()-1:0,ye=!0):m>=zt()&&(m=d.loop?0:zt()-1,ye=!0),(!ye||d.loop)&&(z+=j,W-=j,U=!0));var Oe=k.x*W,Ae=Math.abs(Oe-On.x),Pe;return!U&&Oe>On.x!=H.lastFlickSpeed.x>0?Pe=333:(Pe=Math.abs(H.lastFlickSpeed.x)>0?Ae/Math.abs(H.lastFlickSpeed.x):333,Pe=Math.min(Pe,400),Pe=Math.max(Pe,250)),us===m&&(U=!1),Ft=!0,Le("mainScrollAnimStart"),_r("mainScroll",On.x,Oe,Pe,o.easing.cubic.out,qi,function(){yr(),Ft=!1,us=-1,(U||us!==m)&&a.updateCurrItem(),Le("mainScrollAnimComplete")}),U&&a.updateCurrItem(!0),U},Jp=function(N){return 1/Yl*N*O},Qp=function(){var N=P,H=jl(),U=Vl();P<H?N=H:P>U&&(N=U);var j=1,ne,re=ps;return hs&&!Lo&&!gs&&P<H?(a.close(),!0):(hs&&(ne=function(ye){ve((j-re)*ye+re)}),a.zoomTo(N,0,200,o.easing.cubic.out,ne),!0)};wt("Gestures",{publicMethods:{initGestures:function(){var N=function(H,U,j,ne,re){M=H+U,T=H+j,K=H+ne,re?ee=H+re:ee=""};q=ge.pointerEvent,q&&ge.touch&&(ge.touch=!1),q?navigator.msPointerEnabled?N("MSPointer","Down","Move","Up","Cancel"):N("pointer","down","move","up","cancel"):ge.touch?(N("touch","start","move","end","cancel"),te=!0):N("mouse","down","move","up"),E=T+" "+K+" "+ee,S=M,q&&!te&&(te=navigator.maxTouchPoints>1||navigator.msMaxTouchPoints>1),a.likelyTouchDevice=te,R[M]=jp,R[T]=Vp,R[K]=Zp,ee&&(R[ee]=R[K]),ge.touch&&(S+=" mousedown",E+=" mousemove mouseup",R.mousedown=R[M],R.mousemove=R[T],R.mouseup=R[K]),te||(d.allowPanToNext=!1)}}});var wi,oc=function(N,H,U,j){wi&&clearTimeout(wi),Gi=!0,zo=!0;var ne;N.initialLayout?(ne=N.initialLayout,N.initialLayout=null):ne=d.getThumbBoundsFn&&d.getThumbBoundsFn(m);var re=U?d.hideAnimationDuration:d.showAnimationDuration,ye=function(){br("initialZoom"),U?(a.template.removeAttribute("style"),a.bg.removeAttribute("style")):(ve(1),H&&(H.style.display="block"),o.addClass(n,"pswp--animated-in"),Le("initialZoom"+(U?"OutEnd":"InEnd"))),j&&j(),Gi=!1};if(!re||!ne||ne.x===void 0){Le("initialZoom"+(U?"Out":"In")),P=N.initialZoomLevel,Mt(w,N.initialPosition),Ce(),n.style.opacity=U?0:1,ve(1),re?setTimeout(function(){ye()},re):ye();return}var Oe=function(){var Ae=g,Pe=!a.currItem.src||a.currItem.loadError||d.showHideOpacity;N.miniImg&&(N.miniImg.style.webkitBackfaceVisibility="hidden"),U||(P=ne.w/N.w,w.x=ne.x,w.y=ne.y-ae,a[Pe?"template":"bg"].style.opacity=.001,Ce()),Ro("initialZoom"),U&&!Ae&&o.removeClass(n,"pswp--animated-in"),Pe&&(U?o[(Ae?"remove":"add")+"Class"](n,"pswp--animate_opacity"):setTimeout(function(){o.addClass(n,"pswp--animate_opacity")},30)),wi=setTimeout(function(){if(Le("initialZoom"+(U?"Out":"In")),!U)P=N.initialZoomLevel,Mt(w,N.initialPosition),Ce(),ve(1),Pe?n.style.opacity=1:ve(1),wi=setTimeout(ye,re+20);else{var vt=ne.w/N.w,gn={x:w.x,y:w.y},Fn=P,Ki=ps,Tr=function(mn){mn===1?(P=vt,w.x=ne.x,w.y=ne.y-Me):(P=(vt-Fn)*mn+Fn,w.x=(ne.x-gn.x)*mn+gn.x,w.y=(ne.y-Me-gn.y)*mn+gn.y),Ce(),Pe?n.style.opacity=1-mn:ve(Ki-mn*Ki)};Ae?_r("initialZoom",0,1,re,o.easing.cubic.out,Tr,ye):(Tr(1),wi=setTimeout(ye,re+20))}},U?25:90)};Oe()},Kn,Zt={},xi=[],zo,Gi,eg={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return Kn.length}},Xn,zt,ac=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},tg=function(N,H,U){var j=N.bounds;j.center.x=Math.round((Zt.x-H)/2),j.center.y=Math.round((Zt.y-U)/2)+N.vGap.top,j.max.x=H>Zt.x?Math.round(Zt.x-H):j.center.x,j.max.y=U>Zt.y?Math.round(Zt.y-U)+N.vGap.top:j.center.y,j.min.x=H>Zt.x?0:j.center.x,j.min.y=U>Zt.y?N.vGap.top:j.center.y},Sr=function(N,H,U){if(N.src&&!N.loadError){var j=!U;if(j&&(N.vGap||(N.vGap={top:0,bottom:0}),Le("parseVerticalMargin",N)),Zt.x=H.x,Zt.y=H.y-N.vGap.top-N.vGap.bottom,j){var ne=Zt.x/N.w,re=Zt.y/N.h;N.fitRatio=ne<re?ne:re;var ye=d.scaleMode;ye==="orig"?U=1:ye==="fit"&&(U=N.fitRatio),U>1&&(U=1),N.initialZoomLevel=U,N.bounds||(N.bounds=ac())}return U?(tg(N,N.w*U,N.h*U),j&&U===N.initialZoomLevel&&(N.initialPosition=N.bounds.center),N.bounds):void 0}else return N.w=N.h=0,N.initialZoomLevel=N.fitRatio=1,N.bounds=ac(),N.initialPosition=N.bounds.center,N.bounds},vs=function(N,H,U,j,ne,re){H.loadError||j&&(H.imageAppended=!0,ki(H,j,H===a.currItem&&qe),U.appendChild(j),re&&setTimeout(function(){H&&H.loaded&&H.placeholder&&(H.placeholder.style.display="none",H.placeholder=null)},500))},lc=function(N){N.loading=!0,N.loaded=!1;var H=N.img=o.createEl("pswp__img","img"),U=function(){N.loading=!1,N.loaded=!0,N.loadComplete?N.loadComplete(N):N.img=null,H.onload=H.onerror=null,H=null};return H.onload=U,H.onerror=function(){N.loadError=!0,U()},H.src=N.src,H},cc=function(N,H){if(N.src&&N.loadError&&N.container)return H&&(N.container.innerHTML=""),N.container.innerHTML=d.errorMsg.replace("%url%",N.src),!0},ki=function(N,H,U){if(!!N.src){H||(H=N.container.lastChild);var j=U?N.w:Math.round(N.w*N.fitRatio),ne=U?N.h:Math.round(N.h*N.fitRatio);N.placeholder&&!N.loaded&&(N.placeholder.style.width=j+"px",N.placeholder.style.height=ne+"px"),H.style.width=j+"px",H.style.height=ne+"px"}},uc=function(){if(xi.length){for(var N,H=0;H<xi.length;H++)N=xi[H],N.holder.index===N.index&&vs(N.index,N.item,N.baseDiv,N.img,!1,N.clearPlaceholder);xi=[]}};wt("Controller",{publicMethods:{lazyLoadItem:function(N){N=Rt(N);var H=Xn(N);!H||(H.loaded||H.loading)&&!F||(Le("gettingData",N,H),H.src&&lc(H))},initController:function(){o.extend(d,eg,!0),a.items=Kn=r,Xn=a.getItemAt,zt=d.getNumItemsFn,d.loop,zt()<3&&(d.loop=!1),tt("beforeChange",function(N){var H=d.preload,U=N===null?!0:N>=0,j=Math.min(H[0],zt()),ne=Math.min(H[1],zt()),re;for(re=1;re<=(U?ne:j);re++)a.lazyLoadItem(m+re);for(re=1;re<=(U?j:ne);re++)a.lazyLoadItem(m-re)}),tt("initialLayout",function(){a.currItem.initialLayout=d.getThumbBoundsFn&&d.getThumbBoundsFn(m)}),tt("mainScrollAnimComplete",uc),tt("initialZoomInEnd",uc),tt("destroy",function(){for(var N,H=0;H<Kn.length;H++)N=Kn[H],N.container&&(N.container=null),N.placeholder&&(N.placeholder=null),N.img&&(N.img=null),N.preloader&&(N.preloader=null),N.loadError&&(N.loaded=N.loadError=!1);xi=null})},getItemAt:function(N){return N>=0&&Kn[N]!==void 0?Kn[N]:!1},allowProgressiveImg:function(){return d.forceProgressiveLoading||!te||d.mouseUsed||screen.width>1200},setContent:function(N,H){d.loop&&(H=Rt(H));var U=a.getItemAt(N.index);U&&(U.container=null);var j=a.getItemAt(H),ne;if(!j){N.el.innerHTML="";return}Le("gettingData",H,j),N.index=H,N.item=j;var re=j.container=o.createEl("pswp__zoom-wrap");if(!j.src&&j.html&&(j.html.tagName?re.appendChild(j.html):re.innerHTML=j.html),cc(j),Sr(j,D),j.src&&!j.loadError&&!j.loaded){if(j.loadComplete=function(Ae){if(!!f){if(N&&N.index===H){if(cc(Ae,!0)){Ae.loadComplete=Ae.img=null,Sr(Ae,D),et(Ae),N.index===m&&a.updateCurrZoomItem();return}Ae.imageAppended?!Gi&&Ae.placeholder&&(Ae.placeholder.style.display="none",Ae.placeholder=null):ge.transform&&(Ft||Gi)?xi.push({item:Ae,baseDiv:re,img:Ae.img,index:H,holder:N,clearPlaceholder:!0}):vs(H,Ae,re,Ae.img,Ft||Gi,!0)}Ae.loadComplete=null,Ae.img=null,Le("imageLoadComplete",H,Ae)}},o.features.transform){var ye="pswp__img pswp__img--placeholder";ye+=j.msrc?"":" pswp__img--placeholder--blank";var Oe=o.createEl(ye,j.msrc?"img":"");j.msrc&&(Oe.src=j.msrc),ki(j,Oe),re.appendChild(Oe),j.placeholder=Oe}j.loading||lc(j),a.allowProgressiveImg()&&(!zo&&ge.transform?xi.push({item:j,baseDiv:re,img:j.img,index:H,holder:N}):vs(H,j,re,j.img,!0,!0))}else j.src&&!j.loadError&&(ne=o.createEl("pswp__img","img"),ne.style.opacity=1,ne.src=j.src,ki(j,ne),vs(H,j,re,ne));!zo&&H===m?(hn=re.style,oc(j,ne||j.img)):et(j),N.el.innerHTML="",N.el.appendChild(re)},cleanSlide:function(N){N.img&&(N.img.onload=N.img.onerror=null),N.loaded=N.loading=N.img=N.imageAppended=!1}}});var Yn,qo={},Ho=function(N,H,U){var j=document.createEvent("CustomEvent"),ne={origEvent:N,target:N.target,releasePoint:H,pointerType:U||"touch"};j.initCustomEvent("pswpTap",!0,!0,ne),N.target.dispatchEvent(j)};wt("Tap",{publicMethods:{initTap:function(){tt("firstTouchStart",a.onTapStart),tt("touchRelease",a.onTapRelease),tt("destroy",function(){qo={},Yn=null})},onTapStart:function(N){N.length>1&&(clearTimeout(Yn),Yn=null)},onTapRelease:function(N,H){if(!!H&&!ji&&!Oo&&!Hi){var U=H;if(Yn&&(clearTimeout(Yn),Yn=null,qp(U,qo))){Le("doubleTap",U);return}if(H.type==="mouse"){Ho(N,H,"mouse");return}var j=N.target.tagName.toUpperCase();if(j==="BUTTON"||o.hasClass(N.target,"pswp__single-tap")){Ho(N,H);return}Mt(qo,U),Yn=setTimeout(function(){Ho(N,H),Yn=null},300)}}}});var qt;wt("DesktopZoom",{publicMethods:{initDesktopZoom:function(){_e||(te?tt("mouseUsed",function(){a.setupDesktopZoom()}):a.setupDesktopZoom(!0))},setupDesktopZoom:function(N){qt={};var H="wheel mousewheel DOMMouseScroll";tt("bindEvents",function(){o.bind(n,H,a.handleMouseWheel)}),tt("unbindEvents",function(){qt&&o.unbind(n,H,a.handleMouseWheel)}),a.mouseZoomedIn=!1;var U,j=function(){a.mouseZoomedIn&&(o.removeClass(n,"pswp--zoomed-in"),a.mouseZoomedIn=!1),P<1?o.addClass(n,"pswp--zoom-allowed"):o.removeClass(n,"pswp--zoom-allowed"),ne()},ne=function(){U&&(o.removeClass(n,"pswp--dragging"),U=!1)};tt("resize",j),tt("afterChange",j),tt("pointerDown",function(){a.mouseZoomedIn&&(U=!0,o.addClass(n,"pswp--dragging"))}),tt("pointerUp",ne),N||j()},handleMouseWheel:function(N){if(P<=a.currItem.fitRatio)return d.modal&&(!d.closeOnScroll||Hi||fn?N.preventDefault():Y&&Math.abs(N.deltaY)>2&&(g=!0,a.close())),!0;if(N.stopPropagation(),qt.x=0,"deltaX"in N)N.deltaMode===1?(qt.x=N.deltaX*18,qt.y=N.deltaY*18):(qt.x=N.deltaX,qt.y=N.deltaY);else if("wheelDelta"in N)N.wheelDeltaX&&(qt.x=-.16*N.wheelDeltaX),N.wheelDeltaY?qt.y=-.16*N.wheelDeltaY:qt.y=-.16*N.wheelDelta;else if("detail"in N)qt.y=N.detail;else return;Do(P,!0);var H=w.x-qt.x,U=w.y-qt.y;(d.modal||H<=De.min.x&&H>=De.max.x&&U<=De.min.y&&U>=De.max.y)&&N.preventDefault(),a.panTo(H,U)},toggleDesktopZoom:function(N){N=N||{x:D.x/2+G.x,y:D.y/2+G.y};var H=d.getDoubleTapZoom(!0,a.currItem),U=P===H;a.mouseZoomedIn=!U,a.zoomTo(U?a.currItem.initialZoomLevel:H,N,333),o[(U?"remove":"add")+"Class"](n,"pswp--zoomed-in")}}});var ng={history:!0,galleryUID:1},Wo,dc,Ar,bs,Uo,fc,xt,Zi,jo,Vo,pn,Go,Zo=function(){return pn.hash.substring(1)},hc=function(){Wo&&clearTimeout(Wo),Ar&&clearTimeout(Ar)},pc=function(){var N=Zo(),H={};if(N.length<5)return H;var U,j=N.split("&");for(U=0;U<j.length;U++)if(!!j[U]){var ne=j[U].split("=");ne.length<2||(H[ne[0]]=ne[1])}if(d.galleryPIDs){var re=H.pid;for(H.pid=0,U=0;U<Kn.length;U++)if(Kn[U].pid===re){H.pid=U;break}}else H.pid=parseInt(H.pid,10)-1;return H.pid<0&&(H.pid=0),H},Ko=function(){if(Ar&&clearTimeout(Ar),Hi||fn){Ar=setTimeout(Ko,500);return}bs?clearTimeout(dc):bs=!0;var N=m+1,H=Xn(m);H.hasOwnProperty("pid")&&(N=H.pid);var U=xt+"&gid="+d.galleryUID+"&pid="+N;Zi||pn.hash.indexOf(U)===-1&&(Vo=!0);var j=pn.href.split("#")[0]+"#"+U;Go?"#"+U!==window.location.hash&&history[Zi?"replaceState":"pushState"]("",document.title,j):Zi?pn.replace(j):pn.hash=U,Zi=!0,dc=setTimeout(function(){bs=!1},60)};wt("History",{publicMethods:{initHistory:function(){if(o.extend(d,ng,!0),!!d.history){pn=window.location,Vo=!1,jo=!1,Zi=!1,xt=Zo(),Go="pushState"in history,xt.indexOf("gid=")>-1&&(xt=xt.split("&gid=")[0],xt=xt.split("?gid=")[0]),tt("afterChange",a.updateURL),tt("unbindEvents",function(){o.unbind(window,"hashchange",a.onHashChange)});var N=function(){fc=!0,jo||(Vo?history.back():xt?pn.hash=xt:Go?history.pushState("",document.title,pn.pathname+pn.search):pn.hash=""),hc()};tt("unbindEvents",function(){g&&N()}),tt("destroy",function(){fc||N()}),tt("firstUpdate",function(){m=pc().pid});var H=xt.indexOf("pid=");H>-1&&(xt=xt.substring(0,H),xt.slice(-1)==="&"&&(xt=xt.slice(0,-1))),setTimeout(function(){f&&o.bind(window,"hashchange",a.onHashChange)},40)}},onHashChange:function(){if(Zo()===xt){jo=!0,a.close();return}bs||(Uo=!0,a.goTo(pc().pid),Uo=!1)},updateURL:function(){hc(),!Uo&&(Zi?Wo=setTimeout(Ko,800):Ko())}}}),o.extend(a,Pp)};return e})})(Ep);const Tse=Ep.exports;var Cp={exports:{}};/*! PhotoSwipe Default UI - 4.1.3 - 2019-01-08
* http://photoswipe.com
* Copyright (c) 2019 Dmitry Semenov; */(function(l,t){(function(e,n){l.exports=n()})(is,function(){var e=function(n,i){var r=this,s=!1,o=!0,a,c,u,d,h,f,p,g=!0,m,v,b,_,x,w,E,S,R={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(J,X){return J.title?(X.children[0].innerHTML=J.title,!0):(X.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return n.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return n.currItem.title||""},indexIndicatorSep:" / ",fitControlsWidth:1200},D,P=function(J){if(D)return!0;J=J||window.event,S.timeToIdle&&S.mouseUsed&&!v&&M();for(var X=J.target||J.srcElement,ae,_e=X.getAttribute("class")||"",Me,ge=0;ge<se.length;ge++)ae=se[ge],ae.onTap&&_e.indexOf("pswp__"+ae.name)>-1&&(ae.onTap(),Me=!0);if(Me){J.stopPropagation&&J.stopPropagation(),D=!0;var $e=i.features.isOldAndroid?600:30;setTimeout(function(){D=!1},$e)}},O=function(){return!n.likelyTouchDevice||S.mouseUsed||screen.width>S.fitControlsWidth},L=function(J,X,ae){i[(ae?"add":"remove")+"Class"](J,"pswp__"+X)},B=function(){var J=S.getNumItemsFn()===1;J!==E&&(L(c,"ui--one-slide",J),E=J)},A=function(){L(p,"share-modal--hidden",g)},F=function(){return g=!g,g?(i.removeClass(p,"pswp__share-modal--fade-in"),setTimeout(function(){g&&A()},300)):(A(),setTimeout(function(){g||i.addClass(p,"pswp__share-modal--fade-in")},30)),g||G(),!1},W=function(J){J=J||window.event;var X=J.target||J.srcElement;return n.shout("shareLinkClick",J,X),X.href?X.hasAttribute("download")?!0:(window.open(X.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),g||F(),!1):!1},G=function(){for(var J="",X,ae,_e,Me,ge,$e=0;$e<S.shareButtons.length;$e++)X=S.shareButtons[$e],_e=S.getImageURLForShare(X),Me=S.getPageURLForShare(X),ge=S.getTextForShare(X),ae=X.url.replace("{{url}}",encodeURIComponent(Me)).replace("{{image_url}}",encodeURIComponent(_e)).replace("{{raw_image_url}}",_e).replace("{{text}}",encodeURIComponent(ge)),J+='<a href="'+ae+'" target="_blank" class="pswp__share--'+X.id+'"'+(X.download?"download":"")+">"+X.label+"</a>",S.parseShareButtonOut&&(J=S.parseShareButtonOut(X,J));p.children[0].innerHTML=J,p.children[0].onclick=W},k=function(J){for(var X=0;X<S.closeElClasses.length;X++)if(i.hasClass(J,"pswp__"+S.closeElClasses[X]))return!0},C,$,z=0,M=function(){clearTimeout($),z=0,v&&r.setIdle(!1)},T=function(J){J=J||window.event;var X=J.relatedTarget||J.toElement;(!X||X.nodeName==="HTML")&&(clearTimeout($),$=setTimeout(function(){r.setIdle(!0)},S.timeToIdleOutside))},K=function(){S.fullscreenEl&&!i.features.isOldAndroid&&(a||(a=r.getFullscreenAPI()),a?(i.bind(document,a.eventK,r.updateFullscreen),r.updateFullscreen(),i.addClass(n.template,"pswp--supports-fs")):i.removeClass(n.template,"pswp--supports-fs"))},ee=function(){S.preloaderEl&&(Y(!0),b("beforeChange",function(){clearTimeout(w),w=setTimeout(function(){n.currItem&&n.currItem.loading?(!n.allowProgressiveImg()||n.currItem.img&&!n.currItem.img.naturalWidth)&&Y(!1):Y(!0)},S.loadingIndicatorDelay)}),b("imageLoadComplete",function(J,X){n.currItem===X&&Y(!0)}))},Y=function(J){x!==J&&(L(_,"preloader--active",!J),x=J)},q=function(J){var X=J.vGap;if(O()){var ae=S.barsSize;if(S.captionEl&&ae.bottom==="auto")if(d||(d=i.createEl("pswp__caption pswp__caption--fake"),d.appendChild(i.createEl("pswp__caption__center")),c.insertBefore(d,u),i.addClass(c,"pswp__ui--fit")),S.addCaptionHTMLFn(J,d,!0)){var _e=d.clientHeight;X.bottom=parseInt(_e,10)||44}else X.bottom=ae.top;else X.bottom=ae.bottom==="auto"?0:ae.bottom;X.top=ae.top}else X.top=X.bottom=0},Z=function(){S.timeToIdle&&b("mouseUsed",function(){i.bind(document,"mousemove",M),i.bind(document,"mouseout",T),C=setInterval(function(){z++,z===2&&r.setIdle(!0)},S.timeToIdle/2)})},te=function(){b("onVerticalDrag",function(X){o&&X<.95?r.hideControls():!o&&X>=.95&&r.showControls()});var J;b("onPinchClose",function(X){o&&X<.9?(r.hideControls(),J=!0):J&&!o&&X>.9&&r.showControls()}),b("zoomGestureEnded",function(){J=!1,J&&!o&&r.showControls()})},se=[{name:"caption",option:"captionEl",onInit:function(J){u=J}},{name:"share-modal",option:"shareEl",onInit:function(J){p=J},onTap:function(){F()}},{name:"button--share",option:"shareEl",onInit:function(J){f=J},onTap:function(){F()}},{name:"button--zoom",option:"zoomEl",onTap:n.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(J){h=J}},{name:"button--close",option:"closeEl",onTap:n.close},{name:"button--arrow--left",option:"arrowEl",onTap:n.prev},{name:"button--arrow--right",option:"arrowEl",onTap:n.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){a.isFullscreen()?a.exit():a.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(J){_=J}}],fe=function(){var J,X,ae,_e=function(ge){if(!!ge)for(var $e=ge.length,qe=0;qe<$e;qe++){J=ge[qe],X=J.className;for(var Ye=0;Ye<se.length;Ye++)ae=se[Ye],X.indexOf("pswp__"+ae.name)>-1&&(S[ae.option]?(i.removeClass(J,"pswp__element--disabled"),ae.onInit&&ae.onInit(J)):i.addClass(J,"pswp__element--disabled"))}};_e(c.children);var Me=i.getChildByClass(c,"pswp__top-bar");Me&&_e(Me.children)};r.init=function(){i.extend(n.options,R,!0),S=n.options,c=i.getChildByClass(n.scrollWrap,"pswp__ui"),b=n.listen,te(),b("beforeChange",r.update),b("doubleTap",function(J){var X=n.currItem.initialZoomLevel;n.getZoomLevel()!==X?n.zoomTo(X,J,333):n.zoomTo(S.getDoubleTapZoom(!1,n.currItem),J,333)}),b("preventDragEvent",function(J,X,ae){var _e=J.target||J.srcElement;_e&&_e.getAttribute("class")&&J.type.indexOf("mouse")>-1&&(_e.getAttribute("class").indexOf("__caption")>0||/(SMALL|STRONG|EM)/i.test(_e.tagName))&&(ae.prevent=!1)}),b("bindEvents",function(){i.bind(c,"pswpTap click",P),i.bind(n.scrollWrap,"pswpTap",r.onGlobalTap),n.likelyTouchDevice||i.bind(n.scrollWrap,"mouseover",r.onMouseOver)}),b("unbindEvents",function(){g||F(),C&&clearInterval(C),i.unbind(document,"mouseout",T),i.unbind(document,"mousemove",M),i.unbind(c,"pswpTap click",P),i.unbind(n.scrollWrap,"pswpTap",r.onGlobalTap),i.unbind(n.scrollWrap,"mouseover",r.onMouseOver),a&&(i.unbind(document,a.eventK,r.updateFullscreen),a.isFullscreen()&&(S.hideAnimationDuration=0,a.exit()),a=null)}),b("destroy",function(){S.captionEl&&(d&&c.removeChild(d),i.removeClass(u,"pswp__caption--empty")),p&&(p.children[0].onclick=null),i.removeClass(c,"pswp__ui--over-close"),i.addClass(c,"pswp__ui--hidden"),r.setIdle(!1)}),S.showAnimationDuration||i.removeClass(c,"pswp__ui--hidden"),b("initialZoomIn",function(){S.showAnimationDuration&&i.removeClass(c,"pswp__ui--hidden")}),b("initialZoomOut",function(){i.addClass(c,"pswp__ui--hidden")}),b("parseVerticalMargin",q),fe(),S.shareEl&&f&&p&&(g=!0),B(),Z(),K(),ee()},r.setIdle=function(J){v=J,L(c,"ui--idle",J)},r.update=function(){o&&n.currItem?(r.updateIndexIndicator(),S.captionEl&&(S.addCaptionHTMLFn(n.currItem,u),L(u,"caption--empty",!n.currItem.title)),s=!0):s=!1,g||F(),B()},r.updateFullscreen=function(J){J&&setTimeout(function(){n.setScrollOffset(0,i.getScrollY())},50),i[(a.isFullscreen()?"add":"remove")+"Class"](n.template,"pswp--fs")},r.updateIndexIndicator=function(){S.counterEl&&(h.innerHTML=n.getCurrentIndex()+1+S.indexIndicatorSep+S.getNumItemsFn())},r.onGlobalTap=function(J){J=J||window.event;var X=J.target||J.srcElement;if(!D){if(J.detail&&J.detail.pointerType==="mouse"){if(k(X)){n.close();return}i.hasClass(X,"pswp__img")&&(n.getZoomLevel()===1&&n.getZoomLevel()<=n.currItem.fitRatio?S.clickToCloseNonZoomable&&n.close():n.toggleDesktopZoom(J.detail.releasePoint))}else if(S.tapToToggleControls&&(o?r.hideControls():r.showControls()),S.tapToClose&&(i.hasClass(X,"pswp__img")||k(X))){n.close();return}}},r.onMouseOver=function(J){J=J||window.event;var X=J.target||J.srcElement;L(c,"ui--over-close",k(X))},r.hideControls=function(){i.addClass(c,"pswp__ui--hidden"),o=!1},r.showControls=function(){o=!0,s||r.update(),i.removeClass(c,"pswp__ui--hidden")},r.supportsFullscreen=function(){var J=document;return!!(J.exitFullscreen||J.mozCancelFullScreen||J.webkitExitFullscreen||J.msExitFullscreen)},r.getFullscreenAPI=function(){var J=document.documentElement,X,ae="fullscreenchange";return J.requestFullscreen?X={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:ae}:J.mozRequestFullScreen?X={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+ae}:J.webkitRequestFullscreen?X={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+ae}:J.msRequestFullscreen&&(X={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),X&&(X.enter=function(){if(m=S.closeOnScroll,S.closeOnScroll=!1,this.enterK==="webkitRequestFullscreen")n.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT);else return n.template[this.enterK]()},X.exit=function(){return S.closeOnScroll=m,document[this.exitK]()},X.isFullscreen=function(){return document[this.elementK]}),X}};return e})})(Cp);const Nse=Cp.exports;class Dse{constructor(t,e){y(this,"pswp");y(this,"editor");y(this,"prevStatus","default");y(this,"nextStatus","default");y(this,"zoomInStatus","default");y(this,"zoomOutStatus","default");y(this,"originSizeStatus","default");y(this,"bestSizeStatus","default");this.editor=t,this.pswp=e}init(){this.pswp.on("afterzoom",()=>{this.afterZoom()}),this.pswp.on("afterchange",()=>{this.afterChange()}),this.pswp.on("resize",()=>{setTimeout(()=>{this.afterChange(),this.afterZoom()},333)}),this.render()}renderTemplate(){const t=I(`
        <div class="data-pswp-tool-bar">
            <div class="pswp-toolbar-content"></div>
        </div>
        `),e=t.find(".pswp-toolbar-content"),n=this.editor.language.get("image");return e.append(this.renderBtn("arrow-left",n.prev,this.prevStatus,()=>{this.prevStatus!=="disable"&&this.pswp.prev()})),e.append('<span class="data-pswp-counter"></span>'),e.append(this.renderBtn("arrow-right",n.next,this.nextStatus,()=>{this.nextStatus!=="disable"&&this.pswp.next()})),e.append('<span class="separation"></span>'),e.append(this.renderBtn("zoom-in",n.zoomIn,this.zoomInStatus,()=>{this.zoomInStatus!=="disable"&&this.pswp.zoomIn()})),e.append(this.renderBtn("zoom-out",n.zoomOut,this.zoomOutStatus,()=>{this.zoomOutStatus!=="disable"&&this.pswp.zoomOut()})),e.append(this.renderBtn("origin-size",n.originSize,this.originSizeStatus,()=>{this.originSizeStatus!=="disable"&&this.pswp.zoomToOriginSize()})),e.append(this.renderBtn("best-size",n.bestSize,this.bestSizeStatus,()=>{this.bestSizeStatus!=="disable"&&this.pswp.zoomToBestSize()})),t}afterZoom(){const t=this.pswp.getCurrentZoomLevel(),e=this.pswp.getInitialZoomLevel();let n="default";t===e&&(n="activated"),e===1&&(n="disable"),this.zoomOutStatus=t===.05?"disable":"default",this.zoomInStatus=t===5?"disable":"default",this.originSizeStatus=t===1?"activated":"default",this.bestSizeStatus=n,this.render()}afterChange(){const t=this.pswp.getCount();this.nextStatus=t===1?"disable":"default",this.prevStatus=t===1?"disable":"default",this.render()}renderBtn(t,e,n,i){const r=I(`<span class="data-pswp-${t} btn ${n}"></span>`);return r.on("mouseenter",()=>{Ue.show(r,e)}),r.on("mouseleave",()=>{Ue.hide()}),r.on("mousedown",s=>{s.stopPropagation(),Ue.hide()}),r.on("click",i),r}render(){this.pswp.barUI.empty(),this.pswp.barUI.append(this.renderTemplate())}}class Rse extends zi{constructor(e,n){super();y(this,"editor");y(this,"options");y(this,"timeouts",[]);y(this,"pswpUI");y(this,"zoom");y(this,"isDestroy",!0);y(this,"zoomUI");y(this,"root");y(this,"barUI");y(this,"closeUI");y(this,"reset",()=>{this.root.removeClass(ue?"data-pswp-mobile":"data-pswp-pc"),this.root.addClass(ue?"data-pswp-mobile":"data-pswp-pc"),this.unbindKeyboardEvnet(),this.unbindControllerFadeInAndOut(),ue||(this.bindKeyboardEvnet(),this.bindControllerFadeInAndOut())});y(this,"onBarMouseEnter",()=>{this.removeFadeOut(this.barUI,"barFadeInAndOut"),this.removeFadeOut(this.closeUI,"closeFadeInAndOut")});y(this,"onBarMouseLeave",()=>{this.fadeOut(this.barUI,"barFadeInAndOut"),this.fadeOut(this.closeUI,"closeFadeInAndOut")});y(this,"onCloseMouseEnter",()=>{this.removeFadeOut(this.barUI,"barFadeInAndOut"),this.removeFadeOut(this.closeUI,"closeFadeInAndOut")});y(this,"onCloseMouseLeave",()=>{this.fadeOut(this.barUI,"barFadeInAndOut"),this.fadeOut(this.closeUI,"closeFadeInAndOut")});y(this,"onKeyboardEvent",e=>{(e.metaKey||e.ctrlKey)&&e.keyCode===187&&(e.preventDefault(),this.zoomIn()),ce("mod+-",e)&&(e.preventDefault(),this.zoomOut())});y(this,"close",()=>{var e;(e=this.pswpUI)==null||e.close()});this.editor=e,this.options={shareEl:!1,fullscreenEl:!1,zoomEl:!1,history:!1,closeOnScroll:!1,preloaderEl:!1,captionEl:!1,counterEl:!1,clickToCloseNonZoomable:!1,showAnimationDuration:0,hideAnimationDuration:0,closeOnVerticalDrag:ue,tapToClose:!0,bgOpacity:.8,barsSize:{top:44,bottom:80},...n},this.isDestroy=!0,this.root=this.renderTemplate(),this.barUI=this.root.find(".data-pswp-custom-top-bar"),this.closeUI=this.root.find(".data-pswp-button-close"),I(document.body).append(this.root),this.zoomUI=new Dse(e,this),this.zoomUI.render(),this.reset(),this.bindClickEvent(),window.addEventListener("resize",this.reset)}renderTemplate(){return I(`
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="pswp__bg"></div>
            <div class="pswp__scroll-wrap">
                <div class="pswp__container">
                    <div class="pswp__item"></div>
                    <div class="pswp__item"></div>
                    <div class="pswp__item"></div>
                </div>
                <div class="pswp__ui pswp__ui--hidden">
                    <button type="button" class="pswp__button data-pswp-button-close" title="Close (Esc)"></button>
                    <div class="data-pswp-custom-top-bar"></div>
                </div>
            </div>
        </div>`)}bindControllerFadeInAndOut(){this.barUI.on("mouseenter",this.onBarMouseEnter),this.barUI.on("mouseleave",this.onBarMouseLeave),this.closeUI.on("mouseenter",this.onCloseMouseEnter),this.closeUI.on("mouseleave",this.onCloseMouseLeave)}unbindControllerFadeInAndOut(){this.barUI.off("mouseenter",this.onBarMouseEnter),this.barUI.off("mouseleave",this.onBarMouseLeave),this.closeUI.off("mouseenter",this.onCloseMouseEnter),this.closeUI.off("mouseleave",this.onCloseMouseLeave)}removeFadeOut(e,n){this.timeouts[n]&&clearTimeout(this.timeouts[n]),e.removeClass("pswp-fade-out")}fadeOut(e,n){this.timeouts[n]&&clearTimeout(this.timeouts[n]),this.timeouts[n]=setTimeout(()=>{e.addClass("pswp-fade-out")},3e3)}bindClickEvent(){const e=n=>{const i=window.TouchEvent&&n instanceof TouchEvent?I(n.touches[0].target):I(n.target||[]);i.hasClass("pswp__img")&&setTimeout(()=>{this.zoom=void 0,this.afterZoom()},366),(i.hasClass("pswp__bg")||i.hasClass("data-pswp-tool-bar"))&&this.close()};this.root.on("click",e),this.closeUI.on("click",this.close)}prev(){var e;(e=this.pswpUI)==null||e.prev()}next(){var e;(e=this.pswpUI)==null||e.next()}renderCounter(){var e,n;this.barUI.find(".data-pswp-counter").html(`${(((e=this.pswpUI)==null?void 0:e.getCurrentIndex())||0)+1} / ${((n=this.pswpUI)==null?void 0:n.items.length)||""}`)}getCurrentZoomLevel(){return this.zoom&&+this.zoom.toFixed(2)||this.pswpUI&&+this.pswpUI.getZoomLevel().toFixed(2)||0}zoomTo(e){!this.pswpUI||(this.pswpUI.zoomTo(e,{x:this.pswpUI.viewportSize.x/2,y:this.pswpUI.viewportSize.y/2},100),this.zoom=e,this.afterZoom())}zoomIn(){const e=this.getCurrentZoomLevel();let n=(e||0)+.2;e!==5&&(n>5&&(n=5),this.zoomTo(n))}zoomOut(){const e=this.getCurrentZoomLevel();if(e!==.05&&e!==void 0){let n=e-.2;.05>n&&(n=.05),this.zoomTo(n)}}bindKeyboardEvnet(){this.root.on("keydown",this.onKeyboardEvent)}unbindKeyboardEvnet(){this.root.off("keydown",this.onKeyboardEvent)}zoomToOriginSize(){this.zoomTo(1)}zoomToBestSize(){const e=this.getInitialZoomLevel();!e||this.zoomTo(e)}updateCursor(){const{root:e}=this,n=this.getCurrentZoomLevel(),i=this.getInitialZoomLevel();n===1?e.addClass("pswp--zoomed-in"):i===i&&e.removeClass("pswp--zoomed-in")}getInitialZoomLevel(){var e;return this.pswpUI?+(((e=this.pswpUI.currItem.initialZoomLevel)==null?void 0:e.toFixed(2))||0):0}afterZoom(){this.updateCursor(),this.emit("afterzoom")}getCount(){var e;return((e=this.pswpUI)==null?void 0:e.items.length)||0}afterChange(){if(!ue){const e=this.getInitialZoomLevel();this.renderCounter(),this.zoom=e,setTimeout(()=>{this.afterZoom()},100),this.emit("afterchange"),this.zoom=this.getInitialZoomLevel()}this.setWhiteBackground()}bindPswpEvent(){var e,n,i,r;(e=this.pswpUI)==null||e.listen("afterChange",()=>{this.afterChange()}),(n=this.pswpUI)==null||n.listen("destroy",()=>{this.isDestroy=!0}),(i=this.pswpUI)==null||i.listen("resize",()=>{this.emit("resize")}),(r=this.pswpUI)==null||r.listen("imageLoadComplete",()=>{this.setWhiteBackground()})}setWhiteBackground(){this.root.find(".pswp__img").each(e=>{const n=e;n.complete?(n.style.background="white",n.style["box-shadow"]="0 0 10px rgba(0, 0, 0, 0.5)"):n.onload=()=>{n.style.background="white",n.style["box-shadow"]="0 0 10px rgba(0, 0, 0, 0.5)"}})}open(e,n){if(this.isDestroy===!0){const{root:i}=this,r=new Tse(this.root.get(),Nse,e,{index:n,...this.options});r.items=e,r.init(),this.pswpUI=r,this.isDestroy=!1,ue||(this.barUI.removeClass("pswp-fade-out"),this.fadeOut(this.barUI,"barFadeInAndOut"),this.closeUI.removeClass("pswp-fade-out"),this.fadeOut(this.closeUI,"closeFadeInAndOut")),i.removeClass("pswp-fade-in"),i.addClass("pswp-fade-in"),this.afterChange(),this.bindPswpEvent()}}destroy(){window.removeEventListener("resize",this.reset),this.close()}}const kd=typeof window<"u"?window.devicePixelRatio:1;let Ed;class Mse{constructor(t,e){y(this,"editor");y(this,"options");y(this,"root");y(this,"progress");y(this,"image");y(this,"detail");y(this,"meta");y(this,"maximize");y(this,"bg");y(this,"resizer");y(this,"pswp");y(this,"src");y(this,"status");y(this,"size");y(this,"maxWidth");y(this,"maxHeight");y(this,"rate",1);y(this,"isLoad",!1);y(this,"message");y(this,"onWindowResize",()=>{if(!V(this.editor))return;this.maxWidth=this.getMaxWidth(),this.resetSize();const t=this.image.get();if(!t)return;const{clientWidth:e,clientHeight:n}=t;this.resizer&&(this.resizer.maxWidth=this.maxWidth,this.resizer.setSize(e,n))});y(this,"getSrc",()=>{const{onBeforeRender:t}=this.options;return t&&this.status!=="error"?t(this.status,this.src,this.editor):this.src});y(this,"openZoom",t=>{t.preventDefault(),t.stopPropagation();const e=this.editor,n=[],i=e.card.closest(this.root);let r=0;e.container.find('[data-card-key="image"]').toArray().filter(s=>s.find("img").length>0).forEach((s,o)=>{const a=e.card.find(s),c=a==null?void 0:a.getValue();if(!a||!c)return;const u=a.getCenter().find("img"),d=parseInt(u.css("width")),h=parseInt(u.css("height")),f=c.size,p=f?f.naturalWidth||this.size.naturalWidth:d*kd,g=f?f.naturalHeight||this.size.naturalHeight:h*kd;let m=c.src;const{onBeforeRender:v}=this.options;v&&(m=v("done",m,this.editor));const b=u.attributes("src");n.push({src:m,msrc:b,w:p,h:g}),i!=null&&i.equal(s)&&(r=o)}),this.pswp.open(n,r)});y(this,"focus",()=>{!V(this.editor)||(this.root.addClass("data-image-active"),this.status==="done"&&(this.destroyEditor(),this.renderEditor()))});y(this,"blur",()=>{!V(this.editor)||(this.root.removeClass("data-image-active"),this.status==="done"&&this.destroyEditor())});this.editor=t,this.options=e,this.src=this.options.src,this.size=this.options.size||{width:0,height:0,naturalHeight:0,naturalWidth:0},this.maxHeight=this.options.maxHeight,this.status=this.options.status,this.root=I(this.renderTemplate()),this.progress=this.root.find(".data-image-progress"),this.image=this.root.find("img"),this.detail=this.root.find(".data-image-detail"),this.meta=this.root.find(".data-image-meta"),this.maximize=this.root.find(".data-image-maximize"),this.bg=this.root.find(".data-image-bg"),this.maxWidth=this.getMaxWidth(),this.pswp=Ed||new Rse(t),this.message=this.options.message,Ed=this.pswp}renderTemplate(t){const{link:e,percent:n,className:i,onBeforeRender:r}=this.options;if(this.status==="error")return`<span class="data-image-error" style="max-width:${this.maxWidth}px"><span class="data-icon data-icon-error"></span>${t||this.options.message}<span class="data-icon data-icon-copy"></span></span>`;const s=r?r(this.status,this.options.src,this.editor):this.options.src,o=`<span class="data-image-progress">
                            <i class="data-anticon">
                                <svg viewBox="0 0 1024 1024" class="data-anticon-spin" data-icon="loading" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                                    <path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path>
                                </svg>
                            </i>
                            <span class="percent">${n||0}%</span>
                        </span>`,a=dt(this.options.alt||""),c=a?` alt="${a}" title="${a}" `:"";let u=`<img src="${Sn(s)}" class="${i||""} data-drag-image" ${c}/>`;if(e&&!V(this.editor)){const h=e.target||"_blank";u=`<a href="${Sn(e.href)}" target="${h}">${u}</a>`}return`
        <span class="data-image">
            <span class="data-image-content data-image-loading">
                <span class="data-image-detail">
                    <span class="data-image-meta">
                        ${u}
                        ${o}
						<span class="data-image-bg"></span>
                        <span class="data-image-maximize" style="display: none;"><span class="data-icon data-icon-maximize"></span></span>
                    </span>
                </span>
            </span>
        </span>`}bindErrorEvent(t){const e=this.editor,n=t.find(".data-icon-copy");n.on("mouseenter",()=>{Ue.show(n,e.language.get("image","errorMessageCopy").toString())}),n.on("mouseleave",()=>{Ue.hide()}),n.on("click",i=>{i.stopPropagation(),i.preventDefault(),Ue.hide(),e.clipboard.copy(this.message||this.options.message||"Error message"),e.messageSuccess("copy",e.language.get("copy","success").toString())})}setProgressPercent(t){this.progress.find(".percent").html(`${t}%`)}imageLoadCallback(){const t=this.editor;if(!t.card.closest(this.root)||this.status==="uploading")return;if(this.status==="done"){const o=this.root.find(".data-image-content");o.addClass("data-image-loaded"),o.removeClass("data-image-loading")}const n=this.image.get();if(!n)return;const{naturalWidth:i,naturalHeight:r}=n;this.rate=r/i,this.size.naturalWidth=i,this.size.naturalHeight=r,this.size.width||(this.size.width=i),this.size.height||(this.size.height=r),this.resetSize(),this.image.css("visibility","visible"),this.detail.css("height",""),this.detail.css("width","");const{onChange:s}=this.options;V(t)&&s&&s(this.size,!0),window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize),t.off("editor:resize",this.onWindowResize),t.on("editor:resize",this.onWindowResize),this.resizer&&this.resizer.setSize(n.clientWidth,n.clientHeight),this.isLoad=!0,this.options.onLoad&&this.options.onLoad()}imageLoadError(){if(this.status==="uploading")return;this.status="error";const{container:t}=this.options;t.empty(),t.append(this.renderTemplate(this.editor.language.get("image","loadError").toString())),this.detail.css("width",""),this.detail.css("height",""),this.bindErrorEvent(t);const{onError:e}=this.options;e&&e(),this.isLoad=!0}getMaxWidth(t=this.options.root){const e=this.editor.block.closest(t).get();return e?e.clientWidth-6:0}resetSize(){this.meta.css({"background-color":"",width:""}),this.image.css({width:""});const t=this.image.get();if(!t)return;let{width:e,height:n}=this.size;if(!n)n=Math.round(this.rate*e);else if(!e)e=Math.round(n/this.rate);else if(e&&n)n=Math.round(this.rate*e),this.size.height=n;else{const{clientWidth:i,clientHeight:r}=t;e=i,n=r;const{naturalWidth:s,naturalHeight:o}=this.size;this.isSvg()&&s&&o&&(e=s,n=o)}e>this.maxWidth&&(e=this.maxWidth,n=Math.round(e*this.rate)),this.options.enableResizer===!1?this.image.css("width",""):this.image.css("width",`${e}px`)}changeSize(t,e){t<24&&(t=24,e=t*this.rate),t>this.maxWidth&&(t=this.maxWidth,e=t*this.rate),e<24&&(e=24,t=e/this.rate),t=Math.round(t),e=Math.round(e),this.size.width=t,this.size.height=e,this.image.css({width:`${t}px`});const{onChange:n}=this.options;n&&n(this.size),this.destroyEditor(),this.renderEditor()}changeUrl(t){this.src!==t&&(this.src=t,this.isLoad=!1,this.image.attributes("src",this.getSrc()))}isSvg(){return this.src.split("?")[0].endsWith(".svg")||this.src.startsWith("data:image/svg+xml")}closeZoom(){var t;(t=this.pswp)==null||t.close()}renderEditor(){const t=this.image.get();if(!t)return;const{clientWidth:e,clientHeight:n}=t;if(!e||!n)return;const i=this.editor;if(this.maxWidth=this.getMaxWidth(),this.rate=n/e,ue||!V(i)||i.readonly||this.options.enableResizer===!1)return;const r=new fp({imgUrl:this.getSrc(),width:e,height:n,rate:this.rate,maxWidth:this.maxWidth,onChange:({width:o,height:a})=>this.changeSize(o,a)}),s=r.render();this.root.find(".data-image-detail").append(s),this.resizer=r,this.resizer.on("dblclick",this.openZoom)}destroyEditor(){var t,e;(t=this.resizer)==null||t.off("dblclick",this.openZoom),(e=this.resizer)==null||e.destroy()}destroy(){window.removeEventListener("resize",this.onWindowResize),this.editor.off("editor:resize",this.onWindowResize),this.destroyEditor(),this.image.off("click",this.openZoom),this.image.off("dblclick",this.openZoom),this.maximize.off("click",this.openZoom)}render(t){const{container:e,display:n,enableResizer:i}=this.options;n===Ve.BLOCK&&this.root.addClass("data-image-blcok");const r=this.editor;if(i===!1&&this.root.addClass("data-image-disable-resize"),this.status==="error"&&V(r)){this.root=I(this.renderTemplate(this.message||r.language.get("image","uploadError"))),this.bindErrorEvent(this.root),e.empty().append(this.root),this.progress.remove();return}if(this.status==="uploading"?(this.progress.show(),e.empty().append(this.root)):this.progress.remove(),this.status==="done"&&this.isLoad){const a=this.root.find(".data-image-content");a.addClass("data-image-loaded"),a.removeClass("data-image-loading")}this.status==="done"&&!this.isLoad&&(this.root.inEditor()||e.empty().append(this.root)),this.maxWidth=this.getMaxWidth();let{width:s,height:o}=this.size;if(s&&o||!this.src){if(s>this.maxWidth?(s=this.maxWidth,o=Math.round(s*o/this.size.width)):!this.src&&!s&&!o&&(s=this.maxWidth,o=this.maxWidth/2),this.src){this.options.enableResizer===!1?this.image.css({width:"100%"}):this.image.css({width:s+"px"});const{onChange:a}=this.options;s>0&&o>0&&(this.size={...this.size,width:s,height:o},a&&a(this.size))}this.options.enableResizer===!1?this.bg.css({width:"100%"}):this.bg.css({width:s+"px",height:o+"px"}),t&&this.bg.css("background-image",`url(${t})`)}this.image.on("load",()=>this.imageLoadCallback()),this.image.on("error",()=>this.imageLoadError()),ue||(this.root.on("mouseenter",()=>{this.maximize.show()}),this.root.on("mouseleave",()=>{this.maximize.hide()})),(!V(r)||r.readonly)&&this.image.closest("a").length===0&&this.image.on("click",this.openZoom),this.maximize.on("click",this.openZoom),(V(r)||!this.root.inEditor())&&this.image.on("dblclick",this.openZoom)}}class $s extends Tt{constructor(){super(...arguments);y(this,"image");y(this,"widthInput");y(this,"heightInput");y(this,"isLocalError")}static get cardName(){return"image"}static get cardType(){return Ve.INLINE}static get collab(){return!1}setProgressPercent(e){var n;(n=this.image)==null||n.setProgressPercent(e),this.setValue({percent:e})}setSize(e,n){if(!e.width||!e.height)return;const i=this.getValue();(!n||!i.size||!i.size.height||!i.size.width)&&this.setValue({size:e}),this.widthInput&&(this.widthInput.get().value=e.width.toString()),this.heightInput&&(this.heightInput.get().value=e.height.toString())}onInputChange(e,n){var r,s,o,a,c;const i=this.getValue();typeof e=="string"&&(!/^[1-9]+(\d+)?$/.test(e)&&this.widthInput&&(e=((r=i==null?void 0:i.size)==null?void 0:r.width)||((s=i==null?void 0:i.size)==null?void 0:s.naturalWidth)||0,this.widthInput.get().value=e.toString()),e=parseInt(e.toString(),10)),typeof n=="string"&&(!/^[1-9]+(\d+)?$/.test(n)&&this.heightInput&&(n=((o=i==null?void 0:i.size)==null?void 0:o.height)||((a=i==null?void 0:i.size)==null?void 0:a.naturalHeight)||0,this.heightInput.get().value=n.toString()),n=parseInt(n.toString(),10)),(c=this.image)==null||c.changeSize(parseInt(e.toString(),10),n)}toolbar(){var r;const e=this.editor,n=()=>{var h,f,p,g;if(!V(e)||e.readonly)return[];const{language:s}=e;let o=this.getValue();if(this.isLocalError===!0||(o==null?void 0:o.status)!=="done")return[{key:"delete",type:"delete"}];const a=[{key:"copy",type:"copy"},{key:"delete",type:"delete"}];if(ue)return a;const c=[{key:"width",type:"input",placeholder:s.get("image","toolbbarWidthTitle").toString(),prefix:"W:",value:((h=o==null?void 0:o.size)==null?void 0:h.width)||0,didMount:m=>{this.widthInput=m.find("input[type=input]")},onChange:m=>{var b;const v=Math.round(parseInt(m,10)*(((b=this.image)==null?void 0:b.rate)||1));this.onInputChange(m,v)}},{key:"height",type:"input",placeholder:s.get("image","toolbbarHeightTitle").toString(),prefix:"H:",value:((f=o==null?void 0:o.size)==null?void 0:f.height)||0,didMount:m=>{this.heightInput=m.find("input[type=input]")},onChange:m=>{var b;const v=Math.round(parseInt(m,10)/(((b=this.image)==null?void 0:b.rate)||1));this.onInputChange(v,m)}},{key:"resize",type:"button",content:'<span class="data-icon data-icon-huanyuan"></span>',title:s.get("image","toolbarReductionTitle"),onClick:()=>{var m,v;o=this.getValue(),this.onInputChange(((m=o==null?void 0:o.size)==null?void 0:m.naturalWidth)||0,((v=o==null?void 0:o.size)==null?void 0:v.naturalHeight)||0)}}],u=[{key:"block",type:"button",content:'<span class="data-icon data-icon-block-image"></span>',title:s.get("image","displayBlockTitle"),onClick:()=>{this.type=Ve.BLOCK}},{key:"inline",type:"button",content:'<span class="data-icon data-icon-inline-image"></span>',title:s.get("image","displayInlineTitle"),onClick:()=>{this.type=Ve.INLINE}}],d=e.plugin.findPlugin("image");return a.concat([...((p=d==null?void 0:d.options)==null?void 0:p.enableResizer)===!1?[]:c,...((g=d==null?void 0:d.options)==null?void 0:g.enableTypeSwitch)===!1?[]:u])},i=(r=e.plugin.findPlugin("image"))==null?void 0:r.options;return i!=null&&i.cardToolbars?i.cardToolbars(n(),this.editor):n()}onActivate(e){var n,i;super.onActivate(e),e&&!this.selectedByOther?(n=this.image)==null||n.focus():(i=this.image)==null||i.blur()}onSelectByOther(e,n){var r,s,o;(s=(r=this.image)==null?void 0:r.root)==null||s.css("outline",e?"2px solid "+n.color:"");const i="card-selected-other";return e?this.root.addClass(i):this.root.removeClass(i),(o=this.image)==null?void 0:o.root}writeHistoryOnValueChange(){if(this.loading)return!1}render(e){var r,s,o,a,c;const n=this.getValue();if(!n)return;const i=this.editor;if(!this.image||this.image.root.length===0){const u=i.plugin.findPlugin("image");this.image=new Mse(i,{root:this.root,container:this.getCenter(),status:n.status||"done",src:n.src,size:n.size,alt:n.alt,link:n.link,display:this.type,percent:n.percent,message:n.message,enableResizer:(r=u==null?void 0:u.options)==null?void 0:r.enableResizer,onBeforeRender:(d,h)=>{const f=i.plugin.findPlugin("image");if(f){const{onBeforeRender:p}=f.options||{};if(p)return p(d,h,this.editor)}return h},onChange:(d,h)=>{V(i)&&!i.readonly&&d&&this.setSize(d,h)},onError:()=>{this.isLocalError=!0,this.didUpdate()},onLoad:()=>{var d;this.activated&&((d=this.image)==null||d.focus())},maxHeight:(s=u==null?void 0:u.options)==null?void 0:s.maxHeight})}else this.image.changeUrl(n.src),this.image.status=n.status||"done",this.image.message=n.message,this.image.size.width=((o=n.size)==null?void 0:o.width)||0,this.image.size.height=((a=n.size)==null?void 0:a.height)||0,n.percent&&this.image.setProgressPercent(n.percent),(c=this.image.resizer)==null||c.destroy();this.image.render(e)}didUpdate(){var e,n,i,r;super.didUpdate(),(n=(e=this.toolbarModel)==null?void 0:e.getContainer())==null||n.remove(),(i=this.toolbarModel)==null||i.create(),(r=this.toolbarModel)==null||r.setDefaultAlign("top")}didRender(){var n;this.getValue().status==="done"&&super.didRender(),(n=this.toolbarModel)==null||n.setDefaultAlign("top")}}const Cd="drop:files",Sd="paste:event",Ad="paste:schema",Td="paste:each",Nd="paste:after",Dd="markdown-it";class Sp extends _t{constructor(){super(...arguments);y(this,"cardComponents",{});y(this,"loadCounts",{});y(this,"extensionNames",{svg:"image/svg+xml",png:"image/png",bmp:"image/bmp",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tif:"image/tiff",tiff:"image/tiff",emf:"image/emf",webp:"image/webp"});y(this,"dropFiles",e=>{const n=this.editor;if(!!V(n)&&(e=e.filter(i=>this.isImage(i)),e.length!==0))return n.command.execute("image-uploader",e),!1});y(this,"pasteSchema",e=>{e.add({type:"inline",name:"img",isVoid:!0,attributes:{src:{required:!0,value:"@url"},width:"@number",height:"@number",style:{"max-width":"@length","max-height":"@length",width:"@length",height:"@length"},alt:"*",title:"*","data-type":"*","data-size":"@number","data-width":"@number","data-height":"@number"}})});y(this,"pasteFiles",({files:e})=>{const n=this.editor;if(!!V(n)&&(e=e.filter(i=>this.isImage(i)),e.length!==0))return n.command.execute("image-uploader",e),!1});y(this,"pasteEach",e=>{const n=this.editor,{isRemote:i}=this.options;if(e.isCard()&&e.attributes(We)){if(e.attributes(We)!=="image")return;const r=at(e.attributes(je));if(!r||!r.src){e.remove();return}i&&i(r.src)?(r.status="uploading",r.percent=0,n.card.replaceNode(e,"image",r)):r.status==="uploading"&&(r.percent=0,e.attributes(je,Pi({...r,status:"done"})));return}if(e.name==="img"){const r=e.attributes(),s=r.src||r["data-src"],o=r.alt;if(!s){e.remove();return}const a=n.plugin.findPlugin("image"),c=r.width,u=r.height,d=c||e.css("width"),h=u||e.css("height"),f=r["data-type"]||(a==null?void 0:a.options.defaultType);let p=Ve.INLINE;if(f==="block"){const g=e.parent();g&&g.name==="p"&&n.node.unwrap(g),p=Ve.BLOCK}n.card.replaceNode(e,"image",{type:p,src:s,status:i&&i(s)||/^data:image\//i.test(s)?"uploading":"done",alt:o,percent:0,size:{width:Ee(d),height:Ee(h)}}),e.remove()}});y(this,"pasteAfter",()=>{const e=this.editor;e.container.find("[data-card-key=image]").each((n,i)=>{const r=e.card.find(n);if(!r||!V(e))return;const s=r.getValue();if((s==null?void 0:s.status)!=="uploading"||Object.keys(this.cardComponents).find(c=>this.cardComponents[c].id===r.id))return;const{src:o}=s;if(/^data:image\//i.test(o)){const c=this.dataURIToFile(o),u=Jr(c),d=u?"image.".concat(u):"image",h=new globalThis.File([c],d);h.uid=new Date().getTime()+"-"+Zr(),e.command.execute("image-uploader",[h]),this.cardComponents[h.uid]=r;return}const{isRemote:a}=this.options;a&&a(o)&&this.uploadAddress(o,r)})});y(this,"markdownIt",e=>{this.options.markdown!==!1&&(e.enable("image"),e.enable("reference"))})}static get pluginName(){return"image-uploader"}init(){const e=this.editor;V(this.editor)&&(e.on(Cd,this.dropFiles),e.on(Sd,this.pasteFiles),e.on(Ad,this.pasteSchema),e.on(Td,this.pasteEach),e.on(Nd,this.pasteAfter),e.on(Dd,this.markdownIt));let{accept:n}=this.options.file||{};if(typeof n=="string"&&(n=n.split(",")),Array.isArray(n)){const i=[];(n||[]).forEach(r=>{r=r.trim();const s=r.split(".").pop();s&&i.push(s)}),i.length>0&&(this.extensionNames=i)}else typeof n=="object"&&(this.extensionNames=n)}isImage(e){const n=Jr(e),i=Array.isArray(this.extensionNames)?this.extensionNames:Object.keys(this.extensionNames);return i.indexOf("*")>=0||i.indexOf(n)>=0}dataURIToFile(e){let n;e.split(",")[0].indexOf("base64")>=0?n=atob(e.split(",")[1]):n=unescape(e.split(",")[1]);const i=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return new Blob([r],{type:i})}getUrl(e){const n=this.editor.plugin.components.image;if(n){const{onBeforeRender:i}=n.options||{};if(i)return i(e.status,e.src,this.editor)}return e.src}loadImage(e,n){this.loadCounts[e]||(this.loadCounts[e]=1);const i=new Image,r=this.editor;i.src=this.getUrl(n),i.onload=()=>{delete this.loadCounts[e],r.card.update(e,n)},i.onerror=()=>{this.loadCounts[e]<=3?setTimeout(()=>{this.loadCounts[e]++,this.loadImage(e,n)},500):(delete this.loadCounts[e],n.status="error",n.message=r.language.get("image","loadError"),r.card.update(e,n))}}async execute(e){const n=this.editor;if(!V(n))return;const{request:i,card:r,language:s}=n,{action:o,data:a,type:c,contentType:u,multiple:d,crossOrigin:h,withCredentials:f,headers:p,name:g}=this.options.file,{parse:m}=this.options,v=this.options.file.limitSize||5*1024*1024;if(!Array.isArray(e)&&typeof e!="string"){const b=Array.isArray(this.extensionNames)?"."+this.extensionNames.join(",."):Object.values(this.extensionNames).join(",");e=await i.getFiles({event:e,accept:Gr?"image/*":b.length>0?b:"",multiple:d})}else if(typeof e=="string"){this.insertRemote(e);return}e.length!==0&&i.upload({url:o,crossOrigin:h,withCredentials:f,headers:p,data:a,type:c,contentType:u,onBefore:b=>b.size>v?(n.messageError("upload-limit",s.get("image","uploadLimitError").toString().replace("$size",(v/1024/1024).toFixed(0)+"M")),!1):!0,onReady:b=>{if(!V(n)||!!this.cardComponents[b.uid])return;const _=b.src||"",x=typeof _!="string"?window.btoa(String.fromCharCode(...new Uint8Array(_))):_,w=E=>{var D;const S=n.plugin.findPlugin("image"),R=r.insert("image",{...E,status:"uploading",type:E.type||((D=S==null?void 0:S.options)==null?void 0:D.defaultType)},x);this.cardComponents[b.uid]=R};return new Promise(E=>{const S=new Image;S.src=x;const R=n.plugin.findPlugin("image");S.onload=()=>{var W;const{naturalWidth:D,naturalHeight:P,height:O,width:L}=S;let B=L,A=O;const F=(W=R==null?void 0:R.options)==null?void 0:W.maxHeight;F&&P>D&&O>F&&(A=F,B=D*(F/P)),w({src:"",size:{width:B,height:A,naturalHeight:S.naturalHeight,naturalWidth:S.naturalWidth}}),E()},S.onerror=()=>{w({src:"",status:"error"}),E()}})},onUploading:(b,{percent:_})=>{const x=this.cardComponents[b.uid||""];!x||x.setProgressPercent(_)},onSuccess:(b,_)=>{console.log("\u4E0A\u4F20\uFF1A",b);const x=this.cardComponents[_.uid||""];if(!x)return;let w=b.url||b.data&&b.data.url||b.src||b.data&&b.data.src;const E=m?m(b):w?{result:!0,data:w}:{result:!1};E.result?w=E.data:r.update(x.id,{status:"error",message:E.data||s.get("image","uploadError")});const S={status:"done"};w&&(S.src=w,this.loadImage(x.id,S)),delete this.cardComponents[_.uid||""]},onError:(b,_)=>{const x=this.cardComponents[_.uid||""];!x||(r.update(x.id,{status:"error",message:b.message||s.get("image","uploadError")}),delete this.cardComponents[_.uid||""])}},e,g)}async uploadAddress(e,n){const i=this.editor;if(!V(i))return;const{action:r,type:s,contentType:o,crossOrigin:a,withCredentials:c,headers:u,name:d,data:h}=this.options.remote,{parse:f}=this.options,p=d||"url";i.request.ajax({url:r,method:"POST",contentType:o||"application/json",type:s===void 0?"json":s,crossOrigin:a,withCredentials:c,headers:u,data:typeof h=="function"?async()=>({...await h(),[p]:e}):{...h,[p]:e},success:g=>{let m=g.url||g.data&&g.data.url||g.src||g.data&&g.data.src;const v=f?f(g):m?{result:!0,data:m}:{result:!1};v.result?m=v.data:i.card.update(n.id,{status:"error",message:v.data||i.language.get("image","uploadError")});const b={status:"done"};m&&(b.src=m,this.loadImage(n.id,b))},error:g=>{i.card.update(n.id,{status:"error",message:g.message||i.language.get("image","uploadError")})}})}insertRemote(e,n){const i=this.editor,r=i.plugin.findPlugin("image"),s={src:e,alt:n,status:"uploading",type:(r==null?void 0:r.options.defaultType)||Ve.INLINE},{isRemote:o}=this.options;if(o&&o(e)){const a=i.card.insert("image",s);this.uploadAddress(e,a);return}s.status="done",i.card.insert("image",s)}destroy(){const e=this.editor;V(e)&&(e.off(Cd,this.dropFiles),e.off(Sd,this.pasteFiles),e.off(Ad,this.pasteSchema),e.off(Td,this.pasteEach),e.off(Nd,this.pasteAfter),e.off(Dd,this.markdownIt))}}const Lse={image:{next:"Next",prev:"Previous",zoomIn:"Zoom In",zoomOut:"Zoom Out",originSize:"Origin Size",bestSize:"Best Size",errorMessageCopy:"Copy error message",loadError:"The picture failed to load!",uploadError:"The picture failed to upload!",uploadLimitError:"Upload image size is limited to $size",toolbarReductionTitle:"Reduction size",toolbarWidthTitle:"Width",toolbarHeightTitle:"Height",displayBlockTitle:"Block",displayInlineTitle:"In line"}},Ise={image:{next:"\u4E0B\u4E00\u5F20",prev:"\u4E0A\u4E00\u5F20",zoomIn:"\u653E\u5927",zoomOut:"\u7F29\u5C0F",originSize:"\u5B9E\u9645\u5C3A\u5BF8",bestSize:"\u9002\u5E94\u5C4F\u5E55",errorMessageCopy:"\u590D\u5236\u9519\u8BEF\u4FE1\u606F",loadError:"\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF01",uploadError:"\u4E0A\u4F20\u56FE\u7247\u5931\u8D25\uFF01",uploadLimitError:"\u4E0A\u4F20\u56FE\u7247\u5927\u5C0F\u9650\u5236\u4E3A $size",toolbarReductionTitle:"\u8FD8\u539F",toolbarWidthTitle:"\u5BBD\u5EA6",toolbarHeightTitle:"\u5BBD\u5EA6",displayBlockTitle:"\u72EC\u5360\u4E00\u884C",displayInlineTitle:"\u5D4C\u5165\u884C\u5185"}},Ose={"en-US":Lse,"zh-CN":Ise},Rd="parse:html";class Ap extends _t{constructor(){super(...arguments);y(this,"parseHtml",(e,n)=>{const i=[],r=this.editor;return e.find(`[${ke}="${$s.cardName}"],[${We}="${$s.cardName}"]`).each(s=>{const o=I(s),a=r.card.find(o),c=(a==null?void 0:a.getValue())||at(o.attributes(je));if((c==null?void 0:c.src)&&c.status==="done"){const u=o.find(".data-image-meta img");let d=u.length>0?u.clone(!0):I("<img />");o.empty();let h=c.src;const{onBeforeRender:f}=this.options;f&&(h=f(c.status,c.src,this.editor));const p=o.attributes(pt);d.attributes("src",h),d.css("visibility","visible");const g=c.size;g!=null&&g.width&&d.css("width",`${g.width}px`),g!=null&&g.height&&d.css("height",`${g.height}px`),d.removeAttributes("class"),d.attributes("data-type",p),n&&(d=n(d,c)),p===Ve.BLOCK&&(d=r.node.wrap(d,I('<p style="text-align:center;"></p>'))),o.replaceWith(d),i.push(d)}else o.remove()}),i})}static get pluginName(){return"image"}init(){const e=this.editor;e.language.add(Ose),e.on(Rd,this.parseHtml)}execute(e,n,i){const r={status:e,src:n,alt:i};e==="error"&&(r.src="",r.message=n),this.editor.card.insert("image",r)}async waiting(e){const{card:n}=this.editor,i=o=>{var a;return o.root.inEditor()&&o.name===$s.cardName&&((a=o.getValue())==null?void 0:a.status)==="uploading"},r=()=>n.components.find(i),s=o=>{let a=6e4;return new Promise((c,u)=>{if(e){const p=e(this.constructor.pluginName,o);if(p===!1)return u({name:this.constructor.pluginName,card:o});typeof p=="number"&&(a=p)}const d=new Date().getTime(),h=new Date().getTime(),f=()=>{if(h-d>=a)return c();setTimeout(()=>{i(o)?f():c()},10)};f()})};return new Promise(async(o,a)=>{const c=r(),u=d=>{s(d).then(()=>{const h=r();h?u(h):o()}).catch(a)};c?u(c):o()})}destroy(){this.editor.off(Rd,this.parseHtml)}}const Fse=mt({name:"am-link-editor",components:{FileManage:Yf},props:{defaultText:String,defaultLink:String,defaultjuptType:String,className:String,onLoad:Function,onOk:Function},setup(l){const[t,{openModal:e}]=Hf(),n=i=>{l.onOk&&l.onOk(i)};return Fi(()=>{e(!0,{filetype:"image",getnumber:"more",openfrom:"manage"})}),{registerModal:t,selectImg:n}}});function Bse(l,t,e,n,i,r){const s=ct("FileManage");return oe(),pe("div",null,[Ge(s,{onRegister:l.registerModal,onSuccess:l.selectImg},null,8,["onRegister","onSuccess"])])}const $se=gt(Fse,[["render",Bse]]);class Pse extends _t{static get pluginName(){return"imgattachment"}init(){}async execute(){const t=document.createElement("body"),e=dr($se,{onLoad:()=>{},onOk:n=>{for(let i of n.list)this.editor.command.execute("image","done",i)}});e.use(fg),e.mount(t)}destroy(){this.editor}}class ei extends Tt{constructor(){super(...arguments);y(this,"container");y(this,"getMaxWidth",()=>{var i;const e=this.editor.block.closest(this.root),n=this.root.find(".data-file-size");return e.get().clientWidth-36-(((i=n==null?void 0:n.get())==null?void 0:i.clientWidth)||0)});y(this,"onWindowResize",()=>{this.updateMaxWidth()});y(this,"updateMaxWidth",()=>{const e=this.getMaxWidth();this.root.find(".data-file-title").css("max-width",Math.max(e,0)+"px")});y(this,"onBeforeRender",(e,n)=>{const i=this.editor.plugin.findPlugin("file");if(i){const{onBeforeRender:r}=i.options||{};if(r)return r(e,n,this.editor)}return n});y(this,"destroy",()=>{super.destroy(),this.container=void 0,window.removeEventListener("resize",this.onWindowResize),this.editor.off("editor:resize",this.onWindowResize)})}static get cardName(){return"file"}static get cardType(){return Ve.INLINE}static get selectStyleType(){return ir.BACKGROUND}static get autoSelected(){return!1}static get collab(){return!1}getLocales(){return this.editor.language.get("file")}toolbar(){var r,s;const e=this.editor,n=(s=(r=e.plugin.findPlugin("file"))==null?void 0:r.options)!=null?s:{},i=()=>{const o=[],a=this.getValue();if(!a)return o;const{status:c,preview:u,download:d}=a,h=this.getLocales();if(c==="done"){if(u){const f=()=>{n.onPreview&&n.onPreview(u,a)};o.push({key:"preview",type:"button",content:'<span class="data-icon data-icon-preview" />',title:h.preview,link:n.onPreview?void 0:Sn(this.onBeforeRender("preview",u)),onClick:n.onPreview?f:void 0})}if(d){const f=()=>{n.onDownload&&n.onDownload(d,a)};o.push({key:"download",type:"button",content:'<span class="data-icon data-icon-download" />',title:h.download,link:n.onDownload?void 0:Sn(this.onBeforeRender("download",d)),onClick:n.onDownload?f:void 0})}!(!V(e)||e.readonly)&&o.length>0&&o.push({key:"separator",type:"separator"})}return!V(e)||e.readonly||o.push({key:"delete",type:"delete"}),o};return n!=null&&n.cardToolbars?n.cardToolbars(i(),this.editor):i()}renderTemplate(e){const{name:n,status:i,message:r,percent:s,size:o}=e,a=this.getLocales();if(i==="error")return`<span class="data-file-error"><span class="data-icon data-icon-error"></span>${r||a.loadError}<span class="data-icon data-icon-copy"></span></span>`;let c='<span class="data-icon data-icon-attachment"></span>';i==="uploading"&&(c=`<i class="data-anticon">
                        <svg viewBox="0 0 1024 1024" class="data-anticon-spin" data-icon="loading" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                            <path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path>
                        </svg>
                    </i>
                    `);let u="";const d=o?up(o):"";d&&(u=`<span class="data-file-size">(${dt(d)})</span>`);let h="";return i==="uploading"&&(h=`<span class="percent">${s||0}%</span>`),`
        <a class="data-file data-file-${i}">
            <span class="data-file-icon">${c}</span>
            ${h}
            <span class="data-file-title">${dt(n)}</span>
            ${u}
        </a>
        `}bindErrorEvent(e){const n=this.editor,i=e.find(".data-icon-copy");i.on("mouseenter",()=>{Ue.show(i,n.language.get("image","errorMessageCopy").toString())}),i.on("mouseleave",()=>{Ue.hide()}),i.on("click",r=>{var s;r.stopPropagation(),r.preventDefault(),Ue.hide(),n.clipboard.copy(((s=this.getValue())==null?void 0:s.message)||"Error message"),n.messageSuccess("copy",n.language.get("copy","success").toString())})}setProgressPercent(e){var n;(n=this.container)==null||n.find(".percent").html(`${e}%`),this.setValue({percent:e})}onActivate(e){var n,i;e?(n=this.container)==null||n.addClass("data-file-active"):(i=this.container)==null||i.removeClass("data-file-active")}writeHistoryOnValueChange(){if(this.loading)return!1}render(){var i;const e=this.getValue();if(!e)return;!this.container||this.container.length===0?(this.container=I(this.renderTemplate(e)),this.getCenter().empty().append(this.container)):this.container=this.getCenter().first();const n=this.editor;V(n)?this.container.attributes("draggable","true"):this.renderView(),e.status==="error"&&this.bindErrorEvent(this.root),(i=this.container)==null||i.find(".percent").html(`${e.percent}%`),this.updateMaxWidth(),window.addEventListener("resize",this.onWindowResize),n.on("editor:resize",this.onWindowResize)}renderView(){var r,s,o,a,c;const e=this.getValue(),n=(s=(r=this.editor.plugin.findPlugin("file"))==null?void 0:r.options)!=null?s:{},i=Sn(this.onBeforeRender("download",e.download||""));n.onDownload?(o=this.container)==null||o.on("click",()=>{n.onDownload(i,e)}):((a=this.container)==null||a.attributes("target","_blank"),(c=this.container)==null||c.attributes("href",i))}didUpdate(){var n,i,r;this.getValue().status==="done"&&super.didUpdate(),(i=(n=this.toolbarModel)==null?void 0:n.getContainer())==null||i.remove(),(r=this.toolbarModel)==null||r.create()}}const Md="drop:files",Ld="paste:event",Id="paste:each";class Tp extends _t{constructor(){super(...arguments);y(this,"cardComponents",{});y(this,"extensionNames",{"*":"*"});y(this,"dropFiles",e=>{const n=this.editor;if(!!V(n)&&(e=e.filter(i=>this.isFile(i)),e.length!==0))return n.command.execute("file-uploader",e),!1});y(this,"pasteFiles",({files:e})=>{const n=this.editor;if(!!V(n)&&(e=e.filter(i=>this.isFile(i)),e.length!==0))return n.command.execute("file-uploader",e.filter(i=>this.isFile(i)),e),!1});y(this,"pasteEach",e=>{if(e.isCard()&&e.attributes(We)){if(e.attributes(We)!=="file")return;const n=at(e.attributes(je));if(!n||!n.url){e.remove();return}n.status==="uploading"&&(n.percent=0,e.attributes(je,Pi({...n,status:"done"})));return}})}static get pluginName(){return"file-uploader"}init(){var i,r,s;const e=this.editor;V(e)&&(e.on(Md,this.dropFiles),e.on(Ld,this.pasteFiles),e.on(Id,this.pasteEach));let n=((i=this.options)==null?void 0:i.accept)||((s=(r=this.options)==null?void 0:r.file)==null?void 0:s.accept)||"*";if(typeof n=="string"&&(n=n.split(",")),Array.isArray(n)){const o=[];(n||[]).forEach(a=>{a=a.trim();const c=a.split(".").pop();c&&o.push(c)}),o.length>0&&(this.extensionNames=o)}else typeof n=="object"&&(this.extensionNames=n)}isFile(e){var r;const n=(r=Jr(e))!=null?r:"",i=Array.isArray(this.extensionNames)?this.extensionNames:Object.keys(this.extensionNames);return i.indexOf("*")>=0||i.indexOf(n)>=0}async execute(e){const n=this.editor;if(!V(n))return;const{request:i,card:r,language:s}=n,{action:o,type:a,contentType:c,multiple:u,crossOrigin:d,withCredentials:h,headers:f,name:p}=this.options;let g=this.options.data;typeof g=="function"&&(g=await g());const{parse:m}=this.options,v=this.options.limitSize||5*1024*1024;if(!Array.isArray(e)){const b=Array.isArray(this.extensionNames)?"."+this.extensionNames.join(",."):Object.values(this.extensionNames).join(",");e=await i.getFiles({event:e,accept:Gr?"*":b.length>0?b:"",multiple:u})}e.length!==0&&i.upload({url:o,data:g,type:a,contentType:c,crossOrigin:d,withCredentials:h,headers:f,onBefore:b=>b.size>v?(n.messageError("upload-limit",s.get("file","uploadLimitError").toString().replace("$size",(v/1024/1024).toFixed(0)+"M")),!1):!0,onReady:b=>{if(!V(n)||!!this.cardComponents[b.uid])return;const _=r.insert("file",{status:"uploading",name:b.name,size:b.size});this.cardComponents[b.uid]=_},onUploading:(b,{percent:_})=>{const x=this.cardComponents[b.uid||""];!x||x.setProgressPercent(_)},onSuccess:(b,_)=>{const x=this.cardComponents[_.uid||""];if(!x)return;const w=b.url||b.data&&b.data.url,E=b.preview||b.data&&b.data.preview,S=b.download||b.data&&b.data.download;let R={result:!0,data:{status:"done",url:w,preview:E,download:S}};if(m){const D=m(b);if(D.result){let P=R.data;typeof D.data=="string"?R.data={...P,url:D.data}:(P.url=D.data.url,D.data.status!==void 0&&(P={...P,status:D.data.status}),D.data.preview!==void 0&&(P={...P,preview:D.data.preview}),D.data.download!==void 0&&(P={...P,download:D.data.download}),R.data={...P})}else R={result:!1,data:D.data.toString()}}else w||(R={result:!1,data:b.data});if(!R.result)r.update(x.id,{status:"error",message:typeof R.data=="string"?R.data:s.get("file","uploadError")});else{const D=typeof R.data=="string"?{url:R.data}:{...R.data};n.card.update(x.id,D)}delete this.cardComponents[_.uid||""]},onError:(b,_)=>{const x=this.cardComponents[_.uid||""];!x||(r.update(x.id,{status:"error",message:b.message||s.get("file","uploadError")}),delete this.cardComponents[_.uid||""])}},e,p)}destroy(){const e=this.editor;V(e)&&(e.off(Md,this.dropFiles),e.off(Ld,this.pasteFiles),e.off(Id,this.pasteEach))}}const zse={file:{errorMessageCopy:"Copy error message",loadError:"The file failed to load!",uploadError:"The picture failed to upload!",uploadLimitError:"Upload file size is limited to $size",download:"Download",preview:"Preview"}},qse={file:{errorMessageCopy:"\u590D\u5236\u9519\u8BEF\u4FE1\u606F",loadError:"\u6587\u4EF6\u52A0\u8F7D\u5931\u8D25\uFF01",uploadError:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25\uFF01",uploadLimitError:"\u4E0A\u4F20\u6587\u4EF6\u5927\u5C0F\u9650\u5236\u4E3A $size",download:"\u4E0B\u8F7D",preview:"\u9884\u89C8"}},Hse={"en-US":zse,"zh-CN":qse},Od="parse:html",Fd="paste:schema",Bd="paste:each";class Wse extends _t{constructor(){super(...arguments);y(this,"pasteSchema",e=>{e.add({type:"inline",name:"span",attributes:{"data-type":{required:!0,value:ei.cardName},"data-value":"*"}})});y(this,"pasteHtml",e=>{const n=this.editor;if(!!V(n)){if(e.isElement()&&e.attributes("data-type")===ei.cardName){const r=e.attributes("data-value"),s=at(r);return s.url?(n.card.replaceNode(e,ei.cardName,s),e.remove(),!1):void 0}return!0}});y(this,"parseHtml",(e,n)=>{const i=[];return e.find(`[${ke}="${ei.cardName}"],[${We}="${ei.cardName}"`).each(r=>{const s=I(r),o=this.editor.card.find(s),a=(o==null?void 0:o.getValue())||at(s.attributes(je));if((a==null?void 0:a.url)&&a.status==="done"){const c=`<span data-type="${ei.cardName}" data-value="${Pi(a)}"><a target="_blank" href="${a.url}" style="word-wrap: break-word;color: #096DD9;touch-action: manipulation;background-color: rgba(0,0,0,0);text-decoration: none;outline: none;cursor: pointer;transition: color .3s;"><span style="font-size: 14px;">\u{1F4CE}</span>${a.name}</a></span>`;s.empty();let u=I(c);n&&(u=n(u,a)),s.replaceWith(u),i.push(u)}else s.remove()}),i})}static get pluginName(){return"file"}init(){const e=this.editor;e.language.add(Hse),e.on(Od,this.parseHtml),e.on(Bd,this.pasteHtml),e.on(Fd,this.pasteSchema)}execute(e,n,i,r,s,o){const a={status:e,url:n,name:i||n,size:r,preview:s,download:o};e==="error"&&(a.url="",a.message=n),this.editor.card.insert("file",a)}async waiting(e){const{card:n}=this.editor,i=o=>{var a;return o.root.inEditor()&&o.name===ei.cardName&&((a=o.getValue())==null?void 0:a.status)==="uploading"},r=()=>n.components.find(i),s=o=>{let a=6e4;return new Promise((c,u)=>{if(e){const p=e(this.name,o);if(p===!1)return u({name:this.name,card:o});typeof p=="number"&&(a=p)}const d=new Date().getTime(),h=new Date().getTime(),f=()=>{if(h-d>=a)return c();setTimeout(()=>{i(o)?f():c()},10)};f()})};return new Promise(async(o,a)=>{const c=r(),u=d=>{s(d).then(()=>{const h=r();h?u(h):o()}).catch(a)};c?u(c):o()})}destroy(){const e=this.editor;e.off(Od,this.parseHtml),e.off(Bd,this.pasteHtml),e.off(Fd,this.pasteSchema)}}class ti extends Tt{constructor(){super(...arguments);y(this,"maxWidth",0);y(this,"resizer");y(this,"video");y(this,"isLoad",!1);y(this,"container");y(this,"videoContainer");y(this,"title");y(this,"mask");y(this,"rate",1);y(this,"_fullWidth");y(this,"_naturalSize",{width:0,height:0});y(this,"onBeforeRender",(e,n)=>{const i=this.editor.plugin.findPlugin("video");if(i){const{onBeforeRender:r}=i.options||{};if(r)return r(e,n,this.editor)}return n});y(this,"downloadFile",()=>{const e=this.getValue();!(e!=null&&e.download)||window.open(Sn(this.onBeforeRender("download",e.url)))});y(this,"onWindowResize",()=>{var e,n;!V(this.editor)||(this.maxWidth=this.getMaxWidth(),this.resetSize(),this.resizer&&(this.resizer.maxWidth=this.maxWidth,this.resizer.setSize(((e=this.videoContainer)==null?void 0:e.width())||0,((n=this.videoContainer)==null?void 0:n.height())||0)))});y(this,"handleClick",e=>{const n=this.editor;V(n)&&!this.activated&&n.card.activate(this.root,ui.MOUSE_DOWN,e)})}static get cardName(){return"video"}static get cardType(){return Ve.BLOCK}static get autoSelected(){return!1}getLocales(){return this.editor.language.get("video")}renderTemplate(e){const{name:n,status:i,size:r,message:s,percent:o}=e,a=this.getLocales(),c={video:`<div class="data-video-icon">
                <svg width="32px" height="24px" viewBox="0 0 32 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" fill-opacity="0.25"><g transform="translate(-704.000000, -550.000000)" fill="#000000" fill-rule="nonzero">  <g transform="translate(704.000000, 550.000000)">    <g>      <path d="M13.09375,17.30625 L20.65625,12.375 C20.95,12.16875 20.95,11.809375 20.65625,11.603125 L13.09375,6.696875 C12.66875,6.4 12,6.6375 12,7.084375 L12,16.921875 C12,17.365625 12.671875,17.603125 13.09375,17.30625 Z" id="Path"></path>      <path d="M30,0 L2,0 C0.896875,0 0,0.896875 0,2 L0,22 C0,23.103125 0.896875,24 2,24 L30,24 C31.103125,24 32,23.103125 32,22 L32,2 C32,0.896875 31.103125,0 30,0 Z M5.25,21.25 C5.25,21.525 5.025,21.75 4.75,21.75 L2.5,21.75 C2.225,21.75 2,21.525 2,21.25 L2,18.5 C2,18.225 2.225,18 2.5,18 L4.75,18 C5.025,18 5.25,18.225 5.25,18.5 L5.25,21.25 Z M5.25,13.375 C5.25,13.65 5.025,13.875 4.75,13.875 L2.5,13.875 C2.225,13.875 2,13.65 2,13.375 L2,10.625 C2,10.35 2.225,10.125 2.5,10.125 L4.75,10.125 C5.025,10.125 5.25,10.35 5.25,10.625 L5.25,13.375 Z M5.25,5.5 C5.25,5.775 5.025,6 4.75,6 L2.5,6 C2.225,6 2,5.775 2,5.5 L2,2.75 C2,2.475 2.225,2.25 2.5,2.25 L4.75,2.25 C5.025,2.25 5.25,2.475 5.25,2.75 L5.25,5.5 Z M24.75,21.75 L7.25,21.75 L7.25,2.25 L24.75,2.25 L24.75,21.75 Z M30,21.25 C30,21.525 29.775,21.75 29.5,21.75 L27.25,21.75 C26.975,21.75 26.75,21.525 26.75,21.25 L26.75,18.5 C26.75,18.225 26.975,18 27.25,18 L29.5,18 C29.775,18 30,18.225 30,18.5 L30,21.25 Z M30,13.375 C30,13.65 29.775,13.875 29.5,13.875 L27.25,13.875 C26.975,13.875 26.75,13.65 26.75,13.375 L26.75,10.625 C26.75,10.35 26.975,10.125 27.25,10.125 L29.5,10.125 C29.775,10.125 30,10.35 30,10.625 L30,13.375 Z M30,5.5 C30,5.775 29.775,6 29.5,6 L27.25,6 C26.975,6 26.75,5.775 26.75,5.5 L26.75,2.75 C26.75,2.475 26.975,2.25 27.25,2.25 L29.5,2.25 C29.775,2.25 30,2.475 30,2.75 L30,5.5 Z" id="Shape"></path>    </g>  </g></g> </g></svg></div>`,spin:'<i class="data-video-anticon"><svg viewBox="0 0 1024 1024" class="data-video-anticon-spin" data-icon="loading" width="1em" height="1em" fill="currentColor" aria-hidden="true"> <path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg></i>',warn:'<div class="data-video-icon"><svg width="41px" height="29px" viewBox="0 0 41 29" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-704.000000, -550.000000)">  <g id="Group-2" transform="translate(704.000000, 550.000000)">    <g id="video" fill="#000000" fill-rule="nonzero" opacity="0.449999988">      <path d="M13.09375,17.30625 C12.671875,17.603125 12,17.365625 12,16.921875 L12,7.084375 C12,6.6375 12.66875,6.4 13.09375,6.696875 L20.65625,11.603125 C20.95,11.809375 20.95,12.16875 20.65625,12.375 L13.09375,17.30625 Z M30,0 C31.103125,0 32,0.896875 32,2 L32,22 C32,23.103125 31.103125,24 30,24 L2,24 C0.896875,24 0,23.103125 0,22 L0,2 C0,0.896875 0.896875,0 2,0 L30,0 Z M5.25,21.25 L5.25,18.5 C5.25,18.225 5.025,18 4.75,18 L2.5,18 C2.225,18 2,18.225 2,18.5 L2,21.25 C2,21.525 2.225,21.75 2.5,21.75 L4.75,21.75 C5.025,21.75 5.25,21.525 5.25,21.25 Z M5.25,13.375 L5.25,10.625 C5.25,10.35 5.025,10.125 4.75,10.125 L2.5,10.125 C2.225,10.125 2,10.35 2,10.625 L2,13.375 C2,13.65 2.225,13.875 2.5,13.875 L4.75,13.875 C5.025,13.875 5.25,13.65 5.25,13.375 Z M5.25,5.5 L5.25,2.75 C5.25,2.475 5.025,2.25 4.75,2.25 L2.5,2.25 C2.225,2.25 2,2.475 2,2.75 L2,5.5 C2,5.775 2.225,6 2.5,6 L4.75,6 C5.025,6 5.25,5.775 5.25,5.5 Z M24.75,21.75 L24.75,2.25 L7.25,2.25 L7.25,21.75 L24.75,21.75 Z M30,21.25 L30,18.5 C30,18.225 29.775,18 29.5,18 L27.25,18 C26.975,18 26.75,18.225 26.75,18.5 L26.75,21.25 C26.75,21.525 26.975,21.75 27.25,21.75 L29.5,21.75 C29.775,21.75 30,21.525 30,21.25 Z M30,13.375 L30,10.625 C30,10.35 29.775,10.125 29.5,10.125 L27.25,10.125 C26.975,10.125 26.75,10.35 26.75,10.625 L26.75,13.375 C26.75,13.65 26.975,13.875 27.25,13.875 L29.5,13.875 C29.775,13.875 30,13.65 30,13.375 Z M30,5.5 L30,2.75 C30,2.475 29.775,2.25 29.5,2.25 L27.25,2.25 C26.975,2.25 26.75,2.475 26.75,2.75 L26.75,5.5 C26.75,5.775 26.975,6 27.25,6 L29.5,6 C29.775,6 30,5.775 30,5.5 Z" id="Combined-Shape"></path>    </g>    <g id="error-fill" transform="translate(21.000000, 10.000000)">      <rect id="Rectangle" fill="#000000" opacity="0" x="0" y="0" width="20" height="20"></rect>      <path d="M19.0267927,16.510301 L19.0272631,16.5111171 C19.4269215,17.2064579 18.9263267,18.0729167 18.125,18.0729167 L1.875,18.0729167 C1.07367326,18.0729167 0.573078461,17.2064579 0.973207261,16.510301 L9.0970084,2.44988987 C9.28650026,2.11750251 9.63068515,1.92708333 10,1.92708333 C10.368224,1.92708333 10.7098796,2.11659543 10.9017927,2.447801 L19.0267927,16.510301 Z" id="Path" stroke="#FFFFFF" stroke-width="0.833333333" fill="#FFFFFF"></path>      <path d="M18.6660156,16.71875 L10.5410156,2.65625 C10.4199219,2.44726562 10.2109375,2.34375 10,2.34375 C9.7890625,2.34375 9.578125,2.44726562 9.45898438,2.65625 L1.33398438,16.71875 C1.09375,17.1367188 1.39453125,17.65625 1.875,17.65625 L18.125,17.65625 C18.6054688,17.65625 18.90625,17.1367188 18.6660156,16.71875 Z M9.375,8.125 C9.375,8.0390625 9.4453125,7.96875 9.53125,7.96875 L10.46875,7.96875 C10.5546875,7.96875 10.625,8.0390625 10.625,8.125 L10.625,11.71875 C10.625,11.8046875 10.5546875,11.875 10.46875,11.875 L9.53125,11.875 C9.4453125,11.875 9.375,11.8046875 9.375,11.71875 L9.375,8.125 Z M10,15 C9.48242188,15 9.0625,14.5800781 9.0625,14.0625 C9.0625,13.5449219 9.48242188,13.125 10,13.125 C10.5175781,13.125 10.9375,13.5449219 10.9375,14.0625 C10.9375,14.5800781 10.5175781,15 10,15 Z" id="Shape" fill="#FAAD14" fill-rule="nonzero"></path></g></g></g> </g></svg></div>',error:'<span class="data-error-icon">X</span>'};if(i==="error")return`
            <div class="data-video">
                <div class="data-video-content data-video-error">
                    <div class="data-video-center">
                        <div class="data-video-name">${dt(n)}</div>
                        <div class="data-video-message">
                            ${c.error}
                            ${s||a.loadError}
                        </div>
                    </div>
                </div>
            </div>`;const u=r?up(r):"",d=n?`<div class="data-video-title">${dt(n)}</div>`:"";if(i==="uploading")return`
            <div class="data-video">
                <div class="data-video-content data-video-uploading">
                    <div class="data-video-center">
                        ${c.video}
                        <div class="data-video-name">
                        ${dt(n)} (${dt(u)})
                        </div>
                        <div class="data-video-progress">
                            ${c.spin}
                            <span class="percent">${o||0}%<span>
                        </div>
                    </div>
                </div>
            </div>`;const h=typeof i>"u";if(i==="transcoding"||h)return`
            <div class="data-video">
                <div class="data-video-content data-video-uploaded">
                    <div class="data-video-center">
                        ${c.video}
                        <div class="data-video-name">
                        ${dt(n)} (${dt(u)})
                        </div>
                        <div class="data-video-transcoding">
                            ${c.spin}
                            <span class="transcoding">${h?a.loading:a.transcoding}%<span>
                        </div>
                    </div>
                </div>
            </div>
            `;const f=this.editor.plugin.components.video;return`
        <div class="data-video">
            <div class="data-video-content data-video-done"></div>
			${f&&f.options.showTitle!==!1?d:""}
        </div>
        `}initPlayer(){var u,d,h;const e=this.getValue();if(!e)return;const n=Sn(this.onBeforeRender("query",e.url)),i=document.createElement("video");i.preload="metadata",i.setAttribute("src",n),i.setAttribute("webkit-playsinline","webkit-playsinline"),i.setAttribute("playsinline","playsinline");const{cover:r}=e;r&&(i.poster=Sn(this.onBeforeRender("cover",r))),this.maxWidth=this.getMaxWidth();const s=(u=this.container)==null?void 0:u.find(".data-video-content");if(!s)return;s.append(i),this.mask=I('<div class="data-video-mask" />'),s.append(this.mask),this.videoContainer=(d=this.container)==null?void 0:d.find(".data-video-content"),i.oncontextmenu=function(){return!1};const o=this.editor.plugin.findPlugin("video");let a=o==null?void 0:o.options.fullEditor;const c=this.editor;i.onloadedmetadata=()=>{(!e.naturalWidth||!e.naturalHeight)&&(e.naturalWidth=i.videoWidth,e.naturalHeight=i.videoHeight,this.setValue({naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight})),a&&this._fullWidth&&(e.naturalWidth<this._fullWidth||typeof a=="number")?(typeof a=="boolean"?(this.rate=i.videoHeight/i.videoWidth,a=this._fullWidth*this.rate):this.rate=a/this._fullWidth,this._naturalSize={width:this._fullWidth,height:a}):(this._naturalSize={width:e.naturalWidth||i.videoWidth,height:e.naturalHeight||i.videoHeight},this.rate=this._naturalSize.height/this._naturalSize.width),this.resetSize()},this.video=I(i),this.title=(h=this.container)==null?void 0:h.find(".data-video-title"),e.width&&e.height&&(this.rate=e.height/e.width),this._naturalSize={width:e.naturalWidth||i.videoWidth,height:e.naturalHeight||i.videoHeight},this.resetSize(),setTimeout(()=>{i.controls=!0,V(c)||(i.controlsList="nodownload")},0)}toolbar(){var r;const e=this.editor,n=()=>{const s=[],o=this.getValue();if(!o)return s;const{status:a,download:c}=o,u=this.getLocales();return a==="done"&&(c&&s.push({key:"dropdown",type:"button",content:'<span class="data-icon data-icon-download" />',title:u.download,onClick:this.downloadFile}),V(e)&&!e.readonly&&(s.push({key:"copy",type:"copy"}),s.push({key:"separator",type:"separator"}))),V(e)&&!e.readonly&&s.push({key:"delete",type:"delete"}),s},i=(r=e.plugin.findPlugin("video"))==null?void 0:r.options;return i!=null&&i.cardToolbars?i.cardToolbars(n(),this.editor):n()}setProgressPercent(e){var n;(n=this.container)==null||n.find(".percent").html(`${e}%`),this.setValue({percent:e})}getMaxWidth(e=this.getCenter()){const n=this.editor.block.closest(e).get();return n?n.clientWidth:0}resetSize(){var a,c,u;if(!this.videoContainer)return;const e=this.getValue();if(!e)return;this.videoContainer.css({width:"",height:""}),(a=this.container)==null||a.css({width:""});const n=this.editor.plugin.findPlugin("video"),i=n==null?void 0:n.options.fullEditor;if(!((c=this.video)==null?void 0:c.get()))return;let{width:s,height:o}=e;o?s?s&&o?o=Math.round(this.rate*s):(s=this._naturalSize.width,o=this._naturalSize.height):(o=this._naturalSize.height,s=Math.round(o/this.rate)):(s=this._naturalSize.width,o=Math.round(this.rate*s)),s>this.maxWidth&&(s=this.maxWidth,o=Math.round(s*this.rate)),!(s===0||o===0)&&((u=this.container)==null||u.css({width:s>0?`${s}px`:""}),this.videoContainer.css("width",s>0?`${s}px`:""),typeof i=="number"&&this.videoContainer.css("height",o>0?`${o}px`:""))}changeSize(e,n){var s,o,a,c;e<24&&(e=24,n=e*this.rate),e>this.maxWidth&&(e=this.maxWidth,n=e*this.rate),n<24&&(n=24,e=n/this.rate),e=Math.round(e),n=Math.round(n),(s=this.videoContainer)==null||s.css({width:e>0?`${e}px`:""});const i=this.editor.plugin.findPlugin("video");typeof(i==null?void 0:i.options.fullEditor)=="number"&&((o=this.videoContainer)==null||o.css({height:`${n}px`})),(a=this.container)==null||a.css({width:e>0?`${e}px`:""}),this.setValue({width:e,height:n}),(c=this.resizer)==null||c.destroy(),this.initResizer()}initResizer(){var c;const e=this.getValue();if(!e)return;let{status:n}=e;if(n!=="done")return;const{width:i,height:r,cover:s}=e;this.maxWidth=this.getMaxWidth();const o=new fp({imgUrl:s,width:i||this._naturalSize.width,height:r||this._naturalSize.height,rate:this.rate,maxWidth:this.maxWidth,onChange:({width:u,height:d})=>this.changeSize(u,d)});this.resizer=o;const a=o.render();(c=this.videoContainer)==null||c.append(a)}onActivate(e){var n,i,r,s,o;super.onActivate(e),e?((n=this.container)==null||n.addClass("data-video-active"),(i=this.mask)==null||i.hide(),this.initResizer()):((r=this.container)==null||r.removeClass("data-video-active"),(s=this.mask)==null||s.show(),(o=this.resizer)==null||o.destroy())}onSelectByOther(e,n){var r;(r=this.container)==null||r.css("outline",e?"2px solid "+n.color:"");const i="card-selected-other";return e?this.root.addClass(i):this.root.removeClass(i),this.container}writeHistoryOnValueChange(){if(this.loading)return!1}checker(e,n,i){const{command:r}=this.editor,s=()=>{r.executeMethod("video-uploader","query",e,o=>{o&&o.status!=="done"?setTimeout(s,3e3):n(o)},o=>{i(o)})};s()}render(){const e=this.getValue(),n=this.getCenter(),i=this.editor;if(this._fullWidth=i.container.width()-Ee(i.container.css("padding-left"))-Ee(i.container.css("padding-right")),!e||this.container&&this.container.inEditor()){this.container=I(this.renderTemplate({...e})),n.empty(),n.append(this.container),this.initPlayer();return}n.empty();const{command:r,plugin:s}=i,{video_id:o,status:a}=e,c=this.getLocales();if(this.maxWidth=this.getMaxWidth(),V(i))if(a==="transcoding"){if(this.container=I(this.renderTemplate(e)),!o)throw"video id is undefined";return this.checker(o,u=>{const d={...e,url:u!=null&&u.url?u.url:e.url,name:u!=null&&u.name?u.name:e.name,cover:u!=null&&u.cover?u.cover:e.cover,download:u!=null&&u.download?u.download:e.download,status:"done"};this.setValue(d),this.container=I(this.renderTemplate(d)),n.empty(),n.append(this.container),this.initPlayer()},u=>{const d={...e,status:"error",message:u||c.loadError};this.setValue(d),this.container=I(this.renderTemplate(d)),n.empty(),n.append(this.container)}),this.container}else return a==="done"?(this.container=I(this.renderTemplate({...e,status:void 0})),r.executeMethod("video-uploader","query",o,u=>{const d={...e,url:u!=null&&u.url?u.url:e.url,name:u!=null&&u.name?u.name:e.name,cover:u!=null&&u.cover?u.cover:e.cover,download:u!=null&&u.download?u.download:e.download};this.container=I(this.renderTemplate(d)),this.video=this.container.find("video"),n.empty(),n.append(this.container),this.initPlayer()},u=>{this.container=I(this.renderTemplate({...e,status:"error",message:u||c.loadError})),n.empty(),n.append(this.container)}),this.container):(this.container=I(this.renderTemplate(e)),this.container);else if(a==="done"){this.container=I(this.renderTemplate({...e,status:void 0}));const u=d=>{const h={...e,url:d!=null&&d.url?d.url:e.url,name:d!=null&&d.name?d.name:e.name,cover:d!=null&&d.cover?d.cover:e.cover,download:d!=null&&d.download?d.download:e.download};this.container=I(this.renderTemplate(h)),n.empty(),n.append(this.container),this.initPlayer()};return s.components["video-uploader"]?r.executeMethod("video-uploader","query",o,d=>{u(d)},d=>{this.container=I(this.renderTemplate({...e,status:"error",message:d||c.loadError})),n.empty(),n.append(this.container)}):u(),this.container}else if(a==="error")return I(this.renderTemplate({...e,message:e.message||c.loadError}))}didUpdate(){var e;super.didUpdate(),(e=this.toolbarModel)==null||e.setDefaultAlign("top")}didRender(){var i,r,s;this.getValue().status==="done"&&super.didRender(),this.onWindowResize();const n=this.editor;window.addEventListener("resize",this.onWindowResize),n.on("editor:resize",this.onWindowResize),(i=this.toolbarModel)==null||i.setDefaultAlign("top"),(r=this.container)==null||r.on("mousedown",this.handleClick),(!V(n)||n.readonly)&&((s=this.mask)==null||s.hide())}destroy(){var e;super.destroy(),(e=this.container)==null||e.off("mousedown",this.handleClick),window.removeEventListener("resize",this.onWindowResize),this.editor.off("editor:resize",this.onWindowResize)}}const $d="drop:files",Pd="paste:event",zd="paste:each";class Np extends _t{constructor(){super(...arguments);y(this,"cardComponents",{});y(this,"extensionNames",{mp4:"video/mp4"});y(this,"dropFiles",e=>{const n=this.editor;if(!!V(n)&&(e=e.filter(i=>this.isVideo(i)),e.length!==0))return n.command.execute("video-uploader",e),!1});y(this,"pasteFiles",({files:e})=>{const n=this.editor;if(!!V(n)&&(e=e.filter(i=>this.isVideo(i)),e.length!==0))return n.command.execute("video-uploader",e.filter(i=>this.isVideo(i)),e),!1});y(this,"pasteEach",e=>{if(e.isCard()&&e.attributes(We)){if(e.attributes(We)!=="video")return;const n=at(e.attributes(je));if(!n||!n.url){e.remove();return}n.status==="uploading"&&(n.percent=0,e.attributes(je,Pi({...n,status:"done"})));return}})}static get pluginName(){return"video-uploader"}init(){const e=this.editor;V(e)&&(e.on($d,this.dropFiles),e.on(Pd,this.pasteFiles),e.on(zd,this.pasteEach));let{accept:n}=this.options.file||{};if(typeof n=="string"&&(n=n.split(",")),Array.isArray(n)){const i=[];(n||[]).forEach(r=>{r=r.trim();const s=r.split(".").pop();s&&i.push(s)}),i.length>0&&(this.extensionNames=i)}else typeof n=="object"&&(this.extensionNames=n)}isVideo(e){const n=Jr(e),i=Array.isArray(this.extensionNames)?this.extensionNames:Object.keys(this.extensionNames);return i.indexOf("*")>=0||i.indexOf(n)>=0}async execute(e,...n){if(typeof e=="string"){switch(e){case"query":return this.query(n[0],n[1],n[2])}return}const i=this.editor,{request:r,card:s,language:o}=i,{action:a,data:c,type:u,contentType:d,multiple:h,crossOrigin:f,withCredentials:p,headers:g,name:m}=this.options,{parse:v}=this.options,b=this.options.limitSize||5*1024*1024;if(!Array.isArray(e)){const _=Array.isArray(this.extensionNames)?"."+this.extensionNames.join(",."):Object.values(this.extensionNames).join(",");e=await r.getFiles({event:e,accept:Gr?"video/*":_.length>0?_:"",multiple:h})}e.length!==0&&r.upload({url:a,data:c,type:u,contentType:d,crossOrigin:f,withCredentials:p,headers:g,onBefore:_=>_.size>b?(i.messageError("upload-limit",o.get("video","uploadLimitError").toString().replace("$size",(b/1024/1024).toFixed(0)+"M")),!1):!0,onReady:_=>{if(!V(i)||!!this.cardComponents[_.uid])return;const x=s.insert("video",{status:"uploading",name:_.name,size:_.size});this.cardComponents[_.uid]=x},onUploading:(_,{percent:x})=>{const w=this.cardComponents[_.uid||""];!w||w.setProgressPercent(x)},onSuccess:(_,x)=>{const w=this.cardComponents[x.uid||""];if(!w)return;const E=_.id||_.data&&_.data.id;let S=_.url||_.data&&_.data.url;const R=_.cover||_.data&&_.data.cover,D=_.download||_.data&&_.data.download,P=_.width||_.data&&_.data.width,O=_.height||_.data&&_.data.height;let L=_.status||_.data&&_.data.status;L=L==="transcoding"?"transcoding":"done";let B={result:!0,data:{video_id:E,url:S,cover:R,download:D,status:L,width:P,height:O}};if(v){const A=v(_);if(A.result){let F=B.data;typeof A.data=="string"?B.data={...F,url:A.data}:(F.url=A.data.url,A.data.status!==void 0&&(F={...F,status:A.data.status}),A.data.id!==void 0&&(F={...F,video_id:A.data.id}),A.data.cover!==void 0&&(F={...F,cover:A.data.cover}),A.data.width!==void 0&&(F={...F,width:A.data.width}),A.data.height!==void 0&&(F={...F,height:A.data.height}),B.data={...F})}else B={result:!1,data:A.data.toString()}}else S||(B={result:!1,data:_.data});B.result?i.card.update(w.id,typeof B.data=="string"?{url:B.data}:{...B.data,naturalWidth:B.data.width,naturalHeight:B.data.height}):s.update(w.id,{status:"error",message:typeof B.data=="string"?B.data:o.get("video","uploadError")}),delete this.cardComponents[x.uid||""]},onError:(_,x)=>{const w=this.cardComponents[x.uid||""];!w||(s.update(w.id,{status:"error",message:_.message||o.get("video","uploadError")}),delete this.cardComponents[x.uid||""])}},e,m)}query(e,n,i=()=>{}){const{request:r,language:s}=this.editor,{query:o,parse:a}=this.options;if(!o||!e)return n();const{action:c,type:u,contentType:d,data:h,headers:f}=o;r.ajax({url:c,contentType:d||"",type:u===void 0?"json":u,headers:f,data:typeof h=="function"?async()=>({...await h(),id:e}):{...h,id:e},success:p=>{const{result:g,data:m}=p;if(!g)i(m);else{const v=a?a(p):p;v.result===!1?i(v.data||s.get("video","loadError")):n({...v.data,status:v.data.status!=="transcoding"?"done":"transcoding"})}},error:p=>{i(p.message||s.get("video","loadError"))},method:"GET"})}destroy(){const e=this.editor;e.off($d,this.dropFiles),e.off(Pd,this.pasteFiles),e.off(zd,this.pasteEach)}}const Use={video:{errorMessageCopy:"Copy error message",loadError:"The video failed to load!",uploadError:"The video failed to upload!",uploadLimitError:"Upload video size is limited to $size",download:"Download",preview:"Preview",loading:"Loading...",transcoding:"Transcoding..."}},jse={video:{errorMessageCopy:"\u590D\u5236\u9519\u8BEF\u4FE1\u606F",loadError:"\u89C6\u9891\u52A0\u8F7D\u5931\u8D25\uFF01",uploadError:"\u4E0A\u4F20\u89C6\u9891\u5931\u8D25\uFF01",uploadLimitError:"\u4E0A\u4F20\u89C6\u9891\u5927\u5C0F\u9650\u5236\u4E3A $size",download:"\u4E0B\u8F7D",preview:"\u9884\u89C8",loading:"\u52A0\u8F7D\u4E2D...",transcoding:"\u8F6C\u7801\u4E2D..."}},Vse={"en-US":Use,"zh-CN":jse},qd="parse:html",Hd="paste:each",Wd="paste:schema";class Gse extends _t{constructor(){super(...arguments);y(this,"pasteSchema",e=>{e.add({type:"block",name:"div",attributes:{"data-value":"*","data-type":{required:!0,value:ti.cardName}}})});y(this,"pasteHtml",e=>{const n=this.editor;if(!!V(n)){if(e.isElement()&&e.attributes("data-type")===ti.cardName){const r=e.attributes("data-value"),s=at(r);return s.url?(n.card.replaceNode(e,ti.cardName,s),e.remove(),!1):void 0}return!0}});y(this,"parseHtml",(e,n)=>{const i=[];return e.find(`[${ke}="${ti.cardName}"],[${We}="${ti.cardName}"]`).each(r=>{const s=I(r),o=this.editor.card.find(s),a=(o==null?void 0:o.getValue())||at(s.attributes(je));if((a==null?void 0:a.url)&&a.status==="done"){const{onBeforeRender:c}=this.options,{cover:u,url:d}=a,h=`<div data-type="${ti.cardName}"  data-value="${Pi(a)}"><video controls src="${Sn(c?c("query",d,this.editor):d)}" poster="${u?Sn(c?c("cover",u,this.editor):u):"none"}" webkit-playsinline="webkit-playsinline" playsinline="playsinline" style="outline:none;" /></div>`;s.empty();let f=I(h);n&&(f=n(f,a)),s.replaceWith(f),i.push(f)}else s.remove()}),i})}static get pluginName(){return"video"}init(){const e=this.editor;e.language.add(Vse),e.on(qd,this.parseHtml),e.on(Hd,this.pasteHtml),e.on(Wd,this.pasteSchema)}execute(e,n,i,r,s,o,a,c,u,d,h){const f={status:e,video_id:r,cover:s,url:n,name:i||n,size:o,download:a,width:d,height:h,naturalWidth:c,naturalHeight:u};e==="error"&&(f.url="",f.message=n),this.editor.card.insert("video",f)}async waiting(e){const{card:n}=this.editor,i=o=>{var a;return o.root.inEditor()&&o.name===ti.cardName&&((a=o.getValue())==null?void 0:a.status)==="uploading"},r=()=>n.components.find(i),s=o=>{let a=6e4;return new Promise((c,u)=>{if(e){const p=e(this.constructor.pluginName,o);if(p===!1)return u({name:this.constructor.pluginName,card:o});typeof p=="number"&&(a=p)}const d=new Date().getTime(),h=new Date().getTime(),f=()=>{if(h-d>=a)return c();setTimeout(()=>{i(o)?f():c()},10)};f()})};return new Promise(async(o,a)=>{const c=r(),u=d=>{s(d).then(()=>{const h=r();h?u(h):o()}).catch(a)};c?u(c):o()})}destroy(){const e=this.editor;e.off(qd,this.parseHtml),e.off(Hd,this.pasteHtml),e.off(Wd,this.pasteSchema)}}var Zse=Ol;function Kse(l){return typeof l=="number"&&l==Zse(l)}var Ud=Kse;const Aa="table-wrapper",Ta="table-overflow",jd="data-table",Vd="table-cols-header",Gd="table-cols-header-item",Zd="cols-trigger",Xse="cols-addition-header",Kd="table-rows-header",Xd="table-rows-header-item",Yd="rows-trigger",Na="table-header",Jd="table-menubar",Qd="table-menubar-item",ef="table-menubar-item-input",tf="table-viewport",nf="data-table-reader",rf="table-placeholder",Yse="multi-addition",sf="table-highlight",of="table-row-delete-button",af="table-col-delete-button",lf="table-row-add-button",cf="table-row-add-split-button",uf="table-col-add-button",df="table-col-add-split-button",ff="table-main-content",hf="table-main-bg",Xs=class{constructor(t){y(this,"isReadonly",!1);y(this,"table");this.table=t}static EmptyCell(t=!1){return`<div class="${ff}" ${Nt}="${yt}" ${yt}="${t?"false":"true"}" ${le}="${pi}"><p><br /></p></div>${Xs.CellBG}`}getEmptyCell(){return Xs.EmptyCell(this.isReadonly)}renderRowsHeader(t){return`<div ${le}="${Qe}" class="${Kd}"><div class="${of}"><span class="data-icon data-icon-delete"></span></div><div class="${lf}"><span class="data-icon data-icon-plus"></span><div class="${cf}"></div></div>`+`<div class="${Xd}" draggable="true">
                <div class="row-dragger">
                    <span class="data-icon data-icon-drag"></span>
                    <span class="drag-info"></span>
                </div>
                <div class="${Yd}"></div>
            </div>`.repeat(t)+`
        </div>`}renderColsHeader(t){return`<div ${le}="${Qe}" class="${Vd}"><div class="${af}"><span class="data-icon data-icon-delete"></span></div><div class="${uf}"><span class="data-icon data-icon-plus"></span><div class="${df}"></div></div>`+`<div class="${Gd}" draggable="true">
            <div class="col-dragger">
                <span class="data-icon data-icon-drag"></span>
                <span class="drag-info"></span>
            </div>
            <div class="${Zd}"></div>
        </div>`.repeat(t)+`
    </div>`}htmlEdit({rows:t,cols:e,html:n,noBorder:i,overflow:r},s){e=e===-1/0?1:e,t=t===-1/0?1:t,e=e===1/0?10:e,t=t===1/0?10:t;const a=`<tr>${`<td ${Nt}="table-cell-selection">${this.getEmptyCell()}</td>`.repeat(e)}</tr>`.repeat(t),u=`<colgroup>${"<col />".repeat(e)}</colgroup>`,d=`<div ${le}="${Qe}" class="${sf}"></div>`;let h=`<div ${le}="${Qe}" class="${Na}"><div class="${Na}-item"></div></div>`;const f=`<div ${le}="${Qe}" class="${rf}"></div>`;let p=s.map(m=>{if(m.split)return'<div class="split"></div>';let v=m.text;switch(m.action){case"insertColLeft":case"insertColRight":case"insertRowUp":case"insertRowDown":v=(v==null?void 0:v.replace("$data",`<input type='text' maxlength="3" class="${ef}" />`))||"";break}return`<div class="${Qd}" ${le}="${Qe}" data-action="${m.action}">
                <span class="data-icon data-icon-table-${m.icon}"></span>${v}</div>`});if(p=[`<div ${le}="${Qe}" class="${Jd}">${p.join("")}</div>`],n){const m=n.indexOf("<colgroup")>-1;n=Oi(n)||n,m||(n=n==null?void 0:n.replace(/^(<table[^>]+>)/,function(_){return _+u}));const v=this.table.helper.normalize(I(n));t=v.find("tr").length,n=v.get().outerHTML}const g=n||`<table class="${jd}"${i===!0?" data-table-no-border='true'":""} ${Nt}="class">${u}${a}</table>`;return`<div ${Nt}="*" class="${Aa} ${r!==!1?Ta:""}" ${Nt}="*">${h}<div ${Nt}="*" class="${tf}">${this.renderColsHeader(e)}${g}${f}${d}</div>${this.renderRowsHeader(t)}${p}</div>`}htmlView({html:t,noBorder:e,overflow:n}){return`<div class="${Aa} ${n!==!1?Ta:""}"><div class="${nf}"${e===!0?" data-table-no-border='true'":""}>${Oi(t||"")}</div></div>`}};let Q=Xs;y(Q,"TABLE_WRAPPER_CLASS",`.${Aa}`),y(Q,"TABLE_OVERFLOW_CLASS",`.${Ta}`),y(Q,"TABLE_CLASS",`.${jd}`),y(Q,"COLS_HEADER_CLASS",`.${Vd}`),y(Q,"COLS_HEADER_ITEM_CLASS",`.${Gd}`),y(Q,"COLS_HEADER_TRIGGER_CLASS",`.${Zd}`),y(Q,"COLS_ADDITION_HEADER_CLASS",`.${Xse}`),y(Q,"ROWS_HEADER_CLASS",`.${Kd}`),y(Q,"ROWS_HEADER_ITEM_CLASS",`.${Xd}`),y(Q,"ROWS_HEADER_TRIGGER_CLASS",`.${Yd}`),y(Q,"HEADER_CLASS",`.${Na}`),y(Q,"MENUBAR_CLASS",`.${Jd}`),y(Q,"MENUBAR_ITEM_CLASS",`.${Qd}`),y(Q,"MENUBAR_ITEM_INPUT_CALSS",`.${ef}`),y(Q,"VIEWPORT",`.${tf}`),y(Q,"VIEWPORT_READER",`.${nf}`),y(Q,"PLACEHOLDER_CLASS",`.${rf}`),y(Q,"MULTI_ADDITION_CLASS",`.${Yse}`),y(Q,"TABLE_HIGHLIGHT_CLASS",`.${sf}`),y(Q,"ROW_DELETE_BUTTON_CLASS",`.${of}`),y(Q,"COL_DELETE_BUTTON_CLASS",`.${af}`),y(Q,"ROW_ADD_BUTTON_CLASS",`.${lf}`),y(Q,"COL_ADD_BUTTON_CLASS",`.${uf}`),y(Q,"ROW_ADD_BUTTON_SPLIT_CLASS",`.${cf}`),y(Q,"COL_ADD_BUTTON_SPLIT_CLASS",`.${df}`),y(Q,"TABLE_TD_CONTENT_CLASS",`.${ff}`),y(Q,"TABLE_TD_BG_CLASS",`.${hf}`),y(Q,"CellBG",`<div class="${hf}"><div class="table-main-border-top"></div><div class="table-main-border-right"></div><div class="table-main-border-bottom"></div><div class="table-main-border-left"></div></div>`);var yn;class Dp{constructor(t){y(this,"clipboard");rt(this,yn,void 0);Ze(this,yn,t)}isEmptyModelCol(t){return t&&t.isEmpty}getTableModel(t){let e=[];const n=t.get(),i=n.rows,r=(i==null?void 0:i.length)||0;for(let c=0;c<r;c++){const d=i[c].cells,h=d.length;for(let f=0;f<h;f++){const p=d[f];let{rowSpan:g,colSpan:m}=p;g=g===void 0?1:g,m=m===void 0?1:m;const v=g>1||m>1;e[c]=e[c]||[];let b=f;for(;e[c][b];)b++;if(e[c][b]={rowSpan:g,colSpan:m,isMulti:v,element:p},v){let _=g;for(;_>0;){let x=m;for(;x>0;){if(x!==1||_!==1){const w=c+_-1,E=b+x-1;e[w]=e[w]||[],e[w][E]={isEmpty:!0,parent:{row:c,col:b},element:null}}x--}_--}}}}const s=e.map(c=>c.length),o=Math.max(...s);return e.forEach(c=>{if(c.length<o){let u=o-c.length;for(;u--;)c.push({rowSpan:1,colSpan:1,isShadow:!0,element:null})}for(let u=0;u<o;u++)c[u]||(c[u]={rowSpan:1,colSpan:1,isShadow:!0,element:null})}),{rows:e.length,cols:o,width:n.offsetWidth,height:n.offsetHeight,table:e}}normalize(t){var a,c,u,d;this.trimStartTr(t),this.fixNumberTr(t),t.addClass("data-table"),t.attributes(Nt,"class");const e=t.css("width");parseInt(e)===0&&t.css("width","auto"),t.css("background-color","");const n=this.getTableModel(t);let i=t.find("col");if(i.length!==0){for(let h=i.length-1;h>=0;h--){const f=i[h],p=(a=i.eq(h))==null?void 0:a.attributes("width");if(p&&((c=i.eq(h))==null||c.attributes("width",parseInt(p))),f.span>1){let g=f.span-1;for(;g--;)(u=i[h].parentNode)==null||u.insertBefore(i[h].cloneNode(),i[h])}}if(i=t.find("col"),i.length<n.cols){const h=i.length-1;let f=n.cols-i.length;for(;f--;)(d=i[0].parentNode)==null||d.appendChild(i[h].cloneNode())}t.find("col").attributes("span",1)}else{let h=t.find("colgroup")[0];h||(h=document.createElement("colgroup")),t.prepend(h);const f=function(g){const m=g.find("tr")[0],v=I(m).find("td"),b=[];v.each((x,w)=>{const E=v.eq(w);if(!E)return;let S=E.attributes("data-colwidth"),R=E.attributes("width");const D=E[0].colSpan;S?S=S.split(","):R&&(R=parseInt(R)/D);for(let P=0;D>P;P++)S&&S[P]?b.push(parseInt(S[P])):R?b.push(parseInt(R.toString())):b.push(void 0)});const _=g.find("td");return _.removeAttributes("data-colwidth"),_.removeAttributes("width"),b}(t),p=document.createElement("col");for(let g=0;n.cols>g;g++){const m=p.cloneNode();f[g]&&m.setAttribute("width",(f[g]||"").toString()),h.appendChild(m)}}const r=t.get();n.table.forEach((h,f)=>{r.rows[f]||r.insertRow(f);let g=h.filter(m=>this.isEmptyModelCol(m)?!1:m.isShadow).length;for(;g--;)f===0?r.rows[f].insertCell(0):r.rows[f].insertCell()});const s=t.find("tr");s.each((h,f)=>{var m;const p=s.eq(f);if(!p)return;let g=parseInt(p.css("height"));g=g||((m=ie(this,yn).plugin.findPlugin("table"))==null?void 0:m.options.rowMinHeight)||0,p.css("height",g+"px")});const o=t.find("td");return o.each((h,f)=>{const p=o.eq(f);if(!p)return;p.attributes(Nt,"table-cell-selection");let g=p.find(ze);if(g.length===0){const m=p.html();p.empty(),p.append(Q.EmptyCell(!V(ie(this,yn))||ie(this,yn).readonly)),g=p.find(ze),g.html(m)}g.find("p").each(m=>{m.childNodes.length===0&&m.appendChild(document.createElement("br"))})}),t}trimStartTr(t){var i;const n=t.find("tr").eq(0);n&&((i=n.get())==null?void 0:i.childNodes.length)===0&&n.remove()}fixNumberTr(t){const e=t.get(),n=e.rows,i=(n==null?void 0:n.length)||0;let r=[],s=0,o=[],a=0,c=0,u=0;for(let p=0;p<i;p++){const m=n[p].cells;let v=0;for(let b=0;b<m.length;b++){const{rowSpan:_,colSpan:x}=m[b];a+=_*x,v+=x,_>1&&(c+=(_-1)*x)}o[p]=v,p===0&&(s=v),u=Math.max(v,u)}if(Ud(a/s)&&s===u){let p=0;if(o.forEach(g=>{p+=u-g}),p!==c){const g=c-p;if(Ud(g/u)){let m=[];for(let v=0;v<i;v++){const _=n[v].cells;let x=v+m.length;for(;r[x]===u;)m.push(x),x++;for(let w=0;w<_.length;w++){const{rowSpan:E,colSpan:S}=_[w];if(E>1)for(let R=1;R<E;R++)r[x+R]=(r[x+R]||0)+S}}m.forEach(v=>{e.insertRow(v)})}}}}fixDragEvent(t){var e,n;(e=t.dataTransfer)==null||e.clearData(),(n=t.dataTransfer)==null||n.setData("aomao",""),t.dataTransfer&&(t.dataTransfer.effectAllowed="all")}copyCss(t,e){be(t)&&(t=I(t)),be(e)&&(e=I(e)),e.css("text-align",t.css("text-align")),e.css("vertical-align",t.css("vertical-align"));let n=t.css("background-color");n=n!=="rgba(0, 0, 0, 0)"?n:"#fff",e.css("background-color",n),e.css("color",t.css("color")),e.css("font-weight",t.css("font-weight"))}copyTo(t,e){be(t)&&(t=I(t)),be(e)&&(e=I(e));let n=e.find(ze);n.length===0&&(e.html(Q.EmptyCell(!V(ie(this,yn))||ie(this,yn).readonly)),n=e.find(ze)),n.html(Oi(t.html())),e.name==="td"&&e.find(Q.TABLE_TD_BG_CLASS).length===0&&e.append(I(Q.CellBG)),e.name==="td"&&e.attributes("data-transient-attributes","table-cell-selection")}copyHTML(t){var e;this.clipboard={html:t,text:((e=I(t).get())==null?void 0:e.innerText)||""}}getCopyData(){return this.clipboard}clearCopyData(){this.clipboard=void 0}trimBlankSpan(t){const e=t.length;let n=[],i=0,r=e-1;for(;t[i]&&t[i].tagName.toLowerCase()==="span"&&t[i].innerText.trim()==="";)i++;for(;t[r]&&t[r].tagName.toLowerCase()==="span"&&t[r].innerText.trim()==="";)r--;if(i<=r)for(let s=i;s<=r;s++)n.push(t[s]);return n.length?I(n):t}normalizeTable(t){var o,a,c,u;this.trimStartTr(t),this.fixNumberTr(t),t.addClass("data-table");const e=t.css("width");parseInt(e)===0?t.css("width","auto"):e.endsWith("%")||t.css("width",parseInt(e,10)+"px"),t.css("background-color","");const n=this.getTableModel(t);let i=t.find("col");if(i.length!==0){for(let d=i.length-1;d>=0;d--){const h=i[d],f=(o=i.eq(d))==null?void 0:o.attributes("width");if(f&&!f.endsWith("%")){const p=parseInt(f);Object.is(p,NaN)||(a=i.eq(d))==null||a.attributes("width",p)}if(h.span>1){let p=h.span-1;for(;p--;)(c=i[d].parentNode)==null||c.insertBefore(i[d].cloneNode(),i[d])}}if(i=t.find("col"),i.length<n.cols){const d=i.length-1;let h=n.cols-i.length;for(;h--;)(u=i[0].parentNode)==null||u.appendChild(i[d].cloneNode())}t.find("col").attributes("span",1)}else{let d=t.find("colgroup")[0];d||(d=document.createElement("colgroup")),t.prepend(d);const h=function(p){const g=p.find("tr")[0],m=I(g).find("td"),v=[];m.each((_,x)=>{const w=m.eq(x);if(!w)return;let E=w.attributes("data-colwidth"),S=w.attributes("width");const R=w[0].colSpan;E?E=E.split(","):S&&(S=parseInt(S)/R);for(let D=0;R>D;D++)E&&E[D]?v.push(parseInt(E[D])):S?v.push(parseInt(S.toString())):v.push(void 0)});const b=p.find("td");return b.removeAttributes("data-colwidth"),b.removeAttributes("width"),v}(t),f=document.createElement("col");for(let p=0;n.cols>p;p++){const g=f.cloneNode();h[p]&&g.setAttribute("width",(h[p]||"").toString()),d.appendChild(g)}}const r=t.get();n.table.forEach((d,h)=>{r.rows[h]||r.insertRow(h);let p=d.filter(g=>g.isShadow).length;for(;p--;)r.rows[h].insertCell()});const s=t.find("tr");return s.each((d,h)=>{var g;const f=s.eq(h);if(!f)return;let p=parseInt(f.css("height"));p=p||((g=ie(this,yn).plugin.findPlugin("table"))==null?void 0:g.options.rowMinHeight)||0,f.css("height",p+"px")}),t}}yn=new WeakMap;const Jse=l=>[{action:"cut",icon:"cut",text:l.cut},{action:"copy",icon:"copy",text:l.copy},{action:"mockPaste",icon:"paste",text:l.paste},{split:!0},{action:"insertColLeft",icon:"insert-col-left",text:l.insertColLeft},{action:"insertColRight",icon:"insert-col-right",text:l.insertColRight},{action:"insertRowUp",icon:"insert-row-up",text:l.insertRowUp},{action:"insertRowDown",icon:"insert-row-down",text:l.insertRowDown},{split:!0},{action:"mergeCell",icon:"merge-cell",text:l.mergeCell},{action:"splitCell",icon:"split-cell",text:l.splitCell},{split:!0},{action:"removeCol",icon:"remove-col",text:l.removeCol},{action:"removeRow",icon:"remove-row",text:l.removeRow},{split:!0},{action:"removeTable",icon:"remove-table",text:l.removeTable},{split:!0},{action:"clear",icon:"clear",text:l.clear}];var So={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */(function(l,t){(function(e){var n=Object.hasOwnProperty,i=Array.isArray?Array.isArray:function(C){return Object.prototype.toString.call(C)==="[object Array]"},r=10,s=typeof process=="object"&&typeof process.nextTick=="function",o=typeof Symbol=="function",a=typeof Reflect=="object",c=typeof setImmediate=="function",u=c?setImmediate:setTimeout,d=o?a&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(k){var C=Object.getOwnPropertyNames(k);return C.push.apply(C,Object.getOwnPropertySymbols(k)),C}:Object.keys;function h(){this._events={},this._conf&&f.call(this,this._conf)}function f(k){k&&(this._conf=k,k.delimiter&&(this.delimiter=k.delimiter),k.maxListeners!==e&&(this._maxListeners=k.maxListeners),k.wildcard&&(this.wildcard=k.wildcard),k.newListener&&(this._newListener=k.newListener),k.removeListener&&(this._removeListener=k.removeListener),k.verboseMemoryLeak&&(this.verboseMemoryLeak=k.verboseMemoryLeak),k.ignoreErrors&&(this.ignoreErrors=k.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function p(k,C){var $="(node) warning: possible EventEmitter memory leak detected. "+k+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&($+=" Event name: "+C+"."),typeof process<"u"&&process.emitWarning){var z=new Error($);z.name="MaxListenersExceededWarning",z.emitter=this,z.count=k,process.emitWarning(z)}else console.error($),console.trace&&console.trace()}var g=function(k,C,$){var z=arguments.length;switch(z){case 0:return[];case 1:return[k];case 2:return[k,C];case 3:return[k,C,$];default:for(var M=new Array(z);z--;)M[z]=arguments[z];return M}};function m(k,C){for(var $={},z,M=k.length,T=C?C.length:0,K=0;K<M;K++)z=k[K],$[z]=K<T?C[K]:e;return $}function v(k,C,$){this._emitter=k,this._target=C,this._listeners={},this._listenersCount=0;var z,M;if(($.on||$.off)&&(z=$.on,M=$.off),C.addEventListener?(z=C.addEventListener,M=C.removeEventListener):C.addListener?(z=C.addListener,M=C.removeListener):C.on&&(z=C.on,M=C.off),!z&&!M)throw Error("target does not implement any known event API");if(typeof z!="function")throw TypeError("on method must be a function");if(typeof M!="function")throw TypeError("off method must be a function");this._on=z,this._off=M;var T=k._observers;T?T.push(this):k._observers=[this]}Object.assign(v.prototype,{subscribe:function(k,C,$){var z=this,M=this._target,T=this._emitter,K=this._listeners,ee=function(){var Y=g.apply(null,arguments),q={data:Y,name:C,original:k};if($){var Z=$.call(M,q);Z!==!1&&T.emit.apply(T,[q.name].concat(Y));return}T.emit.apply(T,[C].concat(Y))};if(K[k])throw Error("Event '"+k+"' is already listening");this._listenersCount++,T._newListener&&T._removeListener&&!z._onNewListener?(this._onNewListener=function(Y){Y===C&&K[k]===null&&(K[k]=ee,z._on.call(M,k,ee))},T.on("newListener",this._onNewListener),this._onRemoveListener=function(Y){Y===C&&!T.hasListeners(Y)&&K[k]&&(K[k]=null,z._off.call(M,k,ee))},K[k]=null,T.on("removeListener",this._onRemoveListener)):(K[k]=ee,z._on.call(M,k,ee))},unsubscribe:function(k){var C=this,$=this._listeners,z=this._emitter,M,T,K=this._off,ee=this._target,Y;if(k&&typeof k!="string")throw TypeError("event must be a string");function q(){C._onNewListener&&(z.off("newListener",C._onNewListener),z.off("removeListener",C._onRemoveListener),C._onNewListener=null,C._onRemoveListener=null);var Z=R.call(z,C);z._observers.splice(Z,1)}if(k){if(M=$[k],!M)return;K.call(ee,k,M),delete $[k],--this._listenersCount||q()}else{for(T=d($),Y=T.length;Y-- >0;)k=T[Y],K.call(ee,k,$[k]);this._listeners={},this._listenersCount=0,q()}}});function b(k,C,$,z){var M=Object.assign({},C);if(!k)return M;if(typeof k!="object")throw TypeError("options must be an object");var T=Object.keys(k),K=T.length,ee,Y,q;function Z(se){throw Error('Invalid "'+ee+'" option value'+(se?". Reason: "+se:""))}for(var te=0;te<K;te++){if(ee=T[te],!z&&!n.call(C,ee))throw Error('Unknown "'+ee+'" option');Y=k[ee],Y!==e&&(q=$[ee],M[ee]=q?q(Y,Z):Y)}return M}function _(k,C){return(typeof k!="function"||!k.hasOwnProperty("prototype"))&&C("value must be a constructor"),k}function x(k){var C="value must be type of "+k.join("|"),$=k.length,z=k[0],M=k[1];return $===1?function(T,K){if(typeof T===z)return T;K(C)}:$===2?function(T,K){var ee=typeof T;if(ee===z||ee===M)return T;K(C)}:function(T,K){for(var ee=typeof T,Y=$;Y-- >0;)if(ee===k[Y])return T;K(C)}}var w=x(["function"]),E=x(["object","function"]);function S(k,C,$){var z,M,T=0,K,ee=new k(function(Y,q,Z){$=b($,{timeout:0,overload:!1},{timeout:function(J,X){return J*=1,(typeof J!="number"||J<0||!Number.isFinite(J))&&X("timeout must be a positive number"),J}}),z=!$.overload&&typeof k.prototype.cancel=="function"&&typeof Z=="function";function te(){M&&(M=null),T&&(clearTimeout(T),T=0)}var se=function(J){te(),Y(J)},fe=function(J){te(),q(J)};z?C(se,fe,Z):(M=[function(J){fe(J||Error("canceled"))}],C(se,fe,function(J){if(K)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof J!="function")throw TypeError("onCancel callback must be a function");M.push(J)}),K=!0),$.timeout>0&&(T=setTimeout(function(){var J=Error("timeout");J.code="ETIMEDOUT",T=0,ee.cancel(J),q(J)},$.timeout))});return z||(ee.cancel=function(Y){if(!!M){for(var q=M.length,Z=1;Z<q;Z++)M[Z](Y);M[0](Y),M=null}}),ee}function R(k){var C=this._observers;if(!C)return-1;for(var $=C.length,z=0;z<$;z++)if(C[z]._target===k)return z;return-1}function D(k,C,$,z,M){if(!$)return null;if(z===0){var T=typeof C;if(T==="string"){var K,ee,Y=0,q=0,Z=this.delimiter,te=Z.length;if((ee=C.indexOf(Z))!==-1){K=new Array(5);do K[Y++]=C.slice(q,ee),q=ee+te;while((ee=C.indexOf(Z,q))!==-1);K[Y++]=C.slice(q),C=K,M=Y}else C=[C],M=1}else T==="object"?M=C.length:(C=[C],M=1)}var se=null,fe,J,X,ae,_e,Me=C[z],ge=C[z+1],$e,qe;if(z===M)$._listeners&&(typeof $._listeners=="function"?(k&&k.push($._listeners),se=[$]):(k&&k.push.apply(k,$._listeners),se=[$]));else if(Me==="*"){for($e=d($),ee=$e.length;ee-- >0;)fe=$e[ee],fe!=="_listeners"&&(qe=D(k,C,$[fe],z+1,M),qe&&(se?se.push.apply(se,qe):se=qe));return se}else if(Me==="**"){for(_e=z+1===M||z+2===M&&ge==="*",_e&&$._listeners&&(se=D(k,C,$,M,M)),$e=d($),ee=$e.length;ee-- >0;)fe=$e[ee],fe!=="_listeners"&&(fe==="*"||fe==="**"?($[fe]._listeners&&!_e&&(qe=D(k,C,$[fe],M,M),qe&&(se?se.push.apply(se,qe):se=qe)),qe=D(k,C,$[fe],z,M)):fe===ge?qe=D(k,C,$[fe],z+2,M):qe=D(k,C,$[fe],z,M),qe&&(se?se.push.apply(se,qe):se=qe));return se}else $[Me]&&(se=D(k,C,$[Me],z+1,M));if(J=$["*"],J&&D(k,C,J,z+1,M),X=$["**"],X)if(z<M)for(X._listeners&&D(k,C,X,M,M),$e=d(X),ee=$e.length;ee-- >0;)fe=$e[ee],fe!=="_listeners"&&(fe===ge?D(k,C,X[fe],z+2,M):fe===Me?D(k,C,X[fe],z+1,M):(ae={},ae[fe]=X[fe],D(k,C,{"**":ae},z+1,M)));else X._listeners?D(k,C,X,M,M):X["*"]&&X["*"]._listeners&&D(k,C,X["*"],M,M);return se}function P(k,C,$){var z=0,M=0,T,K=this.delimiter,ee=K.length,Y;if(typeof k=="string")if((T=k.indexOf(K))!==-1){Y=new Array(5);do Y[z++]=k.slice(M,T),M=T+ee;while((T=k.indexOf(K,M))!==-1);Y[z++]=k.slice(M)}else Y=[k],z=1;else Y=k,z=k.length;if(z>1){for(T=0;T+1<z;T++)if(Y[T]==="**"&&Y[T+1]==="**")return}var q=this.listenerTree,Z;for(T=0;T<z;T++)if(Z=Y[T],q=q[Z]||(q[Z]={}),T===z-1)return q._listeners?(typeof q._listeners=="function"&&(q._listeners=[q._listeners]),$?q._listeners.unshift(C):q._listeners.push(C),!q._listeners.warned&&this._maxListeners>0&&q._listeners.length>this._maxListeners&&(q._listeners.warned=!0,p.call(this,q._listeners.length,Z))):q._listeners=C,!0;return!0}function O(k,C,$,z){for(var M=d(k),T=M.length,K,ee,Y,q=k._listeners,Z;T-- >0;)ee=M[T],K=k[ee],ee==="_listeners"?Y=$:Y=$?$.concat(ee):[ee],Z=z||typeof ee=="symbol",q&&C.push(Z?Y:Y.join(this.delimiter)),typeof K=="object"&&O.call(this,K,C,Y,Z);return C}function L(k){for(var C=d(k),$=C.length,z,M,T;$-- >0;)M=C[$],z=k[M],z&&(T=!0,M!=="_listeners"&&!L(z)&&delete k[M]);return T}function B(k,C,$){this.emitter=k,this.event=C,this.listener=$}B.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function A(k,C,$){if($===!0)M=!0;else if($===!1)z=!0;else{if(!$||typeof $!="object")throw TypeError("options should be an object or true");var z=$.async,M=$.promisify,T=$.nextTick,K=$.objectify}if(z||T||M){var ee=C,Y=C._origin||C;if(T&&!s)throw Error("process.nextTick is not supported");M===e&&(M=C.constructor.name==="AsyncFunction"),C=function(){var q=arguments,Z=this,te=this.event;return M?T?Promise.resolve():new Promise(function(se){u(se)}).then(function(){return Z.event=te,ee.apply(Z,q)}):(T?process.nextTick:u)(function(){Z.event=te,ee.apply(Z,q)})},C._async=!0,C._origin=Y}return[C,K?new B(this,k,C):this]}function F(k){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,f.call(this,k)}F.EventEmitter2=F,F.prototype.listenTo=function(k,C,$){if(typeof k!="object")throw TypeError("target musts be an object");var z=this;$=b($,{on:e,off:e,reducers:e},{on:w,off:w,reducers:E});function M(T){if(typeof T!="object")throw TypeError("events must be an object");var K=$.reducers,ee=R.call(z,k),Y;ee===-1?Y=new v(z,k,$):Y=z._observers[ee];for(var q=d(T),Z=q.length,te,se=typeof K=="function",fe=0;fe<Z;fe++)te=q[fe],Y.subscribe(te,T[te]||te,se?K:K&&K[te])}return i(C)?M(m(C)):M(typeof C=="string"?m(C.split(/\s+/)):C),this},F.prototype.stopListeningTo=function(k,C){var $=this._observers;if(!$)return!1;var z=$.length,M,T=!1;if(k&&typeof k!="object")throw TypeError("target should be an object");for(;z-- >0;)M=$[z],(!k||M._target===k)&&(M.unsubscribe(C),T=!0);return T},F.prototype.delimiter=".",F.prototype.setMaxListeners=function(k){k!==e&&(this._maxListeners=k,this._conf||(this._conf={}),this._conf.maxListeners=k)},F.prototype.getMaxListeners=function(){return this._maxListeners},F.prototype.event="",F.prototype.once=function(k,C,$){return this._once(k,C,!1,$)},F.prototype.prependOnceListener=function(k,C,$){return this._once(k,C,!0,$)},F.prototype._once=function(k,C,$,z){return this._many(k,1,C,$,z)},F.prototype.many=function(k,C,$,z){return this._many(k,C,$,!1,z)},F.prototype.prependMany=function(k,C,$,z){return this._many(k,C,$,!0,z)},F.prototype._many=function(k,C,$,z,M){var T=this;if(typeof $!="function")throw new Error("many only accepts instances of Function");function K(){return--C===0&&T.off(k,K),$.apply(this,arguments)}return K._origin=$,this._on(k,K,z,M)},F.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var k=arguments[0],C,$=this.wildcard,z,M,T,K,ee;if(k==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if($&&(C=k,k!=="newListener"&&k!=="removeListener"&&typeof k=="object")){if(M=k.length,o){for(T=0;T<M;T++)if(typeof k[T]=="symbol"){ee=!0;break}}ee||(k=k.join(this.delimiter))}var Y=arguments.length,q;if(this._all&&this._all.length)for(q=this._all.slice(),T=0,M=q.length;T<M;T++)switch(this.event=k,Y){case 1:q[T].call(this,k);break;case 2:q[T].call(this,k,arguments[1]);break;case 3:q[T].call(this,k,arguments[1],arguments[2]);break;default:q[T].apply(this,arguments)}if($)q=[],D.call(this,q,C,this.listenerTree,0,M);else if(q=this._events[k],typeof q=="function"){switch(this.event=k,Y){case 1:q.call(this);break;case 2:q.call(this,arguments[1]);break;case 3:q.call(this,arguments[1],arguments[2]);break;default:for(z=new Array(Y-1),K=1;K<Y;K++)z[K-1]=arguments[K];q.apply(this,z)}return!0}else q&&(q=q.slice());if(q&&q.length){if(Y>3)for(z=new Array(Y-1),K=1;K<Y;K++)z[K-1]=arguments[K];for(T=0,M=q.length;T<M;T++)switch(this.event=k,Y){case 1:q[T].call(this);break;case 2:q[T].call(this,arguments[1]);break;case 3:q[T].call(this,arguments[1],arguments[2]);break;default:q[T].apply(this,z)}return!0}else if(!this.ignoreErrors&&!this._all&&k==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},F.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var k=arguments[0],C=this.wildcard,$,z,M,T,K,ee;if(k==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(C&&($=k,k!=="newListener"&&k!=="removeListener"&&typeof k=="object")){if(T=k.length,o){for(K=0;K<T;K++)if(typeof k[K]=="symbol"){z=!0;break}}z||(k=k.join(this.delimiter))}var Y=[],q=arguments.length,Z;if(this._all)for(K=0,T=this._all.length;K<T;K++)switch(this.event=k,q){case 1:Y.push(this._all[K].call(this,k));break;case 2:Y.push(this._all[K].call(this,k,arguments[1]));break;case 3:Y.push(this._all[K].call(this,k,arguments[1],arguments[2]));break;default:Y.push(this._all[K].apply(this,arguments))}if(C?(Z=[],D.call(this,Z,$,this.listenerTree,0)):Z=this._events[k],typeof Z=="function")switch(this.event=k,q){case 1:Y.push(Z.call(this));break;case 2:Y.push(Z.call(this,arguments[1]));break;case 3:Y.push(Z.call(this,arguments[1],arguments[2]));break;default:for(M=new Array(q-1),ee=1;ee<q;ee++)M[ee-1]=arguments[ee];Y.push(Z.apply(this,M))}else if(Z&&Z.length){if(Z=Z.slice(),q>3)for(M=new Array(q-1),ee=1;ee<q;ee++)M[ee-1]=arguments[ee];for(K=0,T=Z.length;K<T;K++)switch(this.event=k,q){case 1:Y.push(Z[K].call(this));break;case 2:Y.push(Z[K].call(this,arguments[1]));break;case 3:Y.push(Z[K].call(this,arguments[1],arguments[2]));break;default:Y.push(Z[K].apply(this,M))}}else if(!this.ignoreErrors&&!this._all&&k==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(Y)},F.prototype.on=function(k,C,$){return this._on(k,C,!1,$)},F.prototype.prependListener=function(k,C,$){return this._on(k,C,!0,$)},F.prototype.onAny=function(k){return this._onAny(k,!1)},F.prototype.prependAny=function(k){return this._onAny(k,!0)},F.prototype.addListener=F.prototype.on,F.prototype._onAny=function(k,C){if(typeof k!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),C?this._all.unshift(k):this._all.push(k),this},F.prototype._on=function(k,C,$,z){if(typeof k=="function")return this._onAny(k,C),this;if(typeof C!="function")throw new Error("on only accepts instances of Function");this._events||h.call(this);var M=this,T;return z!==e&&(T=A.call(this,k,C,z),C=T[0],M=T[1]),this._newListener&&this.emit("newListener",k,C),this.wildcard?(P.call(this,k,C,$),M):(this._events[k]?(typeof this._events[k]=="function"&&(this._events[k]=[this._events[k]]),$?this._events[k].unshift(C):this._events[k].push(C),!this._events[k].warned&&this._maxListeners>0&&this._events[k].length>this._maxListeners&&(this._events[k].warned=!0,p.call(this,this._events[k].length,k))):this._events[k]=C,M)},F.prototype.off=function(k,C){if(typeof C!="function")throw new Error("removeListener only takes instances of Function");var $,z=[];if(this.wildcard){var M=typeof k=="string"?k.split(this.delimiter):k.slice();if(z=D.call(this,null,M,this.listenerTree,0),!z)return this}else{if(!this._events[k])return this;$=this._events[k],z.push({_listeners:$})}for(var T=0;T<z.length;T++){var K=z[T];if($=K._listeners,i($)){for(var ee=-1,Y=0,q=$.length;Y<q;Y++)if($[Y]===C||$[Y].listener&&$[Y].listener===C||$[Y]._origin&&$[Y]._origin===C){ee=Y;break}if(ee<0)continue;return this.wildcard?K._listeners.splice(ee,1):this._events[k].splice(ee,1),$.length===0&&(this.wildcard?delete K._listeners:delete this._events[k]),this._removeListener&&this.emit("removeListener",k,C),this}else($===C||$.listener&&$.listener===C||$._origin&&$._origin===C)&&(this.wildcard?delete K._listeners:delete this._events[k],this._removeListener&&this.emit("removeListener",k,C))}return this.listenerTree&&L(this.listenerTree),this},F.prototype.offAny=function(k){var C=0,$=0,z;if(k&&this._all&&this._all.length>0){for(z=this._all,C=0,$=z.length;C<$;C++)if(k===z[C])return z.splice(C,1),this._removeListener&&this.emit("removeListenerAny",k),this}else{if(z=this._all,this._removeListener)for(C=0,$=z.length;C<$;C++)this.emit("removeListenerAny",z[C]);this._all=[]}return this},F.prototype.removeListener=F.prototype.off,F.prototype.removeAllListeners=function(k){if(k===e)return!this._events||h.call(this),this;if(this.wildcard){var C=D.call(this,null,k,this.listenerTree,0),$,z;if(!C)return this;for(z=0;z<C.length;z++)$=C[z],$._listeners=null;this.listenerTree&&L(this.listenerTree)}else this._events&&(this._events[k]=null);return this},F.prototype.listeners=function(k){var C=this._events,$,z,M,T,K;if(k===e){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!C)return[];for($=d(C),T=$.length,M=[];T-- >0;)z=C[$[T]],typeof z=="function"?M.push(z):M.push.apply(M,z);return M}else{if(this.wildcard){if(K=this.listenerTree,!K)return[];var ee=[],Y=typeof k=="string"?k.split(this.delimiter):k.slice();return D.call(this,ee,Y,K,0),ee}return C?(z=C[k],z?typeof z=="function"?[z]:z:[]):[]}},F.prototype.eventNames=function(k){var C=this._events;return this.wildcard?O.call(this,this.listenerTree,[],null,k):C?d(C):[]},F.prototype.listenerCount=function(k){return this.listeners(k).length},F.prototype.hasListeners=function(k){if(this.wildcard){var C=[],$=typeof k=="string"?k.split(this.delimiter):k.slice();return D.call(this,C,$,this.listenerTree,0),C.length>0}var z=this._events,M=this._all;return!!(M&&M.length||z&&(k===e?d(z).length:z[k]))},F.prototype.listenersAny=function(){return this._all?this._all:[]},F.prototype.waitFor=function(k,C){var $=this,z=typeof C;return z==="number"?C={timeout:C}:z==="function"&&(C={filter:C}),C=b(C,{timeout:0,filter:e,handleError:!1,Promise,overload:!1},{filter:w,Promise:_}),S(C.Promise,function(M,T,K){function ee(){var Y=C.filter;if(!(Y&&!Y.apply($,arguments)))if($.off(k,ee),C.handleError){var q=arguments[0];q?T(q):M(g.apply(null,arguments).slice(1))}else M(g.apply(null,arguments))}K(function(){$.off(k,ee)}),$._on(k,ee,!1)},{timeout:C.timeout,overload:C.overload})};function W(k,C,$){$=b($,{Promise,timeout:0,overload:!1},{Promise:_});var z=$.Promise;return S(z,function(M,T,K){var ee;if(typeof k.addEventListener=="function"){ee=function(){M(g.apply(null,arguments))},K(function(){k.removeEventListener(C,ee)}),k.addEventListener(C,ee,{once:!0});return}var Y=function(){q&&k.removeListener("error",q),M(g.apply(null,arguments))},q;C!=="error"&&(q=function(Z){k.removeListener(C,Y),T(Z)},k.once("error",q)),K(function(){q&&k.removeListener("error",q),k.removeListener(C,Y)}),k.once(C,Y)},{timeout:$.timeout,overload:$.overload})}var G=F.prototype;Object.defineProperties(F,{defaultMaxListeners:{get:function(){return G._maxListeners},set:function(k){if(typeof k!="number"||k<0||Number.isNaN(k))throw TypeError("n must be a non-negative number");G._maxListeners=k},enumerable:!0},once:{value:W,writable:!0,configurable:!0}}),Object.defineProperties(G,{_maxListeners:{value:r,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),typeof e=="function"&&e.amd?e(function(){return F}):l.exports=F})()})(So);class Qse extends So.exports.EventEmitter2{constructor(e,n,i){super();y(this,"editor");y(this,"table");y(this,"COL_MIN_WIDTH");y(this,"ROW_MIN_HEIGHT");y(this,"MAX_INSERT_NUM");y(this,"tableRoot");y(this,"colsHeader");y(this,"rowsHeader");y(this,"tableHeader");y(this,"menuBar");y(this,"dragging");y(this,"draggingHeader");y(this,"changeSize");y(this,"viewport");y(this,"placeholder");y(this,"contextVisible",!1);y(this,"rowDeleteButton");y(this,"colDeleteButton");y(this,"colAddButton");y(this,"colAddAlign");y(this,"colAddButtonSplit");y(this,"moveColIndex",-1);y(this,"hideColAddButtonTimeount");y(this,"rowAddButton");y(this,"rowAddAlign");y(this,"rowAddButtonSplit");y(this,"moveRowIndex",-1);y(this,"hideRowAddButtonTimeount");y(this,"onMouseDownColsHeader",e=>{const n=I(e.target||[]).closest(Q.COLS_HEADER_TRIGGER_CLASS);if(n.length===0){e instanceof MouseEvent&&e.button===2&&this.showContextMenu(e);return}this.startChangeCol(n,e)});y(this,"onMouseDownRowsHeader",e=>{const n=I(e.target||[]).closest(Q.ROWS_HEADER_TRIGGER_CLASS);if(n.length===0){e instanceof MouseEvent&&e.button===2&&this.showContextMenu(e);return}this.startChangeRow(n,e)});y(this,"onClickColsHeader",e=>{var o;const{selection:n}=this.table;if(I(e.target||[]).closest(Q.COLS_HEADER_TRIGGER_CLASS).length>0)return;const r=I(e.target||[]).closest(Q.COLS_HEADER_ITEM_CLASS);if(r.length===0)return;const s=(o=this.colsHeader)==null?void 0:o.find(Q.COLS_HEADER_ITEM_CLASS).toArray().findIndex(a=>a.equal(r));s!==void 0&&n.selectCol(s)});y(this,"onClickRowsHeader",e=>{var o;const{selection:n}=this.table;if(I(e.target||[]).closest(Q.ROWS_HEADER_TRIGGER_CLASS).length>0)return;const r=I(e.target||[]).closest(Q.ROWS_HEADER_ITEM_CLASS);if(r.length===0)return;const s=(o=this.rowsHeader)==null?void 0:o.find(Q.ROWS_HEADER_ITEM_CLASS).toArray().findIndex(a=>a.equal(r));s!==void 0&&n.selectRow(s)});y(this,"onClickTableHeader",e=>{var i;e.preventDefault();const{selection:n}=this.table;if((i=this.tableHeader)!=null&&i.hasClass("selected"))n.clearSelect();else{const{tableModel:r}=n;if(!r)return;n.select({row:0,col:0},{row:r.rows-1,col:r.cols-1})}});y(this,"onChangeSize",e=>{!this.dragging||(this.dragging.y>-1?this.onChangeRowHeight(e):this.dragging.x>-1&&this.onChangeColWidth(e),this.emit("sizeChanging"))});y(this,"onChangeSizeEnd",e=>{if(!(e.type==="mouseleave"&&this.table.getCenter().contains(e.toElement))){if(this.dragging&&this.changeSize){const{width:n,height:i,element:r}=this.changeSize.trigger;r.removeClass("dragging"),this.dragging.x>-1&&r.css("height",`${i}px`),this.dragging.y>-1&&r.css("width",`${n}px`),this.dragging=void 0,this.renderRowBars(),this.emit("sizeChanged")}this.unbindChangeSizeEvent()}});y(this,"onDragStartColsHeader",e=>{var a,c;e.stopPropagation();const{selection:n}=this.table,i=n.getSelectArea();if(!e.target||!i.allRow)return;const r=I(e.target).closest(Q.COLS_HEADER_ITEM_CLASS);if(r.length===0)return;const s=(a=this.colsHeader)==null?void 0:a.find(Q.COLS_HEADER_ITEM_CLASS).toArray().findIndex(u=>u.equal(r));if(s===void 0)return;const o=s;o<i.begin.col||o>i.end.col||(this.draggingHeader={element:r,minIndex:i.begin.col,maxIndex:i.end.col,count:i.end.col-i.begin.col+1},r.addClass("dragging"),r.find(".drag-info").html(this.editor.language.get("table","draggingCol").replace("$data",this.draggingHeader.count.toString())),(c=this.colsHeader)==null||c.addClass("dragging"),this.table.helper.fixDragEvent(e),this.bindDragColEvent())});y(this,"onDragStartRowsHeader",e=>{var a,c;e.stopPropagation();const{selection:n}=this.table,i=n.getSelectArea();if(!e.target||!i.allCol)return;const r=I(e.target).closest(Q.ROWS_HEADER_ITEM_CLASS);if(r.length===0)return;const s=(a=this.rowsHeader)==null?void 0:a.find(Q.ROWS_HEADER_ITEM_CLASS).toArray().findIndex(u=>u.equal(r));if(s===void 0)return;const o=s;o<i.begin.row||o>i.end.row||(this.draggingHeader={element:r,minIndex:i.begin.row,maxIndex:i.end.row,count:i.end.row-i.begin.row+1},r.addClass("dragging"),r.find(".drag-info").html(this.editor.language.get("table","draggingRow").replace("$data",this.draggingHeader.count.toString())),(c=this.rowsHeader)==null||c.addClass("dragging"),this.table.helper.fixDragEvent(e),this.bindDragRowEvent())});y(this,"onDragCol",e=>{var h,f;if(e.stopPropagation(),!this.draggingHeader||!e.target||(this.dragging===void 0&&(this.dragging={x:e.offsetX,y:e.offsetY}),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),Math.abs(this.dragging.x-e.offsetX)<3))return;this.dragging.x=e.offsetX,this.draggingHeader.element.removeClass("dragging");const n=I(e.target).closest("td"),i=I(e.target).closest(Q.COLS_HEADER_ITEM_CLASS);if(n.length===0&&i.length===0)return;if(i.length>0){const p=(h=this.colsHeader)==null?void 0:h.find(Q.COLS_HEADER_ITEM_CLASS).toArray().findIndex(v=>v.equal(i));if(p===void 0)return;const g=p,m=e.offsetX>i.get().offsetWidth/2?g+1:g;this.showPlaceHolder(m,m!==g);return}const r=(f=this.colsHeader)==null?void 0:f.find(Q.COLS_HEADER_ITEM_CLASS);if(!r)return;const o=n.get().colSpan,[a,c]=this.table.selection.getCellPoint(n);let u=c,d=0;for(let p=0;p<o;p++){const g=r.eq(c+p).get();if(d+g.offsetWidth/2>e.offsetX){u=c+p;break}if(d+g.offsetWidth>e.offsetX){u=c+p+1;break}d+=g.offsetWidth}this.showPlaceHolder(u,u!==c)});y(this,"onDragColEnd",()=>{var u,d,h,f;this.unbindDragColEvent();const{index:e,count:n,isNext:i}=this.draggingHeader||{};if(!this.draggingHeader||e===void 0||n===void 0)return;const{command:r,selection:s}=this.table,o=s.getSelectArea(),a=(u=this.table.wrapper)==null?void 0:u.find(Q.COLS_HEADER_ITEM_CLASS);if(!a)return;let c=[];for(let p=o.begin.col;p<=o.end.col;p++)c.push(((h=(d=a.eq(p))==null?void 0:d.get())==null?void 0:h.offsetWidth)||0);if(r.mockCopy(),o.begin.col>e){const p=i?e-1:e;r.removeCol(),r.insertColAt(p,n,i,c,!0),s.selectCol(p,p+n-1),r.mockPaste(!0)}else{r.removeCol();const p=(i?e-1:e)-n;r.insertColAt(p,n,i,c,!0),s.selectCol(p+1,p+n),r.mockPaste(!0)}(f=this.placeholder)==null||f.css("display","none"),this.draggingHeader=void 0,this.dragging=void 0});y(this,"onDragRow",e=>{var u,d;if(e.stopPropagation(),!this.draggingHeader||!e.target||(this.dragging===void 0&&(this.dragging={x:e.offsetX,y:e.offsetY}),Math.abs(this.dragging.y-e.offsetY)<3))return;this.dragging.y=e.offsetY,this.draggingHeader.element.removeClass("dragging");const n=I(e.target).closest("td"),i=I(e.target).closest(Q.ROWS_HEADER_ITEM_CLASS);if(n.length===0&&i.length===0)return;if(i.length>0){const h=(u=this.rowsHeader)==null?void 0:u.find(Q.ROWS_HEADER_ITEM_CLASS).toArray().findIndex(g=>g.equal(i));if(h===void 0)return;const f=h,p=e.offsetY>i.get().offsetHeight/2?f+1:f;this.showPlaceHolder(p,p!==f);return}const r=(d=this.rowsHeader)==null?void 0:d.find(Q.ROWS_HEADER_ITEM_CLASS);if(!r)return;const s=n.get().rowSpan,[o]=this.table.selection.getCellPoint(n);let a=o,c=0;for(let h=0;h<s;h++){const f=r[o+h];if(c+f.offsetHeight/2>e.offsetY){a=o+h;break}if(c+f.offsetHeight>e.offsetY){a=o+h+1;break}c+=f.offsetHeight}this.showPlaceHolder(a,a!==o)});y(this,"onDragRowEnd",()=>{var u;this.unbindDragRowEvent();const{index:e,count:n,isNext:i}=this.draggingHeader||{};if(!this.draggingHeader||e===void 0||n===void 0)return;const{command:r,selection:s}=this.table,o=s.getSelectArea(),{begin:a,end:c}=o;if(r.mockCopy(),a.row>e){const d=i?e-1:e;r.removeRow(),r.insertRowAt(d,n,!i,!0),s.selectRow(e,e+n-1),r.mockPaste(!0)}else{r.removeRow();const d=(i?e-1:e)-n;r.insertRowAt(d,n,!i,!0),s.selectRow(d+1,d+n),r.mockPaste(!0)}(u=this.placeholder)==null||u.css("display","none"),this.draggingHeader=void 0,this.dragging=void 0});y(this,"menuSets",new WeakSet);y(this,"onMenuInputMousedown",e=>{e.stopPropagation()});y(this,"handleHighlightRow",()=>{const{selection:e}=this.table,{tableModel:n}=e;if(!n)return;const i={...e.getSelectArea()};i.allCol=!0,i.begin={row:i.begin.row,col:0},i.end={row:i.end.row,col:n.cols-1},e.showHighlight(i)});y(this,"handleHighlightCol",()=>{const{selection:e}=this.table,{tableModel:n}=e;if(!n)return;const i={...e.getSelectArea()};i.allRow=!0,i.begin={row:0,col:i.begin.col},i.end={row:n.rows-1,col:i.end.col},e.showHighlight(i)});y(this,"handleHighlightTable",()=>{const{selection:e}=this.table,{tableModel:n}=e;if(!n)return;const i={...e.getSelectArea()};i.allRow=!0,i.allCol=!0,i.begin={row:0,col:0},i.end={row:n.rows-1,col:n.cols-1},e.showHighlight(i)});this.table=n,this.editor=e,this.COL_MIN_WIDTH=i.col_min_width,this.ROW_MIN_HEIGHT=i.row_min_height,this.MAX_INSERT_NUM=i.max_insert_num}init(){const{wrapper:e}=this.table;!e||(this.tableRoot=e.find(Q.TABLE_CLASS),this.colsHeader=e.find(Q.COLS_HEADER_CLASS),this.rowsHeader=e.find(Q.ROWS_HEADER_CLASS),this.tableHeader=e.find(Q.HEADER_CLASS),this.viewport=e.find(Q.VIEWPORT),this.menuBar=e.find(Q.MENUBAR_CLASS),this.placeholder=e.find(Q.PLACEHOLDER_CLASS),this.renderRowBars(),this.renderColBars(),this.bindEvents())}renderRowBars(e=!0){var i,r,s,o,a,c,u,d,h,f,p,g;const n=(i=this.tableRoot)==null?void 0:i.get();if(!!n&&((r=this.rowDeleteButton)==null||r.removeAllEvents(),this.rowDeleteButton=(s=this.rowsHeader)==null?void 0:s.find(Q.ROW_DELETE_BUTTON_CLASS),(o=this.rowAddButton)==null||o.removeAllEvents(),this.rowAddButton=(a=this.rowsHeader)==null?void 0:a.find(Q.ROW_ADD_BUTTON_CLASS),this.rowAddButtonSplit=(c=this.rowAddButton)==null?void 0:c.find(Q.ROW_ADD_BUTTON_SPLIT_CLASS),(u=this.rowDeleteButton)==null||u.on("mouseover",m=>this.handleHighlightRow()).on("mouseleave",m=>this.hideHighlight(m)).on("mousedown",m=>{m.preventDefault(),this.table.command.removeRow()}),(d=this.rowAddButton)==null||d.on("mouseenter",()=>{var m;this.hideRowAddButtonTimeount&&clearTimeout(this.hideRowAddButtonTimeount),(m=this.rowsHeader)==null||m.css("z-index",128)}).on("mouseleave",()=>{this.hideRowAddButtonTimeount=setTimeout(()=>{var m,v;(m=this.rowAddButton)==null||m.hide(),(v=this.rowsHeader)==null||v.css("z-index",1),this.moveRowIndex=-1},200)}).on("mousedown",m=>{m.preventDefault(),this.table.command.insertRowAt(this.moveRowIndex,1,this.rowAddAlign!=="down")}),e)){const m=n.rows,v=(m==null?void 0:m.length)||0,b=(h=this.rowsHeader)==null?void 0:h.find(Q.ROWS_HEADER_ITEM_CLASS);if(b)for(let R=0;R<v;R++){const D=en(m[R],"height"),P=b[R],O=P==null?void 0:P.style.height;P&&D!==O&&(P.style.height=D)}const _=(f=this.rowsHeader)==null?void 0:f.find(Q.ROWS_HEADER_TRIGGER_CLASS),x=this.tableRoot.width(),w=((p=this.table.wrapper)==null?void 0:p.width())||0,S=(x<w?x:w)+(((g=this.rowsHeader)==null?void 0:g.width())||0)-1;_==null||_.each(R=>{R.style.width!==S+"px"&&(R.style.width=S+"px")})}}renderColBars(e=!0){var r,s,o,a,c,u,d,h,f,p;const n=(r=this.tableRoot)==null?void 0:r.get();if(!n)return;const i=Ee(en(n,"width"));(s=this.colDeleteButton)==null||s.removeAllEvents(),this.colDeleteButton=(o=this.table.wrapper)==null?void 0:o.find(Q.COL_DELETE_BUTTON_CLASS),(a=this.colAddButton)==null||a.removeAllEvents(),this.colAddButton=(c=this.colsHeader)==null?void 0:c.find(Q.COL_ADD_BUTTON_CLASS),this.colAddButtonSplit=(u=this.colAddButton)==null?void 0:u.find(Q.COL_ADD_BUTTON_SPLIT_CLASS),(d=this.colDeleteButton)==null||d.on("mouseover",g=>this.handleHighlightCol()).on("mouseleave",g=>this.hideHighlight(g)).on("mousedown",g=>{g.preventDefault(),this.table.command.removeCol()}),(h=this.colAddButton)==null||h.on("mouseenter",()=>{this.hideColAddButtonTimeount&&clearTimeout(this.hideColAddButtonTimeount)}).on("mouseleave",()=>{this.hideColAddButtonTimeount=setTimeout(()=>{var g;(g=this.colAddButton)==null||g.hide(),this.moveColIndex=-1},200)}).on("mousedown",g=>{g.preventDefault(),this.moveColIndex>-1&&this.table.command.insertColAt(this.moveColIndex,1,this.colAddAlign!=="right")}),(f=this.tableRoot)==null||f.css("width",`${i}px`),(p=this.colsHeader)==null||p.css("width",`${i}px`),e&&this.renderColSize()}renderColSize(){var f,p,g,m,v,b,_,x;const e=(f=this.tableRoot)==null?void 0:f.get();if(!e)return;const n=Ee(en(e,"width")),i=(p=this.tableRoot)==null?void 0:p.find("col");if(!i)return;let r=!0;const s={};let o=0,a=0;i.each((w,E)=>{const S=i[E],R=Ee(I(S).attributes("width"));R?(s[E]=R,o+=R,r=!1):a++});const c=(g=this.colsHeader)==null?void 0:g.find(Q.COLS_HEADER_ITEM_CLASS);if(!c)return;const{tableModel:u}=this.table.selection;if(r){let w=[];(m=u==null?void 0:u.table)==null||m.forEach(D=>{D.forEach((P,O)=>{!w[O]&&!this.table.helper.isEmptyModelCol(P)&&!P.isMulti&&P.element&&(w[O]=Ee(en(P.element,"width")))})});let E=0,S=0;for(let D=0;D<i.length;D++)w[D]?S+=w[D]:E++;let R=0;E>0&&(R=Math.round(Math.round((n-S)/E)*1e4)/1e4);for(let D=0;D<i.length;D++){const P=w[D]||R;(v=c.eq(D))==null||v.css("width",P+"px"),(b=i.eq(D))==null||b.attributes("width",P)}}else if(a){const w=Math.round((n-o)/a*1e4)/1e4;i.each((E,S)=>{var D,P;const R=s[S]===void 0?w:s[S];(D=c.eq(S))==null||D.css("width",R+"px"),(P=i.eq(S))==null||P.attributes("width",R)})}else i.each((w,E)=>{const S=Math.round(n*s[E]/o*1e4)/1e4,R=c[E],D=R==null?void 0:R.style.width;R&&D!==S+"px"&&(R.style.width=S+"px")});const d=(_=this.colsHeader)==null?void 0:_.find(Q.COLS_HEADER_TRIGGER_CLASS),h=((u==null?void 0:u.height)||0)+(((x=this.colsHeader)==null?void 0:x.height())||0);d==null||d.each(w=>{w.style.height!==h+"px"&&(w.style.height=h+"px")})}bindEvents(){var c,u,d,h,f,p,g,m,v,b,_,x,w,E,S,R,D,P;(c=this.colsHeader)==null||c.on(ue?"touchstart":"mousedown",this.onMouseDownColsHeader).on("mouseup",this.onClickColsHeader).on("dragstart",this.onDragStartColsHeader),(u=this.rowsHeader)==null||u.on(ue?"touchstart":"mousedown",this.onMouseDownRowsHeader).on("mouseup",this.onClickRowsHeader).on("dragstart",this.onDragStartRowsHeader),(d=this.tableHeader)==null||d.on("mousedown",this.onClickTableHeader),(h=this.table.wrapper)==null||h.on("contextmenu",O=>O.preventDefault()),(f=this.tableRoot)==null||f.on("contextmenu",O=>O.preventDefault()),(p=this.colsHeader)==null||p.on("contextmenu",O=>O.preventDefault()),(g=this.rowsHeader)==null||g.on("contextmenu",O=>O.preventDefault()),(m=this.tableRoot)==null||m.on("mousedown",O=>this.onTableMouseDown(O)),(v=this.menuBar)==null||v.on("click",O=>this.handleClickMenu(O)),(b=this.menuBar)==null||b.on("mouseover",O=>this.handleHoverMenu(O)),(_=this.menuBar)==null||_.on("mouseleave",O=>this.hideHighlight(O));const e=this.editor;(x=this.viewport)==null||x.on(ue?"touchstart":"mousedown",O=>{var F;if(!O.target)return;const L=I(O.target);if(!V(e)||!O.target||!((F=this.viewport)!=null&&F.equal(L)))return;O.preventDefault(),O.stopPropagation();const{change:B}=e,A=B.range.get();e.card.focusPrevBlock(this.table,A,!0),e.card.activate(A.startNode,ui.MOUSE_DOWN),B.range.select(A)});let n=null;(w=this.colsHeader)==null||w.on("mouseenter",()=>{this.hideColAddButtonTimeount&&clearTimeout(this.hideColAddButtonTimeount)}).on("mousemove",O=>{n&&clearTimeout(n),n=setTimeout(()=>{this.onMouseMoveColsHeader(O)},200)}).on("mouseleave",O=>{n&&clearTimeout(n),this.hideColAddButtonTimeount=setTimeout(()=>{var L;(L=this.colAddButton)==null||L.hide()},200)});let i=null;(E=this.colsHeader)==null||E.find(Q.COLS_HEADER_ITEM_CLASS).on("mouseenter",O=>{i&&clearTimeout(i),i=setTimeout(()=>{O.target&&I(O.target).closest(Q.COLS_HEADER_ITEM_CLASS).addClass("active")},200)}).on("mouseleave",O=>{i&&clearTimeout(i),O.target&&I(O.target).closest(Q.COLS_HEADER_ITEM_CLASS).removeClass("active")});let r=null;(S=this.colsHeader)==null||S.find(Q.COLS_HEADER_TRIGGER_CLASS).on("mouseenter",O=>{r&&clearTimeout(r);const L=I(O.target||[]);r=setTimeout(()=>{L.addClass("active")},200)}).on("mouseleave",O=>{r&&clearTimeout(r),O.target&&I(O.target).removeClass("active")});let s=null;(R=this.rowsHeader)==null||R.on("mouseenter",()=>{this.hideRowAddButtonTimeount&&clearTimeout(this.hideRowAddButtonTimeount)}).on("mousemove",O=>{s&&clearTimeout(s),s=setTimeout(()=>{var L;this.onMouseMoveRowsHeader(O),(L=this.rowsHeader)==null||L.css("z-index",128)},200)}).on("mouseleave",()=>{s&&clearTimeout(s),this.hideRowAddButtonTimeount=setTimeout(()=>{var O,L;(O=this.rowsHeader)==null||O.css("z-index",""),(L=this.rowAddButton)==null||L.hide()},200)});let o=null;(D=this.rowsHeader)==null||D.find(Q.ROWS_HEADER_ITEM_CLASS).on("mouseenter",O=>{o&&clearTimeout(o),o=setTimeout(()=>{O.target&&I(O.target).closest(Q.ROWS_HEADER_ITEM_CLASS).addClass("active")},200)}).on("mouseleave",O=>{o&&clearTimeout(o),O.target&&I(O.target).closest(Q.ROWS_HEADER_ITEM_CLASS).removeClass("active")});let a=null;(P=this.rowsHeader)==null||P.find(Q.ROWS_HEADER_TRIGGER_CLASS).on("mouseenter",O=>{a&&clearTimeout(a);const L=I(O.target||[]);a=setTimeout(()=>{L.addClass("active")},200)}).on("mouseleave",O=>{a&&clearTimeout(a),O.target&&I(O.target).removeClass("active")})}onTableMouseDown(e){if(!e.target)return;I(e.target).closest("td").length>0&&e.button===2&&this.table.activated?this.showContextMenu(e):this.hideContextMenu()}onMouseMoveColsHeader(e){var f,p;if(!e.target||!this.colAddButton||!this.colAddButtonSplit)return;const n=I(e.target),i=n.closest(Q.COLS_HEADER_ITEM_CLASS);if(i.length===0)return;const r=this.colsHeader.find(Q.COLS_HEADER_ITEM_CLASS).toArray(),s=i.width(),o=this.colAddButton.width();let a=i.get().offsetLeft;const c=r.findIndex(g=>g.equal(i)),u=e.offsetX>s/2||n.hasClass("cols-trigger"),d=r[r.length-1].equal(i);u&&(a+=d?s-o/2:s),this.colAddAlign=u?"left":"right",this.moveColIndex=c,(f=this.colAddButton)==null||f.show("flex"),this.colAddButton.css("left",`${a}px`),this.colAddButton.css("z-index",128);const h=(((p=this.table.selection.tableModel)==null?void 0:p.height)||0)+i.height()+4;this.colAddButtonSplit.css("height",`${h}px`),this.colAddButtonSplit.css("left",`${d&&u?o-3+"px":""}`)}onMouseMoveRowsHeader(e){var f,p;if(!e.target||!this.rowAddButton||!this.rowAddButtonSplit)return;const n=I(e.target),i=n.closest(Q.ROWS_HEADER_ITEM_CLASS);if(i.length===0)return;const r=this.rowsHeader.find(Q.ROWS_HEADER_ITEM_CLASS).toArray(),s=i.height();let o=i.get().offsetTop;const a=r.findIndex(g=>g.equal(i)),c=e.offsetY>s/2||n.hasClass("rows-trigger");c&&(o+=s),this.moveRowIndex=a,this.rowAddButton.show("flex"),this.rowAddButton.css("top",`${o}px`),this.rowAddAlign=c?"down":"up";const u=(f=this.viewport)==null?void 0:f.get(),d=(((p=this.table.selection.tableModel)==null?void 0:p.width)||0)+i.width()+4;let h=Math.min(u.offsetWidth+4,d);this.rowAddButtonSplit.css("width",`${h}px`)}activeHeader(){var u,d,h,f,p,g,m,v,b,_,x,w,E;const e=this.table.selection.getSelectArea();this.clearActiveStatus();const n=(u=this.colsHeader)==null?void 0:u.find(Q.COLS_HEADER_ITEM_CLASS),i=(d=this.rowsHeader)==null?void 0:d.find(Q.ROWS_HEADER_ITEM_CLASS),{begin:r,end:s,allCol:o,allRow:a}=e;if(i){for(let S=r.row;S<=s.row;S++)if(o){const R=i[S];R!=null&&R.classList.contains("selected")||R==null||R.classList.add("selected"),a&&!(R!=null&&R.classList.contains("no-dragger"))&&(R==null||R.classList.add("no-dragger"))}}if(n){for(let S=r.col;S<=s.col;S++)if(a){const R=n[S];R!=null&&R.classList.contains("selected")||R==null||R.classList.add("selected"),o&&!(R!=null&&R.classList.contains("no-dragger"))&&(R==null||R.classList.add("no-dragger"))}}const c=(h=this.tableHeader)==null?void 0:h.get();if(o&&a?c!=null&&c.classList.contains("selected")||c==null||c.classList.add("selected"):c!=null&&c.classList.contains("selected")&&(c==null||c.classList.remove("selected")),o&&!a){const S=(f=this.tableRoot)==null?void 0:f.find("tr").eq(r.row);if(S){const R=S.get().offsetTop;(p=this.rowDeleteButton)==null||p.show("flex"),(g=this.rowDeleteButton)==null||g.css("top",`${R-this.rowDeleteButton.height()}px`)}}else(m=this.rowDeleteButton)==null||m.hide();if(!o&&a){let S=0;for(let D=r.col;D<=s.col;D++)S+=((v=n==null?void 0:n.eq(D))==null?void 0:v.width())||0;const R=((_=(b=n==null?void 0:n.eq(r.col))==null?void 0:b.get())==null?void 0:_.offsetLeft)||0;(x=this.colDeleteButton)==null||x.show("flex"),(w=this.colDeleteButton)==null||w.css("left",`${R+S/2}px`)}else(E=this.colDeleteButton)==null||E.hide()}clearActiveStatus(){var r,s,o;const e=(r=this.colsHeader)==null?void 0:r.find(Q.COLS_HEADER_ITEM_CLASS),n=(s=this.rowsHeader)==null?void 0:s.find(Q.ROWS_HEADER_ITEM_CLASS);e==null||e.each(a=>{const c=a;c.classList.contains("selected")&&c.classList.remove("selected"),c.classList.contains("no-dragger")&&c.classList.remove("no-dragger")}),n==null||n.each(a=>{const c=a;c.classList.contains("selected")&&c.classList.remove("selected"),c.classList.contains("no-dragger")&&c.classList.remove("no-dragger")});const i=(o=this.tableHeader)==null?void 0:o.get();i!=null&&i.classList.contains("selected")&&i.classList.remove("selected")}refresh(e=!0){this.renderColBars(e),this.renderRowBars(e),this.activeHeader()}startChangeCol(e,n){var o,a,c;n.stopPropagation(),n.preventDefault();const i=e.parent(),r=i.get();this.table.selection.clearSelect(),this.dragging={x:n instanceof MouseEvent?n.clientX:n.touches[0].clientX,y:-1};const s=((o=this.colsHeader)==null?void 0:o.find(Q.COLS_HEADER_ITEM_CLASS).toArray().findIndex(u=>u.equal(i)))||0;this.changeSize={trigger:{element:e,height:Ee(en(e.get(),"height")),width:Ee(en(e.get(),"width"))},element:i,width:Ee(en(r,"width")),height:-1,index:s,table:{width:((a=this.table.selection.tableModel)==null?void 0:a.width)||0,height:((c=this.table.selection.tableModel)==null?void 0:c.height)||0}},this.bindChangeSizeEvent()}startChangeRow(e,n){var o,a,c;n.stopPropagation(),n.preventDefault();const i=e.parent(),r=i.get();this.table.selection.clearSelect(),this.dragging={x:-1,y:n instanceof MouseEvent?n.clientY:n.touches[0].clientY};const s=((o=this.rowsHeader)==null?void 0:o.find(Q.ROWS_HEADER_ITEM_CLASS).toArray().findIndex(u=>u.equal(i)))||0;this.changeSize={trigger:{element:e,height:Ee(en(e.get(),"height")),width:Ee(en(e.get(),"width"))},element:i,width:-1,height:Ee(en(r,"height")),index:s,table:{width:((a=this.table.selection.tableModel)==null?void 0:a.width)||0,height:((c=this.table.selection.tableModel)==null?void 0:c.height)||0}},this.bindChangeSizeEvent()}bindChangeSizeEvent(){var e,n;(e=this.colsHeader)==null||e.addClass("resize"),(n=this.rowsHeader)==null||n.addClass("resize"),document.addEventListener(ue?"touchmove":"mousemove",this.onChangeSize),document.addEventListener(ue?"touchend":"mouseup",this.onChangeSizeEnd),ue||document.addEventListener("mouseleave",this.onChangeSizeEnd)}unbindChangeSizeEvent(){var e,n;(e=this.colsHeader)==null||e.removeClass("resize"),(n=this.rowsHeader)==null||n.removeClass("resize"),document.removeEventListener(ue?"touchmove":"mousemove",this.onChangeSize),document.removeEventListener(ue?"touchend":"mouseup",this.onChangeSizeEnd),ue||document.removeEventListener("mouseleave",this.onChangeSizeEnd)}onChangeColWidth(e){var c,u,d,h,f;if(!this.dragging||!this.changeSize)return;let n=(e instanceof MouseEvent?e.clientX:e.touches[0].clientX)-this.dragging.x;const i=Math.max(this.COL_MIN_WIDTH,this.changeSize.width+n);n=i-this.changeSize.width;const r=this.changeSize.table.width+n;this.changeSize.element.css("width",i+"px");const s=this.changeSize.element.get();(c=this.colsHeader)==null||c.css("width",r+"px");const o=(u=this.viewport)==null?void 0:u.get(),a=s.offsetLeft+s.offsetWidth;a-o.scrollLeft+20>o.offsetWidth?o.scrollLeft=a+20-o.offsetWidth:o.scrollLeft+o.offsetWidth===o.scrollWidth&&(o.scrollLeft=Math.max(0,r+34-o.offsetWidth)),this.clearActiveStatus(),this.hideContextMenu(),this.renderRowBars(),this.renderColSplitBars(this.changeSize.element,this.changeSize.trigger.element),(h=(d=this.tableRoot)==null?void 0:d.find("col").eq(this.changeSize.index))==null||h.attributes("width",i),(f=this.tableRoot)==null||f.css("width",`${r}px`)}onChangeRowHeight(e){var r,s;if(!this.dragging||!this.changeSize)return;let n=(e instanceof MouseEvent?e.clientY:e.touches[0].clientY)-this.dragging.y;const i=Math.max(this.ROW_MIN_HEIGHT,this.changeSize.height+n);n=i-this.changeSize.height,this.changeSize.element.css("height",i+"px"),this.clearActiveStatus(),this.hideContextMenu(),this.renderRowSplitBars(this.changeSize.element,this.changeSize.trigger.element),(s=(r=this.tableRoot)==null?void 0:r.find("tr").eq(this.changeSize.index))==null||s.css("height",`${i}px`)}renderColSplitBars(e,n){var r;const i=((r=this.table.selection.tableModel)==null?void 0:r.height)||0;n.addClass("dragging").css("height",`${i+e.height()}px`)}renderRowSplitBars(e,n){var o,a;const i=(o=this.viewport)==null?void 0:o.get(),r=((a=this.table.selection.tableModel)==null?void 0:a.width)||0,s=Math.min(i.offsetWidth-e.width(),r);n.addClass("dragging").css("width",`${s+e.width()}px`)}bindDragColEvent(){const{wrapper:e}=this.table;e==null||e.on("dragover",this.onDragCol),e==null||e.on("drop",this.onDragColEnd),e==null||e.on("dragend",this.onDragColEnd)}unbindDragColEvent(){var i,r;const{wrapper:e}=this.table,n=(i=this.colsHeader)==null?void 0:i.find(Q.COLS_HEADER_ITEM_CLASS);n==null||n.removeClass("dragging"),(r=this.colsHeader)==null||r.removeClass("dragging"),e==null||e.off("dragover",this.onDragCol),e==null||e.off("drop",this.onDragColEnd),e==null||e.off("dragend",this.onDragColEnd)}bindDragRowEvent(){const{wrapper:e}=this.table;e==null||e.on("dragover",this.onDragRow),e==null||e.on("drop",this.onDragRowEnd),e==null||e.on("dragend",this.onDragRowEnd)}unbindDragRowEvent(){var i,r;const{wrapper:e}=this.table,n=(i=this.rowsHeader)==null?void 0:i.find(Q.ROWS_HEADER_ITEM_CLASS);n==null||n.removeClass("dragging"),(r=this.rowsHeader)==null||r.removeClass("dragging"),e==null||e.off("dragover",this.onDragRow),e==null||e.off("drop",this.onDragRowEnd),e==null||e.off("dragend",this.onDragRowEnd)}showPlaceHolder(e,n){var o,a,c,u,d,h,f,p,g,m,v,b,_,x,w,E,S,R,D,P,O,L;if(!this.draggingHeader)return;const{element:i,minIndex:r,maxIndex:s}=this.draggingHeader;if(i.closest(Q.COLS_HEADER_CLASS).length>0){if(e===this.draggingHeader.index)return;if(r<=e&&e<=s+1){delete this.draggingHeader.index,delete this.draggingHeader.isNext,(o=this.placeholder)==null||o.css("display","none");return}this.draggingHeader.isNext=n,this.draggingHeader.index=e;const B=(a=this.colsHeader)==null?void 0:a.find(Q.COLS_HEADER_ITEM_CLASS);if(!B)return;const A=this.draggingHeader.index!==B.length?B.eq(this.draggingHeader.index).get().offsetLeft+2:B.eq(this.draggingHeader.index-1).get().offsetLeft+B.eq(this.draggingHeader.index-1).get().offsetWidth+2,F=(c=this.viewport)==null?void 0:c.get(),{scrollLeft:W,offsetWidth:G}=F;A<W&&(F.scrollLeft=A-5),A>W+G&&(F.scrollLeft=A-G+5);const k=(((u=this.table.selection.tableModel)==null?void 0:u.height)||0)+B.height(),C=(d=this.viewport)==null?void 0:d.css("padding-top"),$=((h=this.viewport)==null?void 0:h.css("padding-left"))||"0";(f=this.placeholder)==null||f.css("width","2px"),(p=this.placeholder)==null||p.css("height",`${k}px`),(g=this.placeholder)==null||g.css("left",A-4+Ee($)+"px"),(m=this.placeholder)==null||m.css("top",C),(v=this.placeholder)==null||v.css("display","block")}else if(i.closest(Q.ROWS_HEADER_CLASS).length>0){if(e===this.draggingHeader.index)return;if(r<=e&&e<=s+1){delete this.draggingHeader.index,delete this.draggingHeader.isNext,(b=this.placeholder)==null||b.css("display","none");return}this.draggingHeader.index=e,this.draggingHeader.isNext=n;const B=(_=this.rowsHeader)==null?void 0:_.find(Q.ROWS_HEADER_ITEM_CLASS);if(!B)return;const A=this.draggingHeader.index!==B.length?B.eq(this.draggingHeader.index).get().offsetTop+2:B.eq(this.draggingHeader.index-1).get().offsetTop+B.eq(this.draggingHeader.index-1).get().offsetHeight-2,F=((x=this.table.selection.tableModel)==null?void 0:x.width)||0,W=(w=this.viewport)==null?void 0:w.css("padding-top"),G=((E=this.viewport)==null?void 0:E.css("padding-left"))||"0",k=(S=this.colsHeader)==null?void 0:S.find(Q.COLS_HEADER_ITEM_CLASS);(R=this.placeholder)==null||R.css("height","2px"),(D=this.placeholder)==null||D.css("width",`${F}px`),(P=this.placeholder)==null||P.css("left",G),(O=this.placeholder)==null||O.css("top",A+Ee(W||"0")+((k==null?void 0:k.height())||0)-2+"px"),(L=this.placeholder)==null||L.css("display","block")}}removeRow(e){var r,s,o,a;const n=(r=this.rowsHeader)==null?void 0:r.find(Q.ROWS_HEADER_ITEM_CLASS),i=(s=n==null?void 0:n.eq(e))==null?void 0:s.get();i&&((a=(o=this.rowsHeader)==null?void 0:o.get())==null||a.removeChild(i))}removeCol(e){var s,o,a,c,u,d;const n=(s=this.colsHeader)==null?void 0:s.find(Q.COLS_HEADER_ITEM_CLASS),i=(o=this.colsHeader)==null?void 0:o.get(),r=(a=n==null?void 0:n.eq(e))==null?void 0:a.get();!i||!r||((c=this.colsHeader)==null||c.css("width",i.offsetWidth-r.offsetWidth+"px"),i.removeChild(r),(d=this.tableRoot)==null||d.css("width",(u=this.colsHeader)==null?void 0:u.css("width")))}showContextMenu(e){const n=this.editor;if(!this.menuBar||!e.target||!this.table.wrapper||!n.scrollNode)return;e.preventDefault();const{selection:i}=this.table,r=this.menuBar.find(Q.MENUBAR_ITEM_CLASS);r.removeClass("disabled"),r.each(m=>{const v=I(m),b=v.attributes("data-action");if(this.getMenuDisabled(b))v.addClass("disabled");else{const _=v.find(`input${Q.MENUBAR_ITEM_INPUT_CALSS}`);if(_.length===0)return;const x=_.get();this.menuSets.has(m)||(this.menuSets.add(m),_.on("blur",()=>{x.value=Math.min(parseInt(x.value,10)||1,this.MAX_INSERT_NUM).toString()}).on("keydown",R=>{ce("enter",R)&&this.handleTriggerMenu(v)}),_.on("mousedown",this.onMenuInputMousedown));const w=i.getSelectArea(),E=["insertColLeft","insertColRight"].indexOf(b)>-1,S=["insertRowUp","insertRowDown"].indexOf(b)>-1;E&&(x.value=`${w.end.col-w.begin.col+1}`),S&&(x.value=`${w.end.row-w.begin.row+1}`)}}),this.menuBar.find("div.split").each(m=>{const v=I(m);let b=v.prev();for(;b;){if(b.hasClass("split")){v.remove();break}if(!b.hasClass("disabled"))break;b=b.prev()}b||v.remove()});const o=I(e.target);let a=o.getBoundingClientRect()||{top:0,left:0},c=o.parent(),u=0,d=0;for(;c&&c.closest(Q.TABLE_WRAPPER_CLASS).length>0;){const m=c.getBoundingClientRect()||{top:0,left:0};u+=a.top-m.top,d+=a.left-m.left,a=m,c=c.parent()}const h=this.table.wrapper.get().getBoundingClientRect(),f=n.scrollNode.getViewport();u+=e.offsetY;const p=this.menuBar.height(),g=h.top+u+p+4;if(g>f.bottom){let m=g-f.bottom;u-m<0&&h.top+u-m<f.top&&(m=h.top+u-f.top),u-=m}this.menuBar.css("left",d+e.offsetX+"px"),this.menuBar.css("top",u+"px"),this.contextVisible=!0}hideContextMenu(){var n,i;if(!this.contextVisible)return;const e=(n=this.menuBar)==null?void 0:n.find(Q.MENUBAR_ITEM_CLASS);e==null||e.removeClass("disabled"),this.contextVisible=!1,(i=this.menuBar)==null||i.css({top:"-99999px",left:"-99999px"})}getMenuDisabled(e){const{selection:n,command:i}=this.table;switch(e){case"cut":case"copy":return!n.selectArea||n.selectArea.count<=1;case"splitCell":return!n.hasMergeCell();case"mergeCell":return!n.selectArea;case"mockPaste":return!i.hasCopyData();case"removeCol":case"insertColLeft":case"insertColRight":return n.isColSelected();case"removeRow":case"insertRowUp":case"insertRowDown":return n.isRowSelected();default:return!1}}handleClickMenu(e){if(!e.target)return;const n=I(e.target),i=n.closest(".table-menubar-item");i.length===0||n.name==="input"||(e.stopPropagation(),this.handleTriggerMenu(i))}handleTriggerMenu(e){var n;if(!e.hasClass("disabled")){const i=e.attributes("data-action"),r=e.find(`input${Q.MENUBAR_ITEM_INPUT_CALSS}`);let s;r.length>0&&(s=Math.min(parseInt(((n=r.get())==null?void 0:n.value)||"1",10),this.MAX_INSERT_NUM)),this.table.command[i](s)}this.hideContextMenu()}handleHoverMenu(e){if(!e.target)return;const n=I(e.target).closest(".table-menubar-item");if(n.length===0)return;e.stopPropagation();const{selection:i}=this.table;if(!n.hasClass("disabled"))switch(n.attributes("data-action")){case"removeCol":this.handleHighlightCol();break;case"removeRow":this.handleHighlightRow();break;case"removeTable":this.handleHighlightTable();break;default:i.hideHighlight()}}hideHighlight(e){e.stopPropagation(),this.table.selection.hideHighlight()}drawBackgroundColor(e){const{selection:n,helper:i}=this.table;n.each(r=>{!i.isEmptyModelCol(r)&&r.element&&(!e||e==="transparent"?r.element.style.removeProperty("background-color"):r.element.style.backgroundColor=e)})}setAlign(e){const{selection:n,helper:i}=this.table;n.each(r=>{!i.isEmptyModelCol(r)&&r.element&&(!e||e==="top"?r.element.style.removeProperty("vertical-align"):r.element.style.verticalAlign=e)})}destroy(){var e,n,i,r,s,o,a,c,u,d,h,f,p;(e=this.colsHeader)==null||e.removeAllEvents(),(n=this.rowsHeader)==null||n.removeAllEvents(),(i=this.tableHeader)==null||i.removeAllEvents(),(r=this.table.wrapper)==null||r.removeAllEvents(),(s=this.tableRoot)==null||s.removeAllEvents(),(o=this.menuBar)==null||o.removeAllEvents(),(a=this.viewport)==null||a.removeAllEvents(),(c=this.rowDeleteButton)==null||c.removeAllEvents(),(u=this.colDeleteButton)==null||u.removeAllEvents(),(d=this.colAddButton)==null||d.removeAllEvents(),(h=this.colsHeader)==null||h.removeAllEvents(),(f=this.rowAddButton)==null||f.removeAllEvents(),(p=this.rowsHeader)==null||p.removeAllEvents()}}class eoe extends So.exports.EventEmitter2{constructor(e,n){super();y(this,"editor");y(this,"table");y(this,"tableRoot");y(this,"colsHeader");y(this,"rowsHeader");y(this,"tableHeader");y(this,"tableModel");y(this,"selectArea");y(this,"selectRange");y(this,"dragging");y(this,"isShift",!1);y(this,"prevMouseDownTd");y(this,"prevOverTd");y(this,"highlight");y(this,"beginAllRow");y(this,"beginAllCol");y(this,"onTdMouseDown",e=>{var h,f;this.selectRange=void 0;const n=this.editor;if(!e.target||!V(n))return;const{change:i}=n,r=I(e.target),s=r.closest("td");if(s.length===0||!s.inEditor())return;const o=i.range.get(),[a,c]=this.getCellPoint(s),u=!!s.attributes("table-cell-selection");if(this.isShift){let p={row:0,col:0};if(this.prevMouseDownTd){const[g,m]=this.getCellPoint(this.prevMouseDownTd);p={row:g,col:m}}else if(this.selectArea&&(p=this.selectArea.begin,this.tableModel)){const g=this.tableModel.table[p.row][p.col];!this.table.helper.isEmptyModelCol(g)&&g.element&&(this.prevMouseDownTd=I(g.element))}this.select(p,{row:a,col:c});return}else this.prevMouseDownTd=s,e instanceof MouseEvent&&e.button!==2&&this.select({row:a,col:c},{row:a,col:c});if(r.name==="td"&&(u||!o.startNode.closest("td").equal(s)||!o.endNode.closest("td").equal(s))){if(e instanceof MouseEvent&&e.button===2&&!!r.attributes("table-cell-selection"))return;e.preventDefault(),this.focusCell(s)}else r.name==="td"&&e.preventDefault();const d=()=>{this.select({row:a,col:c},{row:a,col:c}),this.dragging={trigger:{element:s}},this.addDragEvent()};if(e instanceof MouseEvent&&e.button===2){r.attributes("table-cell-selection")&&e.preventDefault();return}else if(r.name==="td"){const p=s.find(ze);if(p.length>0){const g=p.last();if(g){if(!g.isBlockCard()||(((h=g.get())==null?void 0:h.offsetTop)||0)+(((f=g.get())==null?void 0:f.clientHeight)||0)>(e instanceof MouseEvent?e:e.touches[0]).clientY)return d();const m=I("<p><br /></p>");p.append(m);const v=n.change.range.get();v.select(m,!0).collapse(!1),n.change.apply(v)}}}d()});y(this,"removeDragEvent",()=>{var e,n;(e=this.tableRoot)==null||e.removeClass("drag-select"),(n=this.table.wrapper)==null||n.removeClass("drag-selecting"),document.removeEventListener(ue?"touchend":"mouseup",this.removeDragEvent),document.removeEventListener(ue?"touchmove":"mousemove",this.onDragMove),this.dragging=void 0});y(this,"onDragMove",e=>{var i,r;if(!this.dragging||!e.target)return;const n=I(e.target).closest("td");n.length===0||!n.inEditor()||this.prevOverTd&&n.equal(this.prevOverTd)||(this.prevOverTd=n,this.dragging.trigger.element.equal(n)?((r=this.table.wrapper)==null||r.removeClass("drag-selecting"),this.clearSelect()):((i=this.table.wrapper)==null||i.addClass("drag-selecting"),this.selectCell(this.dragging.trigger.element,n)))});y(this,"onShiftKeydown",e=>{!e.target||!this.tableModel||!V(this.editor)||ce("shift",e)&&(this.isShift=!0)});y(this,"onKeydown",e=>{if(!e.target||!this.tableModel||!V(this.editor))return;const n=I(e.target).closest("td");if(n.length===0||!n.inEditor())return;const[i,r]=this.getCellPoint(n);if(!(i<0||r<0))if(ce("shift+left",e)?this.selectLeft(e,n):ce("shift+right",e)?this.selectRigth(e,n):ce("shift+up",e)?this.selectUp(e,n):ce("shift+down",e)&&this.selectDown(e,n),ce("shift",e))this.isShift=!0;else{if(this.selectRange&&(this.isShift=!1,this.selectRange=void 0),ce("tab",e)||ce("mod",e)||ce("opt",e)||ce("shift",e)||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey)return;setTimeout(()=>{this.clearSelect()},50)}});y(this,"onShiftKeyup",e=>{this.isShift===!1&&this.selectRange&&(this.selectRange=void 0,this.clearSelect()),this.isShift=!1});this.table=n,this.editor=e}init(){const{wrapper:e}=this.table;!e||(this.tableRoot=e.find(Q.TABLE_CLASS),this.colsHeader=e.find(Q.COLS_HEADER_CLASS),this.rowsHeader=e.find(Q.ROWS_HEADER_CLASS),this.tableHeader=e.find(Q.HEADER_CLASS),this.highlight=e.find(Q.TABLE_HIGHLIGHT_CLASS),this.render("init"),this.bindEvents())}render(e){this.refreshModel();const{tableModel:n}=this;if(!n)return;const{begin:i,end:r}=this.getSelectArea();if(e==="mergeCell"||e==="splitCell"){const s=i.row<0?0:Math.min(i.row,n.rows-1),o=i.col<0?0:Math.min(i.col,n.cols-1);let a=n.table[s][o];this.table.helper.isEmptyModelCol(a)&&(a=n.table[a.parent.row][a.parent.col]),!this.table.helper.isEmptyModelCol(a)&&a.element&&e==="mergeCell"&&(this.clearSelect(),this.selectCellRange(a.element))}else if(e==="removeRow"){const s=i.row<0?0:Math.min(i.row,n.rows-1),o=n.table[s][0];!this.table.helper.isEmptyModelCol(o)&&o.element&&this.focusCell(o.element)}else if(e==="removeCol"){const s=i.col<0?0:Math.min(i.col,n.cols-1),o=n.table[0][s];!this.table.helper.isEmptyModelCol(o)&&o.element&&this.focusCell(o.element)}else this.select(i,r);this.renderBorder()}renderBorder(){const{tableModel:e}=this;!e||e.table.forEach((n,i)=>{n.forEach((r,s)=>{if(!this.table.helper.isEmptyModelCol(r)){if(!r.element)return;let o=i===e.rows-1,a=s===e.cols-1;r.isMulti&&(s+r.colSpan===e.cols&&(a=!0),i+r.rowSpan===e.rows&&(o=!0)),o?r.element.classList.contains("table-last-column")||r.element.classList.add("table-last-column"):r.element.classList.contains("table-last-column")&&r.element.classList.remove("table-last-column"),a?r.element.classList.contains("table-last-row")||r.element.classList.add("table-last-row"):r.element.classList.contains("table-last-row")&&r.element.classList.remove("table-last-row")}})})}bindEvents(){var e;document.addEventListener("keydown",this.onShiftKeydown),document.addEventListener("keyup",this.onShiftKeyup),(e=this.table.wrapper)==null||e.on("mousedown",this.onTdMouseDown).on("keydown",this.onKeydown)}unbindEvents(){var e;document.removeEventListener("keydown",this.onShiftKeydown),document.removeEventListener("keyup",this.onShiftKeyup),(e=this.table.wrapper)==null||e.off("mousedown",this.onTdMouseDown).off("keydown",this.onKeydown)}refreshModel(){!this.tableRoot||this.tableRoot.length===0||(this.tableModel=this.table.helper.getTableModel(this.tableRoot))}each(e,n=!1){const{tableModel:i}=this;if(!i)return;const{begin:r,end:s}=this.getSelectArea();if(!(r.row<0||r.col<0))if(n)for(let o=s.row;o>-1&&o>=r.row;o--)for(let a=s.col;a>-1&&a>=r.col;a--){const c=i.table[o][a];e(c,o,a)}else for(let o=r.row;o>-1&&o<=s.row;o++)for(let a=r.col;a>-1&&a<=s.col;a++){const c=i.table[o][a];e(c,o,a)}}getCellPoint(e){var r,s,o;if(e.name!=="td")return[-1,-1];const n=(r=e.parent())==null?void 0:r.index();if(n===void 0||n<0)return[-1,-1];const i=(o=(s=this.tableModel)==null?void 0:s.table[n])==null?void 0:o.findIndex(a=>{var c;return e.equal((this.table.helper.isEmptyModelCol(a)?(c=this.tableModel)==null?void 0:c.table[a.parent.row][a.parent.col]:a).element)});return i===void 0||i<0?[-1,-1]:[n,i]}getCellIndex(e,n){if(!this.tableModel)return 0;const i=this.tableModel.table[e];let r=0;for(let s=0;s<n;s++){const o=i[s];!this.table.helper.isEmptyModelCol(o)&&o.element&&r++}return r}getSingleCell(){return this.prevMouseDownTd?this.prevMouseDownTd:null}getSingleCellPoint(){const e=this.getSingleCell();return e?this.getCellPoint(e):[-1,-1]}getSelectArea(){if(this.selectArea)return this.selectArea;let e=this.getSingleCellPoint();if(!this.tableModel||e[0]===-1)return{begin:{row:-1,col:-1},end:{row:-1,col:-1},count:0,allCol:!1,allRow:!1};const{cols:n,rows:i,table:r}=this.tableModel;let s=r[e[0]][e[1]];return this.table.helper.isEmptyModelCol(s)&&(s=r[s.parent.row][s.parent.col],s.element&&(e=this.getCellPoint(I(s.element)))),{begin:{row:e[0],col:e[1]},end:{row:e[0],col:e[1]},count:e[0]===-1?0:1,allCol:n===1,allRow:i===1}}selectCol(e,n=e){if(!!this.tableModel){if(this.isShift){if(this.beginAllCol)e<this.beginAllCol?n=this.beginAllCol:e=this.beginAllCol;else if(this.prevMouseDownTd){const[i,r]=this.getCellPoint(this.prevMouseDownTd);e=r,this.beginAllCol=r}else if(this.selectArea&&(e=this.selectArea.begin.col,this.tableModel)){const i=this.tableModel.table[this.selectArea.begin.row][this.selectArea.begin.col];!this.table.helper.isEmptyModelCol(i)&&i.element&&this.focusCell(i.element)}}this.select({row:0,col:e},{row:this.tableModel.rows-1,col:n})}}selectRow(e,n=e){if(!!this.tableModel){if(this.isShift){if(this.beginAllRow)e<this.beginAllRow?n=this.beginAllRow:e=this.beginAllRow;else if(this.prevMouseDownTd){const[i,r]=this.getCellPoint(this.prevMouseDownTd);e=i,this.beginAllRow=i}else if(this.selectArea&&(e=this.selectArea.begin.row,this.tableModel)){const i=this.tableModel.table[this.selectArea.begin.row][this.selectArea.begin.col];!this.table.helper.isEmptyModelCol(i)&&i.element&&this.focusCell(i.element)}}this.select({row:e,col:0},{row:n,col:this.tableModel.cols-1})}}selectCell(e,n){if(e.name!=="td"||n.name!=="td")return;const i=this.getCellPoint(e),r=this.getCellPoint(n);this.select({row:i[0],col:i[1]},{row:r[0],col:r[1]})}clearSelect(){this.select({row:-1,col:-1},{row:-1,col:-1})}select(e,n){var p,g;if(!this.tableModel)return;const i=e.row===n.row&&e.col===n.col;let r=Math.min(e.row,n.row),s=Math.max(e.row,n.row),o=Math.min(e.col,n.col),a=Math.max(e.col,n.col);(p=this.tableRoot)==null||p.find("td[table-cell-selection]").removeAttributes("table-cell-selection");const c=()=>{if(!this.tableModel)return{beginCol:o,beginRow:r,endCol:a,endRow:s};for(let m=r;m<=s;m++){const v=this.tableModel.table[m];if(!!v)for(let b=o;b<=a;b++){const _=v[b];if(!!_)if(this.table.helper.isEmptyModelCol(_)){const x=this.tableModel.table[_.parent.row][_.parent.col];if(this.table.helper.isEmptyModelCol(x))continue;if(x.colSpan+_.parent.col-1===o&&_.parent.col<o)return o=_.parent.col,c();if(x.rowSpan+_.parent.row-1===r&&_.parent.row<r)return r=_.parent.row,c();if(x.rowSpan>1&&s<x.rowSpan-1+_.parent.row)return s=x.rowSpan-1+_.parent.row,c();if(x.colSpan>1&&a<x.colSpan-1+_.parent.col)return a=x.colSpan-1+_.parent.col,c()}else{if(b!==o&&_.colSpan+b-1===o)return o=b,c();if(m!==r&&_.rowSpan+m-1===r)return r=m,c();if(_.rowSpan>1&&s<_.rowSpan-1+m)return s=_.rowSpan-1+m,c();if(_.colSpan>1&&a<_.colSpan-1+b)return a=_.colSpan-1+b,c()}}}return{beginCol:o,beginRow:r,endCol:a,endRow:s}},u=c();r=u.beginRow,s=u.endRow,o=u.beginCol,a=u.endCol;let d=0;if(r>=0&&o>=0&&s<this.tableModel.rows&&a<this.tableModel.cols)for(let m=r;m<=s;m++)for(let v=o;v<=a;v++){const b=this.tableModel.table[m];if(!b)continue;const _=b[v];!_||this.table.helper.isEmptyModelCol(_)||(!i&&_.element&&I(_.element).attributes("table-cell-selection","true"),d++)}if(i&&e.row>-1&&e.col>-1){const m=this.tableModel.table[e.row][e.col];m&&!this.table.helper.isEmptyModelCol(m)&&m.element&&!((g=this.prevMouseDownTd)!=null&&g.equal(m.element))&&this.focusCell(m.element)}const h=o===0&&a===this.tableModel.cols-1,f=r===0&&s===this.tableModel.rows-1;h&&!this.beginAllRow?this.beginAllRow=r:!h&&this.beginAllRow&&(this.beginAllRow=void 0),f&&!this.beginAllCol?this.beginAllCol=o:!f&&this.beginAllCol&&(this.beginAllCol=void 0),this.selectArea=d===0||i?void 0:{begin:{row:r,col:o},end:{row:s,col:a},count:d,allCol:h,allRow:f},this.emit("select",this.selectArea)}focusCell(e,n=!1){var a;const i=this.editor;if(!V(i))return;const{change:r}=i;be(e)&&(e=I(e));const s=r.range.get(),o=e.find(ze);o.length>0&&(s.select(o,!0).shrinkToElementNode().shrinkToTextNode().collapse(n),setTimeout(()=>{r.range.select(s)},20),(a=o.get())==null||a.focus(),this.prevMouseDownTd=e,this.selectCell(e,e))}selectCellRange(e){var c,u;const n=this.editor;if(!V(n))return;const{change:i}=n;be(e)&&(e=I(e));const r=i.range.get(),s=e.find(ze);if(s.length===0)return;r.select(s,!0).shrinkToElementNode();const o=s.children(),a=o.eq(0);o.length===1&&((c=a==null?void 0:a.first())==null?void 0:c.name)==="br"?(r.collapse(!1),i.range.select(r),(u=s.get())==null||u.focus()):i.range.select(r),this.prevMouseDownTd=e,this.selectCell(e,e)}addDragEvent(){var e;(e=this.tableRoot)==null||e.addClass("drag-select"),document.addEventListener(ue?"touchend":"mouseup",this.removeDragEvent),document.addEventListener(ue?"touchmove":"mousemove",this.onDragMove)}selectLeft(e,n){var f,p,g;const i=this.editor;if(!V(i))return;const[r,s]=this.getCellPoint(n);if(r<0||s<0)return;const o=((f=this.selectArea)==null?void 0:f.count)||0,a=i.change.range.get();if(o===0){if(this.selectRange&&this.selectRange.type==="right"&&a.endOffset!==this.selectRange.startOffset)return;this.selectRange={type:"left",startOffset:a.startOffset,endOffset:a.endOffset};const{startNode:m}=a;if(a.startOffset!==0||m.prev())return;let v=m.parent();for(;v&&!v.isEditable();){if(v.prev())return;v=v.parent()}}const c=((p=this.selectArea)==null?void 0:p.begin)||{row:r,col:s},u=((g=this.selectArea)==null?void 0:g.end)||{row:r,col:s},d=c.col!==s;let h=d?c.col-1:u.col-1;h<0||(e.preventDefault(),h===s&&o===2&&(h=-1),d?this.select({...c,col:h},u):this.select(c,{...u,col:h}))}selectRigth(e,n){var p,g,m,v;const i=this.editor;if(!V(i)||!this.tableModel)return;e.stopPropagation();const[r,s]=this.getCellPoint(n);if(r<0||s<0)return;const o=((p=this.selectArea)==null?void 0:p.count)||0,a=i.change.range.get();if(o===0){if(this.selectRange&&this.selectRange.type==="left"&&a.startOffset!==this.selectRange.endOffset)return;this.selectRange={type:"right",startOffset:a.startOffset,endOffset:a.endOffset};const{endNode:b}=a;if(b.isText()&&a.endOffset!==b.text().length)return;const _=b.children();if(b.isElement()&&a.endOffset!==_.length&&((g=b.last())==null?void 0:g.name)!=="br"||b.next())return;let x=b.parent();for(;x&&!x.isEditable();){if(x.next())return;x=x.parent()}}const{cols:c}=this.tableModel,u=((m=this.selectArea)==null?void 0:m.begin)||{row:r,col:s},d=((v=this.selectArea)==null?void 0:v.end)||{row:r,col:s},h=u.col!==s;let f=h?u.col+1:d.col+1;f>c-1||(e.preventDefault(),f===s&&o===2&&(f=-1),h?this.select({...u,col:f},d):this.select(u,{...d,col:f}))}selectUp(e,n){var f,p,g;const i=this.editor;if(!V(i)||!this.tableModel)return;const[r,s]=this.getCellPoint(n);if(r<0||s<0)return;const o=((f=this.selectArea)==null?void 0:f.count)||0,a=i.change.range.get();if(o===0){if(this.selectRange&&this.selectRange.type==="bottom"&&a.endOffset!==this.selectRange.startOffset)return;this.selectRange={type:"top",startOffset:a.startOffset,endOffset:a.endOffset};const m=a.getBoundingClientRect(),v=n.find(ze).getBoundingClientRect();if(m.width!==0&&m.height===0&&m.top-((v==null?void 0:v.top)||0)>10)return}const c=((p=this.selectArea)==null?void 0:p.begin)||{row:r,col:s},u=((g=this.selectArea)==null?void 0:g.end)||{row:r,col:s},d=c.row!==r;let h=d?c.row-1:u.row-1;e.preventDefault(),!(h<0)&&(h===r&&o===2&&(h=-1),d?this.select({...c,row:h},u):this.select(c,{...u,row:h}))}selectDown(e,n){var p,g,m;const i=this.editor;if(!V(i)||!this.tableModel)return;const[r,s]=this.getCellPoint(n);if(r<0||s<0)return;const o=((p=this.selectArea)==null?void 0:p.count)||0,a=i.change.range.get();if(a.shrinkToElementNode(),o===0){if(this.selectRange&&this.selectRange.type==="top"&&a.startOffset!==this.selectRange.endOffset)return;this.selectRange={type:"bottom",startOffset:a.startOffset,endOffset:a.endOffset};const v=a.getBoundingClientRect(),b=n.find(ze).getBoundingClientRect();if(v.width!==0&&v.height===0&&((b==null?void 0:b.bottom)||0)-v.bottom>10)return}const{rows:c}=this.tableModel,u=((g=this.selectArea)==null?void 0:g.begin)||{row:r,col:s},d=((m=this.selectArea)==null?void 0:m.end)||{row:r,col:s},h=u.row!==r;let f=h?u.row+1:d.row+1;f>c-1||(e.preventDefault(),f===r&&o===2&&(f=-1),h?this.select({...u,row:f},d):this.select(u,{...d,row:f}))}getSelectionHtml(e=!1){var h,f,p;const{tableModel:n}=this,{helper:i}=this.table;if(!n||!this.tableRoot)return null;let r={row:0,col:0},s={row:n.rows-1,col:n.cols-1};if(!e){const g=this.getSelectArea();r=g.begin,s=g.end}const o=this.tableRoot.find("col");let a=[],c=0;for(let g=r.col;g<=s.col;g++){const m=(h=o.eq(g))==null?void 0:h.get();!m||(a.push('<col width="'.concat(m.width,'" />')),c+=parseInt(m.width))}const u="<colgroup>".concat(a.join(""),"</colgroup>");let d=[];for(let g=r.row;g<=s.row;g++){let m=[],v;for(let _=r.col;_<=s.col;_++){const x=n.table[g][_];let w,E,S;if(!i.isEmptyModelCol(x)&&x.element&&(S=x.element.cloneNode(!0),x.element.parentElement&&(v=I(x.element.parentElement).css("height"))),!i.isEmptyModelCol(x)&&x.isMulti&&(w=Math.min(g+x.rowSpan-1,s.row)-g+1,E=Math.min(_+x.colSpan-1,s.col)-_+1),i.isEmptyModelCol(x)){const R=n.table[x.parent.row][x.parent.col];if(x.parent.row===g&&x.parent.col<r.col&&_===r.col){const D=r.col-x.parent.col;i.isEmptyModelCol(R)||(E=Math.min(R.colSpan-D,s.col-r.col+1),w=R.rowSpan,S=(f=R.element)==null?void 0:f.cloneNode(!0))}if(x.parent.col===_&&x.parent.row<r.row&&g===r.row){const D=r.row-x.parent.row;i.isEmptyModelCol(R)||(w=Math.min(R.rowSpan-D,s.row-r.row+1),E=R.colSpan,S=(p=R.element)==null?void 0:p.cloneNode(!0))}}if(S){S=S,w&&S.setAttribute("rowspan",`${w}`),E&&S.setAttribute("colspan",`${E}`);const R=S.firstChild;if(R.classList.contains("table-main-content")){const D=S.cloneNode(!1);D.innerHTML=R.innerHTML,m.push(D.outerHTML)}else m.push(S.outerHTML)}}const b=I(`<tr>${m.join("")}</tr>`);v&&b.css("height",v),d.push(b.get().outerHTML)}return`<body><meta name="aomao" content="table" /><table style="width:${c}px">${u}${d.join("")}</table></body>`}hasMergeCell(){const{table:e,tableModel:n}=this;if(!n)return!1;const{begin:i,end:r,count:s}=this.getSelectArea();if(s!==1)return!1;const o=n.table[i.row][i.col];return!e.helper.isEmptyModelCol(o)&&o.isMulti===!0}isRowSelected(){return!!this.selectArea&&this.selectArea.allRow}isColSelected(){return!!this.selectArea&&this.selectArea.allCol}isTableSelected(){return!!this.selectArea&&this.selectArea.allCol&&this.selectArea.allRow}showHighlight(e){var E,S,R,D,P,O,L,B,A,F,W,G,k,C,$,z,M,T,K,ee;const{helper:n}=this.table,{tableModel:i}=this;if(!i)return;const{begin:r,end:s,allCol:o,allRow:a}=e;if(r.row<0||r.col<0)return;const c=r.row,u=s.row,d=r.col,h=s.col;this.hideHighlight();const f=(E=this.colsHeader)==null?void 0:E.find(Q.COLS_HEADER_ITEM_CLASS),p=(S=this.rowsHeader)==null?void 0:S.find(Q.ROWS_HEADER_ITEM_CLASS);for(let Y=c;Y<=u;Y++)for(let q=d;q<=h;q++){const Z=i.table[Y][q];if(this.table.helper.isEmptyModelCol(Z)){r.row>Z.parent.row&&(r.row=Z.parent.row),r.col>=Z.parent.col&&(r.col=Z.parent.col);const te=i.table[Z.parent.row][Z.parent.col];this.table.helper.isEmptyModelCol(te)||(te.rowSpan>1&&s.row<te.rowSpan-1+Z.parent.row&&(s.row=te.rowSpan-1+Z.parent.row),te.colSpan>1&&s.col<te.colSpan-1+Z.parent.col&&(s.col=te.colSpan-1+Z.parent.col))}else this.table.helper.isEmptyModelCol(Z)||(Z.rowSpan>1&&s.row<Z.rowSpan-1+Y&&(s.row=Z.rowSpan-1+Y),Z.colSpan>1&&s.col<Z.colSpan-1+q&&(s.col=Z.colSpan-1+q))}let g=0,m=0;for(let Y=r.row;Y<=s.row;Y++){const q=i.table[Y][r.col];!n.isEmptyModelCol(q)&&q.element&&(g+=q.element.offsetHeight,(R=p==null?void 0:p.eq(Y))==null||R.addClass("active"))}for(let Y=r.col;Y<=s.col;Y++){const q=i.table[r.row][Y];!n.isEmptyModelCol(q)&&q.element&&(m+=q.element.offsetWidth,(D=f==null?void 0:f.eq(Y))==null||D.addClass("active"))}s.row===i.rows-1&&s.col===i.cols-1&&((P=this.tableHeader)==null||P.addClass("active"));const v=i.table[r.row][r.col];let b=0,_=0;if(!n.isEmptyModelCol(v)&&v.element){const Y=(O=this.tableRoot)==null?void 0:O.parent(),q=Y==null?void 0:Y.getBoundingClientRect(),Z=v.element.getBoundingClientRect();b+=Z.top-((q==null?void 0:q.top)||0)-13,_+=Z.left-((q==null?void 0:q.left)||0)}const x=Ee(((B=(L=this.table.wrapper)==null?void 0:L.find(".data-scrollbar"))==null?void 0:B.css("left"))||"0")+Ee(((A=this.table.wrapper)==null?void 0:A.css("margin-left"))||"0");_+=x;const w=((W=(F=this.colsHeader)==null?void 0:F.find(Q.COLS_HEADER_ITEM_CLASS).get())==null?void 0:W.offsetHeight)||0;b+=w,g>0&&m>0&&((G=this.highlight)==null||G.css("width",`${m}px`),(k=this.highlight)==null||k.css("height",`${g}px`),(C=this.highlight)==null||C.css("top",`${b}px`),($=this.highlight)==null||$.css("left",`${_}px`),(z=this.highlight)==null||z.show("block"),(M=this.table.wrapper)==null||M.addClass("data-table-highlight"),o&&((T=this.table.wrapper)==null||T.addClass("data-table-highlight-row")),a&&((K=this.table.wrapper)==null||K.addClass("data-table-highlight-col")),o&&a&&((ee=this.table.wrapper)==null||ee.addClass("data-table-highlight-all")))}hideHighlight(){var e,n,i,r,s,o,a,c;(e=this.highlight)==null||e.hide(),(n=this.colsHeader)==null||n.find(".active").removeClass("active"),(i=this.rowsHeader)==null||i.find(".active").removeClass("active"),(r=this.tableHeader)==null||r.removeClass("active"),(s=this.table.wrapper)==null||s.removeClass("data-table-highlight"),(o=this.table.wrapper)==null||o.removeClass("data-table-highlight-row"),(a=this.table.wrapper)==null||a.removeClass("data-table-highlight-col"),(c=this.table.wrapper)==null||c.removeClass("data-table-highlight-all")}destroy(){this.unbindEvents()}}class toe extends So.exports.EventEmitter2{constructor(e,n){super();y(this,"editor");y(this,"table");y(this,"tableCleared",!1);y(this,"rowCleared",!1);y(this,"colCleared",!1);y(this,"tableRoot");y(this,"colsHeader");y(this,"rowsHeader");y(this,"tableHeader");y(this,"viewport");y(this,"clearFormat",()=>{const{selection:e,helper:n}=this.table;e.getSelectArea(),e.each(i=>{!n.isEmptyModelCol(i)&&i.element&&i.element.removeAttribute("style")}),this.emit("actioned","clearFormat")});y(this,"hasCopyData",()=>!!this.table.helper.getCopyData());y(this,"clearCopyData",()=>{this.table.helper.clearCopyData()});this.editor=e,this.table=n}init(){const{wrapper:e}=this.table;!e||(this.tableRoot=e.find(Q.TABLE_CLASS),this.colsHeader=e.find(Q.COLS_HEADER_CLASS),this.rowsHeader=e.find(Q.ROWS_HEADER_CLASS),this.tableHeader=e.find(Q.HEADER_CLASS),this.viewport=e.find(Q.VIEWPORT))}insertColAt(e,n,i,r,...s){var S,R;const{selection:o,wrapper:a}=this.table,{tableModel:c}=o;if(!a||!c||!this.tableRoot)return;const u=e,d=i?"after":"before",f=(S=a.find(Q.COLS_HEADER_ITEM_CLASS).eq(u))==null?void 0:S.get(),p=i?u+1:u,g=a.find(Q.COLS_HEADER_CLASS);let m=0;r||(r=f.offsetWidth),Array.isArray(r)?r.forEach(D=>{m+=D}):typeof r=="number"&&(m=n*r),g.css("width",g.get().offsetWidth+m+"px");const v=this.tableRoot.find("colgroup"),b=a.find("tr"),_=this.tableRoot.find("col"),x=(R=_.eq(u))==null?void 0:R.clone();if(!x)return;let w=n;const E=this.editor.nodeId;for(;w>0;){const D=I(f.outerHTML);I(f)[d](D);const P=Array.isArray(r)?r[n-w]:r;D.css({width:`${P}px`});const O=x==null?void 0:x.clone();O.removeAttributes(we),O.attributes("width",P),E.create(O);const L=_[e];d==="after"?I(L).after(O):v[0].insertBefore(O[0],L),w--}b.each((D,P)=>{const O=o.getCellIndex(P,p);for(let L=0;L<n;L++){const B=D.insertCell(O);B.innerHTML=this.table.template.getEmptyCell(),I(B).attributes(Nt,"table-cell-selection"),E.generate(B)}}),this.emit("actioned","insertCol",...s),o.selectArea&&o.selectCol(e,e+n-1)}insertCol(e,n=1,...i){var g,m;const{selection:r,wrapper:s}=this.table,{tableModel:o}=r;if(!s||!o)return;const a=r.getSelectArea();let c=e==="left";const u=e==="end"||!e,d=s.find(Q.COLS_HEADER_ITEM_CLASS);let h=o.cols-1;u||(h=c?a.begin.col:a.end.col);let f=c?h-1:h+1;f<0?(f=0,c=!1):!c&&h===o.cols-1&&(f--,c=!0);const p=(g=d.eq(h))==null?void 0:g.get().offsetWidth;if(this.insertColAt(f,n,c,p,...i),u){const v=(m=this.viewport)==null?void 0:m.get();if(!v)return;v.scrollLeft=v.scrollWidth-v.offsetWidth}}removeCol(...e){var f;const{selection:n,conltrollBar:i,helper:r}=this.table,{tableModel:s}=n;if(!s||!this.tableRoot)return;const o=s.table,a={...n.getSelectArea()};a.end.col-a.begin.col===0&&n.each(p=>{r.isEmptyModelCol(p)||(a.end.col+=p.colSpan-1)});const c=a.end.col-a.begin.col+1,u=this.tableRoot.find("colgroup");let d=this.tableRoot.find("tr"),h=u.find("col");if(a.allCol){this.removeTable();return}for(let p=a.end.col;p>=a.begin.col;p--)i.removeCol(p),(f=h.eq(p))==null||f.remove();o.forEach((p,g)=>{var m,v,b;for(let _=a.end.col;_>=a.begin.col;_--){const x=p[_];if(r.isEmptyModelCol(x)){const w=o[x.parent.row][x.parent.col];if(!r.isEmptyModelCol(w)&&x.parent.col<a.begin.col){const E=Math.min(c,x.parent.col+w.colSpan-a.begin.col);w.element&&(w.element.colSpan=w.colSpan-E)}continue}else{if(x.isMulti){const w=_+x.colSpan-1>a.end.col,E=a.end.col+1-_;if(w){let S=0;for(let D=0;D<=a.end.col;D++)r.isEmptyModelCol(p[D])||S++;const R=(v=(m=d.eq(g))==null?void 0:m.get())==null?void 0:v.insertCell(S);if(!R)return;R.setAttribute(Nt,"table-cell-selection"),R.innerHTML=this.table.template.getEmptyCell(),R.colSpan=x.colSpan-E,R.rowSpan=x.rowSpan,this.editor.nodeId.generate(R)}}(b=x.element)==null||b.remove()}}}),this.emit("actioned","removeCol",...e)}insertColLeft(e=1){this.insertCol("left",e)}insertColRight(e=1){this.insertCol("right",e)}insertRowAt(e,n,i,...r){const{wrapper:s,selection:o,helper:a}=this.table,{tableModel:c}=o;if(!s||!c)return;const u=i?"after":"before",d=e,f=s.find(Q.ROWS_HEADER_ITEM_CLASS)[d],p=i?d:d+1;let g=[];c.table[d].forEach((x,w)=>{if(!a.isEmptyModelCol(x)&&x.isMulti){!i&&x.rowSpan>1&&p<=d+x.rowSpan-1?x.element.rowSpan=x.rowSpan+n:g.push({tdBase:x.element});return}if(a.isEmptyModelCol(x)){const E=c.table[x.parent.row][x.parent.col];!a.isEmptyModelCol(E)&&x.parent.row<p&&x.parent.row+E.rowSpan-1>=p?E.element.rowSpan=E.rowSpan+n:!a.isEmptyModelCol(E)&&x.parent.row<d&&x.parent.col===w&&g.push({tdBase:E.element});return}g.push({tdBase:x.element})});let v=n;const b=this.editor.nodeId,_=()=>{var w,E;const x=(E=(w=this.tableRoot)==null?void 0:w.get())==null?void 0:E.insertRow(p);!x||(g.forEach(S=>{const R=x.insertCell();R.setAttribute(Nt,"table-cell-selection"),R.innerHTML=this.table.template.getEmptyCell(),R.colSpan=S.tdBase.colSpan}),I(f)[u](I(f.outerHTML)),b.generate(x),b.generateAll(x),v--)};for(;v>0;)_();this.emit("actioned","insertRow",...r),o.selectArea&&o.selectRow(e,e+n-1)}insertRow(e,n=1,...i){const{selection:r,helper:s}=this.table,{tableModel:o}=r;if(!o)return;const a=r.getSelectArea();let c=e==="up";const u=e==="end"||!e;let d=o.rows-1;if(!u){let f=a.end.row;r.each(p=>{s.isEmptyModelCol(p)||(f+=p.rowSpan-1)}),d=c?a.begin.row:f}let h=d;this.insertRowAt(h,n,c,...i)}insertRowUp(e=1){this.insertRow("up",e)}insertRowDown(e=1){this.insertRow("down",e)}removeRow(...e){var p;const{selection:n,conltrollBar:i,helper:r}=this.table,{tableModel:s}=n;if(!s||!this.tableRoot)return;const o=s.table,a={...n.getSelectArea()},{begin:c,end:u}=a;u.row-c.row===0&&n.each(g=>{r.isEmptyModelCol(g)||(u.row+=g.rowSpan-1)});const d=u.row-c.row+1,h=this.tableRoot.find("tr");if(a.allRow){this.removeTable();return}const f=g=>{o[g].forEach((v,b)=>{if(!r.isEmptyModelCol(v)&&v.isMulti&&v.rowSpan>1&&g+v.rowSpan-1>u.row){const _=n.getCellIndex(u.row+1,b),x=h[u.row+1].insertCell(_),w=u.row-g+1;x.setAttribute(Nt,"table-cell-selection"),x.innerHTML=this.table.template.getEmptyCell(),x.colSpan=v.colSpan,x.rowSpan=v.rowSpan-w,this.editor.nodeId.generate(x)}if(r.isEmptyModelCol(v)){const _=o[v.parent.row][v.parent.col];if(!r.isEmptyModelCol(_)&&v.parent.row<c.row){const x=Math.min(d,v.parent.row+_.rowSpan-c.row);_.element.rowSpan=_.rowSpan-x}}})};for(let g=c.row;g<=u.row;g++)f(g);for(let g=u.row;g>=c.row;g--)(p=this.tableRoot.get())==null||p.deleteRow(g),i.removeRow(g);this.emit("actioned","removeRow",...e)}removeTable(){const e=this.editor;V(e)||this.emit("tableRemoved"),e.card.remove(this.table.id)}copy(e=!1){const{selection:n,helper:i}=this.table,r=n.getSelectionHtml(e);!r||(this.editor.clipboard.copy(r),i.copyHTML(r))}mockCopy(){const{selection:e,helper:n}=this.table,i=e.getSelectionHtml();!i||n.copyHTML(i)}shortcutCopy(e){var s,o,a;const{selection:n,helper:i}=this.table,r=n.getSelectionHtml();!r||((s=e.clipboardData)==null||s.clearData(),(o=e.clipboardData)==null||o.setData("text/plain",I(r).html()),(a=e.clipboardData)==null||a.setData("text/html",r),i.copyHTML(r),e.preventDefault())}cut(){this.copy(),this.clear()}shortcutCut(e){this.shortcutCopy(e),this.clear()}clear(){const{selection:e,helper:n}=this.table,i=e.getSelectArea();if(i.allCol&&i.allRow){if(this.tableCleared){this.removeTable(),this.tableCleared=!1;return}this.tableCleared=!0}if(i.allRow){if(this.rowCleared){this.removeRow(),this.rowCleared=!1;return}this.rowCleared=!0}if(i.allCol){if(this.colCleared){this.removeCol(),this.colCleared=!1;return}this.colCleared=!0}e.each(r=>{!n.isEmptyModelCol(r)&&r.element&&(r.element.innerHTML=this.table.template.getEmptyCell())}),this.emit("actioned","clear")}mockPaste(...e){const n=this.table.helper.getCopyData();!n||this.paste(n,...e)}shortcutPaste(e){e.preventDefault(),e.stopPropagation();const n=this.editor.clipboard.getData(e);this.paste(n)}paste(e,...n){const{selection:i,helper:r}=this.table,{tableModel:s}=i;if(!s)return;const o=i.getSelectArea(),{begin:a,end:c}=o,u=a.row===c.row&&a.col===c.col,{html:d,text:h}=e;if(!d)return;const f=this.editor,{schema:p,conversion:g}=f,m=new $t(d,f).toValue(p,g),v=r.trimBlankSpan(I(m));if(f.nodeId.generateAll(v,!0),v.name==="table"){r.normalizeTable(v);const b=r.getTableModel(v),_=b.rows,x=b.cols,w=b.table[0][0],E=s.table[a.row];if(!E)return;const S=E[a.col];if(!S||r.isEmptyModelCol(w)||r.isEmptyModelCol(S))return;const{rowSpan:R,colSpan:D}=w;if(R===_&&D===x&&!o&&w.element){r.copyTo(w.element,S.element),this.emit("actioned","paste",...n);return}if(u){if(x+a.col>s.cols){const L=x+a.col-s.cols;this.insertCol("end",L,!0)}if(_+a.row>s.rows){const L=_+a.row-s.rows;this.insertRow("end",L,!0)}i.select(a,{row:a.row+_-1,col:a.col+x-1})}const O=i.getSelectArea();n[0]||this.splitCell(!0),i.each((L,B,A)=>{var k;const F=(B-O.begin.row)%_,W=(A-O.begin.col)%x,G=b.table[F][W];if(!!G){if(!r.isEmptyModelCol(G)&&G.isMulti&&!r.isEmptyModelCol(L)){const C=L.element;C.rowSpan=Math.min(G.rowSpan,O.end.row-B+1),C.colSpan=Math.min(G.colSpan,O.end.col-A+1),r.copyTo(G.element,C);return}if(r.isEmptyModelCol(G)){r.isEmptyModelCol(L)||(k=L.element)==null||k.remove();return}G.element&&!r.isEmptyModelCol(L)&&L.element&&r.copyTo(G.element,L.element)}})}else this.mergeCell(!0);this.emit("actioned","paste",...n)}mergeCell(...e){const{selection:n,helper:i}=this.table,{selectArea:r,tableModel:s}=n;if(!r||!s)return;const{begin:o,end:a}=r,c=a.row-o.row+1,u=a.col-o.col+1;let d=[],h=null;if(this.splitCell(),n.select(o,a),n.each((f,p,g)=>{if(!i.isEmptyModelCol(f)){if(g===o.col&&p===o.row){h=f.element,h.rowSpan=c,h.colSpan=u;return}f.element&&(f.element.innerText.trim()!==""&&d.unshift(I(f.element).find(Q.TABLE_TD_CONTENT_CLASS).html()),f.element.remove())}}),h){const p=I(h).find(Q.TABLE_TD_CONTENT_CLASS);p.html(p.html()+d.join("")),this.emit("actioned","mergeCell",...e)}}splitCell(...e){const{selection:n,helper:i}=this.table,{tableModel:r}=n;if(!r||!this.tableRoot)return;let s=this.tableRoot.find("tr");n.each((o,a,c)=>{if(i.isEmptyModelCol(o))return;const u=a+o.rowSpan,d=c+o.colSpan;for(let h=u-1;h>=a;h--){h>=s.length&&this.insertRowAt(a,1);const f=h>=s.length?this.tableRoot.find("tr")[h]:s[h];for(let p=d-1;p>=c;p--){const g=r.table[h][p];if(!i.isEmptyModelCol(g)&&g.isMulti)g.element=g.element,g.element.colSpan=1,g.element.rowSpan=1;else if(i.isEmptyModelCol(g)){const m=n.getCellIndex(h,p),v=f.insertCell(m);this.editor.nodeId.generate(v),v.setAttribute(Nt,"table-cell-selection"),v.innerHTML=this.table.template.getEmptyCell()}}}}),this.emit("actioned","splitCell",...e)}}class un{}y(un,"colors"),y(un,"_map"),y(un,"getStroke"),y(un,"getColors");un.colors=[["#000000","#262626","#595959","#8C8C8C","#BFBFBF","#D9D9D9","#E9E9E9","#F5F5F5","#FAFAFA","#FFFFFF"],["#F5222D","#FA541C","#FA8C16","#FADB14","#52C41A","#13C2C2","#1890FF","#2F54EB","#722ED1","#EB2F96"],["#FFE8E6","#FFECE0","#FFEFD1","#FCFCCA","#E4F7D2","#D3F5F0","#D4EEFC","#DEE8FC","#EFE1FA","#FAE1EB"],["#FFA39E","#FFBB96","#FFD591","#FFFB8F","#B7EB8F","#87E8DE","#91D5FF","#ADC6FF","#D3ADF7","#FFADD2"],["#FF4D4F","#FF7A45","#FFA940","#FFEC3D","#73D13D","#36CFC9","#40A9FF","#597EF7","#9254DE","#F759AB"],["#CF1322","#D4380D","#D46B08","#D4B106","#389E0D","#08979C","#096DD9","#1D39C4","#531DAB","#C41D7F"],["#820014","#871400","#873800","#614700","#135200","#00474F","#003A8C","#061178","#22075E","#780650"]];un._map=function(){let l={};const t=un.colors;for(let e=0,n=t.length;e<n;e++){const i=t[e];for(let r=0,s=i.length;r<s;r++){const o=t[e][r];l[o]={y:e,x:r}}}return l}();un.getStroke=function(l){const t=un._map[l];return t&&(t.y===2||t.y===3&&t.x>2&&t.x<5)?this.colors[4][t.x]:l};un.getColors=function(){return this.colors};const Ks=un;var lr,oi,_n,wn,ts,rn,cr;class noe{constructor(t,e,n){rt(this,lr,void 0);rt(this,oi,void 0);rt(this,_n,void 0);rt(this,wn,void 0);rt(this,ts,void 0);rt(this,rn,void 0);rt(this,cr,void 0);y(this,"windowClick",t=>{const{target:e}=t;!e||I(e).closest(".data-table-color-tool,.table-color-dropdown-arrow").length===0&&this.remove()});Ze(this,lr,t),Ze(this,ts,e),Ze(this,oi,n),Ze(this,cr,new Eo(ie(this,lr))),Ze(this,_n,n.defaultColor||"transparent"),Ze(this,wn,I(`<div class="table-color-dropdown-trigger">
        <button type="button" class="table-color-dropdown-button-text">
            <svg width="16px" height="16px" viewBox="0 0 16 16" style="margin-bottom: ${ie(this,_n)==="transparent"?-5:-3}">
                <g ="none" strokeWidth="1" fill="none" fillRule="evenodd">
                    <path d="M11.9745711,7.921875 C11.9745711,7.921875 13.2147672,9.2863447 13.2147672,10.1226326 C13.2147672,10.8142992 12.6566789,11.3802083 11.9745711,11.3802083 C11.2924632,11.3802083 10.734375,10.8142992 10.734375,10.1226326 C10.734375,9.2863447 11.9745711,7.921875 11.9745711,7.921875 Z M9.07958999,6.47535893 L6.28501575,3.68078468 L3.4904415,6.47535893 L9.07958999,6.47535893 Z M5.3326566,3.04215357 L4.28223263,1.9917296 C4.22692962,1.93642659 4.22692962,1.84676271 4.28223263,1.7914597 L5.03228902,1.0414033 C5.08759203,0.986100299 5.17725591,0.986100299 5.23255892,1.0414033 L6.4546098,2.26345418 C6.46530408,2.27146914 6.4755605,2.28033918 6.48528564,2.29006432 L10.4848531,6.28963174 C10.5954591,6.40023775 10.5954591,6.57956552 10.4848531,6.69017153 L6.4838816,10.691143 C6.37327559,10.801749 6.19394782,10.801749 6.08334181,10.691143 L2.08377439,6.69157557 C1.97316838,6.58096956 1.97316838,6.40164179 2.08377439,6.29103578 L5.3326566,3.04215357 Z" fill="#595959"/>
                    <rect stroke="${Ks.getStroke(ie(this,_n))}" fill="${ie(this,_n)}" strokeWidth="0.5" x="2" y="12.75" width="12" height="1.5" rx="0.125" />
                </g>
            </svg>
        </button>
        <button type="button" class="table-color-dropdown-arrow">
            <span class="table-color-dropdown-empty"></span>
            <span class="data-icon data-icon-arrow"></span>
        </button>
        </div>`)),ie(this,wn).find(".table-color-dropdown-arrow").on("mousedown",i=>{i.preventDefault(),ie(this,rn)!==void 0&&ie(this,rn).length>0?this.remove():this.render()}),ie(this,wn).find(".table-color-dropdown-button-text").on("mousedown",i=>{i.preventDefault();const{onChange:r}=ie(this,oi);r&&r(ie(this,_n))})}getButton(){return ie(this,wn)}select(t){const e=Ks.getStroke(t),n=ie(this,wn).find("rect");n.attributes("stroke",e),n.attributes("fill",t),ie(this,wn).find("svg").css("margin-bottom",t==="transparent"?-5:-3)}change(t){Ze(this,_n,t),this.select(t);const{onChange:e}=ie(this,oi);e&&e(t)}toState(t,e){const n=t.hex?de(t.hex):de(t),i=n.toHsl(),r=n.toHsv(),s=n.toRgb(),o=n.toHex();i.s===0&&(i.h=e||0,r.h=e||0);const a=o==="000000"&&s.a===0;return{hsl:i,hex:a?"transparent":"#".concat(o),rgb:s,hsv:r,oldHue:t.h||e||i.h,source:t.source}}render(){var o;Ze(this,rn,I(`<div class="data-table-color-tool${ue?" data-table-color-tool-mobile":""}" ${le}="${Qe}" ${fo}="${ie(this,ts)}"></div>`));const t=I('<div class="data-table-color-tool-panle"></div>'),{colors:e}=ie(this,oi),n=(a,c)=>{const u=this.toState(a.color||"#FFFFFF"),d=["#ffffff","#fafafa","transparent"].indexOf(u.hex)>=0,h=I(`<span class="data-table-color-tool-item${d?" data-table-color-tool-border":""}"><span style="background-color:${a.color}${a.border?`;${d?"":`border:1px solid ${a.border}`}`:""}"><svg
            style="fill: ${a.color.toUpperCase()==="#8C8C8C"?"#FFFFFF":"#8C8C8C"};
            display: ${a.color===ie(this,_n)&&c!==!1?"block":"none"};"
            viewBox="0 0 18 18"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" /></svg></span></span>`);return h.on("mousedown",f=>{f.preventDefault(),f.stopPropagation(),t.find("svg").each(p=>{p.style.display="none"}),c!==!1&&h.find("svg").css("display","block"),this.change(a.color)}),h},i=I('<div class="data-table-color-tool-group data-table-color-tool-default"></div>'),r=n({color:"transparent"},!1);i.append(r),i.on("mousedown",a=>{a.preventDefault(),t.find("svg").each(c=>{c.style.display="none"}),this.change("transparent")});const s=ie(this,lr).language.get("table","color","nonFillText");i.append(I(`<span class="data-table-color-tool-default-text">${s}</span>`)),ie(this,rn).append(i),e.forEach(a=>{const c=I('<div class="data-table-color-tool-group"></div>');a.forEach(u=>{const d=n(u);c.append(d)}),t.append(c)}),ie(this,rn).append(t),(o=ie(this,cr))==null||o.bind(ie(this,rn),ie(this,wn)),document.addEventListener("mousedown",this.windowClick,!0)}remove(){var t,e;(t=ie(this,rn))==null||t.remove(),(e=ie(this,cr))==null||e.destroy(),document.removeEventListener("mousedown",this.windowClick,!0),Ze(this,rn,void 0)}destroy(){this.remove();const{onDestroy:t}=ie(this,oi);t&&t()}}lr=new WeakMap,oi=new WeakMap,_n=new WeakMap,wn=new WeakMap,ts=new WeakMap,rn=new WeakMap,cr=new WeakMap;var Ff,Bf,$f,ur;const Wl=class extends Tt{constructor(){super(...arguments);y(this,"contenteditable",[`div${Q.TABLE_TD_CONTENT_CLASS}`]);y(this,"colMinWidth",((Ff=this.editor.plugin.findPlugin("table"))==null?void 0:Ff.options.colMinWidth)||40);y(this,"rowMinHeight",((Bf=this.editor.plugin.findPlugin("table"))==null?void 0:Bf.options.rowMinHeight)||35);y(this,"maxInsertNum",(($f=this.editor.plugin.findPlugin("table"))==null?void 0:$f.options.maxInsertNum)||30);y(this,"wrapper");y(this,"helper",new Dp(this.editor));y(this,"template",new Q(this));y(this,"selection",new eoe(this.editor,this));y(this,"conltrollBar",new Qse(this.editor,this,{col_min_width:this.colMinWidth,row_min_height:this.rowMinHeight,max_insert_num:this.maxInsertNum}));y(this,"command",new toe(this.editor,this));y(this,"scrollbar");y(this,"viewport");y(this,"colorTool");y(this,"noBorderToolButton");y(this,"alignToolButton");rt(this,ur,void 0);y(this,"doChange",()=>{this.remoteRefresh(),this.handleChange("local")});y(this,"handleChange",(e="local")=>{var r,s;const n=this.editor;if(!V(n))return;this.conltrollBar.refresh(),this.selection.render("change");const i=super.getValue();if(i!=null&&i.noBorder?(r=this.noBorderToolButton)==null||r.addClass("active"):(s=this.noBorderToolButton)==null||s.removeClass("active"),e==="local"&&V(n)){const o=this.getValue();o&&this.setValue(o)}});y(this,"onChange",(e="local")=>{const n=this.editor;V(n)&&e==="local"&&n.ot.isStopped()||(ie(this,ur)&&clearTimeout(ie(this,ur)),Ze(this,ur,setTimeout(()=>{this.handleChange(e),e==="remote"&&this.remoteRefresh()},50)))});y(this,"updateScrollbar",()=>{var n,i,r,s;if(!this.scrollbar)return;const e=(((i=(n=this.wrapper)==null?void 0:n.getBoundingClientRect())==null?void 0:i.bottom)||0)-(((r=this.wrapper)==null?void 0:r.getViewport().bottom)||0);(s=this.wrapper)==null||s.find(".data-scrollbar-x").css({bottom:`${e>0?e+2:0}px`})});y(this,"remoteRefreshTimeout",null)}static get cardName(){return"table"}static get cardType(){return Ve.BLOCK}static get selectStyleType(){return ir.BACKGROUND}static get autoSelected(){return!1}static get lazyRender(){return!0}init(){var n;super.init();const e=this.editor;V(e)&&(e.event.listeners["keydown:tab"]||(e.event.listeners["keydown:tab"]=[]),e.event.listeners["keydown:tab"].unshift(i=>{var f,p,g;if(!V(e)||e.readonly)return;const{change:r,block:s,node:o,card:a}=e,c=r.range.get(),u=c.endNode.closest("td");if(u.length===0||!u.inEditor())return;const d=a.closest(u,!0);if(!(d!=null&&d.equal(this.root)))return;const h=s.closest(c.endNode);if(u.length>0&&(s.isLastOffset(c,"end")||h.name!=="li"&&o.isEmptyWidthChild(h))){let m=u.next();if(!m){const v=(f=u.parent())==null?void 0:f.next();v?m=v.find("td:first-child")||null:(this.command.insertRowDown(),m=((g=(p=u.parent())==null?void 0:p.next())==null?void 0:g.find("td:first-child"))||null)}if(m)return i.preventDefault(),this.selection.focusCell(m),!1}u.length>0&&setTimeout(()=>{var m;(m=this.scrollbar)==null||m.refresh()},0)}),e.on("keydown:down",i=>{var f,p;if(!V(e)||e.readonly)return;const{change:r,card:s}=e,o=r.range.get(),a=o.endNode.closest("td");if(a.length===0||!a.inEditor())return;const c=s.closest(a,!0);if(!(c!=null&&c.equal(this.root)))return;const u=a.find(".table-main-content");if(!u)return;const d=u.get().getBoundingClientRect(),h=o.getBoundingClientRect();if(a.length>0&&(h.bottom===0||d.bottom-h.bottom<10)){const g=a.index(),m=(f=a.parent())==null?void 0:f.next();if(m){let v=0,b=m.find("td:last-child");if((p=this.selection.tableModel)==null||p.table[m.index()].some(_=>!this.helper.isEmptyModelCol(_)&&v>=g&&_.element?(b=I(_.element),!0):(v++,!1)),b)return i.preventDefault(),this.selection.focusCell(b,!0),!1}else{i.preventDefault();const v=o.cloneRange(),b=this.root.next(),_=b?s.find(b):void 0;return _!=null&&_.onSelectDown?_.onSelectDown(i):(s.focusNextBlock(this,v,!1),r.range.select(v)),!1}}a.length>0&&setTimeout(()=>{var g;(g=this.scrollbar)==null||g.refresh()},0)}),e.on("keydown:up",i=>{var f,p;if(!V(e)||e.readonly)return;const{change:r,card:s}=e,o=r.range.get(),a=o.endNode.closest("td");if(a.length===0||!a.inEditor())return;const c=s.closest(a,!0);if(!(c!=null&&c.equal(this.root)))return;const u=a.find(".table-main-content");if(!u)return;const d=u.get().getBoundingClientRect(),h=o.getBoundingClientRect();if(a.length>0&&(h.top===0||h.top-d.top<10)){const g=a.index(),m=(f=a.parent())==null?void 0:f.prev();if(m){let v=0,b=m.find("td:first-child");if((p=this.selection.tableModel)==null||p.table[m.index()].some(_=>!this.helper.isEmptyModelCol(_)&&v>=g&&_.element?(b=I(_.element),!0):(v++,!1)),b)return i.preventDefault(),this.selection.focusCell(b),!1}else{i.preventDefault();const v=o.cloneRange(),b=this.root.prev(),_=b?s.find(b):void 0;return _!=null&&_.onSelectUp?_.onSelectUp(i):(s.focusPrevBlock(this,v,!1),r.range.select(v)),!1}}a.length>0&&setTimeout(()=>{var g;(g=this.scrollbar)==null||g.refresh()},0)}),e.on("keydown:left",()=>{if(!V(e)||e.readonly)return;const{change:i,card:r}=e,o=i.range.get().endNode.closest("td");if(o.length===0||!o.inEditor())return;const a=r.closest(o,!0);!(a!=null&&a.equal(this.root))||!o.find(".table-main-content")||o.length>0&&setTimeout(()=>{var u;(u=this.scrollbar)==null||u.refresh()},0)}),e.on("keydown:right",()=>{if(!V(e)||e.readonly)return;const{change:i,card:r}=e,o=i.range.get().endNode.closest("td");if(o.length===0||!o.inEditor())return;const a=r.closest(o,!0);!(a!=null&&a.equal(this.root))||!o.find(".table-main-content")||o.length>0&&setTimeout(()=>{var u;(u=this.scrollbar)==null||u.refresh()},0)})),!this.colorTool&&(this.colorTool=new noe(e,this.id,{colors:Wl.colors,defaultColor:(n=super.getValue())==null?void 0:n.color,onChange:i=>{this.conltrollBar.drawBackgroundColor(i);const r=this.getValue();this.setValue({...r,color:i})}}))}toolbar(){var r;const e=this.editor,n=()=>{var c,u;if(!V(e)||e.readonly)return[{key:"maximize",type:"maximize"}];const s=e.language.get("table"),o=[{key:"color",type:"node",title:e.language.get("table","color","title"),node:this.colorTool.getButton()},{key:"border",type:"button",title:(c=super.getValue())!=null&&c.noBorder?s.showBorder:s.noBorder,content:'<span class="data-icon data-icon-no-border"></span>',didMount:d=>{const h=super.getValue();(h==null?void 0:h.noBorder)===!0&&d.addClass("active"),this.noBorderToolButton=d},onClick:(d,h)=>{var g;const f=super.getValue();this.setValue({noBorder:!(f!=null&&f.noBorder)});const p=(g=this.wrapper)==null?void 0:g.find(".data-table");(f==null?void 0:f.noBorder)===!0?(p==null||p.removeAttributes("data-table-no-border"),h.removeClass("active")):(p==null||p.attributes("data-table-no-border","true"),h.addClass("active"))}},{key:"align",type:"dropdown",content:'<span class="data-icon data-icon-align-top" />',title:s.verticalAlign.title,didMount:d=>{this.alignToolButton=d.find(".data-toolbar-btn")},items:[{type:"button",content:`<span class="data-icon data-icon-align-top"></span> ${s.verticalAlign.top}`,onClick:d=>this.updateAlign(d,"top")},{type:"button",content:`<span class="data-icon data-icon-align-middle"></span> ${s.verticalAlign.middle}`,onClick:d=>this.updateAlign(d,"middle")},{type:"button",content:`<span class="data-icon data-icon-align-bottom"></span> ${s.verticalAlign.bottom}`,onClick:d=>this.updateAlign(d,"bottom")}]},{key:"merge",type:"button",title:s.mergeCell,content:'<span class="data-icon data-icon-merge-cells"></span>',disabled:this.conltrollBar.getMenuDisabled("mergeCell"),onClick:()=>{this.command.mergeCell()}},{key:"split",type:"button",title:s.splitCell,content:'<span class="data-icon data-icon-solit-cells"></span>',disabled:this.conltrollBar.getMenuDisabled("splitCell"),onClick:()=>{this.command.splitCell()}}];if(this.isMaximize)return o;const a=[{key:"maximize",type:"maximize"},{key:"copy",type:"copy",onClick:()=>{this.command.copy(!0),e.messageSuccess("copy",e.language.get("copy","success"))}},{key:"delete",type:"delete"},{key:"separator",type:"separator"},...o];return Ee(((u=this.wrapper)==null?void 0:u.css("margin-left"))||"0")===0&&a.unshift({key:"dnd",type:"dnd"}),a},i=(r=e.plugin.findPlugin("table"))==null?void 0:r.options;return i!=null&&i.cardToolbars?i.cardToolbars(n(),this.editor):n()}onSelectLeft(e){const{tableModel:n}=this.selection;if(!!n)for(let i=n.rows-1;i>=0;i--)for(let r=n.cols-1;r>=0;r--){const s=n.table[i][r];if(!this.helper.isEmptyModelCol(s)&&s.element)return e.preventDefault(),this.selection.focusCell(s.element,!1),!1}}onSelectRight(e){const{tableModel:n}=this.selection;if(!!n)for(let i=0;i<n.rows;i++)for(let r=0;r<n.cols;r++){const s=n.table[i][r];if(!this.helper.isEmptyModelCol(s)&&s.element)return e.preventDefault(),this.selection.focusCell(s.element),!1}}onSelectUp(e){const{tableModel:n}=this.selection;if(!!n)for(let i=n.rows-1;i>=0;i--)for(let r=0;r<n.cols;r++){const s=n.table[i][r];if(!this.helper.isEmptyModelCol(s)&&s.element)return e.preventDefault(),this.selection.focusCell(s.element,!1),!1}}onSelectDown(e){const{tableModel:n}=this.selection;if(!!n)for(let i=0;i<n.rows;i++)for(let r=0;r<n.cols;r++){const s=n.table[i][r];if(!this.helper.isEmptyModelCol(s)&&s.element)return e.preventDefault(),this.selection.focusCell(s.element),!1}}updateAlign(e,n="top"){e.preventDefault(),this.conltrollBar.setAlign(n),this.onChange("local"),this.updateAlignText(n)}updateAlignText(e="top"){var i;const n=`<span class="data-icon data-icon-align-${e}"></span>`;(i=this.alignToolButton)==null||i.html(n)}getValue(){const e=super.getValue();if(!this.wrapper)return e;const n=this.wrapper.find(Q.TABLE_CLASS);if(!n)return e;const{tableModel:i}=this.selection;if(!i)return e;const r=this.editor,{schema:s,conversion:o}=r,a=I("<div></div>");a.append(n.clone(!0));const c=new $t(a,r,g=>{g.find(Q.TABLE_TD_BG_CLASS).remove(),g.find(ze).each(m=>{r.node.unwrap(I(m))})}),{rows:u,cols:d,height:h,width:f}=i,p=c.toValue(s,o,!1,!1);return V(r)?{...e,rows:u,cols:d,height:h,width:f,html:p}:{...e,html:p}}drawBackground(e,n){var p,g;const i=e.get().getBoundingClientRect(),r=new DOMRect(i.x,i.y,0,0),{startContainer:s,endContainer:o}=n,a=Kr(s,"td"),c=Kr(o,"td");if(!(a instanceof Element)||!(c instanceof Element)||a.nodeName!=="TD"||(c==null?void 0:c.nodeName)!=="TD"||a===c)return;const u=a.getBoundingClientRect(),d=c.getBoundingClientRect(),h=(p=this.viewport)==null?void 0:p.getBoundingClientRect(),f=((h==null?void 0:h.left)||0)+(this.activated?13:0);return r.x=Math.max(u.left-i.left,f-(((g=this.editor.root.getBoundingClientRect())==null?void 0:g.left)||0)),r.y=u.top-i.top,r.width=(h?Math.min(d.right,h.right):d.right)-u.left,r.height=u.bottom-u.top,r.width<0&&(r.width=0),r.height=d.bottom-u.top,r}activate(e){var n,i,r;super.activate(e),e?(this.conltrollBar.refresh(),(n=this.wrapper)==null||n.addClass("active")):(this.selection.clearSelect(),this.conltrollBar.hideContextMenu(),(i=this.wrapper)==null||i.removeClass("active")),(r=this.scrollbar)==null||r.refresh()}maximize(){var n;super.maximize(),(n=this.scrollbar)==null||n.refresh();const{editor:e}=this;V(e)&&!ue&&this.getCenter().on("scroll",this.updateScrollbar)}minimize(){var e;super.minimize(),(e=this.scrollbar)==null||e.refresh(),this.getCenter().off("scroll",this.updateScrollbar)}getSelectionNodes(){const e=[];return this.selection.each(n=>{!this.helper.isEmptyModelCol(n)&&n.element&&e.push(I(n.element).find(ze))}),e.length===1&&e[0].closest("[table-cell-selection=true]").length===0?[]:e}overflow(e){var s,o,a,c;const n=((o=(s=this.wrapper)==null?void 0:s.find(".data-table"))==null?void 0:o.width())||0,i=this.getCenter().width(),r=n-i;r>0&&!this.isMaximize?(a=this.wrapper)==null||a.css("margin-right",`-${r>e?e:r}px`):(r<0||this.isMaximize)&&((c=this.wrapper)==null||c.css("margin-right",""))}initScrollbar(){var a;if(!this.viewport)return;const e=this.editor,n=e.plugin.findPlugin("table"),i=(n==null?void 0:n.options.overflow)||{},r=i.maxLeftWidth?{onScrollX:c=>{var d;this.isMaximize&&(c=0);const u=i.maxLeftWidth();return(d=this.wrapper)==null||d.css("margin-left",`-${c>u?u:c}px`),c>0?e.root.find(".data-card-dnd").hide():e.root.find(".data-card-dnd").show(),c-u},getScrollLeft:c=>{var u;return c-Ee(((u=this.wrapper)==null?void 0:u.css("margin-left"))||"0")},getOffsetWidth:c=>{var u;return c+Ee(((u=this.wrapper)==null?void 0:u.css("margin-left"))||"0")}}:void 0;this.scrollbar=new Gne(this.viewport,!0,!1,!0,r),this.scrollbar.setContentNode(this.viewport.find(".data-table")),this.scrollbar.on("display",c=>{var u,d;c==="block"?(u=this.wrapper)==null||u.addClass("scrollbar-show"):(d=this.wrapper)==null||d.removeClass("scrollbar-show")});let s={x:0,y:0};const o=({x:c,y:u})=>{i.maxRightWidth&&this.overflow(i.maxRightWidth()),!(s.x===c&&s.y===u)&&(s={x:c,y:u},V(e)&&(e.trigger("scroll",this.root,{x:c,y:u}),this.conltrollBar.refresh()))};this.scrollbar.on("change",o),ue||window.addEventListener("scroll",this.updateScrollbar),window.addEventListener("resize",this.updateScrollbar),V(e)&&!ue&&((a=e.scrollNode)==null||a.on("scroll",this.updateScrollbar))}didRender(){var o,a,c,u,d;super.didRender();const e=this.editor;e.on("undo",this.doChange),e.on("redo",this.doChange),this.viewport=V(e)?(o=this.wrapper)==null?void 0:o.find(Q.VIEWPORT):(a=this.wrapper)==null?void 0:a.find(Q.VIEWPORT_READER),this.selection.init(),this.conltrollBar.init(),this.command.init(),!V(e)||e.readonly?(c=this.toolbarModel)==null||c.setOffset([0,0]):(u=this.toolbarModel)==null||u.setOffset([13,-28,0,-6]);const n=e.plugin.findPlugin("table"),i=(n==null?void 0:n.options.overflow)||{};if(this.viewport&&(this.selection.refreshModel(),setTimeout(()=>{this.initScrollbar()},0)),this.selection.on("select",()=>{var f,p;if(this.conltrollBar.refresh(!1),!V(e))return;const h=(f=this.selection.getSingleCell())==null?void 0:f.css("vertical-align");this.updateAlignText(h),(p=this.toolbarModel)==null||p.update()}),this.conltrollBar.on("sizeChanged",()=>{var h;this.selection.refreshModel(),this.onChange(),(h=this.scrollbar)==null||h.refresh()}),this.conltrollBar.on("sizeChanging",()=>{var h;(h=this.scrollbar)==null||h.refresh(),e.trigger("editor:resize"),this.updateScrollbar()}),this.command.on("actioned",(h,f)=>{var p,g;h==="paste"&&e.card.render(this.wrapper),["splitCell","mergeCell"].includes(h)&&e.trigger("editor:resize"),this.selection.render(h),(p=this.toolbarModel)==null||p.update(),f||this.onChange(),i.maxRightWidth&&this.overflow(i.maxRightWidth()),(g=this.scrollbar)==null||g.refresh()}),!((d=this.wrapper)==null?void 0:d.find(Q.TABLE_CLASS)))return;const s=super.getValue();if(!(s!=null&&s.html)){const h=this.getValue();h&&V(e)&&this.setValue(h),this.onChange()}i.maxRightWidth&&this.overflow(i.maxRightWidth())}remoteRefresh(){var h,f,p;if(!this.wrapper||this.wrapper.length===0||!this.wrapper[0].parentNode)return;const e=this.wrapper.find(Q.COLS_HEADER_CLASS),n=super.getValue();let i=e.find(Q.COLS_HEADER_ITEM_CLASS);const r=i.length;if(n.cols>r)e.append(I(this.template.renderColsHeader(n.cols-r)).find(Q.COLS_HEADER_ITEM_CLASS)),i=e.find(Q.COLS_HEADER_ITEM_CLASS);else if(n.cols<r)for(let g=r;g>n.cols;g--)(h=i.eq(g-1))==null||h.remove();const s=n.html?I(n.html):this.wrapper.find("table");s.find("col").toArray().forEach((g,m)=>{var b;const v=g.attributes("width")||g.css("width");(b=i.eq(m))==null||b.css("width",`${Math.max(parseInt(v),this.colMinWidth)}px`)});const a=this.wrapper.find(Q.ROWS_HEADER_CLASS);let c=a.find(Q.ROWS_HEADER_ITEM_CLASS);const u=c.length;if(n.rows>u)a.append(I(this.template.renderRowsHeader(n.rows-u)).find(Q.ROWS_HEADER_ITEM_CLASS)),c=a.find(Q.ROWS_HEADER_ITEM_CLASS);else if(n.rows<u)for(let g=u;g>n.rows;g--)(f=c.eq(g-1))==null||f.remove();s.find("tr").toArray().forEach((g,m)=>{var v;(v=c.eq(m))==null||v.css("height",Math.max(parseInt(g.css("width")),this.rowMinHeight))}),(p=this.scrollbar)==null||p.refresh(),this.remoteRefreshTimeout&&clearTimeout(this.remoteRefreshTimeout),this.remoteRefreshTimeout=setTimeout(()=>{var g;(g=this.wrapper)==null||g.find(ze).each(m=>{const v=m;v.hasAttribute(yt)||v.setAttribute(yt,this.template.isReadonly?"false":"true")})},10)}render(){const e=this.editor;if(this.template.isReadonly=!V(e)||e.readonly,this.wrapper&&this.wrapper.length>0&&!!this.wrapper[0].parentNode){this.remoteRefresh();return}const n=this.getValue();if(!n)return"Error value";if(n.html){let i=I(n.html);i&&i.name!=="table"&&(i=i.toArray().find(s=>s.name==="table"),i?n.html=i.get().outerHTML:(n.html=`<table><tr><td>${n.html}</td></tr></table>`,i=I(n.html)));const r=this.helper.getTableModel(i);n.rows=r.rows,n.cols=r.cols}return this.wrapper=V(e)?I(this.template.htmlEdit(n,Jse(e.language.get("table")))):I(this.template.htmlView(n)),V(e)||this.wrapper.find("table").addClass("data-table").addClass("data-table-view"),n.rows=this.wrapper.find("tr").length,n.width&&this.wrapper.find("table").css("width",`${n.width}px`),this.wrapper}destroy(){var r,s;super.destroy();const e=this.editor;window.removeEventListener("scroll",this.updateScrollbar),window.removeEventListener("resize",this.updateScrollbar),(r=e.scrollNode)==null||r.off("scroll",this.updateScrollbar),(s=this.scrollbar)==null||s.destroy(),this.command.removeAllListeners();const n=this.selection;n.removeAllListeners(),n.destroy();const i=this.conltrollBar;i.removeAllListeners(),i.destroy(),e.off("undo",this.doChange),e.off("redo",this.doChange)}};let on=Wl;ur=new WeakMap,y(on,"colors",Ks.getColors().map(e=>e.map(n=>({color:n,border:Ks.getStroke(n)}))));const ioe={table:{insertColLeft:"Insert column(s) $data left",insertColRight:"Insert column(s) $data right",insertRowUp:"Insert row(s) $data up",insertRowDown:"Insert row(s) $data down",mergeCell:"Merge cells",splitCell:"Unmerge cells",removeCol:"Delete selected column(s)",removeRow:"Delete selected row(s)",removeTable:"Delete table",copy:"Copy",cut:"Cut",paste:"Paste",clear:"Clear",draggingCol:"Moving $data column",draggingRow:"Moving $data row",color:{title:"Cell background color",nonFillText:"No fill color"},noBorder:"Hide border",showBorder:"Show border",verticalAlign:{title:"Vertical align",top:"Align top",middle:"Align middle",bottom:"Align bottom"}}},roe={table:{insertColLeft:"\u5DE6\u8FB9\u63D2\u5165 $data \u5217",insertColRight:"\u53F3\u8FB9\u63D2\u5165 $data \u5217",insertRowUp:"\u4E0A\u65B9\u63D2\u5165 $data \u884C",insertRowDown:"\u4E0B\u65B9\u63D2\u5165 $data \u884C",mergeCell:"\u5408\u5E76\u5355\u5143\u683C",splitCell:"\u62C6\u5206\u5355\u5143\u683C",removeCol:"\u5220\u9664\u9009\u4E2D\u5217",removeRow:"\u5220\u9664\u9009\u4E2D\u884C",removeTable:"\u5220\u9664\u8868\u683C",copy:"\u590D\u5236",cut:"\u526A\u5207",paste:"\u7C98\u8D34",clear:"\u6E05\u7A7A\u5185\u5BB9",draggingCol:"\u6B63\u5728\u79FB\u52A8 $data \u5217",draggingRow:"\u6B63\u5728\u79FB\u52A8 $data \u884C",color:{title:"\u5355\u5143\u683C\u80CC\u666F\u8272",nonFillText:"\u65E0\u586B\u5145\u8272"},noBorder:"\u9690\u85CF\u8FB9\u6846",showBorder:"\u663E\u793A\u8FB9\u6846",verticalAlign:{title:"\u5782\u76F4\u5BF9\u9F50",top:"\u9876\u5BF9\u9F50",middle:"\u5782\u76F4\u5C45\u4E2D",bottom:"\u5E95\u5BF9\u9F50"}}},soe={"en-US":ioe,"zh-CN":roe};class ooe extends _t{constructor(){super(...arguments);y(this,"onCopy",e=>{const n=this.editor;if(!V(n))return!0;const{change:i,card:r}=n,s=i.range.get(),o=r.find(s.commonAncestorNode,!0);return o&&o.name===on.cardName&&!o.isCursor(s.startNode)&&o.getSelectionNodes().length>1?(e.preventDefault(),o.command.copy(),n.messageSuccess("copy",n.language.get("copy","success")),!1):!0});y(this,"onCut",e=>{const n=this.editor;if(!V(n)||n.readonly)return!0;const{change:i,card:r}=n,s=i.range.get(),o=r.find(s.commonAncestorNode,!0);return o&&o.name===on.cardName&&!o.isCursor(s.startNode)&&o.getSelectionNodes().length>1?(e.preventDefault(),o.command.cut(),!1):!0});y(this,"onPaste",e=>{const n=this.editor;if(!V(n)||n.readonly)return!0;const{change:i,card:r}=n,s=i.range.get(),o=r.find(s.commonAncestorNode,!0);if(o&&o.name===on.cardName&&!o.isCursor(s.startNode)){const a=n.clipboard.getData(e);return!a||!/<meta\s+name="aomao"\s+content="table"\s{0,}\/?>/gi.test(a.html||"")?!0:(e.preventDefault(),o.command.paste(a),!1)}return!0});y(this,"pasteSchema",e=>{e.data.blocks.forEach(r=>{r.allowIn||(r.allowIn=[]),r.allowIn.indexOf("td")<0&&r.allowIn.push("td")});const n=e.find(r=>r.name==="table")[0];n.attributes={class:["data-table"],"data-table-no-border":"*","data-wdith":"@length",style:{width:"@length",background:"@color","background-color":"@color"}};const i=n.allowIn;i?i.push("div"):n.allowIn=["div"],e.find(r=>r.name==="div")[0].attributes={class:{required:!0,value:["editor-table-wrapper"]}},e.find(r=>r.name==="tr")[0].attributes={class:["data-table"],"data-table-no-border":"*",style:{height:"@length",background:"@color","background-color":"@color",display:"*"}},e.find(r=>r.name==="td")[0].attributes={colspan:"@number",rowspan:"@number",class:["table-last-column","table-last-row","table-last-column","table-cell-selection"],style:{"background-color":"@color",background:"@color","vertical-align":["top","middle","bottom"],valign:["top","middle","bottom"]}}});y(this,"pasteEach",e=>{var n;e.name==="div"&&e.hasClass("editor-table-wrapper")&&((n=e.first())==null?void 0:n.name)==="table"&&this.editor.node.unwrap(e)});y(this,"pasteHtml",e=>{const n=this.editor;if(!V(n))return;const i=(d,h="width")=>{const f=d.attributes("data-width"),p=f||d.css(h);p.endsWith("%")&&d.css(h,""),p.endsWith("pt")&&d.css(h,this.convertToPX(p))},r=e.find("table");if(r.length===0)return;const s=new Dp(n),{change:o}=n,a=o.range.get(),c=d=>{d.find("thead").find("th,td").toArray().forEach(v=>{d.before(v.children())}),d.find("tr").toArray().forEach(v=>{v.find("td").toArray().forEach(_=>{n.node.isEmpty(_)||d.before(_.children())})}),d.find("tfoot").find("th,td").toArray().forEach(v=>{d.after(v.children())}),d.remove()},u=a.startNode.closest(ze).length>0;r.each((d,h)=>{var D;let f=r.eq(h);if(!f)return;if(u||((D=f.parent())==null?void 0:D.name)==="td"){c(f);return}let p=f.find("tr");p.each(P=>{const O=I(P);O.css("display")==="none"?O.remove():O.css("display",""),O.children().each(A=>{const F=I(A),W=F.text(),G=F.find("table");if(G.length>0&&(G.after(document.createTextNode(G.text())),G.remove()),F.name!=="td"&&[`
`,`\r
`].includes(W.trim())){const k=I("<td></td>");F.before(k),k.append(F)}})}),f=s.normalizeTable(f),i(f),i(f,"height");const g=f.find("tbody"),m=f.find("thead");m&&m.length>0&&g.prepend(m.children()),m.remove();const v=f.find("tfoot");v&&v.length>0&&g.append(v.children()),v.remove();const b=f.find("th");b.each((P,O)=>{const L=b.eq(O);L==null||L.replaceWith(I(`<td>${L.html()}</td>`))});const _=f.find("td");let x=it().createDocumentFragment();_.each((P,O)=>{x=it().createDocumentFragment();const L=_.eq(O);if(!L)return;i(L),i(L,"height");const B=L.css("background");B&&L.css("background-color",B);const A=L.attributes("valign");A&&L.attributes("vertical-align",A);const F=L.children();for(let G=0,k=F.length;G<k;G++){const C=F.eq(G);if((G===0||G===k-1)&&(C==null?void 0:C.isText())){const $=C.text();if(/^\n(\s)*$/.test($))continue}C&&x.appendChild(C[0])}const W=I(x);L==null||L.empty().append(n.node.normalize(W))});const w=(f==null?void 0:f.css("background"))||(f==null?void 0:f.css("background-color"));w&&_.css("background",w),p=f.find("tr");let E=1;p.each(P=>{const O=I(P),L=O==null?void 0:O.find("td");if((L==null?void 0:L.length)===0&&E<2&&(O==null||O.remove()),L&&(L==null?void 0:L.length)>0){const A=L.toArray().map(F=>F[0].rowSpan);E=Math.max(...A)}O&&(i(O),i(O,"height"));const B=(O==null?void 0:O.css("background"))||(O==null?void 0:O.css("background-color"));B&&(L==null||L.css("background",B))}),n.nodeId.generateAll(f,!0),f.allChildren().forEach(P=>{n.node.isInline(P)&&n.inline.repairCursor(P)});const R=f.get().outerHTML.replace(/\n|\r\n/g,"").replace(/>\s+</g,"><");n.card.replaceNode(f,on.cardName,{html:R}),f.remove()})});y(this,"parseHtml",(e,n)=>{const i=this.editor,r=[];return e.find(`[${ke}="${on.cardName}"],[${We}="${on.cardName}"]`).each(s=>{const o=I(s);let a=o.find("table");const c=at(o.attributes(je));if(a.length===0){if(!c||!c.html)return;if(a=I(Oi(c.html)),a.length===0){o.remove();return}else i.trigger("parse:html",a)}const u=a.attributes("width")||a.css("width");a.css({outline:"none","border-collapse":"collapse",width:"100%"}),a.attributes("data-width",u);const d=a.find("td");d.each((f,p)=>{const g=d.eq(p);g==null||g.css({"min-width":"auto","white-space":"flat","word-wrap":"break-word",margin:"4px 8px",border:a.attributes("data-table-no-border")?"0 none":"1px solid #d9d9d9",padding:"4px 8px",cursor:"default","vertical-align":g.css("vertical-align")||"top"})}),a.find(Q.TABLE_TD_BG_CLASS).remove(),a.find(Q.TABLE_TD_CONTENT_CLASS).each(f=>{i.node.unwrap(I(f))}),n&&(a=n(a,c));const h=a.attributes("data-id")+"-table";a=I(`<div class="editor-table-wrapper" style='width:100%;overflow:auto;'  data-id='${h}'  data-table-no-border='${!!a.attributes("data-table-no-border")}'>`).append(a),o.replaceWith(a),r.push(a)}),r});y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("table")})}static get pluginName(){return"table"}init(){const e=this.editor;this.options.colMinWidth||(this.options.colMinWidth=40),this.options.rowMinHeight||(this.options.rowMinHeight=30),e.language.add(soe),e.schema.add(this.schema()),e.conversion.add("th","td"),e.on("parse:html",this.parseHtml),e.on("paste:each",this.pasteEach),e.on("paste:each-after",this.pasteHtml),e.on("paste:schema",this.pasteSchema),V(e)&&(this.editor.on("markdown-it",this.markdownIt),e.change.event.onDocument("copy",this.onCopy,0),e.change.event.onDocument("cut",this.onCut,0),e.change.event.onDocument("paste",this.onPaste,0))}hotkey(){return this.options.hotkey||""}schema(){return[{name:"table",type:"block",attributes:{class:["data-table"],"data-table-no-border":"*",style:{width:"@length"}}},{name:"colgroup",type:"block",allowIn:["table"]},{name:"col",type:"block",isVoid:!0,attributes:{width:"@number",span:"@number"},allowIn:["colgroup"]},{name:"thead",type:"block",allowIn:["table"]},{name:"tbody",type:"block",allowIn:["table"]},{name:"tr",type:"block",attributes:{style:{height:"@length"}},allowIn:["tbody","thead","tfoot"]},{name:"td",type:"block",attributes:{colspan:"@number",rowspan:"@number",class:["table-last-column","table-last-row","table-last-column","table-cell-selection"],style:{"background-color":"@color","vertical-align":["top","middle","bottom"]}},allowIn:["tr"]},{name:"th",type:"block",attributes:{colspan:"@number",rowspan:"@number"},allowIn:["tr"]}]}execute(e,n){const i=this.editor;if(!V(i))return;const{change:r}=i;r.range.get().startNode.closest(ze).length>0||i.card.insert(on.cardName,{rows:e||3,cols:n||3,overflow:!!this.options.overflow})}convertToPX(e){const n=/([\d\.]+)(pt|px)$/i.exec(e);return n&&n[2]==="pt"?String(Math.round(parseInt(n[1],10)*96/72))+"px":e}destroy(){const e=this.editor;e.off("parse:html",this.parseHtml),e.off("paste:each-after",this.pasteHtml),e.off("paste:schema",this.pasteSchema),e.off("markdown-it",this.markdownIt)}}const pf="paste:each";class Rp extends _t{constructor(){super(...arguments);y(this,"styleName","line-height");y(this,"pasteEach",e=>{const n=this.editor;if(!e.isCard()&&n.node.isBlock(e)){const i=e.css(this.styleName);if(!i)return;const r=this.convertToPX(i);i.endsWith("pt")&&e.css(this.styleName,r);const{filter:s}=this.options;if(s){const a=s(r);a===!1?e.css(this.styleName,""):typeof a=="string"&&e.css(this.styleName,a)}else e.css(this.styleName,"");const o=n.node;o.isBlock(e)||o.unwrap(e)}})}static get pluginName(){return"line-height"}init(){const e=this.editor;e.schema.add(this.schema()),V(e)&&e.on(pf,this.pasteEach)}execute(e){const n=this.editor;if(!V(n))return;e==="default"&&(e="");const{change:i,block:r}=n,s=i.range.get(),o=r.findBlocks(s);!o||o.forEach(a=>{this.addLineHeight(a,e)})}queryState(){const e=this.editor;if(!V(e))return;const{change:n,node:i}=e;if(!n.range.get().startNode.inEditor())return["default"];const{blocks:s}=n,o=[];return s.forEach(a=>{var c;if(i.isNestedBlock(a)){const u=((c=a.get())==null?void 0:c.style.lineHeight)||"";if(!u)return;const d=this.convertToPX(u),{filter:h}=this.options;if(h){const f=h(d);if(f===!1)return;typeof f=="string"?o.push(f):o.push(d)}}}),o.length===0?["default"]:o}addLineHeight(e,n){const{node:i}=this.editor;!i.isNestedBlock(e)||e.css(this.styleName,n||"")}schema(){return{type:"block",attributes:{style:{[this.styleName]:"@length"}}}}convertToPX(e){const n=/([\d\.]+)(pt|px)$/i.exec(e);return n&&n[2]==="pt"?String(Math.round(parseInt(n[1],10)*96/72))+"px":e}destroy(){this.editor.off(pf,this.pasteEach)}}const aoe=mt({name:"am-link-editor",components:{AConfigProvider:zf,AInput:el,AButton:qf,ARadio:Da,ARadioGroup:Da.Group},props:{language:{type:Object,required:!0},defaultText:String,defaultLink:String,defaultjuptType:String,className:String,onLoad:Function,onOk:Function},setup(l){const t=xe(l.defaultText),e=xe(l.defaultLink),n=xe(l.defaultjuptType),i=xe(null),r=l.language.get("link","text"),s=l.language.get("link","text_placeholder"),o=l.language.get("link","link"),a=l.language.get("link","juptType"),c=l.language.get("link","link_placeholder"),u=l.language.get("link","ok_button");return Fi(()=>{i.value&&i.value.focus(),setTimeout(()=>{l.onLoad&&l.onLoad()},200)}),{text:t,link:e,textTitle:r,textPlaceholder:s,linkTitle:o,juptTypeTitle:a,juptType:n,linkPlaceholder:c,buttonTitle:u,linkRef:i}}});function loe(l,t,e,n,i,r){const s=el,o=Da,a=hg,c=qf,u=zf;return oe(),Je(u,{"auto-insert-space-in-button":!1},{default:Be(()=>[Ne("div",{"data-element":"ui",class:lt(["data-link-editor",l.className])},[Ne("p",null,Et(l.textTitle),1),Ne("p",null,[Ge(s,{class:"data-link-input",modelValue:l.text,"onUpdate:modelValue":t[0]||(t[0]=d=>l.text=d),placeholder:l.textPlaceholder},null,8,["modelValue","placeholder"])]),Ne("p",null,Et(l.linkTitle),1),Ne("p",null,[Ge(s,{ref:"linkRef",class:"data-link-input",modelValue:l.link,"onUpdate:modelValue":t[1]||(t[1]=d=>l.link=d),placeholder:l.linkPlaceholder},null,8,["modelValue","placeholder"])]),Ne("p",null,Et(l.juptTypeTitle),1),Ne("p",null,[Ge(a,{modelValue:l.juptType,"onUpdate:modelValue":t[2]||(t[2]=d=>l.juptType=d)},{default:Be(()=>[Ge(o,{value:"_self"},{default:Be(()=>[Pr("\u6B64\u7A97\u53E3\u6253\u5F00")]),_:1}),Ge(o,{value:"_blank"},{default:Be(()=>[Pr("\u6253\u5F00\u65B0\u9875\u9762")]),_:1})]),_:1},8,["modelValue"])]),Ne("p",null,[Ge(c,{class:"data-link-button",onClick:t[3]||(t[3]=d=>l.onOk(l.text,l.link,l.juptType)),disabled:l.link.trim()===""},{default:Be(()=>[Pr(Et(l.buttonTitle),1)]),_:1},8,["disabled"])])],2)]),_:1})}const coe=gt(aoe,[["render",loe]]),uoe=mt({name:"am-link-preview",components:{ATooltip:pr},props:{language:{type:Object,required:!0},readonly:{type:Boolean,required:!0},href:String,className:String,onEdit:Function,onRemove:Function,onLoad:Function},setup(l){const t=l.language.get("link","link_open"),e=l.language.get("link","link_edit"),n=l.language.get("link","link_remove");return Fi(()=>{l.onLoad&&l.onLoad()}),{openTitle:t,editTitle:e,removeTitle:n,isMobile:ue}}}),doe={class:"data-link-preview","data-element":"ui"},foe=["href"],hoe={key:0,class:"data-link-op"};function poe(l,t,e,n,i,r){const s=pr;return oe(),pe("div",doe,[Ge(s,{content:l.openTitle},{default:Be(()=>[Ne("a",{class:"data-icon data-icon-link data-link-preview-open",href:l.href,target:"_blank"},Et(l.href),9,foe)]),_:1},8,["content"]),l.readonly?Re("",!0):(oe(),pe("div",hoe,[l.isMobile?Re("",!0):(oe(),Je(s,{key:0,content:l.editTitle},{default:Be(()=>[Ne("a",{class:"data-icon data-icon-edit",onClick:t[0]||(t[0]=(...o)=>l.onEdit&&l.onEdit(...o))})]),_:1},8,["content"])),l.isMobile?(oe(),pe("a",{key:1,class:"data-icon data-icon-edit",onClick:t[1]||(t[1]=(...o)=>l.onEdit&&l.onEdit(...o))})):Re("",!0),l.isMobile?Re("",!0):(oe(),Je(s,{key:2,content:l.removeTitle},{default:Be(()=>[Ne("a",{class:"data-icon data-icon-unlink",onClick:t[2]||(t[2]=(...o)=>l.onRemove&&l.onRemove(...o))})]),_:1},8,["content"])),l.isMobile?(oe(),pe("a",{key:3,class:"data-icon data-icon-unlink",onClick:t[3]||(t[3]=(...o)=>l.onRemove&&l.onRemove(...o))})):Re("",!0)]))])}const goe=gt(uoe,[["render",poe]]);class moe{constructor(t,e){y(this,"engine");y(this,"root");y(this,"target");y(this,"options");y(this,"mouseInContainer",!1);y(this,"vm");y(this,"position");this.engine=t;const{change:n}=this.engine;this.options=e,this.position=new Eo(this.engine),n.event.onWindow("mousedown",i=>{if(!i.target)return;const r=I(i.target),s=r.closest(".data-link-container");this.mouseInContainer=s&&s.length>0,!r.inEditor()&&!this.mouseInContainer&&this.hide()})}create(){var n;if(!this.target)return;let t=I(".data-link-container");t.length===0&&(t=I(`<div ${le}="${Qe}" class="data-link-container${ue?" data-link-container-mobile":""}"></div>`)),this.root=t;const e=(n=this.target.get())==null?void 0:n.getBoundingClientRect();!e||this.root.css({top:`${window.pageYOffset+e.bottom+4}px`,left:`${window.pageXOffset}px`,position:"absolute","z-index":125})}async onOk(t,e,n){var a,c;if(!this.target)return;const{change:i}=this.engine,r=i.range.get();i.rangePathBeforeCommand||(r.startNode.inEditor()||(r.select(this.target,!0),i.range.select(r)),i.cacheRangeBeforeCommand());const{onConfirm:s}=this.options||{};if(s){const u=await s(t,e,n);t=u.text,e=u.link,n=u.juptType}if(this.target.attributes("href",e),this.target.attributes("target",n),t=t.trim()===""?e:t,this.target.text()!==t){const u=this.target.children();if(u.length<3)this.target.text(t);else if(u.length===3&&((a=u.eq(1))==null?void 0:a.isText()))this.target.text(t);else if(u.length===3){let d=u.eq(1);for(;d;){const h=d.children();if(h.length>1||h.length===0){d.text(t);break}else if((c=h.eq(0))!=null&&c.isText()){d.text(t);break}else d=h}}else this.target.text(t)}this.engine.inline.repairCursor(this.target),r.setStart(this.target.next(),1),r.setEnd(this.target.next(),1),i.apply(r),this.mouseInContainer=!1,this.hide()}editor(t,e,n,i){return dr(coe,{language:this.engine.language,defaultText:t,defaultLink:e,defaultjuptType:n||"_blank",onLoad:()=>{this.mouseInContainer=!0,i&&i()},onOk:(s,o,a)=>this.onOk(s,o,a)})}preview(t,e){const{change:n,inline:i,language:r}=this.engine;return dr(goe,{language:r,href:t,readonly:this.engine.readonly,onLoad:()=>{e&&e()},onEdit:()=>{!this.target||(this.mouseInContainer=!1,this.hide(void 0,!1),this.show(this.target,!0))},onRemove:()=>{if(!this.target)return;const o=n.range.get();o.select(this.target,!0),i.repairRange(o),n.range.select(o),n.cacheRangeBeforeCommand(),i.unwrap(),this.mouseInContainer=!1,this.target=void 0,this.hide()}})}show(t,e){var a,c,u,d,h,f;if(((a=this.target)==null?void 0:a.equal(t))&&!!((u=(c=this.root)==null?void 0:c.parent())!=null&&u.length))return;this.target=t,this.create();const n=t.text().replace(/\u200B/g,""),i=t.attributes("href"),r=t.attributes("target"),s=this.root.get(),o=(!i||e)&&!this.engine.readonly?"am-link-editor":"am-link-preview";if(this.vm&&this.vm._component.name===o){if(!this.root||!this.target)return;(d=this.position)==null||d.destroy(),(h=this.position)==null||h.bind(this.root,this.target);return}else this.vm&&(this.vm.unmount(),this.vm=void 0,(f=this.position)==null||f.destroy());setTimeout(()=>{var p,g;(p=this.position)==null||p.destroy(),(g=this.position)==null||g.bind(this.root,this.target),this.vm=(!i||e)&&!this.engine.readonly?this.editor(n,i,r,()=>{var m;(m=this.position)==null||m.update()}):this.preview(i,()=>{var m;(m=this.position)==null||m.update()}),this.vm.mount(s)},20)}hide(t,e){var i,r;if(t&&this.target&&t.equal(this.target))return;if(((i=this.root)==null?void 0:i.get())&&!this.mouseInContainer){if(this.vm&&(this.vm.unmount(),this.vm=void 0,(r=this.position)==null||r.destroy()),this.root=void 0,this.target&&!this.target.attributes("href")){const{change:s,inline:o}=this.engine,a=s.range.get();a.select(this.target,!0),o.unwrap(a),s.apply(a.collapse(!0))}e!==!1&&(this.target=void 0)}}}const voe={link:{text:"Text",link:"Link",juptType:"jupt way",text_placeholder:"Description text",link_placeholder:"Link address",link_open:"Open link",link_edit:"Edit link",link_remove:"Remove link",ok_button:"OK"}},boe={link:{text:"\u6587\u672C",link:"\u94FE\u63A5",juptType:"\u6253\u5F00\u65B9\u5F0F",text_placeholder:"\u63CF\u8FF0\u6587\u672C",link_placeholder:"\u94FE\u63A5\u5730\u5740",link_open:"\u6253\u5F00\u94FE\u63A5",link_edit:"\u7F16\u8F91\u94FE\u63A5",link_remove:"\u79FB\u9664\u94FE\u63A5",ok_button:"\u786E\u5B9A"}},yoe={"en-US":voe,"zh-CN":boe};const gf="paste:each",mf="markdown-it",vf="parse:html",bf="select";class _oe extends ap{constructor(){super(...arguments);y(this,"toolbar");y(this,"attributes",{target:"@var0",href:"@var1"});y(this,"variable",{"@var0":["_blank","_parent","_top","_self"],"@var1":{required:!0,value:"*"}});y(this,"tagName","a");y(this,"handleClick",e=>{if(!e.target)return;const{onLinkClick:n}=this.options;if(!n)return;const i=I(e.target).closest(`${this.tagName}`);i.name===this.tagName&&n(e,i.attributes("href"))});y(this,"bindQuery",()=>{this.query()});y(this,"query",()=>{var r,s,o;const e=this.editor;if(!V(e))return;const{change:n}=e,i=n.inlines.find(a=>this.isSelf(a));if((r=this.toolbar)==null||r.hide(i),i&&i.length>0&&!i.isCard()){const a=n.range.get();if(a.collapsed||i.contains(a.startNode)&&i.contains(a.endNode))return(s=this.toolbar)==null||s.show(i),!0;(o=this.toolbar)==null||o.hide()}return!1});y(this,"markdownIt",e=>{this.options.markdown!==!1&&(e.enable("link"),e.enable("linkify"))});y(this,"pasteHtml",e=>{if(e.isText()){const n=e.text(),{node:i,inline:r}=this.editor;if(/^https?:\/\/\S+$/.test(n.toLowerCase().trim())&&r.closest(e).equal(e)){const s=i.wrap(e,I(`<${this.tagName} target="_blank" href="${decodeURI(n).trim().replace(/\u200b/g,"")}"></a>`));return r.repairCursor(s),!1}}else if(e.name==="a"){const n=e.attributes("href");e.attributes("target","_blank"),e.attributes("href",decodeURI(n).trim().replace(/\u200b/g,""))}return!0});y(this,"parseHtml",e=>{e.find(this.tagName).css({"font-family":"monospace","font-size":"inherit","background-color":"rgba(0,0,0,.06)",padding:"0 2px",border:"1px solid rgba(0,0,0,.08)","border-radius":"2px 2px","line-height":"inherit","overflow-wrap":"break-word","text-indent":"0"})})}static get pluginName(){return"link"}init(){super.init();const e=this.editor;V(e)&&(this.options.enableToolbar!==!1&&(this.toolbar=new moe(e,{onConfirm:this.options.onConfirm})),e.container.on("click",this.handleClick),e.on(mf,this.markdownIt),e.on(gf,this.pasteHtml)),e.on(vf,this.parseHtml),e.on(bf,this.bindQuery),e.language.add(yoe)}hotkey(){return this.options.hotkey||{key:"mod+k",args:["_blank"]}}execute(){var r;const e=this.editor;if(!V(e))return;const{inline:n,change:i}=e;if(this.queryState()){const s=i.inlines.find(o=>this.isSelf(o));s&&s.length>0&&n.unwrap(s)}else{const s=I(`<${this.tagName} />`);this.setStyle(s,...arguments),this.setAttributes(s,...arguments);const o=arguments.length>2?arguments[2]:"";o?(s.text(o),n.insert(s)):n.wrap(s),!i.range.get().collapsed&&i.inlines.length>0&&((r=this.toolbar)==null||r.show(i.inlines[0]))}}queryState(){return this.query()}destroy(){const e=this.editor;e.container.off("click",this.handleClick),e.off(gf,this.pasteHtml),e.off(vf,this.parseHtml),e.off(bf,this.bindQuery),e.off(mf,this.markdownIt)}}const woe=["c","cpp","csharp","erlang","go","groovy","java","kotlin","makefile","objectivec","perl","python","rust","swift","vbnet"],xoe={header:"color: blue;font-weight: bold;",quote:"color: #090;",negative:"color: #d44;",positive:"color: #292;",strong:"font-weight: bold;",em:"font-style: italic;",link:"text-decoration: underline;color: #00c;",strikethrough:"text-decoration: line-through;",keyword:"color: #d73a49;",atom:"color: #905;",number:"color: #005cc5;",def:"color: #005cc5;",variable:"","variable-2":"color: #005cc5;","variable-3":"color: #22863a;",type:"color: #22863a;",comment:"color: #6a737d;",string:"color: #690","string-2":"color: #690;",meta:"color: #1f7f9a;",qualifier:"color: #555;",builtin:"color: #6f42c1;",bracket:"color: #997;",tag:"color: #22863a;",attribute:"color: #6f42c1;",hr:"color: #999;",error:"color: #f00;",invalidchar:"color: #f00;",operator:"color: #d73a49;",property:"color: #005cc5;"};class Mp{constructor(t,e){y(this,"editor");y(this,"options");y(this,"styleMap");y(this,"codeMirror");y(this,"mode","plain");y(this,"container");this.editor=t,this.options=e,this.styleMap={...xoe,...e.styleMap},this.container=e.container||I(this.renderTemplate())}renderTemplate(){return'<div class="data-codeblock-container"><div class="data-codeblock-content"></div></div>'}getConfig(t,e){const n=this.codeMirror,i=this.editor;let r=n?n.getOption("indentUnit"):woe.indexOf(e||"")>-1?4:2;const s=t?t.match(/^ {2,4}(?=[^\s])/gm):null;return s&&(r=s.reduce((o,a)=>Math.min(o,a.length),1/0)),{tabSize:r,indentUnit:r,scrollbarStyle:"simple",readOnly:!V(i)||i.readonly,viewportMargin:1/0}}getSyntax(t){return this.options.synatxMap[t]||t}create(t,e,n){this.mode=t;const i=this.getSyntax(t),r=Jn(this.container.find(".data-codeblock-content").get(),{value:e,mode:i,lineNumbers:!0,lineWrapping:!1,autofocus:!1,dragDrop:!1,...this.getConfig(e,i),...n});return r.on("focus",()=>{const{onFocus:s}=this.options;s&&s()}),r.on("blur",()=>{const{onBlur:s}=this.options;s&&s()}),ue?r.on("touchstart",(s,o)=>{const{onMouseDown:a}=this.options;a&&a(o)}):r.on("mousedown",(s,o)=>{const{onMouseDown:a}=this.options;o.button===2&&o.stopPropagation(),a&&a(o)}),r.on("change",bo(()=>{!V(this.editor)||this.save()},50)),r.setOption("extraKeys",{Enter:s=>{const o=this.getConfig(s.getValue());Object.keys(o).forEach(a=>s.setOption(a,o[a])),s.execCommand("newlineAndIndent")}}),r.on("keydown",(s,o)=>{(ce("mod+z",o)||ce("mod+y",o)||ce("mod+shift+z",o))&&o.stopPropagation();const a=s.lineCount(),{line:c,ch:u}=s.getCursor(),{onUpFocus:d,onDownFocus:h,onLeftFocus:f,onRightFocus:p}=this.options,g=s.getLine(c);if(c===a-1&&u===g.length){if(ce("down",o)||ce("ctrl+n",o)){h&&h(o);return}else if(ce("right",o)||ce("shift+right",o)||ce("ctrl+e",o)||ce("ctrl+f",o)){p&&p(o);return}}c===0&&u===0&&(ce("up",o)||ce("ctrl+p",o)?d&&d(o):(ce("left",o)||ce("shift+left",o)||ce("ctrl+b",o)||ce("ctrl+a",o))&&f&&f(o))}),this.container.on("mousedown",s=>{r!=null&&r.hasFocus()||setTimeout(()=>{r==null||r.focus()},0)}),this.codeMirror=r,this.codeMirror}setAutoWrap(t){var e;(e=this.codeMirror)==null||e.setOption("lineWrapping",t)}update(t,e){this.mode=t;const n=this.codeMirror,i=this.editor;e!==void 0&&(n==null||n.setValue(e)),n==null||n.setOption("mode",this.getSyntax(t)),n==null||n.setOption("readOnly",!!(!V(i)||i.readonly)),this.save()}render(t,e,n){const i=this.container.find(".data-codeblock-content");t=this.getSyntax(t);const r=I('<div style="font-family: monospace;font-size: 13px; line-height: 21px; color: #595959; direction: ltr; height: auto; overflow: hidden;background: transparent;"><pre style="color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);" /></div>');i.append(r);const s=r.find("pre")[0];this.runMode(e||"",t,s,{...this.getConfig(e,t),...n})}save(){const t=this.codeMirror,e=this.editor;if(!V(e)||!t||e.change.isComposing())return;const n=t.getValue(),{onSave:i}=this.options;i&&i(this.mode,n)}focus(){const t=this.codeMirror;!t||t.focus()}select(t=!0){const e=this.codeMirror;if(!!e)if(e.focus(),t)e.setSelection({line:0,ch:0});else{const n=e.lineCount()-1,i=e.getLine(n);e.setSelection({line:n,ch:i.length})}}toHtml(t,e,n="",i=0){i=i||Jn.defaults.tabSize;let r="",s="";for(let o=0;;){const a=e.indexOf("	",o);if(a===-1){s+=e.slice(o),t+=e.length-o;break}else{t+=a-o,s+=e.slice(o,a);const c=i-t%i;t+=c;for(let u=0;u<c;++u)s+=" ";o=a+1}}if(n){let o="";n.split(" ").forEach(c=>{var u;o+=(u=this.styleMap[c])!=null?u:""});const a=`<span ${o?`style="${o}"`:""}>${dt(s)}</span>`;r+=a}else r+=s;return r}runMode(t,e,n,i){const r=Jn.getMode(Jn.defaults,e),s=i&&i.tabSize||Jn.defaults.tabSize,o=n;let a=0;o.innerHTML="";let c="";const u=Jn.splitLines(t),d=i&&i.state||Jn.startState(r);for(let h=0,f=u.length;h<f;++h){h&&(c+="<br />",a=0);const p=new Jn.StringStream(u[h]);for(!p.string&&r.blankLine&&r.blankLine(d);!p.eol();){const g=r.token?r.token(p,d):"";c+=this.toHtml(a,p.current(),g||"",s),p.start=p.pos}}o.innerHTML=c}destroy(){this.container.remove()}}const koe=mt({name:"gf-codeblock-select",components:{ASelect:zs,AOption:zs.Option},props:{modeDatas:Array,defaultValue:String,getContainer:HTMLElement,onSelect:Function},setup(l){return{hangSelect:e=>{l.onSelect&&l.onSelect(e)}}}});function Eoe(l,t,e,n,i,r){const s=pg,o=zs;return oe(),Je(o,{"allow-search":"",size:"small",style:{"min-width":"128px"},"default-value":l.defaultValue,"popup-container":l.getContainer,onChange:l.hangSelect},{default:Be(()=>[(oe(!0),pe(kt,null,Jt(l.modeDatas,a=>(oe(),Je(s,{label:a.name,value:a.value},{default:Be(()=>[Pr(Et(a.name),1)]),_:2},1032,["label","value"]))),256))]),_:1},8,["default-value","popup-container","onChange"])}const Coe=gt(koe,[["render",Eoe]]),Soe=(l,t,e,n)=>{const i=dr(Coe,{modeDatas:t,defaultValue:e,getContainer:l,onSelect:n});return i.mount(l),i};(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("shell",function(){var n={};function i(p,g){for(var m=0;m<g.length;m++)n[g[m]]=p}var r=["true","false"],s=["if","then","do","else","elif","while","until","for","in","esac","fi","fin","fil","done","exit","set","unset","export","function"],o=["ab","awk","bash","beep","cat","cc","cd","chown","chmod","chroot","clear","cp","curl","cut","diff","echo","find","gawk","gcc","get","git","grep","hg","kill","killall","ln","ls","make","mkdir","openssl","mv","nc","nl","node","npm","ping","ps","restart","rm","rmdir","sed","service","sh","shopt","shred","source","sort","sleep","ssh","start","stop","su","sudo","svn","tee","telnet","top","touch","vi","vim","wall","wc","wget","who","write","yes","zsh"];e.registerHelper("hintWords","shell",r.concat(s,o)),i("atom",r),i("keyword",s),i("builtin",o);function a(p,g){if(p.eatSpace())return null;var m=p.sol(),v=p.next();if(v==="\\")return p.next(),null;if(v==="'"||v==='"'||v==="`")return g.tokens.unshift(c(v,v==="`"?"quote":"string")),f(p,g);if(v==="#")return m&&p.eat("!")?(p.skipToEnd(),"meta"):(p.skipToEnd(),"comment");if(v==="$")return g.tokens.unshift(d),f(p,g);if(v==="+"||v==="=")return"operator";if(v==="-")return p.eat("-"),p.eatWhile(/\w/),"attribute";if(v=="<"){if(p.match("<<"))return"operator";var b=p.match(/^<-?\s*['"]?([^'"]*)['"]?/);if(b)return g.tokens.unshift(h(b[1])),"string-2"}if(/\d/.test(v)&&(p.eatWhile(/\d/),p.eol()||!/\w/.test(p.peek())))return"number";p.eatWhile(/[\w-]/);var _=p.current();return p.peek()==="="&&/\w+/.test(_)?"def":n.hasOwnProperty(_)?n[_]:null}function c(p,g){var m=p=="("?")":p=="{"?"}":p;return function(v,b){for(var _,x=!1;(_=v.next())!=null;){if(_===m&&!x){b.tokens.shift();break}else if(_==="$"&&!x&&p!=="'"&&v.peek()!=m){x=!0,v.backUp(1),b.tokens.unshift(d);break}else{if(!x&&p!==m&&_===p)return b.tokens.unshift(c(p,g)),f(v,b);if(!x&&/['"]/.test(_)&&!/['"]/.test(p)){b.tokens.unshift(u(_,"string")),v.backUp(1);break}}x=!x&&_==="\\"}return g}}function u(p,g){return function(m,v){return v.tokens[0]=c(p,g),m.next(),f(m,v)}}var d=function(p,g){g.tokens.length>1&&p.eat("$");var m=p.next();return/['"({]/.test(m)?(g.tokens[0]=c(m,m=="("?"quote":m=="{"?"def":"string"),f(p,g)):(/\d/.test(m)||p.eatWhile(/\w/),g.tokens.shift(),"def")};function h(p){return function(g,m){return g.sol()&&g.string==p&&m.tokens.shift(),g.skipToEnd(),"string-2"}}function f(p,g){return(g.tokens[0]||a)(p,g)}return{startState:function(){return{tokens:[]}},token:function(p,g){return f(p,g)},closeBrackets:"()[]{}''\"\"``",lineComment:"#",fold:"brace"}}),e.defineMIME("text/x-sh","shell"),e.defineMIME("application/x-sh","shell")})})();var yf={exports:{}},_f;function Hl(){return _f||(_f=1,function(l,t){(function(e){e(Ke.exports)})(function(e){function n(k,C,$,z,M,T){this.indented=k,this.column=C,this.type=$,this.info=z,this.align=M,this.prev=T}function i(k,C,$,z){var M=k.indented;return k.context&&k.context.type=="statement"&&$!="statement"&&(M=k.context.indented),k.context=new n(M,C,$,z,null,k.context)}function r(k){var C=k.context.type;return(C==")"||C=="]"||C=="}")&&(k.indented=k.context.indented),k.context=k.context.prev}function s(k,C,$){if(C.prevToken=="variable"||C.prevToken=="type"||/\S(?:[^- ]>|[*\]])\s*$|\*$/.test(k.string.slice(0,$))||C.typeAtEndOfLine&&k.column()==k.indentation())return!0}function o(k){for(;;){if(!k||k.type=="top")return!0;if(k.type=="}"&&k.prev.info!="namespace")return!1;k=k.prev}}e.defineMode("clike",function(k,C){var $=k.indentUnit,z=C.statementIndentUnit||$,M=C.dontAlignCalls,T=C.keywords||{},K=C.types||{},ee=C.builtin||{},Y=C.blockKeywords||{},q=C.defKeywords||{},Z=C.atoms||{},te=C.hooks||{},se=C.multiLineStrings,fe=C.indentStatements!==!1,J=C.indentSwitch!==!1,X=C.namespaceSeparator,ae=C.isPunctuationChar||/[\[\]{}\(\),;\:\.]/,_e=C.numberStart||/[\d\.]/,Me=C.number||/^(?:0x[a-f\d]+|0b[01]+|(?:\d+\.?\d*|\.\d+)(?:e[-+]?\d+)?)(u|ll?|l|f)?/i,ge=C.isOperatorChar||/[+\-*&%=<>!?|\/]/,$e=C.isIdentifierChar||/[\w\$_\xa1-\uffff]/,qe=C.isReservedIdentifier||!1,Ye,wt;function Rt(he,ve){var me=he.next();if(te[me]){var Ce=te[me](he,ve);if(Ce!==!1)return Ce}if(me=='"'||me=="'")return ve.tokenize=Ln(me),ve.tokenize(he,ve);if(_e.test(me)){if(he.backUp(1),he.match(Me))return"number";he.next()}if(ae.test(me))return Ye=me,null;if(me=="/"){if(he.eat("*"))return ve.tokenize=tt,tt(he,ve);if(he.eat("/"))return he.skipToEnd(),"comment"}if(ge.test(me)){for(;!he.match(/^\/[\/*]/,!1)&&he.eat(ge););return"operator"}if(he.eatWhile($e),X)for(;he.match(X);)he.eatWhile($e);var et=he.current();return c(T,et)?(c(Y,et)&&(Ye="newstatement"),c(q,et)&&(wt=!0),"keyword"):c(K,et)?"type":c(ee,et)||qe&&qe(et)?(c(Y,et)&&(Ye="newstatement"),"builtin"):c(Z,et)?"atom":"variable"}function Ln(he){return function(ve,me){for(var Ce=!1,et,Vt=!1;(et=ve.next())!=null;){if(et==he&&!Ce){Vt=!0;break}Ce=!Ce&&et=="\\"}return(Vt||!(Ce||se))&&(me.tokenize=null),"string"}}function tt(he,ve){for(var me=!1,Ce;Ce=he.next();){if(Ce=="/"&&me){ve.tokenize=null;break}me=Ce=="*"}return"comment"}function Le(he,ve){C.typeFirstDefinitions&&he.eol()&&o(ve.context)&&(ve.typeAtEndOfLine=s(he,ve,he.pos))}return{startState:function(he){return{tokenize:null,context:new n((he||0)-$,0,"top",null,!1),indented:0,startOfLine:!0,prevToken:null}},token:function(he,ve){var me=ve.context;if(he.sol()&&(me.align==null&&(me.align=!1),ve.indented=he.indentation(),ve.startOfLine=!0),he.eatSpace())return Le(he,ve),null;Ye=wt=null;var Ce=(ve.tokenize||Rt)(he,ve);if(Ce=="comment"||Ce=="meta")return Ce;if(me.align==null&&(me.align=!0),Ye==";"||Ye==":"||Ye==","&&he.match(/^\s*(?:\/\/.*)?$/,!1))for(;ve.context.type=="statement";)r(ve);else if(Ye=="{")i(ve,he.column(),"}");else if(Ye=="[")i(ve,he.column(),"]");else if(Ye=="(")i(ve,he.column(),")");else if(Ye=="}"){for(;me.type=="statement";)me=r(ve);for(me.type=="}"&&(me=r(ve));me.type=="statement";)me=r(ve)}else Ye==me.type?r(ve):fe&&((me.type=="}"||me.type=="top")&&Ye!=";"||me.type=="statement"&&Ye=="newstatement")&&i(ve,he.column(),"statement",he.current());if(Ce=="variable"&&(ve.prevToken=="def"||C.typeFirstDefinitions&&s(he,ve,he.start)&&o(ve.context)&&he.match(/^\s*\(/,!1))&&(Ce="def"),te.token){var et=te.token(he,ve,Ce);et!==void 0&&(Ce=et)}return Ce=="def"&&C.styleDefs===!1&&(Ce="variable"),ve.startOfLine=!1,ve.prevToken=wt?"def":Ce||Ye,Le(he,ve),Ce},indent:function(he,ve){if(he.tokenize!=Rt&&he.tokenize!=null||he.typeAtEndOfLine)return e.Pass;var me=he.context,Ce=ve&&ve.charAt(0),et=Ce==me.type;if(me.type=="statement"&&Ce=="}"&&(me=me.prev),C.dontIndentStatements)for(;me.type=="statement"&&C.dontIndentStatements.test(me.info);)me=me.prev;if(te.indent){var Vt=te.indent(he,me,ve,$);if(typeof Vt=="number")return Vt}var qi=me.prev&&me.prev.info=="switch";if(C.allmanIndentation&&/[{(]/.test(Ce)){for(;me.type!="top"&&me.type!="}";)me=me.prev;return me.indented}return me.type=="statement"?me.indented+(Ce=="{"?0:z):me.align&&(!M||me.type!=")")?me.column+(et?0:1):me.type==")"&&!et?me.indented+z:me.indented+(et?0:$)+(!et&&qi&&!/^(?:case|default)\b/.test(ve)?$:0)},electricInput:J?/^\s*(?:case .*?:|default:|\{\}?|\})$/:/^\s*[{}]$/,blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",lineComment:"//",fold:"brace"}});function a(k){for(var C={},$=k.split(" "),z=0;z<$.length;++z)C[$[z]]=!0;return C}function c(k,C){return typeof k=="function"?k(C):k.propertyIsEnumerable(C)}var u="auto if break case register continue return default do sizeof static else struct switch extern typedef union for goto while enum const volatile inline restrict asm fortran",d="alignas alignof and and_eq audit axiom bitand bitor catch class compl concept constexpr const_cast decltype delete dynamic_cast explicit export final friend import module mutable namespace new noexcept not not_eq operator or or_eq override private protected public reinterpret_cast requires static_assert static_cast template this thread_local throw try typeid typename using virtual xor xor_eq",h="bycopy byref in inout oneway out self super atomic nonatomic retain copy readwrite readonly strong weak assign typeof nullable nonnull null_resettable _cmd @interface @implementation @end @protocol @encode @property @synthesize @dynamic @class @public @package @private @protected @required @optional @try @catch @finally @import @selector @encode @defs @synchronized @autoreleasepool @compatibility_alias @available",f="FOUNDATION_EXPORT FOUNDATION_EXTERN NS_INLINE NS_FORMAT_FUNCTION  NS_RETURNS_RETAINEDNS_ERROR_ENUM NS_RETURNS_NOT_RETAINED NS_RETURNS_INNER_POINTER NS_DESIGNATED_INITIALIZER NS_ENUM NS_OPTIONS NS_REQUIRES_NIL_TERMINATION NS_ASSUME_NONNULL_BEGIN NS_ASSUME_NONNULL_END NS_SWIFT_NAME NS_REFINED_FOR_SWIFT",p=a("int long char short double float unsigned signed void bool"),g=a("SEL instancetype id Class Protocol BOOL");function m(k){return c(p,k)||/.+_t$/.test(k)}function v(k){return m(k)||c(g,k)}var b="case do else for if switch while struct enum union",_="struct enum union";function x(k,C){if(!C.startOfLine)return!1;for(var $,z=null;$=k.peek();){if($=="\\"&&k.match(/^.$/)){z=x;break}else if($=="/"&&k.match(/^\/[\/\*]/,!1))break;k.next()}return C.tokenize=z,"meta"}function w(k,C){return C.prevToken=="type"?"type":!1}function E(k){return!k||k.length<2||k[0]!="_"?!1:k[1]=="_"||k[1]!==k[1].toLowerCase()}function S(k){return k.eatWhile(/[\w\.']/),"number"}function R(k,C){if(k.backUp(1),k.match(/^(?:R|u8R|uR|UR|LR)/)){var $=k.match(/^"([^\s\\()]{0,16})\(/);return $?(C.cpp11RawStringDelim=$[1],C.tokenize=O,O(k,C)):!1}return k.match(/^(?:u8|u|U|L)/)?k.match(/^["']/,!1)?"string":!1:(k.next(),!1)}function D(k){var C=/(\w+)::~?(\w+)$/.exec(k);return C&&C[1]==C[2]}function P(k,C){for(var $;($=k.next())!=null;)if($=='"'&&!k.eat('"')){C.tokenize=null;break}return"string"}function O(k,C){var $=C.cpp11RawStringDelim.replace(/[^\w\s]/g,"\\$&"),z=k.match(new RegExp(".*?\\)"+$+'"'));return z?C.tokenize=null:k.skipToEnd(),"string"}function L(k,C){typeof k=="string"&&(k=[k]);var $=[];function z(T){if(T)for(var K in T)T.hasOwnProperty(K)&&$.push(K)}z(C.keywords),z(C.types),z(C.builtin),z(C.atoms),$.length&&(C.helperType=k[0],e.registerHelper("hintWords",k[0],$));for(var M=0;M<k.length;++M)e.defineMIME(k[M],C)}L(["text/x-csrc","text/x-c","text/x-chdr"],{name:"clike",keywords:a(u),types:m,blockKeywords:a(b),defKeywords:a(_),typeFirstDefinitions:!0,atoms:a("NULL true false"),isReservedIdentifier:E,hooks:{"#":x,"*":w},modeProps:{fold:["brace","include"]}}),L(["text/x-c++src","text/x-c++hdr"],{name:"clike",keywords:a(u+" "+d),types:m,blockKeywords:a(b+" class try catch"),defKeywords:a(_+" class namespace"),typeFirstDefinitions:!0,atoms:a("true false NULL nullptr"),dontIndentStatements:/^template$/,isIdentifierChar:/[\w\$_~\xa1-\uffff]/,isReservedIdentifier:E,hooks:{"#":x,"*":w,u:R,U:R,L:R,R,0:S,1:S,2:S,3:S,4:S,5:S,6:S,7:S,8:S,9:S,token:function(k,C,$){if($=="variable"&&k.peek()=="("&&(C.prevToken==";"||C.prevToken==null||C.prevToken=="}")&&D(k.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),L("text/x-java",{name:"clike",keywords:a("abstract assert break case catch class const continue default do else enum extends final finally for goto if implements import instanceof interface native new package private protected public return static strictfp super switch synchronized this throw throws transient try volatile while @interface"),types:a("var byte short int long float double boolean char void Boolean Byte Character Double Float Integer Long Number Object Short String StringBuffer StringBuilder Void"),blockKeywords:a("catch class do else finally for if switch try while"),defKeywords:a("class interface enum @interface"),typeFirstDefinitions:!0,atoms:a("true false null"),number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,hooks:{"@":function(k){return k.match("interface",!1)?!1:(k.eatWhile(/[\w\$_]/),"meta")},'"':function(k,C){return k.match(/""$/)?(C.tokenize=B,C.tokenize(k,C)):!1}},modeProps:{fold:["brace","import"]}}),L("text/x-csharp",{name:"clike",keywords:a("abstract as async await base break case catch checked class const continue default delegate do else enum event explicit extern finally fixed for foreach goto if implicit in init interface internal is lock namespace new operator out override params private protected public readonly record ref required return sealed sizeof stackalloc static struct switch this throw try typeof unchecked unsafe using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),types:a("Action Boolean Byte Char DateTime DateTimeOffset Decimal Double Func Guid Int16 Int32 Int64 Object SByte Single String Task TimeSpan UInt16 UInt32 UInt64 bool byte char decimal double short int long object sbyte float string ushort uint ulong"),blockKeywords:a("catch class do else finally for foreach if struct switch try while"),defKeywords:a("class interface namespace record struct var"),typeFirstDefinitions:!0,atoms:a("true false null"),hooks:{"@":function(k,C){return k.eat('"')?(C.tokenize=P,P(k,C)):(k.eatWhile(/[\w\$_]/),"meta")}}});function B(k,C){for(var $=!1;!k.eol();){if(!$&&k.match('"""')){C.tokenize=null;break}$=k.next()=="\\"&&!$}return"string"}function A(k){return function(C,$){for(var z;z=C.next();)if(z=="*"&&C.eat("/"))if(k==1){$.tokenize=null;break}else return $.tokenize=A(k-1),$.tokenize(C,$);else if(z=="/"&&C.eat("*"))return $.tokenize=A(k+1),$.tokenize(C,$);return"comment"}}L("text/x-scala",{name:"clike",keywords:a("abstract case catch class def do else extends final finally for forSome if implicit import lazy match new null object override package private protected return sealed super this throw trait try type val var while with yield _ assert assume require print println printf readLine readBoolean readByte readShort readChar readInt readLong readFloat readDouble"),types:a("AnyVal App Application Array BufferedIterator BigDecimal BigInt Char Console Either Enumeration Equiv Error Exception Fractional Function IndexedSeq Int Integral Iterable Iterator List Map Numeric Nil NotNull Option Ordered Ordering PartialFunction PartialOrdering Product Proxy Range Responder Seq Serializable Set Specializable Stream StringBuilder StringContext Symbol Throwable Traversable TraversableOnce Tuple Unit Vector Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),multiLineStrings:!0,blockKeywords:a("catch class enum do else finally for forSome if match switch try while"),defKeywords:a("class enum def object package trait type val var"),atoms:a("true false null"),indentStatements:!1,indentSwitch:!1,isOperatorChar:/[+\-*&%=<>!?|\/#:@]/,hooks:{"@":function(k){return k.eatWhile(/[\w\$_]/),"meta"},'"':function(k,C){return k.match('""')?(C.tokenize=B,C.tokenize(k,C)):!1},"'":function(k){return k.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},"=":function(k,C){var $=C.context;return $.type=="}"&&$.align&&k.eat(">")?(C.context=new n($.indented,$.column,$.type,$.info,null,$.prev),"operator"):!1},"/":function(k,C){return k.eat("*")?(C.tokenize=A(1),C.tokenize(k,C)):!1}},modeProps:{closeBrackets:{pairs:'()[]{}""',triples:'"'}}});function F(k){return function(C,$){for(var z=!1,M,T=!1;!C.eol();){if(!k&&!z&&C.match('"')){T=!0;break}if(k&&C.match('"""')){T=!0;break}M=C.next(),!z&&M=="$"&&C.match("{")&&C.skipTo("}"),z=!z&&M=="\\"&&!k}return(T||!k)&&($.tokenize=null),"string"}}L("text/x-kotlin",{name:"clike",keywords:a("package as typealias class interface this super val operator var fun for is in This throw return annotation break continue object if else while do try when !in !is as? file import where by get set abstract enum open inner override private public internal protected catch finally out final vararg reified dynamic companion constructor init sealed field property receiver param sparam lateinit data inline noinline tailrec external annotation crossinline const operator infix suspend actual expect setparam value"),types:a("Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void Annotation Any BooleanArray ByteArray Char CharArray DeprecationLevel DoubleArray Enum FloatArray Function Int IntArray Lazy LazyThreadSafetyMode LongArray Nothing ShortArray Unit"),intendSwitch:!1,indentStatements:!1,multiLineStrings:!0,number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+(\.\d+)?|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,blockKeywords:a("catch class do else finally for if where try while enum"),defKeywords:a("class val var object interface fun"),atoms:a("true false null this"),hooks:{"@":function(k){return k.eatWhile(/[\w\$_]/),"meta"},"*":function(k,C){return C.prevToken=="."?"variable":"operator"},'"':function(k,C){return C.tokenize=F(k.match('""')),C.tokenize(k,C)},"/":function(k,C){return k.eat("*")?(C.tokenize=A(1),C.tokenize(k,C)):!1},indent:function(k,C,$,z){var M=$&&$.charAt(0);if((k.prevToken=="}"||k.prevToken==")")&&$=="")return k.indented;if(k.prevToken=="operator"&&$!="}"&&k.context.type!="}"||k.prevToken=="variable"&&M=="."||(k.prevToken=="}"||k.prevToken==")")&&M==".")return z*2+C.indented;if(C.align&&C.type=="}")return C.indented+(k.context.type==($||"").charAt(0)?0:z)}},modeProps:{closeBrackets:{triples:'"'}}}),L(["x-shader/x-vertex","x-shader/x-fragment"],{name:"clike",keywords:a("sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow const attribute uniform varying break continue discard return for while do if else struct in out inout"),types:a("float int bool void vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 mat2 mat3 mat4"),blockKeywords:a("for while do if else struct"),builtin:a("radians degrees sin cos tan asin acos atan pow exp log exp2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize ftransform faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not texture1D texture1DProj texture1DLod texture1DProjLod texture2D texture2DProj texture2DLod texture2DProjLod texture3D texture3DProj texture3DLod texture3DProjLod textureCube textureCubeLod shadow1D shadow2D shadow1DProj shadow2DProj shadow1DLod shadow2DLod shadow1DProjLod shadow2DProjLod dFdx dFdy fwidth noise1 noise2 noise3 noise4"),atoms:a("true false gl_FragColor gl_SecondaryColor gl_Normal gl_Vertex gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_FogCoord gl_PointCoord gl_Position gl_PointSize gl_ClipVertex gl_FrontColor gl_BackColor gl_FrontSecondaryColor gl_BackSecondaryColor gl_TexCoord gl_FogFragCoord gl_FragCoord gl_FrontFacing gl_FragData gl_FragDepth gl_ModelViewMatrix gl_ProjectionMatrix gl_ModelViewProjectionMatrix gl_TextureMatrix gl_NormalMatrix gl_ModelViewMatrixInverse gl_ProjectionMatrixInverse gl_ModelViewProjectionMatrixInverse gl_TextureMatrixTranspose gl_ModelViewMatrixInverseTranspose gl_ProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixInverseTranspose gl_TextureMatrixInverseTranspose gl_NormalScale gl_DepthRange gl_ClipPlane gl_Point gl_FrontMaterial gl_BackMaterial gl_LightSource gl_LightModel gl_FrontLightModelProduct gl_BackLightModelProduct gl_TextureColor gl_EyePlaneS gl_EyePlaneT gl_EyePlaneR gl_EyePlaneQ gl_FogParameters gl_MaxLights gl_MaxClipPlanes gl_MaxTextureUnits gl_MaxTextureCoords gl_MaxVertexAttribs gl_MaxVertexUniformComponents gl_MaxVaryingFloats gl_MaxVertexTextureImageUnits gl_MaxTextureImageUnits gl_MaxFragmentUniformComponents gl_MaxCombineTextureImageUnits gl_MaxDrawBuffers"),indentSwitch:!1,hooks:{"#":x},modeProps:{fold:["brace","include"]}}),L("text/x-nesc",{name:"clike",keywords:a(u+" as atomic async call command component components configuration event generic implementation includes interface module new norace nx_struct nx_union post provides signal task uses abstract extends"),types:m,blockKeywords:a(b),atoms:a("null true false"),hooks:{"#":x},modeProps:{fold:["brace","include"]}}),L("text/x-objectivec",{name:"clike",keywords:a(u+" "+h),types:v,builtin:a(f),blockKeywords:a(b+" @synthesize @try @catch @finally @autoreleasepool @synchronized"),defKeywords:a(_+" @interface @implementation @protocol @class"),dontIndentStatements:/^@.*$/,typeFirstDefinitions:!0,atoms:a("YES NO NULL Nil nil true false nullptr"),isReservedIdentifier:E,hooks:{"#":x,"*":w},modeProps:{fold:["brace","include"]}}),L("text/x-objectivec++",{name:"clike",keywords:a(u+" "+h+" "+d),types:v,builtin:a(f),blockKeywords:a(b+" @synthesize @try @catch @finally @autoreleasepool @synchronized class try catch"),defKeywords:a(_+" @interface @implementation @protocol @class class namespace"),dontIndentStatements:/^@.*$|^template$/,typeFirstDefinitions:!0,atoms:a("YES NO NULL Nil nil true false nullptr"),isReservedIdentifier:E,hooks:{"#":x,"*":w,u:R,U:R,L:R,R,0:S,1:S,2:S,3:S,4:S,5:S,6:S,7:S,8:S,9:S,token:function(k,C,$){if($=="variable"&&k.peek()=="("&&(C.prevToken==";"||C.prevToken==null||C.prevToken=="}")&&D(k.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),L("text/x-squirrel",{name:"clike",keywords:a("base break clone continue const default delete enum extends function in class foreach local resume return this throw typeof yield constructor instanceof static"),types:m,blockKeywords:a("case catch class else for foreach if switch try while"),defKeywords:a("function local class"),typeFirstDefinitions:!0,atoms:a("true false null"),hooks:{"#":x},modeProps:{fold:["brace","include"]}});var W=null;function G(k){return function(C,$){for(var z=!1,M,T=!1;!C.eol();){if(!z&&C.match('"')&&(k=="single"||C.match('""'))){T=!0;break}if(!z&&C.match("``")){W=G(k),T=!0;break}M=C.next(),z=k=="single"&&!z&&M=="\\"}return T&&($.tokenize=null),"string"}}L("text/x-ceylon",{name:"clike",keywords:a("abstracts alias assembly assert assign break case catch class continue dynamic else exists extends finally for function given if import in interface is let module new nonempty object of out outer package return satisfies super switch then this throw try value void while"),types:function(k){var C=k.charAt(0);return C===C.toUpperCase()&&C!==C.toLowerCase()},blockKeywords:a("case catch class dynamic else finally for function if interface module new object switch try while"),defKeywords:a("class dynamic function interface module object package value"),builtin:a("abstract actual aliased annotation by default deprecated doc final formal late license native optional sealed see serializable shared suppressWarnings tagged throws variable"),isPunctuationChar:/[\[\]{}\(\),;\:\.`]/,isOperatorChar:/[+\-*&%=<>!?|^~:\/]/,numberStart:/[\d#$]/,number:/^(?:#[\da-fA-F_]+|\$[01_]+|[\d_]+[kMGTPmunpf]?|[\d_]+\.[\d_]+(?:[eE][-+]?\d+|[kMGTPmunpf]|)|)/i,multiLineStrings:!0,typeFirstDefinitions:!0,atoms:a("true false null larger smaller equal empty finished"),indentSwitch:!1,styleDefs:!1,hooks:{"@":function(k){return k.eatWhile(/[\w\$_]/),"meta"},'"':function(k,C){return C.tokenize=G(k.match('""')?"triple":"single"),C.tokenize(k,C)},"`":function(k,C){return!W||!k.match("`")?!1:(C.tokenize=W,W=null,C.tokenize(k,C))},"'":function(k){return k.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},token:function(k,C,$){if(($=="variable"||$=="type")&&C.prevToken==".")return"variable-2"}},modeProps:{fold:["brace","import"],closeBrackets:{triples:'"'}}})})}()),yf.exports}Hl();(function(l,t){(function(e){e(Ke.exports,Hl())})(function(e){var n="this super static final const abstract class extends external factory implements mixin get native set typedef with enum throw rethrow assert break case continue default in return new deferred async await covariant try catch finally do else for if switch while import library export part of show hide is as extension on yield late required".split(" "),i="try catch finally do else for if switch while".split(" "),r="true false null".split(" "),s="void bool num int double dynamic var String Null Never".split(" ");function o(g){for(var m={},v=0;v<g.length;++v)m[g[v]]=!0;return m}function a(g){(g.interpolationStack||(g.interpolationStack=[])).push(g.tokenize)}function c(g){return(g.interpolationStack||(g.interpolationStack=[])).pop()}function u(g){return g.interpolationStack?g.interpolationStack.length:0}e.defineMIME("application/dart",{name:"clike",keywords:o(n),blockKeywords:o(i),builtin:o(s),atoms:o(r),hooks:{"@":function(g){return g.eatWhile(/[\w\$_\.]/),"meta"},"'":function(g,m){return d("'",g,m,!1)},'"':function(g,m){return d('"',g,m,!1)},r:function(g,m){var v=g.peek();return v=="'"||v=='"'?d(g.next(),g,m,!0):!1},"}":function(g,m){return u(m)>0?(m.tokenize=c(m),null):!1},"/":function(g,m){return g.eat("*")?(m.tokenize=p(1),m.tokenize(g,m)):!1},token:function(g,m,v){if(v=="variable"){var b=RegExp("^[_$]*[A-Z][a-zA-Z0-9_$]*$","g");if(b.test(g.current()))return"variable-2"}}}});function d(g,m,v,b){var _=!1;if(m.eat(g))if(m.eat(g))_=!0;else return"string";function x(w,E){for(var S=!1;!w.eol();){if(!b&&!S&&w.peek()=="$")return a(E),E.tokenize=h,"string";var R=w.next();if(R==g&&!S&&(!_||w.match(g+g))){E.tokenize=null;break}S=!b&&!S&&R=="\\"}return"string"}return v.tokenize=x,x(m,v)}function h(g,m){return g.eat("$"),g.eat("{")?m.tokenize=null:m.tokenize=f,null}function f(g,m){return g.eatWhile(/[\w_]/),m.tokenize=c(m),"variable"}function p(g){return function(m,v){for(var b;b=m.next();)if(b=="*"&&m.eat("/"))if(g==1){v.tokenize=null;break}else return v.tokenize=p(g-1),v.tokenize(m,v);else if(b=="/"&&m.eat("*"))return v.tokenize=p(g+1),v.tokenize(m,v);return"comment"}}e.registerHelper("hintWords","application/dart",n.concat(r).concat(s)),e.defineMode("dart",function(g){return e.getMode(g,"application/dart")},"clike")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("diff",function(){var n={"+":"positive","-":"negative","@":"meta"};return{token:function(i){var r=i.string.search(/[\t ]+?$/);if(!i.sol()||r===0)return i.skipToEnd(),("error "+(n[i.string.charAt(0)]||"")).replace(/ $/,"");var s=n[i.peek()]||i.skipToEnd();return r===-1?i.skipToEnd():i.pos=r,s}}}),e.defineMIME("text/x-diff","diff")})})();var wf={exports:{}},xf;function Lp(){return xf||(xf=1,function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineSimpleMode=function(h,f){e.defineMode(h,function(p){return e.simpleMode(p,f)})},e.simpleMode=function(h,f){n(f,"start");var p={},g=f.meta||{},m=!1;for(var v in f)if(v!=g&&f.hasOwnProperty(v))for(var b=p[v]=[],_=f[v],x=0;x<_.length;x++){var w=_[x];b.push(new s(w,f)),(w.indent||w.dedent)&&(m=!0)}var E={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:m?[]:null}},copyState:function(R){var D={state:R.state,pending:R.pending,local:R.local,localState:null,indent:R.indent&&R.indent.slice(0)};R.localState&&(D.localState=e.copyState(R.local.mode,R.localState)),R.stack&&(D.stack=R.stack.slice(0));for(var P=R.persistentStates;P;P=P.next)D.persistentStates={mode:P.mode,spec:P.spec,state:P.state==R.localState?D.localState:e.copyState(P.mode,P.state),next:D.persistentStates};return D},token:o(p,h),innerMode:function(R){return R.local&&{mode:R.local.mode,state:R.localState}},indent:d(p,g)};if(g)for(var S in g)g.hasOwnProperty(S)&&(E[S]=g[S]);return E};function n(h,f){if(!h.hasOwnProperty(f))throw new Error("Undefined state "+f+" in simple mode")}function i(h,f){if(!h)return/(?:)/;var p="";return h instanceof RegExp?(h.ignoreCase&&(p="i"),h.unicode&&(p+="u"),h=h.source):h=String(h),new RegExp((f===!1?"":"^")+"(?:"+h+")",p)}function r(h){if(!h)return null;if(h.apply)return h;if(typeof h=="string")return h.replace(/\./g," ");for(var f=[],p=0;p<h.length;p++)f.push(h[p]&&h[p].replace(/\./g," "));return f}function s(h,f){(h.next||h.push)&&n(f,h.next||h.push),this.regex=i(h.regex),this.token=r(h.token),this.data=h}function o(h,f){return function(p,g){if(g.pending){var m=g.pending.shift();return g.pending.length==0&&(g.pending=null),p.pos+=m.text.length,m.token}if(g.local)if(g.local.end&&p.match(g.local.end)){var v=g.local.endToken||null;return g.local=g.localState=null,v}else{var v=g.local.mode.token(p,g.localState),b;return g.local.endScan&&(b=g.local.endScan.exec(p.current()))&&(p.pos=p.start+b.index),v}for(var _=h[g.state],x=0;x<_.length;x++){var w=_[x],E=(!w.data.sol||p.sol())&&p.match(w.regex);if(E){w.data.next?g.state=w.data.next:w.data.push?((g.stack||(g.stack=[])).push(g.state),g.state=w.data.push):w.data.pop&&g.stack&&g.stack.length&&(g.state=g.stack.pop()),w.data.mode&&c(f,g,w.data.mode,w.token),w.data.indent&&g.indent.push(p.indentation()+f.indentUnit),w.data.dedent&&g.indent.pop();var S=w.token;if(S&&S.apply&&(S=S(E)),E.length>2&&w.token&&typeof w.token!="string"){for(var R=2;R<E.length;R++)E[R]&&(g.pending||(g.pending=[])).push({text:E[R],token:w.token[R-1]});return p.backUp(E[0].length-(E[1]?E[1].length:0)),S[0]}else return S&&S.join?S[0]:S}}return p.next(),null}}function a(h,f){if(h===f)return!0;if(!h||typeof h!="object"||!f||typeof f!="object")return!1;var p=0;for(var g in h)if(h.hasOwnProperty(g)){if(!f.hasOwnProperty(g)||!a(h[g],f[g]))return!1;p++}for(var g in f)f.hasOwnProperty(g)&&p--;return p==0}function c(h,f,p,g){var m;if(p.persistent)for(var v=f.persistentStates;v&&!m;v=v.next)(p.spec?a(p.spec,v.spec):p.mode==v.mode)&&(m=v);var b=m?m.mode:p.mode||e.getMode(h,p.spec),_=m?m.state:e.startState(b);p.persistent&&!m&&(f.persistentStates={mode:b,spec:p.spec,state:_,next:f.persistentStates}),f.localState=_,f.local={mode:b,end:p.end&&i(p.end),endScan:p.end&&p.forceEnd!==!1&&i(p.end,!1),endToken:g&&g.join?g[g.length-1]:g}}function u(h,f){for(var p=0;p<f.length;p++)if(f[p]===h)return!0}function d(h,f){return function(p,g,m){if(p.local&&p.local.mode.indent)return p.local.mode.indent(p.localState,g,m);if(p.indent==null||p.local||f.dontIndentStates&&u(p.state,f.dontIndentStates)>-1)return e.Pass;var v=p.indent.length-1,b=h[p.state];e:for(;;){for(var _=0;_<b.length;_++){var x=b[_];if(x.data.dedent&&x.data.dedentIfLineStart!==!1){var w=x.regex.exec(g);if(w&&w[0]){v--,(x.next||x.push)&&(b=h[x.next||x.push]),g=g.slice(w[0].length);continue e}}}break}return v<0?0:p.indent[v]}}})}()),wf.exports}(function(l,t){(function(e){e(Ke.exports,Lp())})(function(e){var n="from",i=new RegExp("^(\\s*)\\b("+n+")\\b","i"),r=["run","cmd","entrypoint","shell"],s=new RegExp("^(\\s*)("+r.join("|")+")(\\s+\\[)","i"),o="expose",a=new RegExp("^(\\s*)("+o+")(\\s+)","i"),c=["arg","from","maintainer","label","env","add","copy","volume","user","workdir","onbuild","stopsignal","healthcheck","shell"],u=[n,o].concat(r).concat(c),d="("+u.join("|")+")",h=new RegExp("^(\\s*)"+d+"(\\s*)(#.*)?$","i"),f=new RegExp("^(\\s*)"+d+"(\\s+)","i");e.defineSimpleMode("dockerfile",{start:[{regex:/^\s*#.*$/,sol:!0,token:"comment"},{regex:i,token:[null,"keyword"],sol:!0,next:"from"},{regex:h,token:[null,"keyword",null,"error"],sol:!0},{regex:s,token:[null,"keyword",null],sol:!0,next:"array"},{regex:a,token:[null,"keyword",null],sol:!0,next:"expose"},{regex:f,token:[null,"keyword",null],sol:!0,next:"arguments"},{regex:/./,token:null}],from:[{regex:/\s*$/,token:null,next:"start"},{regex:/(\s*)(#.*)$/,token:[null,"error"],next:"start"},{regex:/(\s*\S+\s+)(as)/i,token:[null,"keyword"],next:"start"},{token:null,next:"start"}],single:[{regex:/(?:[^\\']|\\.)/,token:"string"},{regex:/'/,token:"string",pop:!0}],double:[{regex:/(?:[^\\"]|\\.)/,token:"string"},{regex:/"/,token:"string",pop:!0}],array:[{regex:/\]/,token:null,next:"start"},{regex:/"(?:[^\\"]|\\.)*"?/,token:"string"}],expose:[{regex:/\d+$/,token:"number",next:"start"},{regex:/[^\d]+$/,token:null,next:"start"},{regex:/\d+/,token:"number"},{regex:/[^\d]+/,token:null},{token:null,next:"start"}],arguments:[{regex:/^\s*#.*$/,sol:!0,token:"comment"},{regex:/"(?:[^\\"]|\\.)*"?$/,token:"string",next:"start"},{regex:/"/,token:"string",push:"double"},{regex:/'(?:[^\\']|\\.)*'?$/,token:"string",next:"start"},{regex:/'/,token:"string",push:"single"},{regex:/[^#"']+[\\`]$/,token:null},{regex:/[^#"']+$/,token:null,next:"start"},{regex:/[^#"']+/,token:null},{token:null,next:"start"}],meta:{lineComment:"#"}}),e.defineMIME("text/x-dockerfile","dockerfile")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMIME("text/x-erlang","erlang"),e.defineMode("erlang",function(n){var i=["-type","-spec","-export_type","-opaque"],r=["after","begin","catch","case","cond","end","fun","if","let","of","query","receive","try","when"],s=/[\->,;]/,o=["->",";",","],a=["and","andalso","band","bnot","bor","bsl","bsr","bxor","div","not","or","orelse","rem","xor"],c=/[\+\-\*\/<>=\|:!]/,u=["=","+","-","*","/",">",">=","<","=<","=:=","==","=/=","/=","||","<-","!"],d=/[<\(\[\{]/,h=["<<","(","[","{"],f=/[>\)\]\}]/,p=["}","]",")",">>"],g=["is_atom","is_binary","is_bitstring","is_boolean","is_float","is_function","is_integer","is_list","is_number","is_pid","is_port","is_record","is_reference","is_tuple","atom","binary","bitstring","boolean","function","integer","list","number","pid","port","record","reference","tuple"],m=["abs","adler32","adler32_combine","alive","apply","atom_to_binary","atom_to_list","binary_to_atom","binary_to_existing_atom","binary_to_list","binary_to_term","bit_size","bitstring_to_list","byte_size","check_process_code","contact_binary","crc32","crc32_combine","date","decode_packet","delete_module","disconnect_node","element","erase","exit","float","float_to_list","garbage_collect","get","get_keys","group_leader","halt","hd","integer_to_list","internal_bif","iolist_size","iolist_to_binary","is_alive","is_atom","is_binary","is_bitstring","is_boolean","is_float","is_function","is_integer","is_list","is_number","is_pid","is_port","is_process_alive","is_record","is_reference","is_tuple","length","link","list_to_atom","list_to_binary","list_to_bitstring","list_to_existing_atom","list_to_float","list_to_integer","list_to_pid","list_to_tuple","load_module","make_ref","module_loaded","monitor_node","node","node_link","node_unlink","nodes","notalive","now","open_port","pid_to_list","port_close","port_command","port_connect","port_control","pre_loaded","process_flag","process_info","processes","purge_module","put","register","registered","round","self","setelement","size","spawn","spawn_link","spawn_monitor","spawn_opt","split_binary","statistics","term_to_binary","time","throw","tl","trunc","tuple_size","tuple_to_list","unlink","unregister","whereis"],v=/[\w@Ø-ÞÀ-Öß-öø-ÿ]/,b=/[0-7]{1,3}|[bdefnrstv\\"']|\^[a-zA-Z]|x[0-9a-zA-Z]{2}|x{[0-9a-zA-Z]+}/;function _(q,Z){if(Z.in_string)return Z.in_string=!E(q),O(Z,q,"string");if(Z.in_atom)return Z.in_atom=!S(q),O(Z,q,"atom");if(q.eatSpace())return O(Z,q,"whitespace");if(!F(Z)&&q.match(/-\s*[a-zß-öø-ÿ][\wØ-ÞÀ-Öß-öø-ÿ]*/))return P(q.current(),i)?O(Z,q,"type"):O(Z,q,"attribute");var te=q.next();if(te=="%")return q.skipToEnd(),O(Z,q,"comment");if(te==":")return O(Z,q,"colon");if(te=="?")return q.eatSpace(),q.eatWhile(v),O(Z,q,"macro");if(te=="#")return q.eatSpace(),q.eatWhile(v),O(Z,q,"record");if(te=="$")return q.next()=="\\"&&!q.match(b)?O(Z,q,"error"):O(Z,q,"number");if(te==".")return O(Z,q,"dot");if(te=="'"){if(!(Z.in_atom=!S(q))){if(q.match(/\s*\/\s*[0-9]/,!1))return q.match(/\s*\/\s*[0-9]/,!0),O(Z,q,"fun");if(q.match(/\s*\(/,!1)||q.match(/\s*:/,!1))return O(Z,q,"function")}return O(Z,q,"atom")}if(te=='"')return Z.in_string=!E(q),O(Z,q,"string");if(/[A-Z_Ø-ÞÀ-Ö]/.test(te))return q.eatWhile(v),O(Z,q,"variable");if(/[a-z_ß-öø-ÿ]/.test(te)){if(q.eatWhile(v),q.match(/\s*\/\s*[0-9]/,!1))return q.match(/\s*\/\s*[0-9]/,!0),O(Z,q,"fun");var se=q.current();return P(se,r)?O(Z,q,"keyword"):P(se,a)?O(Z,q,"operator"):q.match(/\s*\(/,!1)?P(se,m)&&(F(Z).token!=":"||F(Z,2).token=="erlang")?O(Z,q,"builtin"):P(se,g)?O(Z,q,"guard"):O(Z,q,"function"):D(q)==":"?se=="erlang"?O(Z,q,"builtin"):O(Z,q,"function"):P(se,["true","false"])?O(Z,q,"boolean"):O(Z,q,"atom")}var fe=/[0-9]/,J=/[0-9a-zA-Z]/;return fe.test(te)?(q.eatWhile(fe),q.eat("#")?q.eatWhile(J)||q.backUp(1):q.eat(".")&&(q.eatWhile(fe)?q.eat(/[eE]/)&&(q.eat(/[-+]/)?q.eatWhile(fe)||q.backUp(2):q.eatWhile(fe)||q.backUp(1)):q.backUp(1)),O(Z,q,"number")):x(q,d,h)?O(Z,q,"open_paren"):x(q,f,p)?O(Z,q,"close_paren"):w(q,s,o)?O(Z,q,"separator"):w(q,c,u)?O(Z,q,"operator"):O(Z,q,null)}function x(q,Z,te){if(q.current().length==1&&Z.test(q.current())){for(q.backUp(1);Z.test(q.peek());)if(q.next(),P(q.current(),te))return!0;q.backUp(q.current().length-1)}return!1}function w(q,Z,te){if(q.current().length==1&&Z.test(q.current())){for(;Z.test(q.peek());)q.next();for(;0<q.current().length;){if(P(q.current(),te))return!0;q.backUp(1)}q.next()}return!1}function E(q){return R(q,'"',"\\")}function S(q){return R(q,"'","\\")}function R(q,Z,te){for(;!q.eol();){var se=q.next();if(se==Z)return!0;se==te&&q.next()}return!1}function D(q){var Z=q.match(/^\s*([^\s%])/,!1);return Z?Z[1]:""}function P(q,Z){return-1<Z.indexOf(q)}function O(q,Z,te){switch(W(q,B(te,Z)),te){case"atom":return"atom";case"attribute":return"attribute";case"boolean":return"atom";case"builtin":return"builtin";case"close_paren":return null;case"colon":return null;case"comment":return"comment";case"dot":return null;case"error":return"error";case"fun":return"meta";case"function":return"tag";case"guard":return"property";case"keyword":return"keyword";case"macro":return"variable-2";case"number":return"number";case"open_paren":return null;case"operator":return"operator";case"record":return"bracket";case"separator":return null;case"string":return"string";case"type":return"def";case"variable":return"variable";default:return null}}function L(q,Z,te,se){return{token:q,column:Z,indent:te,type:se}}function B(q,Z){return L(Z.current(),Z.column(),Z.indentation(),q)}function A(q){return L(q,0,0,q)}function F(q,Z){var te=q.tokenStack.length,se=Z||1;return te<se?!1:q.tokenStack[te-se]}function W(q,Z){Z.type=="comment"||Z.type=="whitespace"||(q.tokenStack=G(q.tokenStack,Z),q.tokenStack=k(q.tokenStack))}function G(q,Z){var te=q.length-1;return 0<te&&q[te].type==="record"&&Z.type==="dot"?q.pop():(0<te&&q[te].type==="group"&&q.pop(),q.push(Z)),q}function k(q){if(!q.length)return q;var Z=q.length-1;if(q[Z].type==="dot")return[];if(Z>1&&q[Z].type==="fun"&&q[Z-1].token==="fun")return q.slice(0,Z-1);switch(q[Z].token){case"}":return C(q,{g:["{"]});case"]":return C(q,{i:["["]});case")":return C(q,{i:["("]});case">>":return C(q,{i:["<<"]});case"end":return C(q,{i:["begin","case","fun","if","receive","try"]});case",":return C(q,{e:["begin","try","when","->",",","(","[","{","<<"]});case"->":return C(q,{r:["when"],m:["try","if","case","receive"]});case";":return C(q,{E:["case","fun","if","receive","try","when"]});case"catch":return C(q,{e:["try"]});case"of":return C(q,{e:["case"]});case"after":return C(q,{e:["receive","try"]});default:return q}}function C(q,Z){for(var te in Z)for(var se=q.length-1,fe=Z[te],J=se-1;-1<J;J--)if(P(q[J].token,fe)){var X=q.slice(0,J);switch(te){case"m":return X.concat(q[J]).concat(q[se]);case"r":return X.concat(q[se]);case"i":return X;case"g":return X.concat(A("group"));case"E":return X.concat(q[J]);case"e":return X.concat(q[J])}}return te=="E"?[]:q}function $(q,Z){var te,se=n.indentUnit,fe=z(Z),J=F(q,1),X=F(q,2);return q.in_string||q.in_atom?e.Pass:X?J.token=="when"?J.column+se:fe==="when"&&X.type==="function"?X.indent+se:fe==="("&&J.token==="fun"?J.column+3:fe==="catch"&&(te=K(q,["try"]))?te.column:P(fe,["end","after","of"])?(te=K(q,["begin","case","fun","if","receive","try"]),te?te.column:e.Pass):P(fe,p)?(te=K(q,h),te?te.column:e.Pass):P(J.token,[",","|","||"])||P(fe,[",","|","||"])?(te=M(q),te?te.column+te.token.length:se):J.token=="->"?P(X.token,["receive","case","if","try"])?X.column+se+se:X.column+se:P(J.token,h)?J.column+J.token.length:(te=T(q),Y(te)?te.column+se:0):0}function z(q){var Z=q.match(/,|[a-z]+|\}|\]|\)|>>|\|+|\(/);return Y(Z)&&Z.index===0?Z[0]:""}function M(q){var Z=q.tokenStack.slice(0,-1),te=ee(Z,"type",["open_paren"]);return Y(Z[te])?Z[te]:!1}function T(q){var Z=q.tokenStack,te=ee(Z,"type",["open_paren","separator","keyword"]),se=ee(Z,"type",["operator"]);return Y(te)&&Y(se)&&te<se?Z[te+1]:Y(te)?Z[te]:!1}function K(q,Z){var te=q.tokenStack,se=ee(te,"token",Z);return Y(te[se])?te[se]:!1}function ee(q,Z,te){for(var se=q.length-1;-1<se;se--)if(P(q[se][Z],te))return se;return!1}function Y(q){return q!==!1&&q!=null}return{startState:function(){return{tokenStack:[],in_string:!1,in_atom:!1}},token:function(q,Z){return _(q,Z)},indent:function(q,Z){return $(q,Z)},lineComment:"%"}})})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("go",function(n){var i=n.indentUnit,r={break:!0,case:!0,chan:!0,const:!0,continue:!0,default:!0,defer:!0,else:!0,fallthrough:!0,for:!0,func:!0,go:!0,goto:!0,if:!0,import:!0,interface:!0,map:!0,package:!0,range:!0,return:!0,select:!0,struct:!0,switch:!0,type:!0,var:!0,bool:!0,byte:!0,complex64:!0,complex128:!0,float32:!0,float64:!0,int8:!0,int16:!0,int32:!0,int64:!0,string:!0,uint8:!0,uint16:!0,uint32:!0,uint64:!0,int:!0,uint:!0,uintptr:!0,error:!0,rune:!0,any:!0,comparable:!0},s={true:!0,false:!0,iota:!0,nil:!0,append:!0,cap:!0,close:!0,complex:!0,copy:!0,delete:!0,imag:!0,len:!0,make:!0,new:!0,panic:!0,print:!0,println:!0,real:!0,recover:!0},o=/[+\-*&^%:=<>!|\/]/,a;function c(g,m){var v=g.next();if(v=='"'||v=="'"||v=="`")return m.tokenize=u(v),m.tokenize(g,m);if(/[\d\.]/.test(v))return v=="."?g.match(/^[0-9]+([eE][\-+]?[0-9]+)?/):v=="0"?g.match(/^[xX][0-9a-fA-F]+/)||g.match(/^0[0-7]+/):g.match(/^[0-9]*\.?[0-9]*([eE][\-+]?[0-9]+)?/),"number";if(/[\[\]{}\(\),;\:\.]/.test(v))return a=v,null;if(v=="/"){if(g.eat("*"))return m.tokenize=d,d(g,m);if(g.eat("/"))return g.skipToEnd(),"comment"}if(o.test(v))return g.eatWhile(o),"operator";g.eatWhile(/[\w\$_\xa1-\uffff]/);var b=g.current();return r.propertyIsEnumerable(b)?((b=="case"||b=="default")&&(a="case"),"keyword"):s.propertyIsEnumerable(b)?"atom":"variable"}function u(g){return function(m,v){for(var b=!1,_,x=!1;(_=m.next())!=null;){if(_==g&&!b){x=!0;break}b=!b&&g!="`"&&_=="\\"}return(x||!(b||g=="`"))&&(v.tokenize=c),"string"}}function d(g,m){for(var v=!1,b;b=g.next();){if(b=="/"&&v){m.tokenize=c;break}v=b=="*"}return"comment"}function h(g,m,v,b,_){this.indented=g,this.column=m,this.type=v,this.align=b,this.prev=_}function f(g,m,v){return g.context=new h(g.indented,m,v,null,g.context)}function p(g){if(!!g.context.prev){var m=g.context.type;return(m==")"||m=="]"||m=="}")&&(g.indented=g.context.indented),g.context=g.context.prev}}return{startState:function(g){return{tokenize:null,context:new h((g||0)-i,0,"top",!1),indented:0,startOfLine:!0}},token:function(g,m){var v=m.context;if(g.sol()&&(v.align==null&&(v.align=!1),m.indented=g.indentation(),m.startOfLine=!0,v.type=="case"&&(v.type="}")),g.eatSpace())return null;a=null;var b=(m.tokenize||c)(g,m);return b=="comment"||(v.align==null&&(v.align=!0),a=="{"?f(m,g.column(),"}"):a=="["?f(m,g.column(),"]"):a=="("?f(m,g.column(),")"):a=="case"?v.type="case":(a=="}"&&v.type=="}"||a==v.type)&&p(m),m.startOfLine=!1),b},indent:function(g,m){if(g.tokenize!=c&&g.tokenize!=null)return e.Pass;var v=g.context,b=m&&m.charAt(0);if(v.type=="case"&&/^(?:case|default)\b/.test(m))return g.context.type="}",v.indented;var _=b==v.type;return v.align?v.column+(_?0:1):v.indented+(_?0:i)},electricChars:"{}):",closeBrackets:"()[]{}''\"\"``",fold:"brace",blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//"}}),e.defineMIME("text/x-go","go")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("groovy",function(n){function i(_){for(var x={},w=_.split(" "),E=0;E<w.length;++E)x[w[E]]=!0;return x}var r=i("abstract as assert boolean break byte case catch char class const continue def default do double else enum extends final finally float for goto if implements import in instanceof int interface long native new package private protected public return short static strictfp super switch synchronized threadsafe throw throws trait transient try void volatile while"),s=i("catch class def do else enum finally for if interface switch trait try while"),o=i("return break continue"),a=i("null true false this"),c;function u(_,x){var w=_.next();if(w=='"'||w=="'")return d(w,_,x);if(/[\[\]{}\(\),;\:\.]/.test(w))return c=w,null;if(/\d/.test(w))return _.eatWhile(/[\w\.]/),_.eat(/eE/)&&(_.eat(/\+\-/),_.eatWhile(/\d/)),"number";if(w=="/"){if(_.eat("*"))return x.tokenize.push(p),p(_,x);if(_.eat("/"))return _.skipToEnd(),"comment";if(g(x.lastToken,!1))return d(w,_,x)}if(w=="-"&&_.eat(">"))return c="->",null;if(/[+\-*&%=<>!?|\/~]/.test(w))return _.eatWhile(/[+\-*&%=<>|~]/),"operator";if(_.eatWhile(/[\w\$_]/),w=="@")return _.eatWhile(/[\w\$_\.]/),"meta";if(x.lastToken==".")return"property";if(_.eat(":"))return c="proplabel","property";var E=_.current();return a.propertyIsEnumerable(E)?"atom":r.propertyIsEnumerable(E)?(s.propertyIsEnumerable(E)?c="newstatement":o.propertyIsEnumerable(E)&&(c="standalone"),"keyword"):"variable"}u.isBase=!0;function d(_,x,w){var E=!1;if(_!="/"&&x.eat(_))if(x.eat(_))E=!0;else return"string";function S(R,D){for(var P=!1,O,L=!E;(O=R.next())!=null;){if(O==_&&!P){if(!E)break;if(R.match(_+_)){L=!0;break}}if(_=='"'&&O=="$"&&!P){if(R.eat("{"))return D.tokenize.push(h()),"string";if(R.match(/^\w/,!1))return D.tokenize.push(f),"string"}P=!P&&O=="\\"}return L&&D.tokenize.pop(),"string"}return w.tokenize.push(S),S(x,w)}function h(){var _=1;function x(w,E){if(w.peek()=="}"){if(_--,_==0)return E.tokenize.pop(),E.tokenize[E.tokenize.length-1](w,E)}else w.peek()=="{"&&_++;return u(w,E)}return x.isBase=!0,x}function f(_,x){var w=_.match(/^(\.|[\w\$_]+)/);return w?w[0]=="."?null:"variable":(x.tokenize.pop(),x.tokenize[x.tokenize.length-1](_,x))}function p(_,x){for(var w=!1,E;E=_.next();){if(E=="/"&&w){x.tokenize.pop();break}w=E=="*"}return"comment"}function g(_,x){return!_||_=="operator"||_=="->"||/[\.\[\{\(,;:]/.test(_)||_=="newstatement"||_=="keyword"||_=="proplabel"||_=="standalone"&&!x}function m(_,x,w,E,S){this.indented=_,this.column=x,this.type=w,this.align=E,this.prev=S}function v(_,x,w){return _.context=new m(_.indented,x,w,null,_.context)}function b(_){var x=_.context.type;return(x==")"||x=="]"||x=="}")&&(_.indented=_.context.indented),_.context=_.context.prev}return{startState:function(_){return{tokenize:[u],context:new m((_||0)-n.indentUnit,0,"top",!1),indented:0,startOfLine:!0,lastToken:null}},token:function(_,x){var w=x.context;if(_.sol()&&(w.align==null&&(w.align=!1),x.indented=_.indentation(),x.startOfLine=!0,w.type=="statement"&&!g(x.lastToken,!0)&&(b(x),w=x.context)),_.eatSpace())return null;c=null;var E=x.tokenize[x.tokenize.length-1](_,x);if(E=="comment")return E;if(w.align==null&&(w.align=!0),(c==";"||c==":")&&w.type=="statement")b(x);else if(c=="->"&&w.type=="statement"&&w.prev.type=="}")b(x),x.context.align=!1;else if(c=="{")v(x,_.column(),"}");else if(c=="[")v(x,_.column(),"]");else if(c=="(")v(x,_.column(),")");else if(c=="}"){for(;w.type=="statement";)w=b(x);for(w.type=="}"&&(w=b(x));w.type=="statement";)w=b(x)}else c==w.type?b(x):(w.type=="}"||w.type=="top"||w.type=="statement"&&c=="newstatement")&&v(x,_.column(),"statement");return x.startOfLine=!1,x.lastToken=c||E,E},indent:function(_,x){if(!_.tokenize[_.tokenize.length-1].isBase)return e.Pass;var w=x&&x.charAt(0),E=_.context;E.type=="statement"&&!g(_.lastToken,!0)&&(E=E.prev);var S=w==E.type;return E.type=="statement"?E.indented+(w=="{"?0:n.indentUnit):E.align?E.column+(S?0:1):E.indented+(S?0:n.indentUnit)},electricChars:"{}",closeBrackets:{triples:`'"`},fold:"brace",blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//"}}),e.defineMIME("text/x-groovy","groovy")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("http",function(){function n(d,h){return d.skipToEnd(),h.cur=c,"error"}function i(d,h){return d.match(/^HTTP\/\d\.\d/)?(h.cur=r,"keyword"):d.match(/^[A-Z]+/)&&/[ \t]/.test(d.peek())?(h.cur=o,"keyword"):n(d,h)}function r(d,h){var f=d.match(/^\d+/);if(!f)return n(d,h);h.cur=s;var p=Number(f[0]);return p>=100&&p<200?"positive informational":p>=200&&p<300?"positive success":p>=300&&p<400?"positive redirect":p>=400&&p<500?"negative client-error":p>=500&&p<600?"negative server-error":"error"}function s(d,h){return d.skipToEnd(),h.cur=c,null}function o(d,h){return d.eatWhile(/\S/),h.cur=a,"string-2"}function a(d,h){return d.match(/^HTTP\/\d\.\d$/)?(h.cur=c,"keyword"):n(d,h)}function c(d){return d.sol()&&!d.eat(/[ \t]/)?d.match(/^.*?:/)?"atom":(d.skipToEnd(),"error"):(d.skipToEnd(),"string")}function u(d){return d.skipToEnd(),null}return{token:function(d,h){var f=h.cur;return f!=c&&f!=u&&d.eatSpace()?null:f(d,h)},blankLine:function(d){d.cur=u},startState:function(){return{cur:i}}}}),e.defineMIME("message/http","http")})})();(function(l,t){(function(e){e(Ke.exports,sl(),Vg())})(function(e){function n(r,s,o,a){this.state=r,this.mode=s,this.depth=o,this.prev=a}function i(r){return new n(e.copyState(r.mode,r.state),r.mode,r.depth,r.prev&&i(r.prev))}e.defineMode("jsx",function(r,s){var o=e.getMode(r,{name:"xml",allowMissing:!0,multilineTagIndentPastTag:!1,allowMissingTagName:!0}),a=e.getMode(r,s&&s.base||"javascript");function c(f){var p=f.tagName;f.tagName=null;var g=o.indent(f,"","");return f.tagName=p,g}function u(f,p){return p.context.mode==o?d(f,p,p.context):h(f,p,p.context)}function d(f,p,g){if(g.depth==2)return f.match(/^.*?\*\//)?g.depth=1:f.skipToEnd(),"comment";if(f.peek()=="{"){o.skipAttribute(g.state);var m=c(g.state),v=g.state.context;if(v&&f.match(/^[^>]*>\s*$/,!1)){for(;v.prev&&!v.startOfLine;)v=v.prev;v.startOfLine?m-=r.indentUnit:g.prev.state.lexical&&(m=g.prev.state.lexical.indented)}else g.depth==1&&(m+=r.indentUnit);return p.context=new n(e.startState(a,m),a,0,p.context),null}if(g.depth==1){if(f.peek()=="<")return o.skipAttribute(g.state),p.context=new n(e.startState(o,c(g.state)),o,0,p.context),null;if(f.match("//"))return f.skipToEnd(),"comment";if(f.match("/*"))return g.depth=2,u(f,p)}var b=o.token(f,g.state),_=f.current(),x;return/\btag\b/.test(b)?/>$/.test(_)?g.state.context?g.depth=0:p.context=p.context.prev:/^</.test(_)&&(g.depth=1):!b&&(x=_.indexOf("{"))>-1&&f.backUp(_.length-x),b}function h(f,p,g){if(f.peek()=="<"&&a.expressionAllowed(f,g.state))return p.context=new n(e.startState(o,a.indent(g.state,"","")),o,0,p.context),a.skipExpression(g.state),null;var m=a.token(f,g.state);if(!m&&g.depth!=null){var v=f.current();v=="{"?g.depth++:v=="}"&&--g.depth==0&&(p.context=p.context.prev)}return m}return{startState:function(){return{context:new n(e.startState(a),a)}},copyState:function(f){return{context:i(f.context)}},token:u,indent:function(f,p,g){return f.context.mode.indent(f.context.state,p,g)},innerMode:function(f){return f.context}}},"xml","javascript"),e.defineMIME("text/jsx","jsx"),e.defineMIME("text/typescript-jsx",{name:"jsx",base:{name:"javascript",typescript:!0}})})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("cmake",function(){var n=/({)?[a-zA-Z0-9_]+(})?/;function i(s,o){for(var a,c,u=!1;!s.eol()&&(a=s.next())!=o.pending;){if(a==="$"&&c!="\\"&&o.pending=='"'){u=!0;break}c=a}return u&&s.backUp(1),a==o.pending?o.continueString=!1:o.continueString=!0,"string"}function r(s,o){var a=s.next();return a==="$"?s.match(n)?"variable-2":"variable":o.continueString?(s.backUp(1),i(s,o)):s.match(/(\s+)?\w+\(/)||s.match(/(\s+)?\w+\ \(/)?(s.backUp(1),"def"):a=="#"?(s.skipToEnd(),"comment"):a=="'"||a=='"'?(o.pending=a,i(s,o)):a=="("||a==")"?"bracket":a.match(/[0-9]/)?"number":(s.eatWhile(/[\w-]/),null)}return{startState:function(){var s={};return s.inDefinition=!1,s.inInclude=!1,s.continueString=!1,s.pending=!1,s},token:function(s,o){return s.eatSpace()?null:r(s,o)}}}),e.defineMIME("text/x-cmake","cmake")})})();var kf={exports:{}},Ef;function Aoe(){return Ef||(Ef=1,function(l,t){(function(e){e(Ke.exports)})(function(e){e.modeInfo=[{name:"APL",mime:"text/apl",mode:"apl",ext:["dyalog","apl"]},{name:"PGP",mimes:["application/pgp","application/pgp-encrypted","application/pgp-keys","application/pgp-signature"],mode:"asciiarmor",ext:["asc","pgp","sig"]},{name:"ASN.1",mime:"text/x-ttcn-asn",mode:"asn.1",ext:["asn","asn1"]},{name:"Asterisk",mime:"text/x-asterisk",mode:"asterisk",file:/^extensions\.conf$/i},{name:"Brainfuck",mime:"text/x-brainfuck",mode:"brainfuck",ext:["b","bf"]},{name:"C",mime:"text/x-csrc",mode:"clike",ext:["c","h","ino"]},{name:"C++",mime:"text/x-c++src",mode:"clike",ext:["cpp","c++","cc","cxx","hpp","h++","hh","hxx"],alias:["cpp"]},{name:"Cobol",mime:"text/x-cobol",mode:"cobol",ext:["cob","cpy","cbl"]},{name:"C#",mime:"text/x-csharp",mode:"clike",ext:["cs"],alias:["csharp","cs"]},{name:"Clojure",mime:"text/x-clojure",mode:"clojure",ext:["clj","cljc","cljx"]},{name:"ClojureScript",mime:"text/x-clojurescript",mode:"clojure",ext:["cljs"]},{name:"Closure Stylesheets (GSS)",mime:"text/x-gss",mode:"css",ext:["gss"]},{name:"CMake",mime:"text/x-cmake",mode:"cmake",ext:["cmake","cmake.in"],file:/^CMakeLists\.txt$/},{name:"CoffeeScript",mimes:["application/vnd.coffeescript","text/coffeescript","text/x-coffeescript"],mode:"coffeescript",ext:["coffee"],alias:["coffee","coffee-script"]},{name:"Common Lisp",mime:"text/x-common-lisp",mode:"commonlisp",ext:["cl","lisp","el"],alias:["lisp"]},{name:"Cypher",mime:"application/x-cypher-query",mode:"cypher",ext:["cyp","cypher"]},{name:"Cython",mime:"text/x-cython",mode:"python",ext:["pyx","pxd","pxi"]},{name:"Crystal",mime:"text/x-crystal",mode:"crystal",ext:["cr"]},{name:"CSS",mime:"text/css",mode:"css",ext:["css"]},{name:"CQL",mime:"text/x-cassandra",mode:"sql",ext:["cql"]},{name:"D",mime:"text/x-d",mode:"d",ext:["d"]},{name:"Dart",mimes:["application/dart","text/x-dart"],mode:"dart",ext:["dart"]},{name:"diff",mime:"text/x-diff",mode:"diff",ext:["diff","patch"]},{name:"Django",mime:"text/x-django",mode:"django"},{name:"Dockerfile",mime:"text/x-dockerfile",mode:"dockerfile",file:/^Dockerfile$/},{name:"DTD",mime:"application/xml-dtd",mode:"dtd",ext:["dtd"]},{name:"Dylan",mime:"text/x-dylan",mode:"dylan",ext:["dylan","dyl","intr"]},{name:"EBNF",mime:"text/x-ebnf",mode:"ebnf"},{name:"ECL",mime:"text/x-ecl",mode:"ecl",ext:["ecl"]},{name:"edn",mime:"application/edn",mode:"clojure",ext:["edn"]},{name:"Eiffel",mime:"text/x-eiffel",mode:"eiffel",ext:["e"]},{name:"Elm",mime:"text/x-elm",mode:"elm",ext:["elm"]},{name:"Embedded JavaScript",mime:"application/x-ejs",mode:"htmlembedded",ext:["ejs"]},{name:"Embedded Ruby",mime:"application/x-erb",mode:"htmlembedded",ext:["erb"]},{name:"Erlang",mime:"text/x-erlang",mode:"erlang",ext:["erl"]},{name:"Esper",mime:"text/x-esper",mode:"sql"},{name:"Factor",mime:"text/x-factor",mode:"factor",ext:["factor"]},{name:"FCL",mime:"text/x-fcl",mode:"fcl"},{name:"Forth",mime:"text/x-forth",mode:"forth",ext:["forth","fth","4th"]},{name:"Fortran",mime:"text/x-fortran",mode:"fortran",ext:["f","for","f77","f90","f95"]},{name:"F#",mime:"text/x-fsharp",mode:"mllike",ext:["fs"],alias:["fsharp"]},{name:"Gas",mime:"text/x-gas",mode:"gas",ext:["s"]},{name:"Gherkin",mime:"text/x-feature",mode:"gherkin",ext:["feature"]},{name:"GitHub Flavored Markdown",mime:"text/x-gfm",mode:"gfm",file:/^(readme|contributing|history)\.md$/i},{name:"Go",mime:"text/x-go",mode:"go",ext:["go"]},{name:"Groovy",mime:"text/x-groovy",mode:"groovy",ext:["groovy","gradle"],file:/^Jenkinsfile$/},{name:"HAML",mime:"text/x-haml",mode:"haml",ext:["haml"]},{name:"Haskell",mime:"text/x-haskell",mode:"haskell",ext:["hs"]},{name:"Haskell (Literate)",mime:"text/x-literate-haskell",mode:"haskell-literate",ext:["lhs"]},{name:"Haxe",mime:"text/x-haxe",mode:"haxe",ext:["hx"]},{name:"HXML",mime:"text/x-hxml",mode:"haxe",ext:["hxml"]},{name:"ASP.NET",mime:"application/x-aspx",mode:"htmlembedded",ext:["aspx"],alias:["asp","aspx"]},{name:"HTML",mime:"text/html",mode:"htmlmixed",ext:["html","htm","handlebars","hbs"],alias:["xhtml"]},{name:"HTTP",mime:"message/http",mode:"http"},{name:"IDL",mime:"text/x-idl",mode:"idl",ext:["pro"]},{name:"Pug",mime:"text/x-pug",mode:"pug",ext:["jade","pug"],alias:["jade"]},{name:"Java",mime:"text/x-java",mode:"clike",ext:["java"]},{name:"Java Server Pages",mime:"application/x-jsp",mode:"htmlembedded",ext:["jsp"],alias:["jsp"]},{name:"JavaScript",mimes:["text/javascript","text/ecmascript","application/javascript","application/x-javascript","application/ecmascript"],mode:"javascript",ext:["js"],alias:["ecmascript","js","node"]},{name:"JSON",mimes:["application/json","application/x-json"],mode:"javascript",ext:["json","map"],alias:["json5"]},{name:"JSON-LD",mime:"application/ld+json",mode:"javascript",ext:["jsonld"],alias:["jsonld"]},{name:"JSX",mime:"text/jsx",mode:"jsx",ext:["jsx"]},{name:"Jinja2",mime:"text/jinja2",mode:"jinja2",ext:["j2","jinja","jinja2"]},{name:"Julia",mime:"text/x-julia",mode:"julia",ext:["jl"],alias:["jl"]},{name:"Kotlin",mime:"text/x-kotlin",mode:"clike",ext:["kt"]},{name:"LESS",mime:"text/x-less",mode:"css",ext:["less"]},{name:"LiveScript",mime:"text/x-livescript",mode:"livescript",ext:["ls"],alias:["ls"]},{name:"Lua",mime:"text/x-lua",mode:"lua",ext:["lua"]},{name:"Markdown",mime:"text/x-markdown",mode:"markdown",ext:["markdown","md","mkd"]},{name:"mIRC",mime:"text/mirc",mode:"mirc"},{name:"MariaDB SQL",mime:"text/x-mariadb",mode:"sql"},{name:"Mathematica",mime:"text/x-mathematica",mode:"mathematica",ext:["m","nb","wl","wls"]},{name:"Modelica",mime:"text/x-modelica",mode:"modelica",ext:["mo"]},{name:"MUMPS",mime:"text/x-mumps",mode:"mumps",ext:["mps"]},{name:"MS SQL",mime:"text/x-mssql",mode:"sql"},{name:"mbox",mime:"application/mbox",mode:"mbox",ext:["mbox"]},{name:"MySQL",mime:"text/x-mysql",mode:"sql"},{name:"Nginx",mime:"text/x-nginx-conf",mode:"nginx",file:/nginx.*\.conf$/i},{name:"NSIS",mime:"text/x-nsis",mode:"nsis",ext:["nsh","nsi"]},{name:"NTriples",mimes:["application/n-triples","application/n-quads","text/n-triples"],mode:"ntriples",ext:["nt","nq"]},{name:"Objective-C",mime:"text/x-objectivec",mode:"clike",ext:["m"],alias:["objective-c","objc"]},{name:"Objective-C++",mime:"text/x-objectivec++",mode:"clike",ext:["mm"],alias:["objective-c++","objc++"]},{name:"OCaml",mime:"text/x-ocaml",mode:"mllike",ext:["ml","mli","mll","mly"]},{name:"Octave",mime:"text/x-octave",mode:"octave",ext:["m"]},{name:"Oz",mime:"text/x-oz",mode:"oz",ext:["oz"]},{name:"Pascal",mime:"text/x-pascal",mode:"pascal",ext:["p","pas"]},{name:"PEG.js",mime:"null",mode:"pegjs",ext:["jsonld"]},{name:"Perl",mime:"text/x-perl",mode:"perl",ext:["pl","pm"]},{name:"PHP",mimes:["text/x-php","application/x-httpd-php","application/x-httpd-php-open"],mode:"php",ext:["php","php3","php4","php5","php7","phtml"]},{name:"Pig",mime:"text/x-pig",mode:"pig",ext:["pig"]},{name:"Plain Text",mime:"text/plain",mode:"null",ext:["txt","text","conf","def","list","log"]},{name:"PLSQL",mime:"text/x-plsql",mode:"sql",ext:["pls"]},{name:"PostgreSQL",mime:"text/x-pgsql",mode:"sql"},{name:"PowerShell",mime:"application/x-powershell",mode:"powershell",ext:["ps1","psd1","psm1"]},{name:"Properties files",mime:"text/x-properties",mode:"properties",ext:["properties","ini","in"],alias:["ini","properties"]},{name:"ProtoBuf",mime:"text/x-protobuf",mode:"protobuf",ext:["proto"]},{name:"Python",mime:"text/x-python",mode:"python",ext:["BUILD","bzl","py","pyw"],file:/^(BUCK|BUILD)$/},{name:"Puppet",mime:"text/x-puppet",mode:"puppet",ext:["pp"]},{name:"Q",mime:"text/x-q",mode:"q",ext:["q"]},{name:"R",mime:"text/x-rsrc",mode:"r",ext:["r","R"],alias:["rscript"]},{name:"reStructuredText",mime:"text/x-rst",mode:"rst",ext:["rst"],alias:["rst"]},{name:"RPM Changes",mime:"text/x-rpm-changes",mode:"rpm"},{name:"RPM Spec",mime:"text/x-rpm-spec",mode:"rpm",ext:["spec"]},{name:"Ruby",mime:"text/x-ruby",mode:"ruby",ext:["rb"],alias:["jruby","macruby","rake","rb","rbx"]},{name:"Rust",mime:"text/x-rustsrc",mode:"rust",ext:["rs"]},{name:"SAS",mime:"text/x-sas",mode:"sas",ext:["sas"]},{name:"Sass",mime:"text/x-sass",mode:"sass",ext:["sass"]},{name:"Scala",mime:"text/x-scala",mode:"clike",ext:["scala"]},{name:"Scheme",mime:"text/x-scheme",mode:"scheme",ext:["scm","ss"]},{name:"SCSS",mime:"text/x-scss",mode:"css",ext:["scss"]},{name:"Shell",mimes:["text/x-sh","application/x-sh"],mode:"shell",ext:["sh","ksh","bash"],alias:["bash","sh","zsh"],file:/^PKGBUILD$/},{name:"Sieve",mime:"application/sieve",mode:"sieve",ext:["siv","sieve"]},{name:"Slim",mimes:["text/x-slim","application/x-slim"],mode:"slim",ext:["slim"]},{name:"Smalltalk",mime:"text/x-stsrc",mode:"smalltalk",ext:["st"]},{name:"Smarty",mime:"text/x-smarty",mode:"smarty",ext:["tpl"]},{name:"Solr",mime:"text/x-solr",mode:"solr"},{name:"SML",mime:"text/x-sml",mode:"mllike",ext:["sml","sig","fun","smackspec"]},{name:"Soy",mime:"text/x-soy",mode:"soy",ext:["soy"],alias:["closure template"]},{name:"SPARQL",mime:"application/sparql-query",mode:"sparql",ext:["rq","sparql"],alias:["sparul"]},{name:"Spreadsheet",mime:"text/x-spreadsheet",mode:"spreadsheet",alias:["excel","formula"]},{name:"SQL",mime:"text/x-sql",mode:"sql",ext:["sql"]},{name:"SQLite",mime:"text/x-sqlite",mode:"sql"},{name:"Squirrel",mime:"text/x-squirrel",mode:"clike",ext:["nut"]},{name:"Stylus",mime:"text/x-styl",mode:"stylus",ext:["styl"]},{name:"Swift",mime:"text/x-swift",mode:"swift",ext:["swift"]},{name:"sTeX",mime:"text/x-stex",mode:"stex"},{name:"LaTeX",mime:"text/x-latex",mode:"stex",ext:["text","ltx","tex"],alias:["tex"]},{name:"SystemVerilog",mime:"text/x-systemverilog",mode:"verilog",ext:["v","sv","svh"]},{name:"Tcl",mime:"text/x-tcl",mode:"tcl",ext:["tcl"]},{name:"Textile",mime:"text/x-textile",mode:"textile",ext:["textile"]},{name:"TiddlyWiki",mime:"text/x-tiddlywiki",mode:"tiddlywiki"},{name:"Tiki wiki",mime:"text/tiki",mode:"tiki"},{name:"TOML",mime:"text/x-toml",mode:"toml",ext:["toml"]},{name:"Tornado",mime:"text/x-tornado",mode:"tornado"},{name:"troff",mime:"text/troff",mode:"troff",ext:["1","2","3","4","5","6","7","8","9"]},{name:"TTCN",mime:"text/x-ttcn",mode:"ttcn",ext:["ttcn","ttcn3","ttcnpp"]},{name:"TTCN_CFG",mime:"text/x-ttcn-cfg",mode:"ttcn-cfg",ext:["cfg"]},{name:"Turtle",mime:"text/turtle",mode:"turtle",ext:["ttl"]},{name:"TypeScript",mime:"application/typescript",mode:"javascript",ext:["ts"],alias:["ts"]},{name:"TypeScript-JSX",mime:"text/typescript-jsx",mode:"jsx",ext:["tsx"],alias:["tsx"]},{name:"Twig",mime:"text/x-twig",mode:"twig"},{name:"Web IDL",mime:"text/x-webidl",mode:"webidl",ext:["webidl"]},{name:"VB.NET",mime:"text/x-vb",mode:"vb",ext:["vb"]},{name:"VBScript",mime:"text/vbscript",mode:"vbscript",ext:["vbs"]},{name:"Velocity",mime:"text/velocity",mode:"velocity",ext:["vtl"]},{name:"Verilog",mime:"text/x-verilog",mode:"verilog",ext:["v"]},{name:"VHDL",mime:"text/x-vhdl",mode:"vhdl",ext:["vhd","vhdl"]},{name:"Vue.js Component",mimes:["script/x-vue","text/x-vue"],mode:"vue",ext:["vue"]},{name:"XML",mimes:["application/xml","text/xml"],mode:"xml",ext:["xml","xsl","xsd","svg"],alias:["rss","wsdl","xsd"]},{name:"XQuery",mime:"application/xquery",mode:"xquery",ext:["xy","xquery"]},{name:"Yacas",mime:"text/x-yacas",mode:"yacas",ext:["ys"]},{name:"YAML",mimes:["text/x-yaml","text/yaml"],mode:"yaml",ext:["yaml","yml"],alias:["yml"]},{name:"Z80",mime:"text/x-z80",mode:"z80",ext:["z80"]},{name:"mscgen",mime:"text/x-mscgen",mode:"mscgen",ext:["mscgen","mscin","msc"]},{name:"xu",mime:"text/x-xu",mode:"mscgen",ext:["xu"]},{name:"msgenny",mime:"text/x-msgenny",mode:"mscgen",ext:["msgenny"]},{name:"WebAssembly",mime:"text/webassembly",mode:"wast",ext:["wat","wast"]}];for(var n=0;n<e.modeInfo.length;n++){var i=e.modeInfo[n];i.mimes&&(i.mime=i.mimes[0])}e.findModeByMIME=function(r){r=r.toLowerCase();for(var s=0;s<e.modeInfo.length;s++){var o=e.modeInfo[s];if(o.mime==r)return o;if(o.mimes){for(var a=0;a<o.mimes.length;a++)if(o.mimes[a]==r)return o}}if(/\+xml$/.test(r))return e.findModeByMIME("application/xml");if(/\+json$/.test(r))return e.findModeByMIME("application/json")},e.findModeByExtension=function(r){r=r.toLowerCase();for(var s=0;s<e.modeInfo.length;s++){var o=e.modeInfo[s];if(o.ext){for(var a=0;a<o.ext.length;a++)if(o.ext[a]==r)return o}}},e.findModeByFileName=function(r){for(var s=0;s<e.modeInfo.length;s++){var o=e.modeInfo[s];if(o.file&&o.file.test(r))return o}var a=r.lastIndexOf("."),c=a>-1&&r.substring(a+1,r.length);if(c)return e.findModeByExtension(c)},e.findModeByName=function(r){r=r.toLowerCase();for(var s=0;s<e.modeInfo.length;s++){var o=e.modeInfo[s];if(o.name.toLowerCase()==r)return o;if(o.alias){for(var a=0;a<o.alias.length;a++)if(o.alias[a].toLowerCase()==r)return o}}}})}()),kf.exports}(function(l,t){(function(e){e(Ke.exports,sl(),Aoe())})(function(e){e.defineMode("markdown",function(n,i){var r=e.getMode(n,"text/html"),s=r.name=="null";function o(M){if(e.findModeByName){var T=e.findModeByName(M);T&&(M=T.mime||T.mimes[0])}var K=e.getMode(n,M);return K.name=="null"?null:K}i.highlightFormatting===void 0&&(i.highlightFormatting=!1),i.maxBlockquoteDepth===void 0&&(i.maxBlockquoteDepth=0),i.taskLists===void 0&&(i.taskLists=!1),i.strikethrough===void 0&&(i.strikethrough=!1),i.emoji===void 0&&(i.emoji=!1),i.fencedCodeBlockHighlighting===void 0&&(i.fencedCodeBlockHighlighting=!0),i.fencedCodeBlockDefaultMode===void 0&&(i.fencedCodeBlockDefaultMode="text/plain"),i.xml===void 0&&(i.xml=!0),i.tokenTypeOverrides===void 0&&(i.tokenTypeOverrides={});var a={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough",emoji:"builtin"};for(var c in a)a.hasOwnProperty(c)&&i.tokenTypeOverrides[c]&&(a[c]=i.tokenTypeOverrides[c]);var u=/^([*\-_])(?:\s*\1){2,}\s*$/,d=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,h=/^\[(x| )\](?=\s)/i,f=i.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,p=/^ {0,3}(?:\={1,}|-{2,})\s*$/,g=/^[^#!\[\]*_\\<>` "'(~:]+/,m=/^(~~~+|```+)[ \t]*([\w\/+#-]*)[^\n`]*$/,v=/^\s*\[[^\]]+?\]:.*$/,b=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/,_="    ";function x(M,T,K){return T.f=T.inline=K,K(M,T)}function w(M,T,K){return T.f=T.block=K,K(M,T)}function E(M){return!M||!/\S/.test(M.string)}function S(M){if(M.linkTitle=!1,M.linkHref=!1,M.linkText=!1,M.em=!1,M.strong=!1,M.strikethrough=!1,M.quote=0,M.indentedCode=!1,M.f==D){var T=s;if(!T){var K=e.innerMode(r,M.htmlState);T=K.mode.name=="xml"&&K.state.tagStart===null&&!K.state.context&&K.state.tokenize.isInText}T&&(M.f=B,M.block=R,M.htmlState=null)}return M.trailingSpace=0,M.trailingSpaceNewLine=!1,M.prevLine=M.thisLine,M.thisLine={stream:null},null}function R(M,T){var K=M.column()===T.indentation,ee=E(T.prevLine.stream),Y=T.indentedCode,q=T.prevLine.hr,Z=T.list!==!1,te=(T.listStack[T.listStack.length-1]||0)+3;T.indentedCode=!1;var se=T.indentation;if(T.indentationDiff===null&&(T.indentationDiff=T.indentation,Z)){for(T.list=null;se<T.listStack[T.listStack.length-1];)T.listStack.pop(),T.listStack.length?T.indentation=T.listStack[T.listStack.length-1]:T.list=!1;T.list!==!1&&(T.indentationDiff=se-T.listStack[T.listStack.length-1])}var fe=!ee&&!q&&!T.prevLine.header&&(!Z||!Y)&&!T.prevLine.fencedCodeEnd,J=(T.list===!1||q||ee)&&T.indentation<=te&&M.match(u),X=null;if(T.indentationDiff>=4&&(Y||T.prevLine.fencedCodeEnd||T.prevLine.header||ee))return M.skipToEnd(),T.indentedCode=!0,a.code;if(M.eatSpace())return null;if(K&&T.indentation<=te&&(X=M.match(f))&&X[1].length<=6)return T.quote=0,T.header=X[1].length,T.thisLine.header=!0,i.highlightFormatting&&(T.formatting="header"),T.f=T.inline,O(T);if(T.indentation<=te&&M.eat(">"))return T.quote=K?1:T.quote+1,i.highlightFormatting&&(T.formatting="quote"),M.eatSpace(),O(T);if(!J&&!T.setext&&K&&T.indentation<=te&&(X=M.match(d))){var ae=X[1]?"ol":"ul";return T.indentation=se+M.current().length,T.list=!0,T.quote=0,T.listStack.push(T.indentation),T.em=!1,T.strong=!1,T.code=!1,T.strikethrough=!1,i.taskLists&&M.match(h,!1)&&(T.taskList=!0),T.f=T.inline,i.highlightFormatting&&(T.formatting=["list","list-"+ae]),O(T)}else{if(K&&T.indentation<=te&&(X=M.match(m,!0)))return T.quote=0,T.fencedEndRE=new RegExp(X[1]+"+ *$"),T.localMode=i.fencedCodeBlockHighlighting&&o(X[2]||i.fencedCodeBlockDefaultMode),T.localMode&&(T.localState=e.startState(T.localMode)),T.f=T.block=P,i.highlightFormatting&&(T.formatting="code-block"),T.code=-1,O(T);if(T.setext||(!fe||!Z)&&!T.quote&&T.list===!1&&!T.code&&!J&&!v.test(M.string)&&(X=M.lookAhead(1))&&(X=X.match(p)))return T.setext?(T.header=T.setext,T.setext=0,M.skipToEnd(),i.highlightFormatting&&(T.formatting="header")):(T.header=X[0].charAt(0)=="="?1:2,T.setext=T.header),T.thisLine.header=!0,T.f=T.inline,O(T);if(J)return M.skipToEnd(),T.hr=!0,T.thisLine.hr=!0,a.hr;if(M.peek()==="[")return x(M,T,k)}return x(M,T,T.inline)}function D(M,T){var K=r.token(M,T.htmlState);if(!s){var ee=e.innerMode(r,T.htmlState);(ee.mode.name=="xml"&&ee.state.tagStart===null&&!ee.state.context&&ee.state.tokenize.isInText||T.md_inside&&M.current().indexOf(">")>-1)&&(T.f=B,T.block=R,T.htmlState=null)}return K}function P(M,T){var K=T.listStack[T.listStack.length-1]||0,ee=T.indentation<K,Y=K+3;if(T.fencedEndRE&&T.indentation<=Y&&(ee||M.match(T.fencedEndRE))){i.highlightFormatting&&(T.formatting="code-block");var q;return ee||(q=O(T)),T.localMode=T.localState=null,T.block=R,T.f=B,T.fencedEndRE=null,T.code=0,T.thisLine.fencedCodeEnd=!0,ee?w(M,T,T.block):q}else return T.localMode?T.localMode.token(M,T.localState):(M.skipToEnd(),a.code)}function O(M){var T=[];if(M.formatting){T.push(a.formatting),typeof M.formatting=="string"&&(M.formatting=[M.formatting]);for(var K=0;K<M.formatting.length;K++)T.push(a.formatting+"-"+M.formatting[K]),M.formatting[K]==="header"&&T.push(a.formatting+"-"+M.formatting[K]+"-"+M.header),M.formatting[K]==="quote"&&(!i.maxBlockquoteDepth||i.maxBlockquoteDepth>=M.quote?T.push(a.formatting+"-"+M.formatting[K]+"-"+M.quote):T.push("error"))}if(M.taskOpen)return T.push("meta"),T.length?T.join(" "):null;if(M.taskClosed)return T.push("property"),T.length?T.join(" "):null;if(M.linkHref?T.push(a.linkHref,"url"):(M.strong&&T.push(a.strong),M.em&&T.push(a.em),M.strikethrough&&T.push(a.strikethrough),M.emoji&&T.push(a.emoji),M.linkText&&T.push(a.linkText),M.code&&T.push(a.code),M.image&&T.push(a.image),M.imageAltText&&T.push(a.imageAltText,"link"),M.imageMarker&&T.push(a.imageMarker)),M.header&&T.push(a.header,a.header+"-"+M.header),M.quote&&(T.push(a.quote),!i.maxBlockquoteDepth||i.maxBlockquoteDepth>=M.quote?T.push(a.quote+"-"+M.quote):T.push(a.quote+"-"+i.maxBlockquoteDepth)),M.list!==!1){var ee=(M.listStack.length-1)%3;ee?ee===1?T.push(a.list2):T.push(a.list3):T.push(a.list1)}return M.trailingSpaceNewLine?T.push("trailing-space-new-line"):M.trailingSpace&&T.push("trailing-space-"+(M.trailingSpace%2?"a":"b")),T.length?T.join(" "):null}function L(M,T){if(M.match(g,!0))return O(T)}function B(M,T){var K=T.text(M,T);if(typeof K<"u")return K;if(T.list)return T.list=null,O(T);if(T.taskList){var ee=M.match(h,!0)[1]===" ";return ee?T.taskOpen=!0:T.taskClosed=!0,i.highlightFormatting&&(T.formatting="task"),T.taskList=!1,O(T)}if(T.taskOpen=!1,T.taskClosed=!1,T.header&&M.match(/^#+$/,!0))return i.highlightFormatting&&(T.formatting="header"),O(T);var Y=M.next();if(T.linkTitle){T.linkTitle=!1;var q=Y;Y==="("&&(q=")"),q=(q+"").replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1");var Z="^\\s*(?:[^"+q+"\\\\]+|\\\\\\\\|\\\\.)"+q;if(M.match(new RegExp(Z),!0))return a.linkHref}if(Y==="`"){var te=T.formatting;i.highlightFormatting&&(T.formatting="code"),M.eatWhile("`");var se=M.current().length;if(T.code==0&&(!T.quote||se==1))return T.code=se,O(T);if(se==T.code){var fe=O(T);return T.code=0,fe}else return T.formatting=te,O(T)}else if(T.code)return O(T);if(Y==="\\"&&(M.next(),i.highlightFormatting)){var J=O(T),X=a.formatting+"-escape";return J?J+" "+X:X}if(Y==="!"&&M.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return T.imageMarker=!0,T.image=!0,i.highlightFormatting&&(T.formatting="image"),O(T);if(Y==="["&&T.imageMarker&&M.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return T.imageMarker=!1,T.imageAltText=!0,i.highlightFormatting&&(T.formatting="image"),O(T);if(Y==="]"&&T.imageAltText){i.highlightFormatting&&(T.formatting="image");var J=O(T);return T.imageAltText=!1,T.image=!1,T.inline=T.f=F,J}if(Y==="["&&!T.image)return T.linkText&&M.match(/^.*?\]/)||(T.linkText=!0,i.highlightFormatting&&(T.formatting="link")),O(T);if(Y==="]"&&T.linkText){i.highlightFormatting&&(T.formatting="link");var J=O(T);return T.linkText=!1,T.inline=T.f=M.match(/\(.*?\)| ?\[.*?\]/,!1)?F:B,J}if(Y==="<"&&M.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){T.f=T.inline=A,i.highlightFormatting&&(T.formatting="link");var J=O(T);return J?J+=" ":J="",J+a.linkInline}if(Y==="<"&&M.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){T.f=T.inline=A,i.highlightFormatting&&(T.formatting="link");var J=O(T);return J?J+=" ":J="",J+a.linkEmail}if(i.xml&&Y==="<"&&M.match(/^(!--|\?|!\[CDATA\[|[a-z][a-z0-9-]*(?:\s+[a-z_:.\-]+(?:\s*=\s*[^>]+)?)*\s*(?:>|$))/i,!1)){var ae=M.string.indexOf(">",M.pos);if(ae!=-1){var _e=M.string.substring(M.start,ae);/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(_e)&&(T.md_inside=!0)}return M.backUp(1),T.htmlState=e.startState(r),w(M,T,D)}if(i.xml&&Y==="<"&&M.match(/^\/\w*?>/))return T.md_inside=!1,"tag";if(Y==="*"||Y==="_"){for(var Me=1,ge=M.pos==1?" ":M.string.charAt(M.pos-2);Me<3&&M.eat(Y);)Me++;var $e=M.peek()||" ",qe=!/\s/.test($e)&&(!b.test($e)||/\s/.test(ge)||b.test(ge)),Ye=!/\s/.test(ge)&&(!b.test(ge)||/\s/.test($e)||b.test($e)),wt=null,Rt=null;if(Me%2&&(!T.em&&qe&&(Y==="*"||!Ye||b.test(ge))?wt=!0:T.em==Y&&Ye&&(Y==="*"||!qe||b.test($e))&&(wt=!1)),Me>1&&(!T.strong&&qe&&(Y==="*"||!Ye||b.test(ge))?Rt=!0:T.strong==Y&&Ye&&(Y==="*"||!qe||b.test($e))&&(Rt=!1)),Rt!=null||wt!=null){i.highlightFormatting&&(T.formatting=wt==null?"strong":Rt==null?"em":"strong em"),wt===!0&&(T.em=Y),Rt===!0&&(T.strong=Y);var fe=O(T);return wt===!1&&(T.em=!1),Rt===!1&&(T.strong=!1),fe}}else if(Y===" "&&(M.eat("*")||M.eat("_"))){if(M.peek()===" ")return O(T);M.backUp(1)}if(i.strikethrough){if(Y==="~"&&M.eatWhile(Y)){if(T.strikethrough){i.highlightFormatting&&(T.formatting="strikethrough");var fe=O(T);return T.strikethrough=!1,fe}else if(M.match(/^[^\s]/,!1))return T.strikethrough=!0,i.highlightFormatting&&(T.formatting="strikethrough"),O(T)}else if(Y===" "&&M.match("~~",!0)){if(M.peek()===" ")return O(T);M.backUp(2)}}if(i.emoji&&Y===":"&&M.match(/^(?:[a-z_\d+][a-z_\d+-]*|\-[a-z_\d+][a-z_\d+-]*):/)){T.emoji=!0,i.highlightFormatting&&(T.formatting="emoji");var Ln=O(T);return T.emoji=!1,Ln}return Y===" "&&(M.match(/^ +$/,!1)?T.trailingSpace++:T.trailingSpace&&(T.trailingSpaceNewLine=!0)),O(T)}function A(M,T){var K=M.next();if(K===">"){T.f=T.inline=B,i.highlightFormatting&&(T.formatting="link");var ee=O(T);return ee?ee+=" ":ee="",ee+a.linkInline}return M.match(/^[^>]+/,!0),a.linkInline}function F(M,T){if(M.eatSpace())return null;var K=M.next();return K==="("||K==="["?(T.f=T.inline=G(K==="("?")":"]"),i.highlightFormatting&&(T.formatting="link-string"),T.linkHref=!0,O(T)):"error"}var W={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/};function G(M){return function(T,K){var ee=T.next();if(ee===M){K.f=K.inline=B,i.highlightFormatting&&(K.formatting="link-string");var Y=O(K);return K.linkHref=!1,Y}return T.match(W[M]),K.linkHref=!0,O(K)}}function k(M,T){return M.match(/^([^\]\\]|\\.)*\]:/,!1)?(T.f=C,M.next(),i.highlightFormatting&&(T.formatting="link"),T.linkText=!0,O(T)):x(M,T,B)}function C(M,T){if(M.match("]:",!0)){T.f=T.inline=$,i.highlightFormatting&&(T.formatting="link");var K=O(T);return T.linkText=!1,K}return M.match(/^([^\]\\]|\\.)+/,!0),a.linkText}function $(M,T){return M.eatSpace()?null:(M.match(/^[^\s]+/,!0),M.peek()===void 0?T.linkTitle=!0:M.match(/^(?:\s+(?:"(?:[^"\\]|\\.)+"|'(?:[^'\\]|\\.)+'|\((?:[^)\\]|\\.)+\)))?/,!0),T.f=T.inline=B,a.linkHref+" url")}var z={startState:function(){return{f:R,prevLine:{stream:null},thisLine:{stream:null},block:R,htmlState:null,indentation:0,inline:B,text:L,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,setext:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,emoji:!1,fencedEndRE:null}},copyState:function(M){return{f:M.f,prevLine:M.prevLine,thisLine:M.thisLine,block:M.block,htmlState:M.htmlState&&e.copyState(r,M.htmlState),indentation:M.indentation,localMode:M.localMode,localState:M.localMode?e.copyState(M.localMode,M.localState):null,inline:M.inline,text:M.text,formatting:!1,linkText:M.linkText,linkTitle:M.linkTitle,linkHref:M.linkHref,code:M.code,em:M.em,strong:M.strong,strikethrough:M.strikethrough,emoji:M.emoji,header:M.header,setext:M.setext,hr:M.hr,taskList:M.taskList,list:M.list,listStack:M.listStack.slice(0),quote:M.quote,indentedCode:M.indentedCode,trailingSpace:M.trailingSpace,trailingSpaceNewLine:M.trailingSpaceNewLine,md_inside:M.md_inside,fencedEndRE:M.fencedEndRE}},token:function(M,T){if(T.formatting=!1,M!=T.thisLine.stream){if(T.header=0,T.hr=!1,M.match(/^\s*$/,!0))return S(T),null;if(T.prevLine=T.thisLine,T.thisLine={stream:M},T.taskList=!1,T.trailingSpace=0,T.trailingSpaceNewLine=!1,!T.localState&&(T.f=T.block,T.f!=D)){var K=M.match(/^\s*/,!0)[0].replace(/\t/g,_).length;if(T.indentation=K,T.indentationDiff=null,K>0)return null}}return T.f(M,T)},innerMode:function(M){return M.block==D?{state:M.htmlState,mode:r}:M.localState?{state:M.localState,mode:M.localMode}:{state:M,mode:z}},indent:function(M,T,K){return M.block==D&&r.indent?r.indent(M.htmlState,T,K):M.localState&&M.localMode.indent?M.localMode.indent(M.localState,T,K):e.Pass},blankLine:S,getType:O,blockCommentStart:"<!--",blockCommentEnd:"-->",closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return z},"xml"),e.defineMIME("text/markdown","markdown"),e.defineMIME("text/x-markdown","markdown")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("octave",function(){function n(m){return new RegExp("^(("+m.join(")|(")+"))\\b")}var i=new RegExp("^[\\+\\-\\*/&|\\^~<>!@'\\\\]"),r=new RegExp("^[\\(\\[\\{\\},:=;\\.]"),s=new RegExp("^((==)|(~=)|(<=)|(>=)|(<<)|(>>)|(\\.[\\+\\-\\*/\\^\\\\]))"),o=new RegExp("^((!=)|(\\+=)|(\\-=)|(\\*=)|(/=)|(&=)|(\\|=)|(\\^=))"),a=new RegExp("^((>>=)|(<<=))"),c=new RegExp("^[\\]\\)]"),u=new RegExp("^[_A-Za-z\xA1-\uFFFF][_A-Za-z0-9\xA1-\uFFFF]*"),d=n(["error","eval","function","abs","acos","atan","asin","cos","cosh","exp","log","prod","sum","log10","max","min","sign","sin","sinh","sqrt","tan","reshape","break","zeros","default","margin","round","ones","rand","syn","ceil","floor","size","clear","zeros","eye","mean","std","cov","det","eig","inv","norm","rank","trace","expm","logm","sqrtm","linspace","plot","title","xlabel","ylabel","legend","text","grid","meshgrid","mesh","num2str","fft","ifft","arrayfun","cellfun","input","fliplr","flipud","ismember"]),h=n(["return","case","switch","else","elseif","end","endif","endfunction","if","otherwise","do","for","while","try","catch","classdef","properties","events","methods","global","persistent","endfor","endwhile","printf","sprintf","disp","until","continue","pkg"]);function f(m,v){return!m.sol()&&m.peek()==="'"?(m.next(),v.tokenize=g,"operator"):(v.tokenize=g,g(m,v))}function p(m,v){return m.match(/^.*%}/)?(v.tokenize=g,"comment"):(m.skipToEnd(),"comment")}function g(m,v){if(m.eatSpace())return null;if(m.match("%{"))return v.tokenize=p,m.skipToEnd(),"comment";if(m.match(/^[%#]/))return m.skipToEnd(),"comment";if(m.match(/^[0-9\.+-]/,!1)){if(m.match(/^[+-]?0x[0-9a-fA-F]+[ij]?/))return m.tokenize=g,"number";if(m.match(/^[+-]?\d*\.\d+([EeDd][+-]?\d+)?[ij]?/)||m.match(/^[+-]?\d+([EeDd][+-]?\d+)?[ij]?/))return"number"}if(m.match(n(["nan","NaN","inf","Inf"])))return"number";var b=m.match(/^"(?:[^"]|"")*("|$)/)||m.match(/^'(?:[^']|'')*('|$)/);return b?b[1]?"string":"string error":m.match(h)?"keyword":m.match(d)?"builtin":m.match(u)?"variable":m.match(i)||m.match(s)?"operator":m.match(r)||m.match(o)||m.match(a)?null:m.match(c)?(v.tokenize=f,null):(m.next(),"error")}return{startState:function(){return{tokenize:g}},token:function(m,v){var b=v.tokenize(m,v);return(b==="number"||b==="variable")&&(v.tokenize=f),b},lineComment:"%",fold:"indent"}}),e.defineMIME("text/x-octave","octave")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("nginx",function(n){function i(g){for(var m={},v=g.split(" "),b=0;b<v.length;++b)m[v[b]]=!0;return m}var r=i("break return rewrite set accept_mutex accept_mutex_delay access_log add_after_body add_before_body add_header addition_types aio alias allow ancient_browser ancient_browser_value auth_basic auth_basic_user_file auth_http auth_http_header auth_http_timeout autoindex autoindex_exact_size autoindex_localtime charset charset_types client_body_buffer_size client_body_in_file_only client_body_in_single_buffer client_body_temp_path client_body_timeout client_header_buffer_size client_header_timeout client_max_body_size connection_pool_size create_full_put_path daemon dav_access dav_methods debug_connection debug_points default_type degradation degrade deny devpoll_changes devpoll_events directio directio_alignment empty_gif env epoll_events error_log eventport_events expires fastcgi_bind fastcgi_buffer_size fastcgi_buffers fastcgi_busy_buffers_size fastcgi_cache fastcgi_cache_key fastcgi_cache_methods fastcgi_cache_min_uses fastcgi_cache_path fastcgi_cache_use_stale fastcgi_cache_valid fastcgi_catch_stderr fastcgi_connect_timeout fastcgi_hide_header fastcgi_ignore_client_abort fastcgi_ignore_headers fastcgi_index fastcgi_intercept_errors fastcgi_max_temp_file_size fastcgi_next_upstream fastcgi_param fastcgi_pass_header fastcgi_pass_request_body fastcgi_pass_request_headers fastcgi_read_timeout fastcgi_send_lowat fastcgi_send_timeout fastcgi_split_path_info fastcgi_store fastcgi_store_access fastcgi_temp_file_write_size fastcgi_temp_path fastcgi_upstream_fail_timeout fastcgi_upstream_max_fails flv geoip_city geoip_country google_perftools_profiles gzip gzip_buffers gzip_comp_level gzip_disable gzip_hash gzip_http_version gzip_min_length gzip_no_buffer gzip_proxied gzip_static gzip_types gzip_vary gzip_window if_modified_since ignore_invalid_headers image_filter image_filter_buffer image_filter_jpeg_quality image_filter_transparency imap_auth imap_capabilities imap_client_buffer index ip_hash keepalive_requests keepalive_timeout kqueue_changes kqueue_events large_client_header_buffers limit_conn limit_conn_log_level limit_rate limit_rate_after limit_req limit_req_log_level limit_req_zone limit_zone lingering_time lingering_timeout lock_file log_format log_not_found log_subrequest map_hash_bucket_size map_hash_max_size master_process memcached_bind memcached_buffer_size memcached_connect_timeout memcached_next_upstream memcached_read_timeout memcached_send_timeout memcached_upstream_fail_timeout memcached_upstream_max_fails merge_slashes min_delete_depth modern_browser modern_browser_value msie_padding msie_refresh multi_accept open_file_cache open_file_cache_errors open_file_cache_events open_file_cache_min_uses open_file_cache_valid open_log_file_cache output_buffers override_charset perl perl_modules perl_require perl_set pid pop3_auth pop3_capabilities port_in_redirect postpone_gzipping postpone_output protocol proxy proxy_bind proxy_buffer proxy_buffer_size proxy_buffering proxy_buffers proxy_busy_buffers_size proxy_cache proxy_cache_key proxy_cache_methods proxy_cache_min_uses proxy_cache_path proxy_cache_use_stale proxy_cache_valid proxy_connect_timeout proxy_headers_hash_bucket_size proxy_headers_hash_max_size proxy_hide_header proxy_ignore_client_abort proxy_ignore_headers proxy_intercept_errors proxy_max_temp_file_size proxy_method proxy_next_upstream proxy_pass_error_message proxy_pass_header proxy_pass_request_body proxy_pass_request_headers proxy_read_timeout proxy_redirect proxy_send_lowat proxy_send_timeout proxy_set_body proxy_set_header proxy_ssl_session_reuse proxy_store proxy_store_access proxy_temp_file_write_size proxy_temp_path proxy_timeout proxy_upstream_fail_timeout proxy_upstream_max_fails random_index read_ahead real_ip_header recursive_error_pages request_pool_size reset_timedout_connection resolver resolver_timeout rewrite_log rtsig_overflow_events rtsig_overflow_test rtsig_overflow_threshold rtsig_signo satisfy secure_link_secret send_lowat send_timeout sendfile sendfile_max_chunk server_name_in_redirect server_names_hash_bucket_size server_names_hash_max_size server_tokens set_real_ip_from smtp_auth smtp_capabilities smtp_client_buffer smtp_greeting_delay so_keepalive source_charset ssi ssi_ignore_recycled_buffers ssi_min_file_chunk ssi_silent_errors ssi_types ssi_value_length ssl ssl_certificate ssl_certificate_key ssl_ciphers ssl_client_certificate ssl_crl ssl_dhparam ssl_engine ssl_prefer_server_ciphers ssl_protocols ssl_session_cache ssl_session_timeout ssl_verify_client ssl_verify_depth starttls stub_status sub_filter sub_filter_once sub_filter_types tcp_nodelay tcp_nopush thread_stack_size timeout timer_resolution types_hash_bucket_size types_hash_max_size underscores_in_headers uninitialized_variable_warn use user userid userid_domain userid_expires userid_mark userid_name userid_p3p userid_path userid_service valid_referers variables_hash_bucket_size variables_hash_max_size worker_connections worker_cpu_affinity worker_priority worker_processes worker_rlimit_core worker_rlimit_nofile worker_rlimit_sigpending worker_threads working_directory xclient xml_entities xslt_stylesheet xslt_typesdrew@li229-23"),s=i("http mail events server types location upstream charset_map limit_except if geo map"),o=i("include root server server_name listen internal proxy_pass memcached_pass fastcgi_pass try_files"),a=n.indentUnit,c;function u(g,m){return c=m,g}function d(g,m){g.eatWhile(/[\w\$_]/);var v=g.current();if(r.propertyIsEnumerable(v))return"keyword";if(s.propertyIsEnumerable(v))return"variable-2";if(o.propertyIsEnumerable(v))return"string-2";var b=g.next();if(b=="@")return g.eatWhile(/[\w\\\-]/),u("meta",g.current());if(b=="/"&&g.eat("*"))return m.tokenize=h,h(g,m);if(b=="<"&&g.eat("!"))return m.tokenize=f,f(g,m);if(b=="=")u(null,"compare");else return(b=="~"||b=="|")&&g.eat("=")?u(null,"compare"):b=='"'||b=="'"?(m.tokenize=p(b),m.tokenize(g,m)):b=="#"?(g.skipToEnd(),u("comment","comment")):b=="!"?(g.match(/^\s*\w*/),u("keyword","important")):/\d/.test(b)?(g.eatWhile(/[\w.%]/),u("number","unit")):/[,.+>*\/]/.test(b)?u(null,"select-op"):/[;{}:\[\]]/.test(b)?u(null,b):(g.eatWhile(/[\w\\\-]/),u("variable","variable"))}function h(g,m){for(var v=!1,b;(b=g.next())!=null;){if(v&&b=="/"){m.tokenize=d;break}v=b=="*"}return u("comment","comment")}function f(g,m){for(var v=0,b;(b=g.next())!=null;){if(v>=2&&b==">"){m.tokenize=d;break}v=b=="-"?v+1:0}return u("comment","comment")}function p(g){return function(m,v){for(var b=!1,_;(_=m.next())!=null&&!(_==g&&!b);)b=!b&&_=="\\";return b||(v.tokenize=d),u("string","string")}}return{startState:function(g){return{tokenize:d,baseIndent:g||0,stack:[]}},token:function(g,m){if(g.eatSpace())return null;c=null;var v=m.tokenize(g,m),b=m.stack[m.stack.length-1];return c=="hash"&&b=="rule"?v="atom":v=="variable"&&(b=="rule"?v="number":(!b||b=="@media{")&&(v="tag")),b=="rule"&&/^[\{\};]$/.test(c)&&m.stack.pop(),c=="{"?b=="@media"?m.stack[m.stack.length-1]="@media{":m.stack.push("{"):c=="}"?m.stack.pop():c=="@media"?m.stack.push("@media"):b=="{"&&c!="comment"&&m.stack.push("rule"),v},indent:function(g,m){var v=g.stack.length;return/^\}/.test(m)&&(v-=g.stack[g.stack.length-1]=="rule"?2:1),g.baseIndent+v*a},electricChars:"}"}}),e.defineMIME("text/x-nginx-conf","nginx")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("pascal",function(){function n(d){for(var h={},f=d.split(" "),p=0;p<f.length;++p)h[f[p]]=!0;return h}var i=n("absolute and array asm begin case const constructor destructor div do downto else end file for function goto if implementation in inherited inline interface label mod nil not object of operator or packed procedure program record reintroduce repeat self set shl shr string then to type unit until uses var while with xor as class dispinterface except exports finalization finally initialization inline is library on out packed property raise resourcestring threadvar try absolute abstract alias assembler bitpacked break cdecl continue cppdecl cvar default deprecated dynamic enumerator experimental export external far far16 forward generic helper implements index interrupt iocheck local message name near nodefault noreturn nostackframe oldfpccall otherwise overload override pascal platform private protected public published read register reintroduce result safecall saveregisters softfloat specialize static stdcall stored strict unaligned unimplemented varargs virtual write"),r={null:!0},s=/[+\-*&%=<>!?|\/]/;function o(d,h){var f=d.next();if(f=="#"&&h.startOfLine)return d.skipToEnd(),"meta";if(f=='"'||f=="'")return h.tokenize=a(f),h.tokenize(d,h);if(f=="("&&d.eat("*"))return h.tokenize=c,c(d,h);if(f=="{")return h.tokenize=u,u(d,h);if(/[\[\]\(\),;\:\.]/.test(f))return null;if(/\d/.test(f))return d.eatWhile(/[\w\.]/),"number";if(f=="/"&&d.eat("/"))return d.skipToEnd(),"comment";if(s.test(f))return d.eatWhile(s),"operator";d.eatWhile(/[\w\$_]/);var p=d.current();return i.propertyIsEnumerable(p)?"keyword":r.propertyIsEnumerable(p)?"atom":"variable"}function a(d){return function(h,f){for(var p=!1,g,m=!1;(g=h.next())!=null;){if(g==d&&!p){m=!0;break}p=!p&&g=="\\"}return(m||!p)&&(f.tokenize=null),"string"}}function c(d,h){for(var f=!1,p;p=d.next();){if(p==")"&&f){h.tokenize=null;break}f=p=="*"}return"comment"}function u(d,h){for(var f;f=d.next();)if(f=="}"){h.tokenize=null;break}return"comment"}return{startState:function(){return{tokenize:null}},token:function(d,h){if(d.eatSpace())return null;var f=(h.tokenize||o)(d,h);return f=="comment"||f=="meta",f},electricChars:"{}"}}),e.defineMIME("text/x-pascal","pascal")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("perl",function(){var o={"->":4,"++":4,"--":4,"**":4,"=~":4,"!~":4,"*":4,"/":4,"%":4,x:4,"+":4,"-":4,".":4,"<<":4,">>":4,"<":4,">":4,"<=":4,">=":4,lt:4,gt:4,le:4,ge:4,"==":4,"!=":4,"<=>":4,eq:4,ne:4,cmp:4,"~~":4,"&":4,"|":4,"^":4,"&&":4,"||":4,"//":4,"..":4,"...":4,"?":4,":":4,"=":4,"+=":4,"-=":4,"*=":4,",":4,"=>":4,"::":4,not:4,and:4,or:4,xor:4,BEGIN:[5,1],END:[5,1],PRINT:[5,1],PRINTF:[5,1],GETC:[5,1],READ:[5,1],READLINE:[5,1],DESTROY:[5,1],TIE:[5,1],TIEHANDLE:[5,1],UNTIE:[5,1],STDIN:5,STDIN_TOP:5,STDOUT:5,STDOUT_TOP:5,STDERR:5,STDERR_TOP:5,$ARG:5,$_:5,"@ARG":5,"@_":5,$LIST_SEPARATOR:5,'$"':5,$PROCESS_ID:5,$PID:5,$$:5,$REAL_GROUP_ID:5,$GID:5,"$(":5,$EFFECTIVE_GROUP_ID:5,$EGID:5,"$)":5,$PROGRAM_NAME:5,$0:5,$SUBSCRIPT_SEPARATOR:5,$SUBSEP:5,"$;":5,$REAL_USER_ID:5,$UID:5,"$<":5,$EFFECTIVE_USER_ID:5,$EUID:5,"$>":5,$a:5,$b:5,$COMPILING:5,"$^C":5,$DEBUGGING:5,"$^D":5,"${^ENCODING}":5,$ENV:5,"%ENV":5,$SYSTEM_FD_MAX:5,"$^F":5,"@F":5,"${^GLOBAL_PHASE}":5,"$^H":5,"%^H":5,"@INC":5,"%INC":5,$INPLACE_EDIT:5,"$^I":5,"$^M":5,$OSNAME:5,"$^O":5,"${^OPEN}":5,$PERLDB:5,"$^P":5,$SIG:5,"%SIG":5,$BASETIME:5,"$^T":5,"${^TAINT}":5,"${^UNICODE}":5,"${^UTF8CACHE}":5,"${^UTF8LOCALE}":5,$PERL_VERSION:5,"$^V":5,"${^WIN32_SLOPPY_STAT}":5,$EXECUTABLE_NAME:5,"$^X":5,$1:5,$MATCH:5,"$&":5,"${^MATCH}":5,$PREMATCH:5,"$`":5,"${^PREMATCH}":5,$POSTMATCH:5,"$'":5,"${^POSTMATCH}":5,$LAST_PAREN_MATCH:5,"$+":5,$LAST_SUBMATCH_RESULT:5,"$^N":5,"@LAST_MATCH_END":5,"@+":5,"%LAST_PAREN_MATCH":5,"%+":5,"@LAST_MATCH_START":5,"@-":5,"%LAST_MATCH_START":5,"%-":5,$LAST_REGEXP_CODE_RESULT:5,"$^R":5,"${^RE_DEBUG_FLAGS}":5,"${^RE_TRIE_MAXBUF}":5,$ARGV:5,"@ARGV":5,ARGV:5,ARGVOUT:5,$OUTPUT_FIELD_SEPARATOR:5,$OFS:5,"$,":5,$INPUT_LINE_NUMBER:5,$NR:5,"$.":5,$INPUT_RECORD_SEPARATOR:5,$RS:5,"$/":5,$OUTPUT_RECORD_SEPARATOR:5,$ORS:5,"$\\":5,$OUTPUT_AUTOFLUSH:5,"$|":5,$ACCUMULATOR:5,"$^A":5,$FORMAT_FORMFEED:5,"$^L":5,$FORMAT_PAGE_NUMBER:5,"$%":5,$FORMAT_LINES_LEFT:5,"$-":5,$FORMAT_LINE_BREAK_CHARACTERS:5,"$:":5,$FORMAT_LINES_PER_PAGE:5,"$=":5,$FORMAT_TOP_NAME:5,"$^":5,$FORMAT_NAME:5,"$~":5,"${^CHILD_ERROR_NATIVE}":5,$EXTENDED_OS_ERROR:5,"$^E":5,$EXCEPTIONS_BEING_CAUGHT:5,"$^S":5,$WARNING:5,"$^W":5,"${^WARNING_BITS}":5,$OS_ERROR:5,$ERRNO:5,"$!":5,"%OS_ERROR":5,"%ERRNO":5,"%!":5,$CHILD_ERROR:5,"$?":5,$EVAL_ERROR:5,"$@":5,$OFMT:5,"$#":5,"$*":5,$ARRAY_BASE:5,"$[":5,$OLD_PERL_VERSION:5,"$]":5,if:[1,1],elsif:[1,1],else:[1,1],while:[1,1],unless:[1,1],for:[1,1],foreach:[1,1],abs:1,accept:1,alarm:1,atan2:1,bind:1,binmode:1,bless:1,bootstrap:1,break:1,caller:1,chdir:1,chmod:1,chomp:1,chop:1,chown:1,chr:1,chroot:1,close:1,closedir:1,connect:1,continue:[1,1],cos:1,crypt:1,dbmclose:1,dbmopen:1,default:1,defined:1,delete:1,die:1,do:1,dump:1,each:1,endgrent:1,endhostent:1,endnetent:1,endprotoent:1,endpwent:1,endservent:1,eof:1,eval:1,exec:1,exists:1,exit:1,exp:1,fcntl:1,fileno:1,flock:1,fork:1,format:1,formline:1,getc:1,getgrent:1,getgrgid:1,getgrnam:1,gethostbyaddr:1,gethostbyname:1,gethostent:1,getlogin:1,getnetbyaddr:1,getnetbyname:1,getnetent:1,getpeername:1,getpgrp:1,getppid:1,getpriority:1,getprotobyname:1,getprotobynumber:1,getprotoent:1,getpwent:1,getpwnam:1,getpwuid:1,getservbyname:1,getservbyport:1,getservent:1,getsockname:1,getsockopt:1,given:1,glob:1,gmtime:1,goto:1,grep:1,hex:1,import:1,index:1,int:1,ioctl:1,join:1,keys:1,kill:1,last:1,lc:1,lcfirst:1,length:1,link:1,listen:1,local:2,localtime:1,lock:1,log:1,lstat:1,m:null,map:1,mkdir:1,msgctl:1,msgget:1,msgrcv:1,msgsnd:1,my:2,new:1,next:1,no:1,oct:1,open:1,opendir:1,ord:1,our:2,pack:1,package:1,pipe:1,pop:1,pos:1,print:1,printf:1,prototype:1,push:1,q:null,qq:null,qr:null,quotemeta:null,qw:null,qx:null,rand:1,read:1,readdir:1,readline:1,readlink:1,readpipe:1,recv:1,redo:1,ref:1,rename:1,require:1,reset:1,return:1,reverse:1,rewinddir:1,rindex:1,rmdir:1,s:null,say:1,scalar:1,seek:1,seekdir:1,select:1,semctl:1,semget:1,semop:1,send:1,setgrent:1,sethostent:1,setnetent:1,setpgrp:1,setpriority:1,setprotoent:1,setpwent:1,setservent:1,setsockopt:1,shift:1,shmctl:1,shmget:1,shmread:1,shmwrite:1,shutdown:1,sin:1,sleep:1,socket:1,socketpair:1,sort:1,splice:1,split:1,sprintf:1,sqrt:1,srand:1,stat:1,state:1,study:1,sub:1,substr:1,symlink:1,syscall:1,sysopen:1,sysread:1,sysseek:1,system:1,syswrite:1,tell:1,telldir:1,tie:1,tied:1,time:1,times:1,tr:null,truncate:1,uc:1,ucfirst:1,umask:1,undef:1,unlink:1,unpack:1,unshift:1,untie:1,use:1,utime:1,values:1,vec:1,wait:1,waitpid:1,wantarray:1,warn:1,when:1,write:1,y:null},a="string-2",c=/[goseximacplud]/;function u(f,p,g,m,v){return p.chain=null,p.style=null,p.tail=null,p.tokenize=function(b,_){for(var x=!1,w,E=0;w=b.next();){if(w===g[E]&&!x)return g[++E]!==void 0?(_.chain=g[E],_.style=m,_.tail=v):v&&b.eatWhile(v),_.tokenize=h,m;x=!x&&w=="\\"}return m},p.tokenize(f,p)}function d(f,p,g){return p.tokenize=function(m,v){return m.string==g&&(v.tokenize=h),m.skipToEnd(),"string"},p.tokenize(f,p)}function h(f,p){if(f.eatSpace())return null;if(p.chain)return u(f,p,p.chain,p.style,p.tail);if(f.match(/^(\-?((\d[\d_]*)?\.\d+(e[+-]?\d+)?|\d+\.\d*)|0x[\da-fA-F_]+|0b[01_]+|\d[\d_]*(e[+-]?\d+)?)/))return"number";if(f.match(/^<<(?=[_a-zA-Z])/))return f.eatWhile(/\w/),d(f,p,f.current().substr(2));if(f.sol()&&f.match(/^\=item(?!\w)/))return d(f,p,"=cut");var g=f.next();if(g=='"'||g=="'"){if(i(f,3)=="<<"+g){var m=f.pos;f.eatWhile(/\w/);var v=f.current().substr(1);if(v&&f.eat(g))return d(f,p,v);f.pos=m}return u(f,p,[g],"string")}if(g=="q"){var b=n(f,-2);if(!(b&&/\w/.test(b))){if(b=n(f,0),b=="x"){if(b=n(f,1),b=="(")return s(f,2),u(f,p,[")"],a,c);if(b=="[")return s(f,2),u(f,p,["]"],a,c);if(b=="{")return s(f,2),u(f,p,["}"],a,c);if(b=="<")return s(f,2),u(f,p,[">"],a,c);if(/[\^'"!~\/]/.test(b))return s(f,1),u(f,p,[f.eat(b)],a,c)}else if(b=="q"){if(b=n(f,1),b=="(")return s(f,2),u(f,p,[")"],"string");if(b=="[")return s(f,2),u(f,p,["]"],"string");if(b=="{")return s(f,2),u(f,p,["}"],"string");if(b=="<")return s(f,2),u(f,p,[">"],"string");if(/[\^'"!~\/]/.test(b))return s(f,1),u(f,p,[f.eat(b)],"string")}else if(b=="w"){if(b=n(f,1),b=="(")return s(f,2),u(f,p,[")"],"bracket");if(b=="[")return s(f,2),u(f,p,["]"],"bracket");if(b=="{")return s(f,2),u(f,p,["}"],"bracket");if(b=="<")return s(f,2),u(f,p,[">"],"bracket");if(/[\^'"!~\/]/.test(b))return s(f,1),u(f,p,[f.eat(b)],"bracket")}else if(b=="r"){if(b=n(f,1),b=="(")return s(f,2),u(f,p,[")"],a,c);if(b=="[")return s(f,2),u(f,p,["]"],a,c);if(b=="{")return s(f,2),u(f,p,["}"],a,c);if(b=="<")return s(f,2),u(f,p,[">"],a,c);if(/[\^'"!~\/]/.test(b))return s(f,1),u(f,p,[f.eat(b)],a,c)}else if(/[\^'"!~\/(\[{<]/.test(b)){if(b=="(")return s(f,1),u(f,p,[")"],"string");if(b=="[")return s(f,1),u(f,p,["]"],"string");if(b=="{")return s(f,1),u(f,p,["}"],"string");if(b=="<")return s(f,1),u(f,p,[">"],"string");if(/[\^'"!~\/]/.test(b))return u(f,p,[f.eat(b)],"string")}}}if(g=="m"){var b=n(f,-2);if(!(b&&/\w/.test(b))&&(b=f.eat(/[(\[{<\^'"!~\/]/),b)){if(/[\^'"!~\/]/.test(b))return u(f,p,[b],a,c);if(b=="(")return u(f,p,[")"],a,c);if(b=="[")return u(f,p,["]"],a,c);if(b=="{")return u(f,p,["}"],a,c);if(b=="<")return u(f,p,[">"],a,c)}}if(g=="s"){var b=/[\/>\]})\w]/.test(n(f,-2));if(!b&&(b=f.eat(/[(\[{<\^'"!~\/]/),b))return b=="["?u(f,p,["]","]"],a,c):b=="{"?u(f,p,["}","}"],a,c):b=="<"?u(f,p,[">",">"],a,c):b=="("?u(f,p,[")",")"],a,c):u(f,p,[b,b],a,c)}if(g=="y"){var b=/[\/>\]})\w]/.test(n(f,-2));if(!b&&(b=f.eat(/[(\[{<\^'"!~\/]/),b))return b=="["?u(f,p,["]","]"],a,c):b=="{"?u(f,p,["}","}"],a,c):b=="<"?u(f,p,[">",">"],a,c):b=="("?u(f,p,[")",")"],a,c):u(f,p,[b,b],a,c)}if(g=="t"){var b=/[\/>\]})\w]/.test(n(f,-2));if(!b&&(b=f.eat("r"),b&&(b=f.eat(/[(\[{<\^'"!~\/]/),b)))return b=="["?u(f,p,["]","]"],a,c):b=="{"?u(f,p,["}","}"],a,c):b=="<"?u(f,p,[">",">"],a,c):b=="("?u(f,p,[")",")"],a,c):u(f,p,[b,b],a,c)}if(g=="`")return u(f,p,[g],"variable-2");if(g=="/")return/~\s*$/.test(i(f))?u(f,p,[g],a,c):"operator";if(g=="$"){var m=f.pos;if(f.eatWhile(/\d/)||f.eat("{")&&f.eatWhile(/\d/)&&f.eat("}"))return"variable-2";f.pos=m}if(/[$@%]/.test(g)){var m=f.pos;if(f.eat("^")&&f.eat(/[A-Z]/)||!/[@$%&]/.test(n(f,-2))&&f.eat(/[=|\\\-#?@;:&`~\^!\[\]*'"$+.,\/<>()]/)){var b=f.current();if(o[b])return"variable-2"}f.pos=m}if(/[$@%&]/.test(g)&&(f.eatWhile(/[\w$]/)||f.eat("{")&&f.eatWhile(/[\w$]/)&&f.eat("}"))){var b=f.current();return o[b]?"variable-2":"variable"}if(g=="#"&&n(f,-2)!="$")return f.skipToEnd(),"comment";if(/[:+\-\^*$&%@=<>!?|\/~\.]/.test(g)){var m=f.pos;if(f.eatWhile(/[:+\-\^*$&%@=<>!?|\/~\.]/),o[f.current()])return"operator";f.pos=m}if(g=="_"&&f.pos==1){if(r(f,6)=="_END__")return u(f,p,["\0"],"comment");if(r(f,7)=="_DATA__")return u(f,p,["\0"],"variable-2");if(r(f,7)=="_C__")return u(f,p,["\0"],"string")}if(/\w/.test(g)){var m=f.pos;if(n(f,-2)=="{"&&(n(f,0)=="}"||f.eatWhile(/\w/)&&n(f,0)=="}"))return"string";f.pos=m}if(/[A-Z]/.test(g)){var _=n(f,-2),m=f.pos;if(f.eatWhile(/[A-Z_]/),/[\da-z]/.test(n(f,0)))f.pos=m;else{var b=o[f.current()];return b?(b[1]&&(b=b[0]),_!=":"?b==1?"keyword":b==2?"def":b==3?"atom":b==4?"operator":b==5?"variable-2":"meta":"meta"):"meta"}}if(/[a-zA-Z_]/.test(g)){var _=n(f,-2);f.eatWhile(/\w/);var b=o[f.current()];return b?(b[1]&&(b=b[0]),_!=":"?b==1?"keyword":b==2?"def":b==3?"atom":b==4?"operator":b==5?"variable-2":"meta":"meta"):"meta"}return null}return{startState:function(){return{tokenize:h,chain:null,style:null,tail:null}},token:function(f,p){return(p.tokenize||h)(f,p)},lineComment:"#"}}),e.registerHelper("wordChars","perl",/[\w$]/),e.defineMIME("text/x-perl","perl");function n(o,a){return o.string.charAt(o.pos+(a||0))}function i(o,a){if(a){var c=o.pos-a;return o.string.substr(c>=0?c:0,a)}else return o.string.substr(0,o.pos-1)}function r(o,a){var c=o.string.length,u=c-o.pos+1;return o.string.substr(o.pos,a&&a<c?a:u)}function s(o,a){var c=o.pos+a,u;c<=0?o.pos=0:c>=(u=o.string.length-1)?o.pos=u:o.pos=c}})})();(function(l,t){(function(e){e(Ke.exports,Gg.exports,Hl())})(function(e){function n(d){for(var h={},f=d.split(" "),p=0;p<f.length;++p)h[f[p]]=!0;return h}function i(d,h,f){return d.length==0?r(h):function(p,g){for(var m=d[0],v=0;v<m.length;v++)if(p.match(m[v][0]))return g.tokenize=i(d.slice(1),h),m[v][1];return g.tokenize=r(h,f),"string"}}function r(d,h){return function(f,p){return s(f,p,d,h)}}function s(d,h,f,p){if(p!==!1&&d.match("${",!1)||d.match("{$",!1))return h.tokenize=null,"string";if(p!==!1&&d.match(/^\$[a-zA-Z_][a-zA-Z0-9_]*/))return d.match("[",!1)&&(h.tokenize=i([[["[",null]],[[/\d[\w\.]*/,"number"],[/\$[a-zA-Z_][a-zA-Z0-9_]*/,"variable-2"],[/[\w\$]+/,"variable"]],[["]",null]]],f,p)),d.match(/^->\w/,!1)&&(h.tokenize=i([[["->",null]],[[/[\w]+/,"variable"]]],f,p)),"variable-2";for(var g=!1;!d.eol()&&(g||p===!1||!d.match("{$",!1)&&!d.match(/^(\$[a-zA-Z_][a-zA-Z0-9_]*|\$\{)/,!1));){if(!g&&d.match(f)){h.tokenize=null,h.tokStack.pop(),h.tokStack.pop();break}g=d.next()=="\\"&&!g}return"string"}var o="abstract and array as break case catch class clone const continue declare default do else elseif enddeclare endfor endforeach endif endswitch endwhile enum extends final for foreach function global goto if implements interface instanceof namespace new or private protected public static switch throw trait try use var while xor die echo empty exit eval include include_once isset list require require_once return print unset __halt_compiler self static parent yield insteadof finally readonly match",a="true false null TRUE FALSE NULL __CLASS__ __DIR__ __FILE__ __LINE__ __METHOD__ __FUNCTION__ __NAMESPACE__ __TRAIT__",c="func_num_args func_get_arg func_get_args strlen strcmp strncmp strcasecmp strncasecmp each error_reporting define defined trigger_error user_error set_error_handler restore_error_handler get_declared_classes get_loaded_extensions extension_loaded get_extension_funcs debug_backtrace constant bin2hex hex2bin sleep usleep time mktime gmmktime strftime gmstrftime strtotime date gmdate getdate localtime checkdate flush wordwrap htmlspecialchars htmlentities html_entity_decode md5 md5_file crc32 getimagesize image_type_to_mime_type phpinfo phpversion phpcredits strnatcmp strnatcasecmp substr_count strspn strcspn strtok strtoupper strtolower strpos strrpos strrev hebrev hebrevc nl2br basename dirname pathinfo stripslashes stripcslashes strstr stristr strrchr str_shuffle str_word_count strcoll substr substr_replace quotemeta ucfirst ucwords strtr addslashes addcslashes rtrim str_replace str_repeat count_chars chunk_split trim ltrim strip_tags similar_text explode implode setlocale localeconv parse_str str_pad chop strchr sprintf printf vprintf vsprintf sscanf fscanf parse_url urlencode urldecode rawurlencode rawurldecode readlink linkinfo link unlink exec system escapeshellcmd escapeshellarg passthru shell_exec proc_open proc_close rand srand getrandmax mt_rand mt_srand mt_getrandmax base64_decode base64_encode abs ceil floor round is_finite is_nan is_infinite bindec hexdec octdec decbin decoct dechex base_convert number_format fmod ip2long long2ip getenv putenv getopt microtime gettimeofday getrusage uniqid quoted_printable_decode set_time_limit get_cfg_var magic_quotes_runtime set_magic_quotes_runtime get_magic_quotes_gpc get_magic_quotes_runtime import_request_variables error_log serialize unserialize memory_get_usage memory_get_peak_usage var_dump var_export debug_zval_dump print_r highlight_file show_source highlight_string ini_get ini_get_all ini_set ini_alter ini_restore get_include_path set_include_path restore_include_path setcookie header headers_sent connection_aborted connection_status ignore_user_abort parse_ini_file is_uploaded_file move_uploaded_file intval floatval doubleval strval gettype settype is_null is_resource is_bool is_long is_float is_int is_integer is_double is_real is_numeric is_string is_array is_object is_scalar ereg ereg_replace eregi eregi_replace split spliti join sql_regcase dl pclose popen readfile rewind rmdir umask fclose feof fgetc fgets fgetss fread fopen fpassthru ftruncate fstat fseek ftell fflush fwrite fputs mkdir rename copy tempnam tmpfile file file_get_contents file_put_contents stream_select stream_context_create stream_context_set_params stream_context_set_option stream_context_get_options stream_filter_prepend stream_filter_append fgetcsv flock get_meta_tags stream_set_write_buffer set_file_buffer set_socket_blocking stream_set_blocking socket_set_blocking stream_get_meta_data stream_register_wrapper stream_wrapper_register stream_set_timeout socket_set_timeout socket_get_status realpath fnmatch fsockopen pfsockopen pack unpack get_browser crypt opendir closedir chdir getcwd rewinddir readdir dir glob fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype file_exists is_writable is_writeable is_readable is_executable is_file is_dir is_link stat lstat chown touch clearstatcache mail ob_start ob_flush ob_clean ob_end_flush ob_end_clean ob_get_flush ob_get_clean ob_get_length ob_get_level ob_get_status ob_get_contents ob_implicit_flush ob_list_handlers ksort krsort natsort natcasesort asort arsort sort rsort usort uasort uksort shuffle array_walk count end prev next reset current key min max in_array array_search extract compact array_fill range array_multisort array_push array_pop array_shift array_unshift array_splice array_slice array_merge array_merge_recursive array_keys array_values array_count_values array_reverse array_reduce array_pad array_flip array_change_key_case array_rand array_unique array_intersect array_intersect_assoc array_diff array_diff_assoc array_sum array_filter array_map array_chunk array_key_exists array_intersect_key array_combine array_column pos sizeof key_exists assert assert_options version_compare ftok str_rot13 aggregate session_name session_module_name session_save_path session_id session_regenerate_id session_decode session_register session_unregister session_is_registered session_encode session_start session_destroy session_unset session_set_save_handler session_cache_limiter session_cache_expire session_set_cookie_params session_get_cookie_params session_write_close preg_match preg_match_all preg_replace preg_replace_callback preg_split preg_quote preg_grep overload ctype_alnum ctype_alpha ctype_cntrl ctype_digit ctype_lower ctype_graph ctype_print ctype_punct ctype_space ctype_upper ctype_xdigit virtual apache_request_headers apache_note apache_lookup_uri apache_child_terminate apache_setenv apache_response_headers apache_get_version getallheaders mysql_connect mysql_pconnect mysql_close mysql_select_db mysql_create_db mysql_drop_db mysql_query mysql_unbuffered_query mysql_db_query mysql_list_dbs mysql_list_tables mysql_list_fields mysql_list_processes mysql_error mysql_errno mysql_affected_rows mysql_insert_id mysql_result mysql_num_rows mysql_num_fields mysql_fetch_row mysql_fetch_array mysql_fetch_assoc mysql_fetch_object mysql_data_seek mysql_fetch_lengths mysql_fetch_field mysql_field_seek mysql_free_result mysql_field_name mysql_field_table mysql_field_len mysql_field_type mysql_field_flags mysql_escape_string mysql_real_escape_string mysql_stat mysql_thread_id mysql_client_encoding mysql_get_client_info mysql_get_host_info mysql_get_proto_info mysql_get_server_info mysql_info mysql mysql_fieldname mysql_fieldtable mysql_fieldlen mysql_fieldtype mysql_fieldflags mysql_selectdb mysql_createdb mysql_dropdb mysql_freeresult mysql_numfields mysql_numrows mysql_listdbs mysql_listtables mysql_listfields mysql_db_name mysql_dbname mysql_tablename mysql_table_name pg_connect pg_pconnect pg_close pg_connection_status pg_connection_busy pg_connection_reset pg_host pg_dbname pg_port pg_tty pg_options pg_ping pg_query pg_send_query pg_cancel_query pg_fetch_result pg_fetch_row pg_fetch_assoc pg_fetch_array pg_fetch_object pg_fetch_all pg_affected_rows pg_get_result pg_result_seek pg_result_status pg_free_result pg_last_oid pg_num_rows pg_num_fields pg_field_name pg_field_num pg_field_size pg_field_type pg_field_prtlen pg_field_is_null pg_get_notify pg_get_pid pg_result_error pg_last_error pg_last_notice pg_put_line pg_end_copy pg_copy_to pg_copy_from pg_trace pg_untrace pg_lo_create pg_lo_unlink pg_lo_open pg_lo_close pg_lo_read pg_lo_write pg_lo_read_all pg_lo_import pg_lo_export pg_lo_seek pg_lo_tell pg_escape_string pg_escape_bytea pg_unescape_bytea pg_client_encoding pg_set_client_encoding pg_meta_data pg_convert pg_insert pg_update pg_delete pg_select pg_exec pg_getlastoid pg_cmdtuples pg_errormessage pg_numrows pg_numfields pg_fieldname pg_fieldsize pg_fieldtype pg_fieldnum pg_fieldprtlen pg_fieldisnull pg_freeresult pg_result pg_loreadall pg_locreate pg_lounlink pg_loopen pg_loclose pg_loread pg_lowrite pg_loimport pg_loexport http_response_code get_declared_traits getimagesizefromstring socket_import_stream stream_set_chunk_size trait_exists header_register_callback class_uses session_status session_register_shutdown echo print global static exit array empty eval isset unset die include require include_once require_once json_decode json_encode json_last_error json_last_error_msg curl_close curl_copy_handle curl_errno curl_error curl_escape curl_exec curl_file_create curl_getinfo curl_init curl_multi_add_handle curl_multi_close curl_multi_exec curl_multi_getcontent curl_multi_info_read curl_multi_init curl_multi_remove_handle curl_multi_select curl_multi_setopt curl_multi_strerror curl_pause curl_reset curl_setopt_array curl_setopt curl_share_close curl_share_init curl_share_setopt curl_strerror curl_unescape curl_version mysqli_affected_rows mysqli_autocommit mysqli_change_user mysqli_character_set_name mysqli_close mysqli_commit mysqli_connect_errno mysqli_connect_error mysqli_connect mysqli_data_seek mysqli_debug mysqli_dump_debug_info mysqli_errno mysqli_error_list mysqli_error mysqli_fetch_all mysqli_fetch_array mysqli_fetch_assoc mysqli_fetch_field_direct mysqli_fetch_field mysqli_fetch_fields mysqli_fetch_lengths mysqli_fetch_object mysqli_fetch_row mysqli_field_count mysqli_field_seek mysqli_field_tell mysqli_free_result mysqli_get_charset mysqli_get_client_info mysqli_get_client_stats mysqli_get_client_version mysqli_get_connection_stats mysqli_get_host_info mysqli_get_proto_info mysqli_get_server_info mysqli_get_server_version mysqli_info mysqli_init mysqli_insert_id mysqli_kill mysqli_more_results mysqli_multi_query mysqli_next_result mysqli_num_fields mysqli_num_rows mysqli_options mysqli_ping mysqli_prepare mysqli_query mysqli_real_connect mysqli_real_escape_string mysqli_real_query mysqli_reap_async_query mysqli_refresh mysqli_rollback mysqli_select_db mysqli_set_charset mysqli_set_local_infile_default mysqli_set_local_infile_handler mysqli_sqlstate mysqli_ssl_set mysqli_stat mysqli_stmt_init mysqli_store_result mysqli_thread_id mysqli_thread_safe mysqli_use_result mysqli_warning_count";e.registerHelper("hintWords","php",[o,a,c].join(" ").split(" ")),e.registerHelper("wordChars","php",/[\w$]/);var u={name:"clike",helperType:"php",keywords:n(o),blockKeywords:n("catch do else elseif for foreach if switch try while finally"),defKeywords:n("class enum function interface namespace trait"),atoms:n(a),builtin:n(c),multiLineStrings:!0,hooks:{$:function(d){return d.eatWhile(/[\w\$_]/),"variable-2"},"<":function(d,h){var f;if(f=d.match(/^<<\s*/)){var p=d.eat(/['"]/);d.eatWhile(/[\w\.]/);var g=d.current().slice(f[0].length+(p?2:1));if(p&&d.eat(p),g)return(h.tokStack||(h.tokStack=[])).push(g,0),h.tokenize=r(g,p!="'"),"string"}return!1},"#":function(d){for(;!d.eol()&&!d.match("?>",!1);)d.next();return"comment"},"/":function(d){if(d.eat("/")){for(;!d.eol()&&!d.match("?>",!1);)d.next();return"comment"}return!1},'"':function(d,h){return(h.tokStack||(h.tokStack=[])).push('"',0),h.tokenize=r('"'),"string"},"{":function(d,h){return h.tokStack&&h.tokStack.length&&h.tokStack[h.tokStack.length-1]++,!1},"}":function(d,h){return h.tokStack&&h.tokStack.length>0&&!--h.tokStack[h.tokStack.length-1]&&(h.tokenize=r(h.tokStack[h.tokStack.length-2])),!1}}};e.defineMode("php",function(d,h){var f=e.getMode(d,h&&h.htmlMode||"text/html"),p=e.getMode(d,u);function g(m,v){var b=v.curMode==p;if(m.sol()&&v.pending&&v.pending!='"'&&v.pending!="'"&&(v.pending=null),b)return b&&v.php.tokenize==null&&m.match("?>")?(v.curMode=f,v.curState=v.html,v.php.context.prev||(v.php=null),"meta"):p.token(m,v.curState);if(m.match(/^<\?\w*/))return v.curMode=p,v.php||(v.php=e.startState(p,f.indent(v.html,"",""))),v.curState=v.php,"meta";if(v.pending=='"'||v.pending=="'"){for(;!m.eol()&&m.next()!=v.pending;);var _="string"}else if(v.pending&&m.pos<v.pending.end){m.pos=v.pending.end;var _=v.pending.style}else var _=f.token(m,v.curState);v.pending&&(v.pending=null);var x=m.current(),w=x.search(/<\?/),E;return w!=-1&&(_=="string"&&(E=x.match(/[\'\"]$/))&&!/\?>/.test(x)?v.pending=E[0]:v.pending={end:m.pos,style:_},m.backUp(x.length-w)),_}return{startState:function(){var m=e.startState(f),v=h.startOpen?e.startState(p):null;return{html:m,php:v,curMode:h.startOpen?p:f,curState:h.startOpen?v:m,pending:null}},copyState:function(m){var v=m.html,b=e.copyState(f,v),_=m.php,x=_&&e.copyState(p,_),w;return m.curMode==f?w=b:w=x,{html:b,php:x,curMode:m.curMode,curState:w,pending:m.pending}},token:g,indent:function(m,v,b){return m.curMode!=p&&/^\s*<\//.test(v)||m.curMode==p&&/^\?>/.test(v)?f.indent(m.html,v,b):m.curMode.indent(m.curState,v,b)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//",innerMode:function(m){return{state:m.curState,mode:m.curMode}}}},"htmlmixed","clike"),e.defineMIME("application/x-httpd-php","php"),e.defineMIME("application/x-httpd-php-open",{name:"php",startOpen:!0}),e.defineMIME("text/x-php",u)})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("powershell",function(){function n(A,F){F=F||{};for(var W=F.prefix!==void 0?F.prefix:"^",G=F.suffix!==void 0?F.suffix:"\\b",k=0;k<A.length;k++)A[k]instanceof RegExp?A[k]=A[k].source:A[k]=A[k].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");return new RegExp(W+"("+A.join("|")+")"+G,"i")}var i="(?=[^A-Za-z\\d\\-_]|$)",r=/[\w\-:]/,s=n([/begin|break|catch|continue|data|default|do|dynamicparam/,/else|elseif|end|exit|filter|finally|for|foreach|from|function|if|in/,/param|process|return|switch|throw|trap|try|until|where|while/],{suffix:i}),o=/[\[\]{},;`\\\.]|@[({]/,a=n(["f",/b?not/,/[ic]?split/,"join",/is(not)?/,"as",/[ic]?(eq|ne|[gl][te])/,/[ic]?(not)?(like|match|contains)/,/[ic]?replace/,/b?(and|or|xor)/],{prefix:"-"}),c=/[+\-*\/%]=|\+\+|--|\.\.|[+\-*&^%:=!|\/]|<(?!#)|(?!#)>/,u=n([a,c],{suffix:""}),d=/^((0x[\da-f]+)|((\d+\.\d+|\d\.|\.\d+|\d+)(e[\+\-]?\d+)?))[ld]?([kmgtp]b)?/i,h=/^[A-Za-z\_][A-Za-z\-\_\d]*\b/,f=/[A-Z]:|%|\?/i,p=n([/Add-(Computer|Content|History|Member|PSSnapin|Type)/,/Checkpoint-Computer/,/Clear-(Content|EventLog|History|Host|Item(Property)?|Variable)/,/Compare-Object/,/Complete-Transaction/,/Connect-PSSession/,/ConvertFrom-(Csv|Json|SecureString|StringData)/,/Convert-Path/,/ConvertTo-(Csv|Html|Json|SecureString|Xml)/,/Copy-Item(Property)?/,/Debug-Process/,/Disable-(ComputerRestore|PSBreakpoint|PSRemoting|PSSessionConfiguration)/,/Disconnect-PSSession/,/Enable-(ComputerRestore|PSBreakpoint|PSRemoting|PSSessionConfiguration)/,/(Enter|Exit)-PSSession/,/Export-(Alias|Clixml|Console|Counter|Csv|FormatData|ModuleMember|PSSession)/,/ForEach-Object/,/Format-(Custom|List|Table|Wide)/,new RegExp("Get-(Acl|Alias|AuthenticodeSignature|ChildItem|Command|ComputerRestorePoint|Content|ControlPanelItem|Counter|Credential|Culture|Date|Event|EventLog|EventSubscriber|ExecutionPolicy|FormatData|Help|History|Host|HotFix|Item|ItemProperty|Job|Location|Member|Module|PfxCertificate|Process|PSBreakpoint|PSCallStack|PSDrive|PSProvider|PSSession|PSSessionConfiguration|PSSnapin|Random|Service|TraceSource|Transaction|TypeData|UICulture|Unique|Variable|Verb|WinEvent|WmiObject)"),/Group-Object/,/Import-(Alias|Clixml|Counter|Csv|LocalizedData|Module|PSSession)/,/ImportSystemModules/,/Invoke-(Command|Expression|History|Item|RestMethod|WebRequest|WmiMethod)/,/Join-Path/,/Limit-EventLog/,/Measure-(Command|Object)/,/Move-Item(Property)?/,new RegExp("New-(Alias|Event|EventLog|Item(Property)?|Module|ModuleManifest|Object|PSDrive|PSSession|PSSessionConfigurationFile|PSSessionOption|PSTransportOption|Service|TimeSpan|Variable|WebServiceProxy|WinEvent)"),/Out-(Default|File|GridView|Host|Null|Printer|String)/,/Pause/,/(Pop|Push)-Location/,/Read-Host/,/Receive-(Job|PSSession)/,/Register-(EngineEvent|ObjectEvent|PSSessionConfiguration|WmiEvent)/,/Remove-(Computer|Event|EventLog|Item(Property)?|Job|Module|PSBreakpoint|PSDrive|PSSession|PSSnapin|TypeData|Variable|WmiObject)/,/Rename-(Computer|Item(Property)?)/,/Reset-ComputerMachinePassword/,/Resolve-Path/,/Restart-(Computer|Service)/,/Restore-Computer/,/Resume-(Job|Service)/,/Save-Help/,/Select-(Object|String|Xml)/,/Send-MailMessage/,new RegExp("Set-(Acl|Alias|AuthenticodeSignature|Content|Date|ExecutionPolicy|Item(Property)?|Location|PSBreakpoint|PSDebug|PSSessionConfiguration|Service|StrictMode|TraceSource|Variable|WmiInstance)"),/Show-(Command|ControlPanelItem|EventLog)/,/Sort-Object/,/Split-Path/,/Start-(Job|Process|Service|Sleep|Transaction|Transcript)/,/Stop-(Computer|Job|Process|Service|Transcript)/,/Suspend-(Job|Service)/,/TabExpansion2/,/Tee-Object/,/Test-(ComputerSecureChannel|Connection|ModuleManifest|Path|PSSessionConfigurationFile)/,/Trace-Command/,/Unblock-File/,/Undo-Transaction/,/Unregister-(Event|PSSessionConfiguration)/,/Update-(FormatData|Help|List|TypeData)/,/Use-Transaction/,/Wait-(Event|Job|Process)/,/Where-Object/,/Write-(Debug|Error|EventLog|Host|Output|Progress|Verbose|Warning)/,/cd|help|mkdir|more|oss|prompt/,/ac|asnp|cat|cd|chdir|clc|clear|clhy|cli|clp|cls|clv|cnsn|compare|copy|cp|cpi|cpp|cvpa|dbp|del|diff|dir|dnsn|ebp/,/echo|epal|epcsv|epsn|erase|etsn|exsn|fc|fl|foreach|ft|fw|gal|gbp|gc|gci|gcm|gcs|gdr|ghy|gi|gjb|gl|gm|gmo|gp|gps/,/group|gsn|gsnp|gsv|gu|gv|gwmi|h|history|icm|iex|ihy|ii|ipal|ipcsv|ipmo|ipsn|irm|ise|iwmi|iwr|kill|lp|ls|man|md/,/measure|mi|mount|move|mp|mv|nal|ndr|ni|nmo|npssc|nsn|nv|ogv|oh|popd|ps|pushd|pwd|r|rbp|rcjb|rcsn|rd|rdr|ren|ri/,/rjb|rm|rmdir|rmo|rni|rnp|rp|rsn|rsnp|rujb|rv|rvpa|rwmi|sajb|sal|saps|sasv|sbp|sc|select|set|shcm|si|sl|sleep|sls/,/sort|sp|spjb|spps|spsv|start|sujb|sv|swmi|tee|trcm|type|where|wjb|write/],{prefix:"",suffix:""}),g=n([/[$?^_]|Args|ConfirmPreference|ConsoleFileName|DebugPreference|Error|ErrorActionPreference|ErrorView|ExecutionContext/,/FormatEnumerationLimit|Home|Host|Input|MaximumAliasCount|MaximumDriveCount|MaximumErrorCount|MaximumFunctionCount/,/MaximumHistoryCount|MaximumVariableCount|MyInvocation|NestedPromptLevel|OutputEncoding|Pid|Profile|ProgressPreference/,/PSBoundParameters|PSCommandPath|PSCulture|PSDefaultParameterValues|PSEmailServer|PSHome|PSScriptRoot|PSSessionApplicationName/,/PSSessionConfigurationName|PSSessionOption|PSUICulture|PSVersionTable|Pwd|ShellId|StackTrace|VerbosePreference/,/WarningPreference|WhatIfPreference/,/Event|EventArgs|EventSubscriber|Sender/,/Matches|Ofs|ForEach|LastExitCode|PSCmdlet|PSItem|PSSenderInfo|This/,/true|false|null/],{prefix:"\\$",suffix:""}),m=n([f,p,g],{suffix:i}),v={keyword:s,number:d,operator:u,builtin:m,punctuation:o,identifier:h};function b(A,F){var W=F.returnStack[F.returnStack.length-1];if(W&&W.shouldReturnFrom(F))return F.tokenize=W.tokenize,F.returnStack.pop(),F.tokenize(A,F);if(A.eatSpace())return null;if(A.eat("("))return F.bracketNesting+=1,"punctuation";if(A.eat(")"))return F.bracketNesting-=1,"punctuation";for(var G in v)if(A.match(v[G]))return G;var k=A.next();if(k==="'")return _(A,F);if(k==="$")return P(A,F);if(k==='"')return x(A,F);if(k==="<"&&A.eat("#"))return F.tokenize=D,D(A,F);if(k==="#")return A.skipToEnd(),"comment";if(k==="@"){var C=A.eat(/["']/);if(C&&A.eol())return F.tokenize=L,F.startQuote=C[0],L(A,F);if(A.eol())return"error";if(A.peek().match(/[({]/))return"punctuation";if(A.peek().match(r))return P(A,F)}return"error"}function _(A,F){for(var W;(W=A.peek())!=null;)if(A.next(),W==="'"&&!A.eat("'"))return F.tokenize=b,"string";return"error"}function x(A,F){for(var W;(W=A.peek())!=null;){if(W==="$")return F.tokenize=w,"string";if(A.next(),W==="`"){A.next();continue}if(W==='"'&&!A.eat('"'))return F.tokenize=b,"string"}return"error"}function w(A,F){return R(A,F,x)}function E(A,F){return F.tokenize=L,F.startQuote='"',L(A,F)}function S(A,F){return R(A,F,E)}function R(A,F,W){if(A.match("$(")){var G=F.bracketNesting;return F.returnStack.push({shouldReturnFrom:function(k){return k.bracketNesting===G},tokenize:W}),F.tokenize=b,F.bracketNesting+=1,"punctuation"}else return A.next(),F.returnStack.push({shouldReturnFrom:function(){return!0},tokenize:W}),F.tokenize=P,F.tokenize(A,F)}function D(A,F){for(var W=!1,G;(G=A.next())!=null;){if(W&&G==">"){F.tokenize=b;break}W=G==="#"}return"comment"}function P(A,F){var W=A.peek();return A.eat("{")?(F.tokenize=O,O(A,F)):W!=null&&W.match(r)?(A.eatWhile(r),F.tokenize=b,"variable-2"):(F.tokenize=b,"error")}function O(A,F){for(var W;(W=A.next())!=null;)if(W==="}"){F.tokenize=b;break}return"variable-2"}function L(A,F){var W=F.startQuote;if(A.sol()&&A.match(new RegExp(W+"@")))F.tokenize=b;else if(W==='"')for(;!A.eol();){var G=A.peek();if(G==="$")return F.tokenize=S,"string";A.next(),G==="`"&&A.next()}else A.skipToEnd();return"string"}var B={startState:function(){return{returnStack:[],bracketNesting:0,tokenize:b}},token:function(A,F){return F.tokenize(A,F)},blockCommentStart:"<#",blockCommentEnd:"#>",lineComment:"#",fold:"brace"};return B}),e.defineMIME("application/x-powershell","powershell")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){function n(a){return new RegExp("^(("+a.join(")|(")+"))\\b","i")}var i=["package","message","import","syntax","required","optional","repeated","reserved","default","extensions","packed","bool","bytes","double","enum","float","string","int32","int64","uint32","uint64","sint32","sint64","fixed32","fixed64","sfixed32","sfixed64","option","service","rpc","returns"],r=n(i);e.registerHelper("hintWords","protobuf",i);var s=new RegExp("^[_A-Za-z\xA1-\uFFFF][_A-Za-z0-9\xA1-\uFFFF]*");function o(a){return a.eatSpace()?null:a.match("//")?(a.skipToEnd(),"comment"):a.match(/^[0-9\.+-]/,!1)&&(a.match(/^[+-]?0x[0-9a-fA-F]+/)||a.match(/^[+-]?\d*\.\d+([EeDd][+-]?\d+)?/)||a.match(/^[+-]?\d+([EeDd][+-]?\d+)?/))?"number":a.match(/^"([^"]|(""))*"/)||a.match(/^'([^']|(''))*'/)?"string":a.match(r)?"keyword":a.match(s)?"variable":(a.next(),null)}e.defineMode("protobuf",function(){return{token:o,fold:"brace"}}),e.defineMIME("text/x-protobuf","protobuf")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){function n(c){return new RegExp("^(("+c.join(")|(")+"))\\b")}var i=n(["and","or","not","is"]),r=["as","assert","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","lambda","pass","raise","return","try","while","with","yield","in","False","True"],s=["abs","all","any","bin","bool","bytearray","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip","__import__","NotImplemented","Ellipsis","__debug__"];e.registerHelper("hintWords","python",r.concat(s).concat(["exec","print"]));function o(c){return c.scopes[c.scopes.length-1]}e.defineMode("python",function(c,u){for(var d="error",h=u.delimiters||u.singleDelimiters||/^[\(\)\[\]\{\}@,:`=;\.\\]/,f=[u.singleOperators,u.doubleOperators,u.doubleDelimiters,u.tripleDelimiters,u.operators||/^([-+*/%\/&|^]=?|[<>=]+|\/\/=?|\*\*=?|!=|[~!@]|\.\.\.)/],p=0;p<f.length;p++)f[p]||f.splice(p--,1);var g=u.hangingIndent||c.indentUnit,m=r,v=s;u.extra_keywords!=null&&(m=m.concat(u.extra_keywords)),u.extra_builtins!=null&&(v=v.concat(u.extra_builtins));var b=!(u.version&&Number(u.version)<3);if(b){var _=u.identifiers||/^[_A-Za-z\u00A1-\uFFFF][_A-Za-z0-9\u00A1-\uFFFF]*/;m=m.concat(["nonlocal","None","aiter","anext","async","await","breakpoint","match","case"]),v=v.concat(["ascii","bytes","exec","print"]);var x=new RegExp(`^(([rbuf]|(br)|(rb)|(fr)|(rf))?('{3}|"{3}|['"]))`,"i")}else{var _=u.identifiers||/^[_A-Za-z][_A-Za-z0-9]*/;m=m.concat(["exec","print"]),v=v.concat(["apply","basestring","buffer","cmp","coerce","execfile","file","intern","long","raw_input","reduce","reload","unichr","unicode","xrange","None"]);var x=new RegExp(`^(([rubf]|(ur)|(br))?('{3}|"{3}|['"]))`,"i")}var w=n(m),E=n(v);function S(W,G){var k=W.sol()&&G.lastToken!="\\";if(k&&(G.indent=W.indentation()),k&&o(G).type=="py"){var C=o(G).offset;if(W.eatSpace()){var $=W.indentation();return $>C?O(G):$<C&&B(W,G)&&W.peek()!="#"&&(G.errorToken=!0),null}else{var z=R(W,G);return C>0&&B(W,G)&&(z+=" "+d),z}}return R(W,G)}function R(W,G,k){if(W.eatSpace())return null;if(!k&&W.match(/^#.*/))return"comment";if(W.match(/^[0-9\.]/,!1)){var C=!1;if(W.match(/^[\d_]*\.\d+(e[\+\-]?\d+)?/i)&&(C=!0),W.match(/^[\d_]+\.\d*/)&&(C=!0),W.match(/^\.\d+/)&&(C=!0),C)return W.eat(/J/i),"number";var $=!1;if(W.match(/^0x[0-9a-f_]+/i)&&($=!0),W.match(/^0b[01_]+/i)&&($=!0),W.match(/^0o[0-7_]+/i)&&($=!0),W.match(/^[1-9][\d_]*(e[\+\-]?[\d_]+)?/)&&(W.eat(/J/i),$=!0),W.match(/^0(?![\dx])/i)&&($=!0),$)return W.eat(/L/i),"number"}if(W.match(x)){var z=W.current().toLowerCase().indexOf("f")!==-1;return z?(G.tokenize=D(W.current(),G.tokenize),G.tokenize(W,G)):(G.tokenize=P(W.current(),G.tokenize),G.tokenize(W,G))}for(var M=0;M<f.length;M++)if(W.match(f[M]))return"operator";return W.match(h)?"punctuation":G.lastToken=="."&&W.match(_)?"property":W.match(w)||W.match(i)?"keyword":W.match(E)?"builtin":W.match(/^(self|cls)\b/)?"variable-2":W.match(_)?G.lastToken=="def"||G.lastToken=="class"?"def":"variable":(W.next(),k?null:d)}function D(W,G){for(;"rubf".indexOf(W.charAt(0).toLowerCase())>=0;)W=W.substr(1);var k=W.length==1,C="string";function $(M){return function(T,K){var ee=R(T,K,!0);return ee=="punctuation"&&(T.current()=="{"?K.tokenize=$(M+1):T.current()=="}"&&(M>1?K.tokenize=$(M-1):K.tokenize=z)),ee}}function z(M,T){for(;!M.eol();)if(M.eatWhile(/[^'"\{\}\\]/),M.eat("\\")){if(M.next(),k&&M.eol())return C}else{if(M.match(W))return T.tokenize=G,C;if(M.match("{{"))return C;if(M.match("{",!1))return T.tokenize=$(0),M.current()?C:T.tokenize(M,T);if(M.match("}}"))return C;if(M.match("}"))return d;M.eat(/['"]/)}if(k){if(u.singleLineStringErrors)return d;T.tokenize=G}return C}return z.isString=!0,z}function P(W,G){for(;"rubf".indexOf(W.charAt(0).toLowerCase())>=0;)W=W.substr(1);var k=W.length==1,C="string";function $(z,M){for(;!z.eol();)if(z.eatWhile(/[^'"\\]/),z.eat("\\")){if(z.next(),k&&z.eol())return C}else{if(z.match(W))return M.tokenize=G,C;z.eat(/['"]/)}if(k){if(u.singleLineStringErrors)return d;M.tokenize=G}return C}return $.isString=!0,$}function O(W){for(;o(W).type!="py";)W.scopes.pop();W.scopes.push({offset:o(W).offset+c.indentUnit,type:"py",align:null})}function L(W,G,k){var C=W.match(/^[\s\[\{\(]*(?:#|$)/,!1)?null:W.column()+1;G.scopes.push({offset:G.indent+g,type:k,align:C})}function B(W,G){for(var k=W.indentation();G.scopes.length>1&&o(G).offset>k;){if(o(G).type!="py")return!0;G.scopes.pop()}return o(G).offset!=k}function A(W,G){W.sol()&&(G.beginningOfLine=!0,G.dedent=!1);var k=G.tokenize(W,G),C=W.current();if(G.beginningOfLine&&C=="@")return W.match(_,!1)?"meta":b?"operator":d;if(/\S/.test(C)&&(G.beginningOfLine=!1),(k=="variable"||k=="builtin")&&G.lastToken=="meta"&&(k="meta"),(C=="pass"||C=="return")&&(G.dedent=!0),C=="lambda"&&(G.lambda=!0),C==":"&&!G.lambda&&o(G).type=="py"&&W.match(/^\s*(?:#|$)/,!1)&&O(G),C.length==1&&!/string|comment/.test(k)){var $="[({".indexOf(C);if($!=-1&&L(W,G,"])}".slice($,$+1)),$="])}".indexOf(C),$!=-1)if(o(G).type==C)G.indent=G.scopes.pop().offset-g;else return d}return G.dedent&&W.eol()&&o(G).type=="py"&&G.scopes.length>1&&G.scopes.pop(),k}var F={startState:function(W){return{tokenize:S,scopes:[{offset:W||0,type:"py",align:null}],indent:W||0,lastToken:null,lambda:!1,dedent:0}},token:function(W,G){var k=G.errorToken;k&&(G.errorToken=!1);var C=A(W,G);return C&&C!="comment"&&(G.lastToken=C=="keyword"||C=="punctuation"?W.current():C),C=="punctuation"&&(C=null),W.eol()&&G.lambda&&(G.lambda=!1),k?C+" "+d:C},indent:function(W,G){if(W.tokenize!=S)return W.tokenize.isString?e.Pass:0;var k=o(W),C=k.type==G.charAt(0)||k.type=="py"&&!W.dedent&&/^(else:|elif |except |finally:)/.test(G);return k.align!=null?k.align-(C?1:0):k.offset-(C?g:0)},electricInput:/^\s*([\}\]\)]|else:|elif |except |finally:)$/,closeBrackets:{triples:`'"`},lineComment:"#",fold:"indent"};return F}),e.defineMIME("text/x-python","python");var a=function(c){return c.split(" ")};e.defineMIME("text/x-cython",{name:"python",extra_keywords:a("by cdef cimport cpdef ctypedef enum except extern gil include nogil property public readonly struct union DEF IF ELIF ELSE")})})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.registerHelper("wordChars","r",/[\w.]/),e.defineMode("r",function(n){function i(S){for(var R={},D=0;D<S.length;++D)R[S[D]]=!0;return R}var r=["NULL","NA","Inf","NaN","NA_integer_","NA_real_","NA_complex_","NA_character_","TRUE","FALSE"],s=["list","quote","bquote","eval","return","call","parse","deparse"],o=["if","else","repeat","while","function","for","in","next","break"],a=["if","else","repeat","while","function","for"];e.registerHelper("hintWords","r",r.concat(s,o));var c=i(r),u=i(s),d=i(o),h=i(a),f=/[+\-*\/^<>=!&|~$:]/,p;function g(S,R){p=null;var D=S.next();if(D=="#")return S.skipToEnd(),"comment";if(D=="0"&&S.eat("x"))return S.eatWhile(/[\da-f]/i),"number";if(D=="."&&S.eat(/\d/))return S.match(/\d*(?:e[+\-]?\d+)?/),"number";if(/\d/.test(D))return S.match(/\d*(?:\.\d+)?(?:e[+\-]\d+)?L?/),"number";if(D=="'"||D=='"')return R.tokenize=m(D),"string";if(D=="`")return S.match(/[^`]+`/),"variable-3";if(D=="."&&S.match(/.(?:[.]|\d+)/))return"keyword";if(/[a-zA-Z\.]/.test(D)){S.eatWhile(/[\w\.]/);var P=S.current();return c.propertyIsEnumerable(P)?"atom":d.propertyIsEnumerable(P)?(h.propertyIsEnumerable(P)&&!S.match(/\s*if(\s+|$)/,!1)&&(p="block"),"keyword"):u.propertyIsEnumerable(P)?"builtin":"variable"}else return D=="%"?(S.skipTo("%")&&S.next(),"operator variable-2"):D=="<"&&S.eat("-")||D=="<"&&S.match("<-")||D=="-"&&S.match(/>>?/)?"operator arrow":D=="="&&R.ctx.argList?"arg-is":f.test(D)?D=="$"?"operator dollar":(S.eatWhile(f),"operator"):/[\(\){}\[\];]/.test(D)?(p=D,D==";"?"semi":null):null}function m(S){return function(R,D){if(R.eat("\\")){var P=R.next();return P=="x"?R.match(/^[a-f0-9]{2}/i):(P=="u"||P=="U")&&R.eat("{")&&R.skipTo("}")?R.next():P=="u"?R.match(/^[a-f0-9]{4}/i):P=="U"?R.match(/^[a-f0-9]{8}/i):/[0-7]/.test(P)&&R.match(/^[0-7]{1,2}/),"string-2"}else{for(var O;(O=R.next())!=null;){if(O==S){D.tokenize=g;break}if(O=="\\"){R.backUp(1);break}}return"string"}}}var v=1,b=2,_=4;function x(S,R,D){S.ctx={type:R,indent:S.indent,flags:0,column:D.column(),prev:S.ctx}}function w(S,R){var D=S.ctx;S.ctx={type:D.type,indent:D.indent,flags:D.flags|R,column:D.column,prev:D.prev}}function E(S){S.indent=S.ctx.indent,S.ctx=S.ctx.prev}return{startState:function(){return{tokenize:g,ctx:{type:"top",indent:-n.indentUnit,flags:b},indent:0,afterIdent:!1}},token:function(S,R){if(S.sol()&&((R.ctx.flags&3)==0&&(R.ctx.flags|=b),R.ctx.flags&_&&E(R),R.indent=S.indentation()),S.eatSpace())return null;var D=R.tokenize(S,R);return D!="comment"&&(R.ctx.flags&b)==0&&w(R,v),(p==";"||p=="{"||p=="}")&&R.ctx.type=="block"&&E(R),p=="{"?x(R,"}",S):p=="("?(x(R,")",S),R.afterIdent&&(R.ctx.argList=!0)):p=="["?x(R,"]",S):p=="block"?x(R,"block",S):p==R.ctx.type?E(R):R.ctx.type=="block"&&D!="comment"&&w(R,_),R.afterIdent=D=="variable"||D=="keyword",D},indent:function(S,R){if(S.tokenize!=g)return 0;var D=R&&R.charAt(0),P=S.ctx,O=D==P.type;return P.flags&_&&(P=P.prev),P.type=="block"?P.indent+(D=="{"?0:n.indentUnit):P.flags&v?P.column+(O?0:1):P.indent+(O?0:n.indentUnit)},lineComment:"#"}}),e.defineMIME("text/x-rsrc","r")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){function n(u){for(var d={},h=0,f=u.length;h<f;++h)d[u[h]]=!0;return d}var i=["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"],r=n(i),s=n(["def","class","case","for","while","until","module","catch","loop","proc","begin"]),o=n(["end","until"]),a={"[":"]","{":"}","(":")"},c={"]":"[","}":"{",")":"("};e.defineMode("ruby",function(u){var d;function h(x,w,E){return E.tokenize.push(x),x(w,E)}function f(x,w){if(x.sol()&&x.match("=begin")&&x.eol())return w.tokenize.push(_),"comment";if(x.eatSpace())return null;var E=x.next(),S;if(E=="`"||E=="'"||E=='"')return h(v(E,"string",E=='"'||E=="`"),x,w);if(E=="/")return p(x)?h(v(E,"string-2",!0),x,w):"operator";if(E=="%"){var R="string",D=!0;x.eat("s")?R="atom":x.eat(/[WQ]/)?R="string":x.eat(/[r]/)?R="string-2":x.eat(/[wxq]/)&&(R="string",D=!1);var P=x.eat(/[^\w\s=]/);return P?(a.propertyIsEnumerable(P)&&(P=a[P]),h(v(P,R,D,!0),x,w)):"operator"}else{if(E=="#")return x.skipToEnd(),"comment";if(E=="<"&&(S=x.match(/^<([-~])[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return h(b(S[2],S[1]),x,w);if(E=="0")return x.eat("x")?x.eatWhile(/[\da-fA-F]/):x.eat("b")?x.eatWhile(/[01]/):x.eatWhile(/[0-7]/),"number";if(/\d/.test(E))return x.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if(E=="?"){for(;x.match(/^\\[CM]-/););return x.eat("\\")?x.eatWhile(/\w/):x.next(),"string"}else{if(E==":")return x.eat("'")?h(v("'","atom",!1),x,w):x.eat('"')?h(v('"',"atom",!0),x,w):x.eat(/[\<\>]/)?(x.eat(/[\<\>]/),"atom"):x.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":x.eat(/[a-zA-Z$@_\xa1-\uffff]/)?(x.eatWhile(/[\w$\xa1-\uffff]/),x.eat(/[\?\!\=]/),"atom"):"operator";if(E=="@"&&x.match(/^@?[a-zA-Z_\xa1-\uffff]/))return x.eat("@"),x.eatWhile(/[\w\xa1-\uffff]/),"variable-2";if(E=="$")return x.eat(/[a-zA-Z_]/)?x.eatWhile(/[\w]/):x.eat(/\d/)?x.eat(/\d/):x.next(),"variable-3";if(/[a-zA-Z_\xa1-\uffff]/.test(E))return x.eatWhile(/[\w\xa1-\uffff]/),x.eat(/[\?\!]/),x.eat(":")?"atom":"ident";if(E=="|"&&(w.varList||w.lastTok=="{"||w.lastTok=="do"))return d="|",null;if(/[\(\)\[\]{}\\;]/.test(E))return d=E,null;if(E=="-"&&x.eat(">"))return"arrow";if(/[=+\-\/*:\.^%<>~|]/.test(E)){var O=x.eatWhile(/[=+\-\/*:\.^%<>~|]/);return E=="."&&!O&&(d="."),"operator"}else return null}}}function p(x){for(var w=x.pos,E=0,S,R=!1,D=!1;(S=x.next())!=null;)if(D)D=!1;else{if("[{(".indexOf(S)>-1)E++;else if("]})".indexOf(S)>-1){if(E--,E<0)break}else if(S=="/"&&E==0){R=!0;break}D=S=="\\"}return x.backUp(x.pos-w),R}function g(x){return x||(x=1),function(w,E){if(w.peek()=="}"){if(x==1)return E.tokenize.pop(),E.tokenize[E.tokenize.length-1](w,E);E.tokenize[E.tokenize.length-1]=g(x-1)}else w.peek()=="{"&&(E.tokenize[E.tokenize.length-1]=g(x+1));return f(w,E)}}function m(){var x=!1;return function(w,E){return x?(E.tokenize.pop(),E.tokenize[E.tokenize.length-1](w,E)):(x=!0,f(w,E))}}function v(x,w,E,S){return function(R,D){var P=!1,O;for(D.context.type==="read-quoted-paused"&&(D.context=D.context.prev,R.eat("}"));(O=R.next())!=null;){if(O==x&&(S||!P)){D.tokenize.pop();break}if(E&&O=="#"&&!P){if(R.eat("{")){x=="}"&&(D.context={prev:D.context,type:"read-quoted-paused"}),D.tokenize.push(g());break}else if(/[@\$]/.test(R.peek())){D.tokenize.push(m());break}}P=!P&&O=="\\"}return w}}function b(x,w){return function(E,S){return w&&E.eatSpace(),E.match(x)?S.tokenize.pop():E.skipToEnd(),"string"}}function _(x,w){return x.sol()&&x.match("=end")&&x.eol()&&w.tokenize.pop(),x.skipToEnd(),"comment"}return{startState:function(){return{tokenize:[f],indented:0,context:{type:"top",indented:-u.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(x,w){d=null,x.sol()&&(w.indented=x.indentation());var E=w.tokenize[w.tokenize.length-1](x,w),S,R=d;if(E=="ident"){var D=x.current();E=w.lastTok=="."?"property":r.propertyIsEnumerable(x.current())?"keyword":/^[A-Z]/.test(D)?"tag":w.lastTok=="def"||w.lastTok=="class"||w.varList?"def":"variable",E=="keyword"&&(R=D,s.propertyIsEnumerable(D)?S="indent":o.propertyIsEnumerable(D)?S="dedent":((D=="if"||D=="unless")&&x.column()==x.indentation()||D=="do"&&w.context.indented<w.indented)&&(S="indent"))}return(d||E&&E!="comment")&&(w.lastTok=R),d=="|"&&(w.varList=!w.varList),S=="indent"||/[\(\[\{]/.test(d)?w.context={prev:w.context,type:d||E,indented:w.indented}:(S=="dedent"||/[\)\]\}]/.test(d))&&w.context.prev&&(w.context=w.context.prev),x.eol()&&(w.continuedLine=d=="\\"||E=="operator"),E},indent:function(x,w){if(x.tokenize[x.tokenize.length-1]!=f)return e.Pass;var E=w&&w.charAt(0),S=x.context,R=S.type==c[E]||S.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(w);return S.indented+(R?0:u.indentUnit)+(x.continuedLine?u.indentUnit:0)},electricInput:/^\s*(?:end|rescue|elsif|else|\})$/,lineComment:"#",fold:"indent"}}),e.defineMIME("text/x-ruby","ruby"),e.registerHelper("hintWords","ruby",i)})})();(function(l,t){(function(e){e(Ke.exports,Lp())})(function(e){e.defineSimpleMode("rust",{start:[{regex:/b?"/,token:"string",next:"string"},{regex:/b?r"/,token:"string",next:"string_raw"},{regex:/b?r#+"/,token:"string",next:"string_raw_hash"},{regex:/'(?:[^'\\]|\\(?:[nrt0'"]|x[\da-fA-F]{2}|u\{[\da-fA-F]{6}\}))'/,token:"string-2"},{regex:/b'(?:[^']|\\(?:['\\nrt0]|x[\da-fA-F]{2}))'/,token:"string-2"},{regex:/(?:(?:[0-9][0-9_]*)(?:(?:[Ee][+-]?[0-9_]+)|\.[0-9_]+(?:[Ee][+-]?[0-9_]+)?)(?:f32|f64)?)|(?:0(?:b[01_]+|(?:o[0-7_]+)|(?:x[0-9a-fA-F_]+))|(?:[0-9][0-9_]*))(?:u8|u16|u32|u64|i8|i16|i32|i64|isize|usize)?/,token:"number"},{regex:/(let(?:\s+mut)?|fn|enum|mod|struct|type|union)(\s+)([a-zA-Z_][a-zA-Z0-9_]*)/,token:["keyword",null,"def"]},{regex:/(?:abstract|alignof|as|async|await|box|break|continue|const|crate|do|dyn|else|enum|extern|fn|for|final|if|impl|in|loop|macro|match|mod|move|offsetof|override|priv|proc|pub|pure|ref|return|self|sizeof|static|struct|super|trait|type|typeof|union|unsafe|unsized|use|virtual|where|while|yield)\b/,token:"keyword"},{regex:/\b(?:Self|isize|usize|char|bool|u8|u16|u32|u64|f16|f32|f64|i8|i16|i32|i64|str|Option)\b/,token:"atom"},{regex:/\b(?:true|false|Some|None|Ok|Err)\b/,token:"builtin"},{regex:/\b(fn)(\s+)([a-zA-Z_][a-zA-Z0-9_]*)/,token:["keyword",null,"def"]},{regex:/#!?\[.*\]/,token:"meta"},{regex:/\/\/.*/,token:"comment"},{regex:/\/\*/,token:"comment",next:"comment"},{regex:/[-+\/*=<>!]+/,token:"operator"},{regex:/[a-zA-Z_]\w*!/,token:"variable-3"},{regex:/[a-zA-Z_]\w*/,token:"variable"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0}],string:[{regex:/"/,token:"string",next:"start"},{regex:/(?:[^\\"]|\\(?:.|$))*/,token:"string"}],string_raw:[{regex:/"/,token:"string",next:"start"},{regex:/[^"]*/,token:"string"}],string_raw_hash:[{regex:/"#+/,token:"string",next:"start"},{regex:/(?:[^"]|"(?!#))*/,token:"string"}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}],meta:{dontIndentStates:["comment"],electricInput:/^\s*\}$/,blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//",fold:"brace"}}),e.defineMIME("text/x-rustsrc","rust"),e.defineMIME("text/rust","rust")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("sql",function(u,d){var h=d.client||{},f=d.atoms||{false:!0,true:!0,null:!0},p=d.builtin||a(c),g=d.keywords||a(o),m=d.operatorChars||/^[*+\-%<>!=&|~^\/]/,v=d.support||{},b=d.hooks||{},_=d.dateSQL||{date:!0,time:!0,timestamp:!0},x=d.backslashStringEscapes!==!1,w=d.brackets||/^[\{}\(\)\[\]]/,E=d.punctuation||/^[;.,:]/;function S(L,B){var A=L.next();if(b[A]){var F=b[A](L,B);if(F!==!1)return F}if(v.hexNumber&&(A=="0"&&L.match(/^[xX][0-9a-fA-F]+/)||(A=="x"||A=="X")&&L.match(/^'[0-9a-fA-F]*'/)))return"number";if(v.binaryNumber&&((A=="b"||A=="B")&&L.match(/^'[01]*'/)||A=="0"&&L.match(/^b[01]+/)))return"number";if(A.charCodeAt(0)>47&&A.charCodeAt(0)<58)return L.match(/^[0-9]*(\.[0-9]+)?([eE][-+]?[0-9]+)?/),v.decimallessFloat&&L.match(/^\.(?!\.)/),"number";if(A=="?"&&(L.eatSpace()||L.eol()||L.eat(";")))return"variable-3";if(A=="'"||A=='"'&&v.doubleQuote)return B.tokenize=R(A),B.tokenize(L,B);if((v.nCharCast&&(A=="n"||A=="N")||v.charsetCast&&A=="_"&&L.match(/[a-z][a-z0-9]*/i))&&(L.peek()=="'"||L.peek()=='"'))return"keyword";if(v.escapeConstant&&(A=="e"||A=="E")&&(L.peek()=="'"||L.peek()=='"'&&v.doubleQuote))return B.tokenize=function(G,k){return(k.tokenize=R(G.next(),!0))(G,k)},"keyword";if(v.commentSlashSlash&&A=="/"&&L.eat("/"))return L.skipToEnd(),"comment";if(v.commentHash&&A=="#"||A=="-"&&L.eat("-")&&(!v.commentSpaceRequired||L.eat(" ")))return L.skipToEnd(),"comment";if(A=="/"&&L.eat("*"))return B.tokenize=D(1),B.tokenize(L,B);if(A=="."){if(v.zerolessFloat&&L.match(/^(?:\d+(?:e[+-]?\d+)?)/i))return"number";if(L.match(/^\.+/))return null;if(L.match(/^[\w\d_$#]+/))return"variable-2"}else{if(m.test(A))return L.eatWhile(m),"operator";if(w.test(A))return"bracket";if(E.test(A))return L.eatWhile(E),"punctuation";if(A=="{"&&(L.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||L.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";L.eatWhile(/^[_\w\d]/);var W=L.current().toLowerCase();return _.hasOwnProperty(W)&&(L.match(/^( )+'[^']*'/)||L.match(/^( )+"[^"]*"/))?"number":f.hasOwnProperty(W)?"atom":p.hasOwnProperty(W)?"type":g.hasOwnProperty(W)?"keyword":h.hasOwnProperty(W)?"builtin":null}}function R(L,B){return function(A,F){for(var W=!1,G;(G=A.next())!=null;){if(G==L&&!W){F.tokenize=S;break}W=(x||B)&&!W&&G=="\\"}return"string"}}function D(L){return function(B,A){var F=B.match(/^.*?(\/\*|\*\/)/);return F?F[1]=="/*"?A.tokenize=D(L+1):L>1?A.tokenize=D(L-1):A.tokenize=S:B.skipToEnd(),"comment"}}function P(L,B,A){B.context={prev:B.context,indent:L.indentation(),col:L.column(),type:A}}function O(L){L.indent=L.context.indent,L.context=L.context.prev}return{startState:function(){return{tokenize:S,context:null}},token:function(L,B){if(L.sol()&&B.context&&B.context.align==null&&(B.context.align=!1),B.tokenize==S&&L.eatSpace())return null;var A=B.tokenize(L,B);if(A=="comment")return A;B.context&&B.context.align==null&&(B.context.align=!0);var F=L.current();return F=="("?P(L,B,")"):F=="["?P(L,B,"]"):B.context&&B.context.type==F&&O(B),A},indent:function(L,B){var A=L.context;if(!A)return e.Pass;var F=B.charAt(0)==A.type;return A.align?A.col+(F?0:1):A.indent+(F?0:u.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:v.commentSlashSlash?"//":v.commentHash?"#":"--",closeBrackets:"()[]{}''\"\"``",config:d}});function n(u){for(var d;(d=u.next())!=null;)if(d=="`"&&!u.eat("`"))return"variable-2";return u.backUp(u.current().length-1),u.eatWhile(/\w/)?"variable-2":null}function i(u){for(var d;(d=u.next())!=null;)if(d=='"'&&!u.eat('"'))return"variable-2";return u.backUp(u.current().length-1),u.eatWhile(/\w/)?"variable-2":null}function r(u){return u.eat("@")&&(u.match("session."),u.match("local."),u.match("global.")),u.eat("'")?(u.match(/^.*'/),"variable-2"):u.eat('"')?(u.match(/^.*"/),"variable-2"):u.eat("`")?(u.match(/^.*`/),"variable-2"):u.match(/^[0-9a-zA-Z$\.\_]+/)?"variable-2":null}function s(u){return u.eat("N")?"atom":u.match(/^[a-zA-Z.#!?]/)?"variable-2":null}var o="alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit ";function a(u){for(var d={},h=u.split(" "),f=0;f<h.length;++f)d[h[f]]=!0;return d}var c="bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric";e.defineMIME("text/x-sql",{name:"sql",keywords:a(o+"begin"),builtin:a(c),atoms:a("false true null unknown"),dateSQL:a("date time timestamp"),support:a("doubleQuote binaryNumber hexNumber")}),e.defineMIME("text/x-mssql",{name:"sql",client:a("$partition binary_checksum checksum connectionproperty context_info current_request_id error_line error_message error_number error_procedure error_severity error_state formatmessage get_filestream_transaction_context getansinull host_id host_name isnull isnumeric min_active_rowversion newid newsequentialid rowcount_big xact_state object_id"),keywords:a(o+"begin trigger proc view index for add constraint key primary foreign collate clustered nonclustered declare exec go if use index holdlock nolock nowait paglock readcommitted readcommittedlock readpast readuncommitted repeatableread rowlock serializable snapshot tablock tablockx updlock with"),builtin:a("bigint numeric bit smallint decimal smallmoney int tinyint money float real char varchar text nchar nvarchar ntext binary varbinary image cursor timestamp hierarchyid uniqueidentifier sql_variant xml table "),atoms:a("is not null like and or in left right between inner outer join all any some cross unpivot pivot exists"),operatorChars:/^[*+\-%<>!=^\&|\/]/,brackets:/^[\{}\(\)]/,punctuation:/^[;.,:/]/,backslashStringEscapes:!1,dateSQL:a("date datetimeoffset datetime2 smalldatetime datetime time"),hooks:{"@":r}}),e.defineMIME("text/x-mysql",{name:"sql",client:a("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:a(o+"accessible action add after algorithm all analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general get global grant grants group group_concat handler hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show signal slave slow smallint snapshot soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:a("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:a("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:a("date time timestamp"),support:a("decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":r,"`":n,"\\":s}}),e.defineMIME("text/x-mariadb",{name:"sql",client:a("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),keywords:a(o+"accessible action add after algorithm all always analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general generated get global grant grants group group_concat handler hard hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password persistent phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show shutdown signal slave slow smallint snapshot soft soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views virtual warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),builtin:a("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),atoms:a("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^]/,dateSQL:a("date time timestamp"),support:a("decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),hooks:{"@":r,"`":n,"\\":s}}),e.defineMIME("text/x-sqlite",{name:"sql",client:a("auth backup bail binary changes check clone databases dbinfo dump echo eqp exit explain fullschema headers help import imposter indexes iotrace limit lint load log mode nullvalue once open output print prompt quit read restore save scanstats schema separator session shell show stats system tables testcase timeout timer trace vfsinfo vfslist vfsname width"),keywords:a(o+"abort action add after all analyze attach autoincrement before begin cascade case cast check collate column commit conflict constraint cross current_date current_time current_timestamp database default deferrable deferred detach each else end escape except exclusive exists explain fail for foreign full glob if ignore immediate index indexed initially inner instead intersect isnull key left limit match natural no notnull null of offset outer plan pragma primary query raise recursive references regexp reindex release rename replace restrict right rollback row savepoint temp temporary then to transaction trigger unique using vacuum view virtual when with without"),builtin:a("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text clob bigint int int2 int8 integer float double char varchar date datetime year unsigned signed numeric real"),atoms:a("null current_date current_time current_timestamp"),operatorChars:/^[*+\-%<>!=&|/~]/,dateSQL:a("date time timestamp datetime"),support:a("decimallessFloat zerolessFloat"),identifierQuote:'"',hooks:{"@":r,":":r,"?":r,$:r,'"':i,"`":n}}),e.defineMIME("text/x-cassandra",{name:"sql",client:{},keywords:a("add all allow alter and any apply as asc authorize batch begin by clustering columnfamily compact consistency count create custom delete desc distinct drop each_quorum exists filtering from grant if in index insert into key keyspace keyspaces level limit local_one local_quorum modify nan norecursive nosuperuser not of on one order password permission permissions primary quorum rename revoke schema select set storage superuser table three to token truncate ttl two type unlogged update use user users using values where with writetime"),builtin:a("ascii bigint blob boolean counter decimal double float frozen inet int list map static text timestamp timeuuid tuple uuid varchar varint"),atoms:a("false true infinity NaN"),operatorChars:/^[<>=]/,dateSQL:{},support:a("commentSlashSlash decimallessFloat"),hooks:{}}),e.defineMIME("text/x-plsql",{name:"sql",client:a("appinfo arraysize autocommit autoprint autorecovery autotrace blockterminator break btitle cmdsep colsep compatibility compute concat copycommit copytypecheck define describe echo editfile embedded escape exec execute feedback flagger flush heading headsep instance linesize lno loboffset logsource long longchunksize markup native newpage numformat numwidth pagesize pause pno recsep recsepchar release repfooter repheader serveroutput shiftinout show showmode size spool sqlblanklines sqlcase sqlcode sqlcontinue sqlnumber sqlpluscompatibility sqlprefix sqlprompt sqlterminator suffix tab term termout time timing trimout trimspool ttitle underline verify version wrap"),keywords:a("abort accept access add all alter and any array arraylen as asc assert assign at attributes audit authorization avg base_table begin between binary_integer body boolean by case cast char char_base check close cluster clusters colauth column comment commit compress connect connected constant constraint crash create current currval cursor data_base database date dba deallocate debugoff debugon decimal declare default definition delay delete desc digits dispose distinct do drop else elseif elsif enable end entry escape exception exception_init exchange exclusive exists exit external fast fetch file for force form from function generic goto grant group having identified if immediate in increment index indexes indicator initial initrans insert interface intersect into is key level library like limited local lock log logging long loop master maxextents maxtrans member minextents minus mislabel mode modify multiset new next no noaudit nocompress nologging noparallel not nowait number_base object of off offline on online only open option or order out package parallel partition pctfree pctincrease pctused pls_integer positive positiven pragma primary prior private privileges procedure public raise range raw read rebuild record ref references refresh release rename replace resource restrict return returning returns reverse revoke rollback row rowid rowlabel rownum rows run savepoint schema segment select separate session set share snapshot some space split sql start statement storage subtype successful synonym tabauth table tables tablespace task terminate then to trigger truncate type union unique unlimited unrecoverable unusable update use using validate value values variable view views when whenever where while with work"),builtin:a("abs acos add_months ascii asin atan atan2 average bfile bfilename bigserial bit blob ceil character chartorowid chr clob concat convert cos cosh count dec decode deref dual dump dup_val_on_index empty error exp false float floor found glb greatest hextoraw initcap instr instrb int integer isopen last_day least length lengthb ln lower lpad ltrim lub make_ref max min mlslabel mod months_between natural naturaln nchar nclob new_time next_day nextval nls_charset_decl_len nls_charset_id nls_charset_name nls_initcap nls_lower nls_sort nls_upper nlssort no_data_found notfound null number numeric nvarchar2 nvl others power rawtohex real reftohex round rowcount rowidtochar rowtype rpad rtrim serial sign signtype sin sinh smallint soundex sqlcode sqlerrm sqrt stddev string substr substrb sum sysdate tan tanh to_char text to_date to_label to_multi_byte to_number to_single_byte translate true trunc uid unlogged upper user userenv varchar varchar2 variance varying vsize xml"),operatorChars:/^[*\/+\-%<>!=~]/,dateSQL:a("date time timestamp"),support:a("doubleQuote nCharCast zerolessFloat binaryNumber hexNumber")}),e.defineMIME("text/x-hive",{name:"sql",keywords:a("select alter $elem$ $key$ $value$ add after all analyze and archive as asc before between binary both bucket buckets by cascade case cast change cluster clustered clusterstatus collection column columns comment compute concatenate continue create cross cursor data database databases dbproperties deferred delete delimited desc describe directory disable distinct distribute drop else enable end escaped exclusive exists explain export extended external fetch fields fileformat first format formatted from full function functions grant group having hold_ddltime idxproperties if import in index indexes inpath inputdriver inputformat insert intersect into is items join keys lateral left like limit lines load local location lock locks mapjoin materialized minus msck no_drop nocompress not of offline on option or order out outer outputdriver outputformat overwrite partition partitioned partitions percent plus preserve procedure purge range rcfile read readonly reads rebuild recordreader recordwriter recover reduce regexp rename repair replace restrict revoke right rlike row schema schemas semi sequencefile serde serdeproperties set shared show show_database sort sorted ssl statistics stored streamtable table tables tablesample tblproperties temporary terminated textfile then tmp to touch transform trigger unarchive undo union uniquejoin unlock update use using utc utc_tmestamp view when where while with admin authorization char compact compactions conf cube current current_date current_timestamp day decimal defined dependency directories elem_type exchange file following for grouping hour ignore inner interval jar less logical macro minute month more none noscan over owner partialscan preceding pretty principals protection reload rewrite role roles rollup rows second server sets skewed transactions truncate unbounded unset uri user values window year"),builtin:a("bool boolean long timestamp tinyint smallint bigint int float double date datetime unsigned string array struct map uniontype key_type utctimestamp value_type varchar"),atoms:a("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:a("date timestamp"),support:a("doubleQuote binaryNumber hexNumber")}),e.defineMIME("text/x-pgsql",{name:"sql",client:a("source"),keywords:a(o+"a abort abs absent absolute access according action ada add admin after aggregate alias all allocate also alter always analyse analyze and any are array array_agg array_max_cardinality as asc asensitive assert assertion assignment asymmetric at atomic attach attribute attributes authorization avg backward base64 before begin begin_frame begin_partition bernoulli between bigint binary bit bit_length blob blocked bom boolean both breadth by c cache call called cardinality cascade cascaded case cast catalog catalog_name ceil ceiling chain char char_length character character_length character_set_catalog character_set_name character_set_schema characteristics characters check checkpoint class class_origin clob close cluster coalesce cobol collate collation collation_catalog collation_name collation_schema collect column column_name columns command_function command_function_code comment comments commit committed concurrently condition condition_number configuration conflict connect connection connection_name constant constraint constraint_catalog constraint_name constraint_schema constraints constructor contains content continue control conversion convert copy corr corresponding cost count covar_pop covar_samp create cross csv cube cume_dist current current_catalog current_date current_default_transform_group current_path current_role current_row current_schema current_time current_timestamp current_transform_group_for_type current_user cursor cursor_name cycle data database datalink datatype date datetime_interval_code datetime_interval_precision day db deallocate debug dec decimal declare default defaults deferrable deferred defined definer degree delete delimiter delimiters dense_rank depends depth deref derived desc describe descriptor detach detail deterministic diagnostics dictionary disable discard disconnect dispatch distinct dlnewcopy dlpreviouscopy dlurlcomplete dlurlcompleteonly dlurlcompletewrite dlurlpath dlurlpathonly dlurlpathwrite dlurlscheme dlurlserver dlvalue do document domain double drop dump dynamic dynamic_function dynamic_function_code each element else elseif elsif empty enable encoding encrypted end end_frame end_partition endexec enforced enum equals errcode error escape event every except exception exclude excluding exclusive exec execute exists exit exp explain expression extension external extract false family fetch file filter final first first_value flag float floor following for force foreach foreign fortran forward found frame_row free freeze from fs full function functions fusion g general generated get global go goto grant granted greatest group grouping groups handler having header hex hierarchy hint hold hour id identity if ignore ilike immediate immediately immutable implementation implicit import in include including increment indent index indexes indicator info inherit inherits initially inline inner inout input insensitive insert instance instantiable instead int integer integrity intersect intersection interval into invoker is isnull isolation join k key key_member key_type label lag language large last last_value lateral lead leading leakproof least left length level library like like_regex limit link listen ln load local localtime localtimestamp location locator lock locked log logged loop lower m map mapping match matched materialized max max_cardinality maxvalue member merge message message_length message_octet_length message_text method min minute minvalue mod mode modifies module month more move multiset mumps name names namespace national natural nchar nclob nesting new next nfc nfd nfkc nfkd nil no none normalize normalized not nothing notice notify notnull nowait nth_value ntile null nullable nullif nulls number numeric object occurrences_regex octet_length octets of off offset oids old on only open operator option options or order ordering ordinality others out outer output over overlaps overlay overriding owned owner p pad parallel parameter parameter_mode parameter_name parameter_ordinal_position parameter_specific_catalog parameter_specific_name parameter_specific_schema parser partial partition pascal passing passthrough password path percent percent_rank percentile_cont percentile_disc perform period permission pg_context pg_datatype_name pg_exception_context pg_exception_detail pg_exception_hint placing plans pli policy portion position position_regex power precedes preceding precision prepare prepared preserve primary print_strict_params prior privileges procedural procedure procedures program public publication query quote raise range rank read reads real reassign recheck recovery recursive ref references referencing refresh regr_avgx regr_avgy regr_count regr_intercept regr_r2 regr_slope regr_sxx regr_sxy regr_syy reindex relative release rename repeatable replace replica requiring reset respect restart restore restrict result result_oid return returned_cardinality returned_length returned_octet_length returned_sqlstate returning returns reverse revoke right role rollback rollup routine routine_catalog routine_name routine_schema routines row row_count row_number rows rowtype rule savepoint scale schema schema_name schemas scope scope_catalog scope_name scope_schema scroll search second section security select selective self sensitive sequence sequences serializable server server_name session session_user set setof sets share show similar simple size skip slice smallint snapshot some source space specific specific_name specifictype sql sqlcode sqlerror sqlexception sqlstate sqlwarning sqrt stable stacked standalone start state statement static statistics stddev_pop stddev_samp stdin stdout storage strict strip structure style subclass_origin submultiset subscription substring substring_regex succeeds sum symmetric sysid system system_time system_user t table table_name tables tablesample tablespace temp template temporary text then ties time timestamp timezone_hour timezone_minute to token top_level_count trailing transaction transaction_active transactions_committed transactions_rolled_back transform transforms translate translate_regex translation treat trigger trigger_catalog trigger_name trigger_schema trim trim_array true truncate trusted type types uescape unbounded uncommitted under unencrypted union unique unknown unlink unlisten unlogged unnamed unnest until untyped update upper uri usage use_column use_variable user user_defined_type_catalog user_defined_type_code user_defined_type_name user_defined_type_schema using vacuum valid validate validator value value_of values var_pop var_samp varbinary varchar variable_conflict variadic varying verbose version versioning view views volatile warning when whenever where while whitespace width_bucket window with within without work wrapper write xml xmlagg xmlattributes xmlbinary xmlcast xmlcomment xmlconcat xmldeclaration xmldocument xmlelement xmlexists xmlforest xmliterate xmlnamespaces xmlparse xmlpi xmlquery xmlroot xmlschema xmlserialize xmltable xmltext xmlvalidate year yes zone"),builtin:a("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float8 inet integer int int4 interval json jsonb line lseg macaddr macaddr8 money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:a("false true null unknown"),operatorChars:/^[*\/+\-%<>!=&|^\/#@?~]/,backslashStringEscapes:!1,dateSQL:a("date time timestamp"),support:a("decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast escapeConstant")}),e.defineMIME("text/x-gql",{name:"sql",keywords:a("ancestor and asc by contains desc descendant distinct from group has in is limit offset on order select superset where"),atoms:a("false true"),builtin:a("blob datetime first key __key__ string integer double boolean null"),operatorChars:/^[*+\-%<>!=]/}),e.defineMIME("text/x-gpsql",{name:"sql",client:a("source"),keywords:a("abort absolute access action active add admin after aggregate all also alter always analyse analyze and any array as asc assertion assignment asymmetric at authorization backward before begin between bigint binary bit boolean both by cache called cascade cascaded case cast chain char character characteristics check checkpoint class close cluster coalesce codegen collate column comment commit committed concurrency concurrently configuration connection constraint constraints contains content continue conversion copy cost cpu_rate_limit create createdb createexttable createrole createuser cross csv cube current current_catalog current_date current_role current_schema current_time current_timestamp current_user cursor cycle data database day deallocate dec decimal declare decode default defaults deferrable deferred definer delete delimiter delimiters deny desc dictionary disable discard distinct distributed do document domain double drop dxl each else enable encoding encrypted end enum errors escape every except exchange exclude excluding exclusive execute exists explain extension external extract false family fetch fields filespace fill filter first float following for force foreign format forward freeze from full function global grant granted greatest group group_id grouping handler hash having header hold host hour identity if ignore ilike immediate immutable implicit in including inclusive increment index indexes inherit inherits initially inline inner inout input insensitive insert instead int integer intersect interval into invoker is isnull isolation join key language large last leading least left level like limit list listen load local localtime localtimestamp location lock log login mapping master match maxvalue median merge minute minvalue missing mode modifies modify month move name names national natural nchar new newline next no nocreatedb nocreateexttable nocreaterole nocreateuser noinherit nologin none noovercommit nosuperuser not nothing notify notnull nowait null nullif nulls numeric object of off offset oids old on only operator option options or order ordered others out outer over overcommit overlaps overlay owned owner parser partial partition partitions passing password percent percentile_cont percentile_disc placing plans position preceding precision prepare prepared preserve primary prior privileges procedural procedure protocol queue quote randomly range read readable reads real reassign recheck recursive ref references reindex reject relative release rename repeatable replace replica reset resource restart restrict returning returns revoke right role rollback rollup rootpartition row rows rule savepoint scatter schema scroll search second security segment select sequence serializable session session_user set setof sets share show similar simple smallint some split sql stable standalone start statement statistics stdin stdout storage strict strip subpartition subpartitions substring superuser symmetric sysid system table tablespace temp template temporary text then threshold ties time timestamp to trailing transaction treat trigger trim true truncate trusted type unbounded uncommitted unencrypted union unique unknown unlisten until update user using vacuum valid validation validator value values varchar variadic varying verbose version view volatile web when where whitespace window with within without work writable write xml xmlattributes xmlconcat xmlelement xmlexists xmlforest xmlparse xmlpi xmlroot xmlserialize year yes zone"),builtin:a("bigint int8 bigserial serial8 bit varying varbit boolean bool box bytea character char varchar cidr circle date double precision float float8 inet integer int int4 interval json jsonb line lseg macaddr macaddr8 money numeric decimal path pg_lsn point polygon real float4 smallint int2 smallserial serial2 serial serial4 text time without zone with timetz timestamp timestamptz tsquery tsvector txid_snapshot uuid xml"),atoms:a("false true null unknown"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:a("date time timestamp"),support:a("decimallessFloat zerolessFloat binaryNumber hexNumber nCharCast charsetCast")}),e.defineMIME("text/x-sparksql",{name:"sql",keywords:a("add after all alter analyze and anti archive array as asc at between bucket buckets by cache cascade case cast change clear cluster clustered codegen collection column columns comment commit compact compactions compute concatenate cost create cross cube current current_date current_timestamp database databases data dbproperties defined delete delimited deny desc describe dfs directories distinct distribute drop else end escaped except exchange exists explain export extended external false fields fileformat first following for format formatted from full function functions global grant group grouping having if ignore import in index indexes inner inpath inputformat insert intersect interval into is items join keys last lateral lazy left like limit lines list load local location lock locks logical macro map minus msck natural no not null nulls of on optimize option options or order out outer outputformat over overwrite partition partitioned partitions percent preceding principals purge range recordreader recordwriter recover reduce refresh regexp rename repair replace reset restrict revoke right rlike role roles rollback rollup row rows schema schemas select semi separated serde serdeproperties set sets show skewed sort sorted start statistics stored stratify struct table tables tablesample tblproperties temp temporary terminated then to touch transaction transactions transform true truncate unarchive unbounded uncache union unlock unset use using values view when where window with"),builtin:a("abs acos acosh add_months aggregate and any approx_count_distinct approx_percentile array array_contains array_distinct array_except array_intersect array_join array_max array_min array_position array_remove array_repeat array_sort array_union arrays_overlap arrays_zip ascii asin asinh assert_true atan atan2 atanh avg base64 between bigint bin binary bit_and bit_count bit_get bit_length bit_or bit_xor bool_and bool_or boolean bround btrim cardinality case cast cbrt ceil ceiling char char_length character_length chr coalesce collect_list collect_set concat concat_ws conv corr cos cosh cot count count_if count_min_sketch covar_pop covar_samp crc32 cume_dist current_catalog current_database current_date current_timestamp current_timezone current_user date date_add date_format date_from_unix_date date_part date_sub date_trunc datediff day dayofmonth dayofweek dayofyear decimal decode degrees delimited dense_rank div double e element_at elt encode every exists exp explode explode_outer expm1 extract factorial filter find_in_set first first_value flatten float floor forall format_number format_string from_csv from_json from_unixtime from_utc_timestamp get_json_object getbit greatest grouping grouping_id hash hex hour hypot if ifnull in initcap inline inline_outer input_file_block_length input_file_block_start input_file_name inputformat instr int isnan isnotnull isnull java_method json_array_length json_object_keys json_tuple kurtosis lag last last_day last_value lcase lead least left length levenshtein like ln locate log log10 log1p log2 lower lpad ltrim make_date make_dt_interval make_interval make_timestamp make_ym_interval map map_concat map_entries map_filter map_from_arrays map_from_entries map_keys map_values map_zip_with max max_by md5 mean min min_by minute mod monotonically_increasing_id month months_between named_struct nanvl negative next_day not now nth_value ntile nullif nvl nvl2 octet_length or outputformat overlay parse_url percent_rank percentile percentile_approx pi pmod posexplode posexplode_outer position positive pow power printf quarter radians raise_error rand randn random rank rcfile reflect regexp regexp_extract regexp_extract_all regexp_like regexp_replace repeat replace reverse right rint rlike round row_number rpad rtrim schema_of_csv schema_of_json second sentences sequence sequencefile serde session_window sha sha1 sha2 shiftleft shiftright shiftrightunsigned shuffle sign signum sin sinh size skewness slice smallint some sort_array soundex space spark_partition_id split sqrt stack std stddev stddev_pop stddev_samp str_to_map string struct substr substring substring_index sum tan tanh textfile timestamp timestamp_micros timestamp_millis timestamp_seconds tinyint to_csv to_date to_json to_timestamp to_unix_timestamp to_utc_timestamp transform transform_keys transform_values translate trim trunc try_add try_divide typeof ucase unbase64 unhex uniontype unix_date unix_micros unix_millis unix_seconds unix_timestamp upper uuid var_pop var_samp variance version weekday weekofyear when width_bucket window xpath xpath_boolean xpath_double xpath_float xpath_int xpath_long xpath_number xpath_short xpath_string xxhash64 year zip_with"),atoms:a("false true null"),operatorChars:/^[*\/+\-%<>!=~&|^]/,dateSQL:a("date time timestamp"),support:a("doubleQuote zerolessFloat")}),e.defineMIME("text/x-esper",{name:"sql",client:a("source"),keywords:a("alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit after all and as at asc avedev avg between by case cast coalesce count create current_timestamp day days delete define desc distinct else end escape events every exists false first from full group having hour hours in inner insert instanceof into irstream is istream join last lastweekday left limit like max match_recognize matches median measures metadatasql min minute minutes msec millisecond milliseconds not null offset on or order outer output partition pattern prev prior regexp retain-union retain-intersection right rstream sec second seconds select set some snapshot sql stddev sum then true unidirectional until update variable weekday when where window"),builtin:{},atoms:a("false true null"),operatorChars:/^[*+\-%<>!=&|^\/#@?~]/,dateSQL:a("time"),support:a("decimallessFloat zerolessFloat binaryNumber hexNumber")}),e.defineMIME("text/x-trino",{name:"sql",keywords:a("abs absent acos add admin after all all_match alter analyze and any any_match approx_distinct approx_most_frequent approx_percentile approx_set arbitrary array_agg array_distinct array_except array_intersect array_join array_max array_min array_position array_remove array_sort array_union arrays_overlap as asc asin at at_timezone atan atan2 authorization avg bar bernoulli beta_cdf between bing_tile bing_tile_at bing_tile_coordinates bing_tile_polygon bing_tile_quadkey bing_tile_zoom_level bing_tiles_around bit_count bitwise_and bitwise_and_agg bitwise_left_shift bitwise_not bitwise_or bitwise_or_agg bitwise_right_shift bitwise_right_shift_arithmetic bitwise_xor bool_and bool_or both by call cardinality cascade case cast catalogs cbrt ceil ceiling char2hexint checksum chr classify coalesce codepoint column columns combinations comment commit committed concat concat_ws conditional constraint contains contains_sequence convex_hull_agg copartition corr cos cosh cosine_similarity count count_if covar_pop covar_samp crc32 create cross cube cume_dist current current_catalog current_date current_groups current_path current_role current_schema current_time current_timestamp current_timezone current_user data date_add date_diff date_format date_parse date_trunc day day_of_month day_of_week day_of_year deallocate default define definer degrees delete dense_rank deny desc describe descriptor distinct distributed dow doy drop e element_at else empty empty_approx_set encoding end error escape evaluate_classifier_predictions every except excluding execute exists exp explain extract false features fetch filter final first first_value flatten floor following for format format_datetime format_number from from_base from_base32 from_base64 from_base64url from_big_endian_32 from_big_endian_64 from_encoded_polyline from_geojson_geometry from_hex from_ieee754_32 from_ieee754_64 from_iso8601_date from_iso8601_timestamp from_iso8601_timestamp_nanos from_unixtime from_unixtime_nanos from_utf8 full functions geometric_mean geometry_from_hadoop_shape geometry_invalid_reason geometry_nearest_points geometry_to_bing_tiles geometry_union geometry_union_agg grant granted grants graphviz great_circle_distance greatest group grouping groups hamming_distance hash_counts having histogram hmac_md5 hmac_sha1 hmac_sha256 hmac_sha512 hour human_readable_seconds if ignore in including index infinity initial inner input insert intersect intersection_cardinality into inverse_beta_cdf inverse_normal_cdf invoker io is is_finite is_infinite is_json_scalar is_nan isolation jaccard_index join json_array json_array_contains json_array_get json_array_length json_exists json_extract json_extract_scalar json_format json_object json_parse json_query json_size json_value keep key keys kurtosis lag last last_day_of_month last_value lateral lead leading learn_classifier learn_libsvm_classifier learn_libsvm_regressor learn_regressor least left length level levenshtein_distance like limit line_interpolate_point line_interpolate_points line_locate_point listagg ln local localtime localtimestamp log log10 log2 logical lower lpad ltrim luhn_check make_set_digest map_agg map_concat map_entries map_filter map_from_entries map_keys map_union map_values map_zip_with match match_recognize matched matches materialized max max_by md5 measures merge merge_set_digest millisecond min min_by minute mod month multimap_agg multimap_from_entries murmur3 nan natural next nfc nfd nfkc nfkd ngrams no none none_match normal_cdf normalize not now nth_value ntile null nullif nulls numeric_histogram object objectid_timestamp of offset omit on one only option or order ordinality outer output over overflow parse_data_size parse_datetime parse_duration partition partitions passing past path pattern per percent_rank permute pi position pow power preceding prepare privileges properties prune qdigest_agg quarter quotes radians rand random range rank read recursive reduce reduce_agg refresh regexp_count regexp_extract regexp_extract_all regexp_like regexp_position regexp_replace regexp_split regr_intercept regr_slope regress rename render repeat repeatable replace reset respect restrict returning reverse revoke rgb right role roles rollback rollup round row_number rows rpad rtrim running scalar schema schemas second security seek select sequence serializable session set sets sha1 sha256 sha512 show shuffle sign simplify_geometry sin skewness skip slice some soundex spatial_partitioning spatial_partitions split split_part split_to_map split_to_multimap spooky_hash_v2_32 spooky_hash_v2_64 sqrt st_area st_asbinary st_astext st_boundary st_buffer st_centroid st_contains st_convexhull st_coorddim st_crosses st_difference st_dimension st_disjoint st_distance st_endpoint st_envelope st_envelopeaspts st_equals st_exteriorring st_geometries st_geometryfromtext st_geometryn st_geometrytype st_geomfrombinary st_interiorringn st_interiorrings st_intersection st_intersects st_isclosed st_isempty st_isring st_issimple st_isvalid st_length st_linefromtext st_linestring st_multipoint st_numgeometries st_numinteriorring st_numpoints st_overlaps st_point st_pointn st_points st_polygon st_relate st_startpoint st_symdifference st_touches st_union st_within st_x st_xmax st_xmin st_y st_ymax st_ymin start starts_with stats stddev stddev_pop stddev_samp string strpos subset substr substring sum system table tables tablesample tan tanh tdigest_agg text then ties timestamp_objectid timezone_hour timezone_minute to to_base to_base32 to_base64 to_base64url to_big_endian_32 to_big_endian_64 to_char to_date to_encoded_polyline to_geojson_geometry to_geometry to_hex to_ieee754_32 to_ieee754_64 to_iso8601 to_milliseconds to_spherical_geography to_timestamp to_unixtime to_utf8 trailing transaction transform transform_keys transform_values translate trim trim_array true truncate try try_cast type typeof uescape unbounded uncommitted unconditional union unique unknown unmatched unnest update upper url_decode url_encode url_extract_fragment url_extract_host url_extract_parameter url_extract_path url_extract_port url_extract_protocol url_extract_query use user using utf16 utf32 utf8 validate value value_at_quantile values values_at_quantiles var_pop var_samp variance verbose version view week week_of_year when where width_bucket wilson_interval_lower wilson_interval_upper window with with_timezone within without word_stem work wrapper write xxhash64 year year_of_week yow zip zip_with"),builtin:a("array bigint bingtile boolean char codepoints color date decimal double function geometry hyperloglog int integer interval ipaddress joniregexp json json2016 jsonpath kdbtree likepattern map model objectid p4hyperloglog precision qdigest re2jregexp real regressor row setdigest smallint sphericalgeography tdigest time timestamp tinyint uuid varbinary varchar zone"),atoms:a("false true null unknown"),operatorChars:/^[[\]|<>=!\-+*/%]/,dateSQL:a("date time timestamp zone"),support:a("decimallessFloat zerolessFloat hexNumber")})})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){function n(D){for(var P={},O=0;O<D.length;O++)P[D[O]]=!0;return P}var i=n(["_","var","let","actor","class","enum","extension","import","protocol","struct","func","typealias","associatedtype","open","public","internal","fileprivate","private","deinit","init","new","override","self","subscript","super","convenience","dynamic","final","indirect","lazy","required","static","unowned","unowned(safe)","unowned(unsafe)","weak","as","is","break","case","continue","default","else","fallthrough","for","guard","if","in","repeat","switch","where","while","defer","return","inout","mutating","nonmutating","isolated","nonisolated","catch","do","rethrows","throw","throws","async","await","try","didSet","get","set","willSet","assignment","associativity","infix","left","none","operator","postfix","precedence","precedencegroup","prefix","right","Any","AnyObject","Type","dynamicType","Self","Protocol","__COLUMN__","__FILE__","__FUNCTION__","__LINE__"]),r=n(["var","let","actor","class","enum","extension","import","protocol","struct","func","typealias","associatedtype","for"]),s=n(["true","false","nil","self","super","_"]),o=n(["Array","Bool","Character","Dictionary","Double","Float","Int","Int8","Int16","Int32","Int64","Never","Optional","Set","String","UInt8","UInt16","UInt32","UInt64","Void"]),a="+-/*%=|&<>~^?!",c=":;,.(){}[]",u=/^\-?0b[01][01_]*/,d=/^\-?0o[0-7][0-7_]*/,h=/^\-?0x[\dA-Fa-f][\dA-Fa-f_]*(?:(?:\.[\dA-Fa-f][\dA-Fa-f_]*)?[Pp]\-?\d[\d_]*)?/,f=/^\-?\d[\d_]*(?:\.\d[\d_]*)?(?:[Ee]\-?\d[\d_]*)?/,p=/^\$\d+|(`?)[_A-Za-z][_A-Za-z$0-9]*\1/,g=/^\.(?:\$\d+|(`?)[_A-Za-z][_A-Za-z$0-9]*\1)/,m=/^\#[A-Za-z]+/,v=/^@(?:\$\d+|(`?)[_A-Za-z][_A-Za-z$0-9]*\1)/;function b(D,P,O){if(D.sol()&&(P.indented=D.indentation()),D.eatSpace())return null;var L=D.peek();if(L=="/"){if(D.match("//"))return D.skipToEnd(),"comment";if(D.match("/*"))return P.tokenize.push(w),w(D,P)}if(D.match(m))return"builtin";if(D.match(v))return"attribute";if(D.match(u)||D.match(d)||D.match(h)||D.match(f))return"number";if(D.match(g))return"property";if(a.indexOf(L)>-1)return D.next(),"operator";if(c.indexOf(L)>-1)return D.next(),D.match(".."),"punctuation";var B;if(B=D.match(/("""|"|')/)){var A=x.bind(null,B[0]);return P.tokenize.push(A),A(D,P)}if(D.match(p)){var F=D.current();return o.hasOwnProperty(F)?"variable-2":s.hasOwnProperty(F)?"atom":i.hasOwnProperty(F)?(r.hasOwnProperty(F)&&(P.prev="define"),"keyword"):O=="define"?"def":"variable"}return D.next(),null}function _(){var D=0;return function(P,O,L){var B=b(P,O,L);if(B=="punctuation"){if(P.current()=="(")++D;else if(P.current()==")"){if(D==0)return P.backUp(1),O.tokenize.pop(),O.tokenize[O.tokenize.length-1](P,O);--D}}return B}}function x(D,P,O){for(var L=D.length==1,B,A=!1;B=P.peek();)if(A){if(P.next(),B=="(")return O.tokenize.push(_()),"string";A=!1}else{if(P.match(D))return O.tokenize.pop(),"string";P.next(),A=B=="\\"}return L&&O.tokenize.pop(),"string"}function w(D,P){for(var O;O=D.next();)if(O==="/"&&D.eat("*"))P.tokenize.push(w);else if(O==="*"&&D.eat("/")){P.tokenize.pop();break}return"comment"}function E(D,P,O){this.prev=D,this.align=P,this.indented=O}function S(D,P){var O=P.match(/^\s*($|\/[\/\*])/,!1)?null:P.column()+1;D.context=new E(D.context,O,D.indented)}function R(D){D.context&&(D.indented=D.context.indented,D.context=D.context.prev)}e.defineMode("swift",function(D){return{startState:function(){return{prev:null,context:null,indented:0,tokenize:[]}},token:function(P,O){var L=O.prev;O.prev=null;var B=O.tokenize[O.tokenize.length-1]||b,A=B(P,O,L);if(!A||A=="comment"?O.prev=L:O.prev||(O.prev=A),A=="punctuation"){var F=/[\(\[\{]|([\]\)\}])/.exec(P.current());F&&(F[1]?R:S)(O,P)}return A},indent:function(P,O){var L=P.context;if(!L)return 0;var B=/^[\]\}\)]/.test(O);return L.align!=null?L.align-(B?1:0):L.indented+(B?0:D.indentUnit)},electricInput:/^\s*[\)\}\]]$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",fold:"brace",closeBrackets:"()[]{}''\"\"``"}}),e.defineMIME("text/x-swift","swift")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("vb",function(n,i){var r="error";function s(k){return new RegExp("^(("+k.join(")|(")+"))\\b","i")}var o=new RegExp("^[\\+\\-\\*/%&\\\\|\\^~<>!]"),a=new RegExp("^[\\(\\)\\[\\]\\{\\}@,:`=;\\.]"),c=new RegExp("^((==)|(<>)|(<=)|(>=)|(<>)|(<<)|(>>)|(//)|(\\*\\*))"),u=new RegExp("^((\\+=)|(\\-=)|(\\*=)|(%=)|(/=)|(&=)|(\\|=)|(\\^=))"),d=new RegExp("^((//=)|(>>=)|(<<=)|(\\*\\*=))"),h=new RegExp("^[_A-Za-z][_A-Za-z0-9]*"),f=["class","module","sub","enum","select","while","if","function","get","set","property","try","structure","synclock","using","with"],p=["else","elseif","case","catch","finally"],g=["next","loop"],m=["and","andalso","or","orelse","xor","in","not","is","isnot","like"],v=s(m),b=["#const","#else","#elseif","#end","#if","#region","addhandler","addressof","alias","as","byref","byval","cbool","cbyte","cchar","cdate","cdbl","cdec","cint","clng","cobj","compare","const","continue","csbyte","cshort","csng","cstr","cuint","culng","cushort","declare","default","delegate","dim","directcast","each","erase","error","event","exit","explicit","false","for","friend","gettype","goto","handles","implements","imports","infer","inherits","interface","isfalse","istrue","lib","me","mod","mustinherit","mustoverride","my","mybase","myclass","namespace","narrowing","new","nothing","notinheritable","notoverridable","of","off","on","operator","option","optional","out","overloads","overridable","overrides","paramarray","partial","private","protected","public","raiseevent","readonly","redim","removehandler","resume","return","shadows","shared","static","step","stop","strict","then","throw","to","true","trycast","typeof","until","until","when","widening","withevents","writeonly"],_=["object","boolean","char","string","byte","sbyte","short","ushort","int16","uint16","integer","uinteger","int32","uint32","long","ulong","int64","uint64","decimal","single","double","float","date","datetime","intptr","uintptr"],x=s(b),w=s(_),E='"',S=s(f),R=s(p),D=s(g),P=s(["end"]),O=s(["do"]);e.registerHelper("hintWords","vb",f.concat(p).concat(g).concat(m).concat(b).concat(_));function L(k,C){C.currentIndent++}function B(k,C){C.currentIndent--}function A(k,C){if(k.eatSpace())return null;var $=k.peek();if($==="'")return k.skipToEnd(),"comment";if(k.match(/^((&H)|(&O))?[0-9\.a-f]/i,!1)){var z=!1;if((k.match(/^\d*\.\d+F?/i)||k.match(/^\d+\.\d*F?/)||k.match(/^\.\d+F?/))&&(z=!0),z)return k.eat(/J/i),"number";var M=!1;if(k.match(/^&H[0-9a-f]+/i)||k.match(/^&O[0-7]+/i)?M=!0:k.match(/^[1-9]\d*F?/)?(k.eat(/J/i),M=!0):k.match(/^0(?![\dx])/i)&&(M=!0),M)return k.eat(/L/i),"number"}return k.match(E)?(C.tokenize=F(k.current()),C.tokenize(k,C)):k.match(d)||k.match(u)?null:k.match(c)||k.match(o)||k.match(v)?"operator":k.match(a)?null:k.match(O)?(L(k,C),C.doInCurrentLine=!0,"keyword"):k.match(S)?(C.doInCurrentLine?C.doInCurrentLine=!1:L(k,C),"keyword"):k.match(R)?"keyword":k.match(P)?(B(k,C),B(k,C),"keyword"):k.match(D)?(B(k,C),"keyword"):k.match(w)||k.match(x)?"keyword":k.match(h)?"variable":(k.next(),r)}function F(k){var C=k.length==1,$="string";return function(z,M){for(;!z.eol();){if(z.eatWhile(/[^'"]/),z.match(k))return M.tokenize=A,$;z.eat(/['"]/)}if(C){if(i.singleLineStringErrors)return r;M.tokenize=A}return $}}function W(k,C){var $=C.tokenize(k,C),z=k.current();if(z===".")return $=C.tokenize(k,C),$==="variable"?"variable":r;var M="[({".indexOf(z);return M!==-1&&L(k,C),M="])}".indexOf(z),M!==-1&&B(k,C)?r:$}var G={electricChars:"dDpPtTfFeE ",startState:function(){return{tokenize:A,lastToken:null,currentIndent:0,nextLineIndent:0,doInCurrentLine:!1}},token:function(k,C){k.sol()&&(C.currentIndent+=C.nextLineIndent,C.nextLineIndent=0,C.doInCurrentLine=0);var $=W(k,C);return C.lastToken={style:$,content:k.current()},$},indent:function(k,C){var $=C.replace(/^\s+|\s+$/g,"");return $.match(D)||$.match(P)||$.match(R)?n.indentUnit*(k.currentIndent-1):k.currentIndent<0?0:k.currentIndent*n.indentUnit},lineComment:"'"};return G}),e.defineMIME("text/x-vb","vb")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("velocity",function(){function n(f){for(var p={},g=f.split(" "),m=0;m<g.length;++m)p[g[m]]=!0;return p}var i=n("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}"),r=n("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}"),s=n("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent"),o=/[+\-*&%=<>!?:\/|]/;function a(f,p,g){return p.tokenize=g,g(f,p)}function c(f,p){var g=p.beforeParams;p.beforeParams=!1;var m=f.next();if(m=="'"&&!p.inString&&p.inParams)return p.lastTokenWasBuiltin=!1,a(f,p,u(m));if(m=='"'){if(p.lastTokenWasBuiltin=!1,p.inString)return p.inString=!1,"string";if(p.inParams)return a(f,p,u(m))}else{if(/[\[\]{}\(\),;\.]/.test(m))return m=="("&&g?p.inParams=!0:m==")"&&(p.inParams=!1,p.lastTokenWasBuiltin=!0),null;if(/\d/.test(m))return p.lastTokenWasBuiltin=!1,f.eatWhile(/[\w\.]/),"number";if(m=="#"&&f.eat("*"))return p.lastTokenWasBuiltin=!1,a(f,p,d);if(m=="#"&&f.match(/ *\[ *\[/))return p.lastTokenWasBuiltin=!1,a(f,p,h);if(m=="#"&&f.eat("#"))return p.lastTokenWasBuiltin=!1,f.skipToEnd(),"comment";if(m=="$")return f.eat("!"),f.eatWhile(/[\w\d\$_\.{}-]/),s&&s.propertyIsEnumerable(f.current())?"keyword":(p.lastTokenWasBuiltin=!0,p.beforeParams=!0,"builtin");if(o.test(m))return p.lastTokenWasBuiltin=!1,f.eatWhile(o),"operator";f.eatWhile(/[\w\$_{}@]/);var v=f.current();return i&&i.propertyIsEnumerable(v)?"keyword":r&&r.propertyIsEnumerable(v)||f.current().match(/^#@?[a-z0-9_]+ *$/i)&&f.peek()=="("&&!(r&&r.propertyIsEnumerable(v.toLowerCase()))?(p.beforeParams=!0,p.lastTokenWasBuiltin=!1,"keyword"):p.inString?(p.lastTokenWasBuiltin=!1,"string"):f.pos>v.length&&f.string.charAt(f.pos-v.length-1)=="."&&p.lastTokenWasBuiltin?"builtin":(p.lastTokenWasBuiltin=!1,null)}}function u(f){return function(p,g){for(var m=!1,v,b=!1;(v=p.next())!=null;){if(v==f&&!m){b=!0;break}if(f=='"'&&p.peek()=="$"&&!m){g.inString=!0,b=!0;break}m=!m&&v=="\\"}return b&&(g.tokenize=c),"string"}}function d(f,p){for(var g=!1,m;m=f.next();){if(m=="#"&&g){p.tokenize=c;break}g=m=="*"}return"comment"}function h(f,p){for(var g=0,m;m=f.next();){if(m=="#"&&g==2){p.tokenize=c;break}m=="]"?g++:m!=" "&&(g=0)}return"meta"}return{startState:function(){return{tokenize:c,beforeParams:!1,inParams:!1,inString:!1,lastTokenWasBuiltin:!1}},token:function(f,p){return f.eatSpace()?null:p.tokenize(f,p)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}}),e.defineMIME("text/velocity","velocity")})})();sl();(function(l,t){(function(e){e(Ke.exports)})(function(e){e.defineMode("yaml",function(){var n=["true","false","on","off","yes","no"],i=new RegExp("\\b(("+n.join(")|(")+"))$","i");return{token:function(r,s){var o=r.peek(),a=s.escaped;if(s.escaped=!1,o=="#"&&(r.pos==0||/\s/.test(r.string.charAt(r.pos-1))))return r.skipToEnd(),"comment";if(r.match(/^('([^']|\\.)*'?|"([^"]|\\.)*"?)/))return"string";if(s.literal&&r.indentation()>s.keyCol)return r.skipToEnd(),"string";if(s.literal&&(s.literal=!1),r.sol()){if(s.keyCol=0,s.pair=!1,s.pairStart=!1,r.match("---")||r.match("..."))return"def";if(r.match(/\s*-\s+/))return"meta"}if(r.match(/^(\{|\}|\[|\])/))return o=="{"?s.inlinePairs++:o=="}"?s.inlinePairs--:o=="["?s.inlineList++:s.inlineList--,"meta";if(s.inlineList>0&&!a&&o==",")return r.next(),"meta";if(s.inlinePairs>0&&!a&&o==",")return s.keyCol=0,s.pair=!1,s.pairStart=!1,r.next(),"meta";if(s.pairStart){if(r.match(/^\s*(\||\>)\s*/))return s.literal=!0,"meta";if(r.match(/^\s*(\&|\*)[a-z0-9\._-]+\b/i))return"variable-2";if(s.inlinePairs==0&&r.match(/^\s*-?[0-9\.\,]+\s?$/)||s.inlinePairs>0&&r.match(/^\s*-?[0-9\.\,]+\s?(?=(,|}))/))return"number";if(r.match(i))return"keyword"}return!s.pair&&r.match(/^\s*(?:[,\[\]{}&*!|>'"%@`][^\s'":]|[^,\[\]{}#&*!|>'"%@`])[^#]*?(?=\s*:($|\s))/)?(s.pair=!0,s.keyCol=r.indentation(),"atom"):s.pair&&r.match(/^:\s*/)?(s.pairStart=!0,"meta"):(s.pairStart=!1,s.escaped=o=="\\",r.next(),null)},startState:function(){return{pair:!1,pairStart:!1,keyCol:0,inlinePairs:0,inlineList:0,literal:!1,escaped:!1}},lineComment:"#",fold:"indent"}}),e.defineMIME("text/x-yaml","yaml"),e.defineMIME("text/yaml","yaml")})})();(function(l,t){(function(e){e(Ke.exports)})(function(e){function n(s,o,a){this.orientation=o,this.scroll=a,this.screen=this.total=this.size=1,this.pos=0,this.node=document.createElement("div"),this.node.className=s+"-"+o,this.inner=this.node.appendChild(document.createElement("div"));var c=this;e.on(this.inner,"mousedown",function(d){if(d.which!=1)return;e.e_preventDefault(d);var h=c.orientation=="horizontal"?"pageX":"pageY",f=d[h],p=c.pos;function g(){e.off(document,"mousemove",m),e.off(document,"mouseup",g)}function m(v){if(v.which!=1)return g();c.moveTo(p+(v[h]-f)*(c.total/c.size))}e.on(document,"mousemove",m),e.on(document,"mouseup",g)}),e.on(this.node,"click",function(d){e.e_preventDefault(d);var h=c.inner.getBoundingClientRect(),f;c.orientation=="horizontal"?f=d.clientX<h.left?-1:d.clientX>h.right?1:0:f=d.clientY<h.top?-1:d.clientY>h.bottom?1:0,c.moveTo(c.pos+f*c.screen)});function u(d){var h=e.wheelEventPixels(d)[c.orientation=="horizontal"?"x":"y"],f=c.pos;c.moveTo(c.pos+h),c.pos!=f&&e.e_preventDefault(d)}e.on(this.node,"mousewheel",u),e.on(this.node,"DOMMouseScroll",u)}n.prototype.setPos=function(s,o){return s<0&&(s=0),s>this.total-this.screen&&(s=this.total-this.screen),!o&&s==this.pos?!1:(this.pos=s,this.inner.style[this.orientation=="horizontal"?"left":"top"]=s*(this.size/this.total)+"px",!0)},n.prototype.moveTo=function(s){this.setPos(s)&&this.scroll(s,this.orientation)};var i=10;n.prototype.update=function(s,o,a){var c=this.screen!=o||this.total!=s||this.size!=a;c&&(this.screen=o,this.total=s,this.size=a);var u=this.screen*(this.size/this.total);u<i&&(this.size-=i-u,u=i),this.inner.style[this.orientation=="horizontal"?"width":"height"]=u+"px",this.setPos(this.pos,c)};function r(s,o,a){this.addClass=s,this.horiz=new n(s,"horizontal",a),o(this.horiz.node),this.vert=new n(s,"vertical",a),o(this.vert.node),this.width=null}r.prototype.update=function(s){if(this.width==null){var o=window.getComputedStyle?window.getComputedStyle(this.horiz.node):this.horiz.node.currentStyle;o&&(this.width=parseInt(o.height))}var a=this.width||0,c=s.scrollWidth>s.clientWidth+1,u=s.scrollHeight>s.clientHeight+1;return this.vert.node.style.display=u?"block":"none",this.horiz.node.style.display=c?"block":"none",u&&(this.vert.update(s.scrollHeight,s.clientHeight,s.viewHeight-(c?a:0)),this.vert.node.style.bottom=c?a+"px":"0"),c&&(this.horiz.update(s.scrollWidth,s.clientWidth,s.viewWidth-(u?a:0)-s.barLeft),this.horiz.node.style.right=u?a+"px":"0",this.horiz.node.style.left=s.barLeft+"px"),{right:u?a:0,bottom:c?a:0}},r.prototype.setScrollTop=function(s){this.vert.setPos(s)},r.prototype.setScrollLeft=function(s){this.horiz.setPos(s)},r.prototype.clear=function(){var s=this.horiz.node.parentNode;s.removeChild(this.horiz.node),s.removeChild(this.vert.node)},e.scrollbarModel.simple=function(s,o){return new r("CodeMirror-simplescroll",s,o)},e.scrollbarModel.overlay=function(s,o){return new r("CodeMirror-overlayscroll",s,o)}})})();const Cf=[{value:"plain",syntax:"simplemode",name:"Plain Text"},{value:"bash",syntax:"shell",name:"Bash"},{value:"basic",syntax:"vbscript",name:"Basic"},{value:"c",syntax:"text/x-csrc",name:"C"},{value:"cpp",syntax:"text/x-c++src",alias:["c++"],name:"C++"},{value:"csharp",syntax:"text/x-csharp",alias:["c#"],name:"C#"},{value:"css",syntax:"css",name:"CSS"},{value:"dart",syntax:"dart",name:"Dart"},{value:"diff",syntax:"diff",name:"Diff"},{value:"dockerfile",syntax:"dockerfile",name:"Dockerfile"},{value:"erlang",syntax:"erlang",name:"Erlang"},{value:"git",syntax:"shell",name:"Git"},{value:"go",syntax:"go",alias:["golang"],name:"Go"},{value:"graphql",syntax:"simplemode",name:"GraphQL"},{value:"groovy",syntax:"groovy",name:"Groovy"},{value:"html",syntax:"htmlmixed",name:"HTML",alias:["html5"]},{value:"http",syntax:"http",name:"HTTP"},{value:"java",syntax:"text/x-java",name:"Java"},{value:"javascript",syntax:"text/javascript",name:"JavaScript",alias:["js"]},{value:"json",syntax:"application/json",name:"JSON"},{value:"jsx",syntax:"jsx",name:"JSX"},{value:"katex",syntax:"simplemode",name:"KaTeX"},{value:"kotlin",syntax:"text/x-kotlin",name:"Kotlin"},{value:"less",syntax:"css",name:"Less"},{value:"makefile",syntax:"cmake",name:"Makefile"},{value:"markdown",syntax:"markdown",name:"Markdown"},{value:"matlab",syntax:"octave",name:"MATLAB"},{value:"nginx",syntax:"nginx",name:"Nginx"},{value:"objectivec",syntax:"text/x-objectivec",name:"Objective-C"},{value:"pascal",syntax:"pascal",name:"Pascal"},{value:"perl",syntax:"perl",name:"Perl"},{value:"php",syntax:"php",name:"PHP"},{value:"powershell",syntax:"powershell",name:"PowerShell"},{value:"protobuf",syntax:"protobuf",name:"Protobuf"},{value:"python",syntax:"python",name:"Python",alias:["py"]},{value:"r",syntax:"r",name:"R"},{value:"ruby",syntax:"ruby",name:"Ruby"},{value:"rust",syntax:"rust",name:"Rust"},{value:"scala",syntax:"text/x-scala",name:"Scala"},{value:"shell",syntax:"shell",name:"Shell"},{value:"sql",syntax:"text/x-sql",name:"SQL"},{value:"swift",syntax:"swift",name:"Swift"},{value:"typescript",syntax:"text/typescript",name:"TypeScript",alias:["ts"]},{value:"vbnet",syntax:"vb",name:"VB.net"},{value:"velocity",syntax:"velocity",name:"Velocity"},{value:"xml",syntax:"xml",name:"XML"},{value:"yaml",syntax:"yaml",name:"YAML"}];var ai;const Ys=class extends Tt{constructor(){super(...arguments);y(this,"mirror");y(this,"resize",()=>{var e;return(e=this.codeEditor)==null?void 0:e.container.find(".data-codeblock-content")});y(this,"codeEditor");y(this,"modeNameMap",{});y(this,"modeSynatxMap",{});rt(this,ai,void 0)}static get cardName(){return"codeblock"}static get cardType(){return Ve.BLOCK}static get autoSelected(){return!1}static get singleSelectable(){return!1}static getModes(){return Cf}static get lazyRender(){return!0}init(){if(Ia||(super.init(),this.codeEditor))return;Cf.forEach(n=>{this.modeNameMap[n.value]=n.name,this.modeSynatxMap[n.value]=n.syntax,n.alias&&n.alias.forEach(i=>{this.modeNameMap[i]=n.name,this.modeSynatxMap[i]=n.syntax})});const e=this.editor;this.codeEditor=new Mp(e,{synatxMap:this.modeSynatxMap,onSave:(n,i)=>{const r=this.getValue();n===(r==null?void 0:r.mode)&&i===r.code||this.setValue({mode:n,code:i})},onMouseDown:n=>{this.activated||setTimeout(()=>{e.card.activate(this.root,ui.MOUSE_DOWN)},10)},onUpFocus:n=>{var c;if(!V(e))return;n.preventDefault();const{change:i,card:r}=e,s=i.range.get().cloneRange(),o=this.root.prev(),a=o?r.find(o):void 0;if(a!=null&&a.onSelectUp)a.onSelectUp(n);else if(o)r.focusPrevBlock(this,s,!1),i.range.select(s);else{this.focus(s,!0),i.range.select(s);return}this.activate(!1),(c=this.toolbarModel)==null||c.hide()},onDownFocus:n=>{var c;if(!V(e))return;n.preventDefault();const{change:i,card:r}=e,s=i.range.get().cloneRange(),o=this.root.next(),a=o?r.find(o):void 0;if(a!=null&&a.onSelectDown)a.onSelectDown(n);else if(o)r.focusNextBlock(this,s,!1),i.range.select(s);else{this.focus(s,!1),i.range.select(s);return}this.activate(!1),(c=this.toolbarModel)==null||c.hide()},onLeftFocus:n=>{var s;if(!V(e))return;n.preventDefault();const{change:i}=e,r=i.range.get().cloneRange();this.focus(r,!0),i.range.select(r),this.activate(!1),(s=this.toolbarModel)==null||s.hide()},onRightFocus:n=>{var s;if(!V(e))return;n.preventDefault();const{change:i}=e,r=i.range.get().cloneRange();this.focus(r,!1),i.range.select(r),this.activate(!1),(s=this.toolbarModel)==null||s.hide()}})}toolbar(){var r;const e=this.editor,n=()=>this.loading?[]:!V(e)||e.readonly?[{key:"copy",type:"copy"},{key:"autoWrap",type:"switch",content:e.language.get(Ys.cardName,"autoWrap"),getState:()=>{var s;return ie(this,ai)===void 0&&Ze(this,ai,!!((s=this.getValue())!=null&&s.autoWrap)),ie(this,ai)},onClick:()=>{var o;const s=!ie(this,ai);Ze(this,ai,s),(o=this.codeEditor)==null||o.setAutoWrap(s)}}]:[{key:"dnd",type:"dnd"},{key:"copy",type:"copy"},{key:"delete",type:"delete"},{key:"select",type:"node",node:I("<div />"),didMount:s=>{setTimeout(()=>{Soe(s.get(),this.constructor.getModes(),this.modeNameMap[this.codeEditor.mode]||this.codeEditor.mode||"plain",o=>{setTimeout(()=>{var a;this.focusEditor(),(a=this.codeEditor)==null||a.update(o)},10)})},100)}},{key:"autoWrap",type:"switch",content:e.language.get(Ys.cardName,"autoWrap"),getState:()=>{var s;return!!((s=this.getValue())!=null&&s.autoWrap)},onClick:()=>{var a;const s=this.getValue(),o=!(s!=null&&s.autoWrap);this.setValue({autoWrap:o}),(a=this.codeEditor)==null||a.setAutoWrap(o)}}],i=(r=e.plugin.findPlugin("codeblock"))==null?void 0:r.options;return i!=null&&i.cardToolbars?i.cardToolbars(n(),this.editor):n()}focusEditor(){var e;(e=this.codeEditor)==null||e.focus(),this.editor.card.activate(this.root)}onSelectLeft(e){var n;!this.codeEditor||(e.preventDefault(),this.codeEditor.select(!1),this.activate(!0),(n=this.toolbarModel)==null||n.show())}onSelectRight(e){var n;!this.codeEditor||(e.preventDefault(),this.codeEditor.select(!0),this.activate(!0),(n=this.toolbarModel)==null||n.show())}onSelectDown(e){var n;!this.codeEditor||(e.preventDefault(),this.codeEditor.select(!0),this.activate(!0),(n=this.toolbarModel)==null||n.show())}onSelectUp(e){var n;!this.codeEditor||(e.preventDefault(),this.codeEditor.select(!1),this.activate(!0),(n=this.toolbarModel)==null||n.show())}render(){var r,s;if(!this.codeEditor)return;this.codeEditor.container.inEditor()||(this.codeEditor.container=I(this.codeEditor.renderTemplate()),this.mirror=void 0,this.getCenter().empty().append(this.codeEditor.container));const e=this.getValue(),n=(e==null?void 0:e.mode)||"plain",i=(e==null?void 0:e.code)||"";if(V(this.editor)){if(this.mirror){this.codeEditor.update(n,i),this.codeEditor.setAutoWrap(!!(e!=null&&e.autoWrap));return}this.mirror=(r=this.codeEditor)==null?void 0:r.create(n,i,{lineWrapping:!!(e!=null&&e.autoWrap)})}else(s=this.codeEditor)==null||s.create(n,i,{lineWrapping:!!(e!=null&&e.autoWrap)})}};let Di=Ys;ai=new WeakMap;const Toe={codeblock:{autoWrap:"Auto Wrap"}},Noe={codeblock:{autoWrap:"\u81EA\u52A8\u6362\u884C"}},Doe={"en-US":Toe,"zh-CN":Noe},Si="data-syntax",Sf="parse:html",Af="paste:schema",Tf="paste:each",Nf="markdown-it";class Roe extends _t{constructor(){super(...arguments);y(this,"markdownIt",e=>{this.options.markdown!==!1&&(e.enable("code"),e.enable("fence"))});y(this,"pasteSchema",e=>{e.add([{type:"block",name:"pre",attributes:{[Si]:"*",class:"*",language:"*","auto-wrap":"*"}},{type:"block",name:"code",attributes:{[Si]:{required:!0,value:"*"},"auto-wrap":"*"}},{type:"block",name:"code",attributes:{language:{required:!0,value:"*"}}},{type:"block",name:"code",attributes:{class:{required:!0,value:n=>n.includes("language")}},allowIn:["pre","$root"]},{type:"block",name:"div",attributes:{[Si]:{required:!0,value:"*"},"auto-wrap":"*"}}])});y(this,"pasteHtml",e=>{var i;const n=this.editor;if(!(!V(n)||e.isText())){if(((i=e.get())==null?void 0:i.hasAttribute(Si))||e.name==="pre"){let r=e.attributes(Si);if(!r){const o=c=>{var d;const u=(d=c==null?void 0:c.get())==null?void 0:d.classList;if(!!u)for(let h=0;h<u.length;h++){const f=u.item(h);if(f&&f.startsWith("language-")){const p=f.split("-");return p.shift(),p.join("-")}}};e.name==="pre"&&(r=e.attributes("language"),r||(r=o(e)));const a=e.find("code");!r&&a.length>0&&(r=a.attributes(Si)||a.attributes("language"),r||(r=o(a)))}let s=new $t(e,n).toText(void 0,void 0,!1);return s=ho(s.replace(/\u200b/g,"")),s.endsWith(`
`)&&(s=s.slice(0,-1)),n.card.replaceNode(e,"codeblock",{mode:r||"plain",code:s,autoWrap:e.attributes("auto-wrap")==="true"}),e.remove(),!1}return!0}});y(this,"parseHtml",(e,n)=>{const i=this.editor,r=[],s={};Di.getModes().forEach(u=>{s[u.value]=u.syntax});const o=new Mp(i,{synatxMap:s,styleMap:this.options.styleMap}),a="data-codeblock-content",c=o.container.find(`.${a}`);return c.css({border:"1px solid #e8e8e8",padding:"8px"}),c.addClass(La),c.css("background","#f9f9f9"),e.find(`[${ke}="${Di.cardName}"],[${We}="${Di.cardName}"]`).each(u=>{const d=I(u),h=i.card.find(d),f=(h==null?void 0:h.getValue())||at(d.attributes(je));if(f){d.empty(),c.empty(),o.render(f.mode||"plain",f.code||"");const p=c.clone(!0);d.append(p),d.removeAttributes(ke),d.removeAttributes(pt),d.removeAttributes(je),d.attributes(Si,f.mode||"plain"),d.attributes("auto-wrap",f.autoWrap?"true":"false"),p.removeClass(La).removeClass(a);let g=d;n&&(g=n(d,f),d.replaceWith(g)),r.push(g)}else d.remove()}),o.destroy(),r})}static get pluginName(){return"codeblock"}init(){const e=this.editor;e.language.add(Doe),e.on(Sf,this.parseHtml),e.on(Af,this.pasteSchema),e.on(Tf,this.pasteHtml),V(e)&&e.on(Nf,this.markdownIt)}execute(e,n){const i=this.editor;if(!V(i))return;const{card:r}=i;if(!n){const o=i.getSelectionData();o&&(n=o.text)}const s=r.insert(Di.cardName,{mode:e,code:n});setTimeout(()=>{s.focusEditor()},200)}hotkey(){return this.options.hotkey||""}destroy(){const e=this.editor;e.off(Sf,this.parseHtml),e.off(Af,this.pasteSchema),e.off(Tf,this.pasteHtml),V(e)&&e.off(Nf,this.markdownIt)}}const Moe="data-paintformat-mode";class Loe extends _t{constructor(){super(...arguments);y(this,"activeMarks");y(this,"activeBlocks");y(this,"type");y(this,"event");y(this,"isFormat",!1);y(this,"onBeforeCommandExecute",e=>{e!=="paintformat"&&!this.isFormat&&this.event&&this.removeActiveNodes(this.editor.container[0].ownerDocument)});y(this,"onContainerMouseUp",e=>{if(!this.activeMarks||!e.target)return;const n=this.editor;if(n.card.closest(I(e.target))){this.removeActiveNodes(n.container[0].ownerDocument);return}this.isFormat=!0,this.paintFormat(this.activeMarks,this.activeBlocks),this.isFormat=!1,this.type==="single"&&this.removeActiveNodes(n.container[0].ownerDocument)})}static get pluginName(){return"paintformat"}init(){const e=this.editor;!V(e)||(e.on("beforeCommandExecute",this.onBeforeCommandExecute),e.container.on("mouseup",this.onContainerMouseUp))}removeActiveNodes(e){be(e)&&(e=I(e));const n=this.editor;n.container.removeClass(Moe),this.activeMarks=void 0,this.activeBlocks=void 0,this.event&&(e.off("keydown",this.event),this.event=void 0),V(n)&&n.trigger("select")}bindEvent(e){const n=e[0].ownerDocument,i=r=>{r.metaKey||r.ctrlKey||r.shiftKey||(this.event=void 0,(r.key==="Escape"||r.keyCode===27)&&(e.off("keydown",i),n&&this.removeActiveNodes(n)))};n&&(I(n).on("keydown",i),this.event=i)}paintFormat(e,n){const i=this.editor;if(!V(i))return;const{change:r,command:s,block:o}=i,a=r.range.get(),c=this.options.removeCommand||"removeformat";if(a.collapsed){let u=I(`<img ${le}="${Qe}" role="format-dummy" style="display: none;" />`);a.insertNode(u[0]);const d=o.closest(a.startNode);a.select(d,!0),r.range.select(a),typeof c=="function"?c(a):s.execute(c),this.paintMarks(e);const h=o.getBlocks(a);n&&h.forEach(f=>{this.paintBlocks(f,n)}),u=d.find('img[role="format-dummy"]'),a.select(u),a.collapse(!0),u.remove(),r.apply(a)}else{typeof c=="function"?c(a):s.execute(c),this.paintMarks(e);const u=o.getBlocks(a);n&&u.forEach(d=>{this.paintBlocks(d,n)})}i.mark.merge(a)}paintMarks(e){const n=this.editor,{mark:i}=n;for(let r=e.length-1;r>=0;r--){const s=e[r];i.wrap(n.node.clone(s,!1,!1))}}paintBlocks(e,n){const i=this.editor;if(!V(i)||!e.inEditor())return;const{node:r,change:s}=i,o=i.block,a=s.range.get(),c=a.createSelection("removeformat");n.forEach(u=>{if(!e.inEditor()||this.options.paintBlock&&this.options.paintBlock(e,u)===!1)return;if(u.name!==e.name){if(a.select(e).shrinkToElementNode(),s.blocks=[e],u.name==="p"){const h=o.findPlugin(e);h&&h.execute(u.name)}else if(r.isRootBlock(u)){const h=o.findPlugin(u);h&&h.execute(u.name)}else if(r.isList(u)&&u.name!=="li"){const h=o.findPlugin(u),f=o.findPlugin(e.name==="li"?e.parent():e);h&&f!==h&&h.execute()}}const d=u.css();Object.keys(d).length>0&&o.setBlocks({style:d})}),c.move()}execute(e="single"){const n=this.editor;if(!V(n))return;if(this.activeMarks){this.removeActiveNodes(n.container);return}this.type=e,this.bindEvent(n.container);const{change:i,mark:r,block:s}=n,o=i.range.get();this.activeMarks=r.findMarks(o),this.activeBlocks=s.findBlocks(o),n.trigger("select"),n.container.addClass("data-paintformat-mode")}queryState(){return!!this.activeMarks}destroy(){const e=this.editor;e.off("beforeCommandExecute",this.onBeforeCommandExecute),e.container.off("mouseup",this.onContainerMouseUp)}}const Df="parse:html",Rf="keydown:backspace",Mf="keydown:enter",Os="paste:each",Lf="markdown-it";class Ioe extends Fl{constructor(){super(...arguments);y(this,"tagName","blockquote");y(this,"canMerge",!0);y(this,"pasteEach",e=>{var n;e.isText()&&((n=e.parent())==null?void 0:n.name)===this.tagName&&this.editor.node.wrap(e,I("<p></p>"))});y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("blockquote")});y(this,"onBackspace",e=>{const n=this.editor;if(!V(n))return;const{change:i,node:r}=n,s=i.range.get(),o=n.block;if(o.isLastOffset(s,"end")&&!s.collapsed){const h=o.closest(s.startNode),f=o.closest(s.endNode),p=h.parent(),g=f.parent();if(p&&g&&g.name==="blockquote"&&!p.equal(g)){g.remove();return}}if(!s.collapsed||!o.isFirstOffset(s,"start"))return;const u=o.closest(s.startNode),d=u.parent();if(d&&d.name==="blockquote"&&r.isBlock(u)){if(e.preventDefault(),u.prevElement())i.mergeAfterDelete(u);else if(r.isEmpty(d)){const h=I("<p><br/></p>");d.replaceWith(h),s.select(h,!0).collapse(!1),i.apply(s)}else o.unwrap("<blockquote />");return!1}});y(this,"onEnter",e=>{const n=this.editor;if(!V(n))return;const{change:i}=n,r=n.block,s=i.range.get(),o=r.closest(s.endNode),a=o.parent();if((a==null?void 0:a.name)===this.tagName&&o.name==="p"&&o.nextElement())return e.preventDefault(),r.insertOrSplit(s,o),!1});y(this,"parseHtml",e=>{e.find("blockquote").css({"margin-top":"5px","margin-bottom":"5px","padding-left":"1em","margin-left":"0px","border-left":"3px solid #eee",opacity:"0.6"})});y(this,"pasteHtml",e=>{const n=this.editor;if(!!V(n)){if(e.name===this.tagName){const i=n.node;return e.css("padding-left",""),e.css("text-indent",""),i.isEmpty(e)&&e.empty().append("<p><br/></p>"),n.normalize(e),!1}return!0}})}static get pluginName(){return"quote"}init(){super.init();const e=this.editor;e.schema.addAllowIn(this.tagName),e.on(Df,this.parseHtml),V(e)&&(e.on(Os,this.pasteHtml),e.on(Rf,this.onBackspace),e.on(Mf,this.onEnter),e.on(Os,this.pasteEach),e.on(Lf,this.markdownIt))}execute(){const e=this.editor;if(!V(e))return;const{change:n,block:i,node:r}=e;if(!this.queryState())i.wrap(`<${this.tagName} />`);else{const s=n.range.get(),o=n.blocks[0].closest(this.tagName),a=s.createSelection();r.unwrap(o),a.move(),n.range.select(s);return}}queryState(){const e=this.editor;if(!V(e))return;const{change:n}=e,i=n.blocks;if(i.length===0)return!1;const r=i[0].closest(this.tagName);return this.isSelf(r)}hotkey(){return this.options.hotkey||"mod+shift+u"}destroy(){const e=this.editor;e.off(Df,this.parseHtml),V(e)&&(e.off(Os,this.pasteHtml),e.off(Rf,this.onBackspace),e.off(Mf,this.onEnter),e.off(Os,this.pasteEach),e.off(Lf,this.markdownIt))}}class Ooe extends _t{static get pluginName(){return"redo"}execute(){const t=this.editor;!V(t)||t.readonly||t.history.redo()}queryState(){const t=this.editor;if(!(!V(t)||t.readonly))return t.history.hasRedo()}hotkey(){return this.options.hotkey||["mod+y","shift+mod+y"]}}class Foe extends _t{static get pluginName(){return"removeformat"}execute(){const t=this.editor;if(!V(t))return;const{change:e,block:n,mark:i,inline:r}=t,s=n,o=e.range.get(),a=s.getBlocks(o),c=i.findMarks(o),u=r.findInlines(o);if(c.length>0)i.unwrap();else if(u.length>0)r.unwrap();else{const d=o.createSelection("removeformat");a.forEach(h=>{const f=s.findPlugin(h.name==="li"?h.parent():h);f&&(o.select(h).shrinkToElementNode(),f.execute()),h.removeAttributes("style")}),d.move()}}hotkey(){return this.options.hotkey||"mod+\\"}}const If="markdown-it";class Boe extends mi{constructor(){super(...arguments);y(this,"tagName","del");y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("strikethrough")})}static get pluginName(){return"strikethrough"}init(){super.init();const e=this.editor;V(e)&&e.on(If,this.markdownIt)}hotkey(){return this.options.hotkey||"mod+shift+x"}conversion(){return[{from:(e,n)=>e==="span"&&(n["text-decoration"]||"").includes("line-through"),to:(e,n,i)=>{const r=I(`<${this.tagName} />`);return n["text-decoration"]=n["text-decoration"].split(/\s+/).filter(s=>s!=="line-through").join(" ").trim(),r.css(n),r.attributes(i),r}},{from:"s",to:this.tagName},{from:"strike",to:this.tagName}]}destroy(){this.editor.off(If,this.markdownIt)}}class $oe extends mi{constructor(){super(...arguments);y(this,"tagName","u")}static get pluginName(){return"underline"}hotkey(){return this.options.hotkey||"mod+u"}conversion(){return[{from:(e,n)=>e==="span"&&(n["text-decoration"]||"").includes("underline"),to:(e,n,i)=>{const r=I(`<${this.tagName} />`);return n["text-decoration"]=n["text-decoration"].split(/\s+/).filter(s=>s!=="underline").join(" ").trim(),r.css(n),r.attributes(i),r}}]}}class Poe extends _t{static get pluginName(){return"undo"}execute(){const t=this.editor;!V(t)||t.readonly||t.history.undo()}queryState(){const t=this.editor;if(!(!V(t)||t.readonly))return t.history.hasUndo()}hotkey(){return this.options.hotkey||["mod+z","shift+mod+z"]}}const Of="markdown-it";class zoe extends lp{constructor(){super(...arguments);y(this,"tagName","ul");y(this,"attributes",{"data-indent":"@var0"});y(this,"variable",{"@var0":"@number"});y(this,"allowIn",["blockquote","$root"]);y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("list")})}static get pluginName(){return"unorderedlist"}init(){super.init();const e=this.editor;V(e)&&e.on(Of,this.markdownIt)}schema(){return[super.schema(),{name:"ul",type:"block"},{name:"li",type:"block",allowIn:["ul"]}]}isCurrent(e){return!e.hasClass(this.editor.list.CUSTOMZIE_UL_CLASS)&&e.name==="ul"}execute(){const e=this.editor;if(!V(e))return;const{change:n,list:i,block:r}=e;i.split();const s=n.range.get(),o=r.findBlocks(s);if(o){const a=s.createSelection();i.getPluginNameByNodes(o)==="unorderedlist"?i.unwrap(o):i.toNormal(o,"ul"),a.move(),n.range.select(s),i.merge()}}hotkey(){return this.options.hotkey||"mod+shift+8"}destroy(){this.editor.off(Of,this.markdownIt)}}class qoe extends lp{constructor(){super(...arguments);y(this,"tagName","ol");y(this,"attributes",{start:"@var0","data-indent":"@var1"});y(this,"variable",{"@var0":"@number","@var1":"@number"});y(this,"allowIn",["blockquote","$root"]);y(this,"markdownIt",e=>{this.options.markdown!==!1&&e.enable("list")})}static get pluginName(){return"orderedlist"}init(){super.init();const e=this.editor;V(e)&&e.on("markdown-it",this.markdownIt)}schema(){return[super.schema(),{name:"ol",type:"block"},{name:"li",type:"block",allowIn:["ol"]}]}isCurrent(e){const{list:n}=this.editor;return!e.hasClass(n.CUSTOMZIE_UL_CLASS)&&e.name==="ol"}execute(e=1){const n=this.editor;if(!V(n))return;const{change:i,list:r,block:s}=n;r.split();const o=i.range.get(),a=s.findBlocks(o);if(a){const c=o.createSelection();r.getPluginNameByNodes(a)==="orderedlist"?r.unwrap(a):r.toNormal(a,"ol",e),c.move(),i.range.select(o),r.merge()}}hotkey(){return this.options.hotkey||"mod+shift+7"}destroy(){this.editor.off("markdown-it",this.markdownIt)}}const Hoe=[wse,xse,kse,Ese,Cse,wp,xp,Sse,Ase,kp,Ap,Sp,Pse,Wse,Tp,Np,ooe,Rp,_oe,Roe,Loe,Ioe,Ooe,Foe,Boe,Poe,$oe,qoe,zoe,vse],Woe=[Di,Ja,$s,ti,on,ei],Uoe=l=>{},Mr={}.VITE_APP_ENV=="production"?window==null?void 0:window.globalConfig.Upload_url:window==null?void 0:window.globalConfig.Upload_url_dev,joe={[kp.pluginName]:{markdown:"*"},[Ap.pluginName]:{onBeforeRender:(l,t)=>(t.startsWith("data:image/"),t)},[Sp.pluginName]:{file:{action:`${Mr}/upload/image`,headers:()=>{const l=ys(),t=Date.parse(new Date().toString())/1e3;return{"verify-time":t,"verify-encrypt":_s.exports("charm@888"+t),Authorization:l}}},remote:{action:`${Mr}/upload/thirdImage`,headers:()=>{const l=ys(),t=Date.parse(new Date().toString())/1e3;return{"verify-time":t,"verify-encrypt":_s.exports("charm@888"+t),Authorization:l}}},isRemote:l=>l.indexOf(Mr)<0},[Tp.pluginName]:{action:`${Mr}/upload/file`,headers:()=>{const l=ys(),t=Date.parse(new Date().toString())/1e3;return{"verify-time":t,"verify-encrypt":_s.exports("charm@888"+t),Authorization:l}}},[Np.pluginName]:{action:`${Mr}/attupfile/upfile?filetype='video'`,headers:()=>{const l=ys(),t=Date.parse(new Date().toString())/1e3;return{"verify-time":t,"verify-encrypt":_s.exports("charm@888"+t),Authorization:l}},limitSize:1024*1024*50},[Gse.pluginName]:{onBeforeRender:(l,t)=>t+`?_t=${Date.parse(new Date().toString())/1e3}`},[wp.pluginName]:{filter:l=>{const t=yp.find(e=>l.split(",").some(n=>e.value.toLowerCase().indexOf(n.replace(/"/,"").toLowerCase())>-1));return t?t.value:!1}},[xp.pluginName]:{filter:l=>["12px","13px","14px","15px","16px","19px","22px","24px","29px","32px","40px","48px"].indexOf(l)>-1},[Rp.pluginName]:{filter:l=>l==="14px"?"1":l==="16px"?"1.15":l==="21px"?"1.5":l==="28px"?"2":l==="35px"?"2.5":l==="42px"?"3":["1","1.15","1.5","2","2.5","3"].indexOf(l)>-1}},Voe=mt({name:"engine-edit",components:{GfLoading:_se,GfToolbar:Hr,IconSync:og},props:{docData:{type:String,default:""},minHeight:{type:Number,default:320}},emits:["updata"],data(){return{items:[["collapse"],["undo","redo","paintformat","removeformat"],["heading","fontfamily","fontsize"],["fontcolor","backcolor"],["alignment","unorderedlist","orderedlist","indent","line-height"],["link","quote","bold","italic","strikethrough","underline"]]}},setup(l,{emit:t}){const e=xe(null),n=xe(null),i=xe([]),r=xe(!0),s=xe(!1),o=xe("");return Fi(()=>{if(e.value){const c=new qne(e.value,{plugins:Hoe,cards:Woe,autoPrepend:!1,lazyRender:!1,placeholder:"\u5F00\u59CB\u7F16\u8F91",config:joe});Uoe(),c.setHtml(o.value,()=>{r.value=!1}),c.on("change",()=>{gg(()=>{t("updata",c.getHtml())})}),n.value=c}document.addEventListener("keydown",c=>{c.keyCode==83&&(navigator.platform.match("Mac")?c.metaKey:c.ctrlKey)&&c.preventDefault()})}),Js(()=>{n.value&&n.value.destroy()}),{loading:r,isMobile:ue,container:e,engine:n,members:i,upLoading:s,setVal:c=>{o.value=c,n.value&&n.value.setHtml(c,()=>{r.value=!1})}}}});const Goe={class:"editor-content"},Zoe={ref:"container"};function Koe(l,t,e,n,i,r){const s=ct("gf-toolbar"),o=ct("gf-loading");return oe(),Je(o,{loading:l.loading,text:"\u7F16\u8F91\u5668\u521D\u59CB\u4E2D"},{default:Be(()=>[Ne("div",{class:"editor-wrapper",style:zn({height:`${l.minHeight}px`})},[l.engine?(oe(),Je(s,{key:0,engine:l.engine,items:l.items},null,8,["engine","items"])):Re("",!0),Ne("div",{class:"editor-container",style:zn({height:`${l.minHeight-37}px`})},[Ne("div",Goe,[Ne("div",Zoe,null,512)])],4)],4)]),_:1},8,["loading"])}const Xoe=gt(Voe,[["render",Koe]]),Yoe=mt({name:"AddBook",components:{BasicModal:kg,Editor:Xoe,FileManage:Yf},emits:["success"],setup(l,{emit:t}){const[e,{openModal:n}]=Hf(),i=xe(!1),r=xe(!0),s=xe(!1),o=xe([]),a=xe(1),c=xe(620),u=xe(620),d=xe(),h={id:0,title:"",price:0,num:0,content:""},f=xe(h),p=xe(),[g,{setModalProps:m,closeModal:v}]=Eg(async O=>{var A;(A=d.value)==null||A.resetFields(),a.value=1,m({confirmLoading:!1});const L=await Ag({}),B=[{value:0,label:"\u672A\u9009\u5206\u7C7B"}];if(L?o.value=B.concat(L):o.value=B,s.value=!!(O!=null&&O.isUpdate),Jo(s)){f.value=mc(O.record);const F=await Zg({id:O.record.id});f.value=Object.assign({},f.value,F),p.value&&p.value.setVal(F.content)}else f.value=h}),b=mg(()=>Jo(s)?"\u7F16\u8F91\u6570\u636E":"\u65B0\u589E\u6570\u636E"),{loading:_,setLoading:x}=Cg();return{registerModal:g,getTitle:b,handleSubmit:async()=>{var O;try{if(!await((O=d.value)==null?void 0:O.validate())){x(!0),Xi.loading({content:"\u63D0\u4EA4\u4E2D",id:"upStatus",duration:2e3});let B=mc(Jo(f));await Kg(B),Xi.success({content:"\u63D0\u4EA4\u6210\u529F",id:"upStatus",duration:2e3}),v(),t("success"),x(!1)}}catch{x(!1),Xi.clear("top")}},formRef:d,loading:_,formData:f,cateList:o,OYoptions:[{label:"\u5426",value:0},{label:"\u662F",value:1}],tapList:[{id:1,name:"\u57FA\u7840\u5185\u5BB9"},{id:2,name:"\u8BE6\u7EC6\u5185\u5BB9"}],activeKey:a,customupFile:O=>{Xi.loading({content:"\u4E0A\u4F20\u4E2D",id:"upStatus",duration:0});const L=new AbortController;return async function(){const{onProgress:A,onError:F,onSuccess:W,fileItem:G}=O;A(20);const k=C=>{let $;C.total>0&&($=C.loaded/C.total*100),A(parseInt(String($),10),C)};try{const C=(G==null?void 0:G.name)||"",$=await Tg({name:"file",file:G.file,filename:C,data:{cid:0}},k);$&&(f.value.replaceFile=$.url),Xi.success({content:"\u4E0A\u4F20\u6210\u529F",id:"upStatus",duration:1500})}catch(C){F(C),Xi.error({content:"\u4E0A\u4F20\u5931\u8D25",id:"upStatus",duration:2e3})}}(),{abort(){L.abort()}}},handleEditUpdta:O=>{f.value.content=O},modelHeight:c,editorRef:p,onHeightChange:O=>{u.value=O},windHeight:u,isEditor:r,registerFileModal:e,selectImg:O=>{O.type=="more"?O.list.forEach(L=>{console.log("\u591A\u5F20\u9644\u4EF6\u8FD4\u56DE:",L)}):O.type=="one"&&(f.value.replaceimage=O.url)},UpImage:()=>{n(!0,{filetype:"image",getnumber:"one",openfrom:"use"})},visibleimage:i}}});const Joe={key:0,class:"tabs-header"},Qoe={class:"tabs-nav-wrap"},eae=["onClick"],tae={class:"label"},nae={class:"content_box"},iae={class:"besecontent"};function rae(l,t,e,n,i,r){const s=zs,o=vg,a=bg,c=el,u=yg,d=_g,h=wg,f=ct("Editor"),p=xg,g=ct("FileManage"),m=ct("BasicModal");return oe(),Je(m,Yt(l.$attrs,{onRegister:l.registerModal,isPadding:!1,loading:l.loading,width:"1000px",onHeightChange:l.onHeightChange,minHeight:l.modelHeight,title:l.getTitle,onOk:l.handleSubmit}),{default:Be(()=>[Ne("div",{class:"addFormbox",style:zn({"min-height":`${l.windHeight}px`})},[l.isEditor?(oe(),pe("div",Joe,[Ne("div",Qoe,[(oe(!0),pe(kt,null,Jt(l.tapList,v=>(oe(),pe("div",{class:lt(["tap_item",{item_active:l.activeKey==v.id}]),onClick:()=>{l.activeKey=v.id}},[Ne("div",tae,Et(v.name),1)],10,eae))),256))]),Ne("div",{class:"tabs-bar",style:zn({top:`${(l.activeKey-1)*64}px`,height:"64px"})},null,4)])):Re("",!0),Ne("div",{class:lt(["tabs-content",{addpadding:!l.isEditor}])},[Ge(p,{ref:"formRef",model:l.formData,"auto-label-width":""},{default:Be(()=>[Ne("div",nae,[vc(Ge(h,{style:zn([{overflow:"auto"},{height:`${l.windHeight}px`}])},{default:Be(()=>[Ne("div",iae,[Ge(d,{gutter:16},{default:Be(()=>[Ge(a,{span:12},{default:Be(()=>[Ge(o,{field:"cid",label:"\u9009\u62E9\u5206\u7C7B","validate-trigger":"input"},{default:Be(()=>[Ge(s,{modelValue:l.formData.cid,"onUpdate:modelValue":t[0]||(t[0]=v=>l.formData.cid=v),options:l.cateList,placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B"},null,8,["modelValue","options"])]),_:1})]),_:1}),Ge(a,{span:12},{default:Be(()=>[Ge(o,{field:"title",label:"\u6807\u98981",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u6807\u98981"}]},{default:Be(()=>[Ge(c,{modelValue:l.formData.title,"onUpdate:modelValue":t[1]||(t[1]=v=>l.formData.title=v),placeholder:"\u8BF7\u586B\u6807\u98981"},null,8,["modelValue"])]),_:1})]),_:1}),Ge(a,{span:12},{default:Be(()=>[Ge(o,{field:"price",label:"\u4EF7\u683C"},{default:Be(()=>[Ge(u,{modelValue:l.formData.price,"onUpdate:modelValue":t[2]||(t[2]=v=>l.formData.price=v),placeholder:"\u8BF7\u586B\u4EF7\u683C"},null,8,["modelValue"])]),_:1})]),_:1}),Ge(a,{span:12},{default:Be(()=>[Ge(o,{field:"num",label:"\u5E93\u5B58",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u5E93\u5B58"}]},{default:Be(()=>[Ge(u,{modelValue:l.formData.num,"onUpdate:modelValue":t[3]||(t[3]=v=>l.formData.num=v),placeholder:"\u8BF7\u586B\u5E93\u5B58"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["style"]),[[bc,l.activeKey==1]]),vc(Ne("div",{class:"hcontent",style:zn({height:`${l.windHeight}px`})},[Ge(f,{minHeight:l.windHeight,ref:"editorRef",onUpdata:l.handleEditUpdta},null,8,["minHeight","onUpdata"])],4),[[bc,l.activeKey==2]])])]),_:1},8,["model"])],2)],4),Ge(g,{onRegister:l.registerFileModal,onSuccess:l.selectImg},null,8,["onRegister","onSuccess"])]),_:1},16,["onRegister","loading","onHeightChange","minHeight","title","onOk"])}const sae=gt(Yoe,[["render",rae],["__scopeId","data-v-7d1d1753"]]),Mae=Object.freeze(Object.defineProperty({__proto__:null,default:sae},Symbol.toStringTag,{value:"Module"}));export{sae as A,Mae as a,Rae as d,Nae as g,Dae as u};
