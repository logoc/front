import{n as H,p as I,_ as Y}from"./index.a2bf8911.js";/* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css                *//* empty css                */import{d as j,e as _,c as X,u as R,aS as p,aL as K,C as n,aE as f,aH as a,aI as u,D as C,aK as T,aJ as O,aN as d,aO as k,G as E,aF as v,E as Z,bU as x,aW as ee,b7 as ae,b_ as ue,bL as le,bM as te,cc as oe,bQ as se,bR as de,bS as ne,aY as ie,c4 as re,bc as me,b2 as pe,b3 as fe}from"./arco.b02d9b55.js";import{B as ce,u as ge}from"./index.c4821ce7.js";import{u as ve}from"./loading.7f7bf96d.js";import{g as _e,a as Ee,b as be,s as De}from"./devapi.0e5791d2.js";import{g as Q}from"./generatecode.4bd8b8fc.js";import{I as Fe}from"./IconPicker.7129cb1a.js";import{I as ye}from"./Icon.031e5930.js";import"./chart.67655b2c.js";import"./vue.e4c26cfd.js";/* empty css                *//* empty css                */function Be(e){return H.post({url:"/developer/apicode/installcode",params:e},{errorMessageMode:"message"})}function he(e){return H.post({url:"/developer/apicode/uninstallcode",params:e},{errorMessageMode:"message"})}function Ve(e){return H.post({url:"/developer/apicode/removeFile",params:e},{errorMessageMode:"message"})}const Ce=j({name:"AddBook",components:{BasicModal:ce,IconPicker:Fe,Icon:ye},emits:["success"],setup(e,{emit:s}){const A=_(!1),b=_([]),w=_([]),L=_([]),h=_([]),i=_(),r={id:0,type:"biz",cid:0,status:0,istoken:0,title:"",des:"",url:"",param:"",method:"get",tablename:[],apicode_type:0,is_install:0,fields:[],getdata_type:"list"},t=_(r),g=_(""),[$,{setModalProps:m,closeModal:D}]=ge(async o=>{var F;(F=i.value)==null||F.resetFields(),m({confirmLoading:!1});const M=await _e(),c=[{id:0,name:"\u672A\u9009\u5206\u7EC4",pid:0}];M?w.value=c.concat(M):w.value=c,L.value=await Ee({}),h.value=await be({}),A.value=!!(o!=null&&o.isUpdate),R(A)?(t.value=I(o.record),t.value.fields&&(t.value.fields=t.value.fields.split(",")),t.value.tablename&&(t.value.tablename=t.value.tablename.split(",")),t.value.method=="get"&&setTimeout(async()=>{b.value=await Q({tablename:o.record.tablename})},1e3),g.value=o.record.url):(t.value=I(r),b.value=[])}),S=X(()=>R(A)?"\u7F16\u8F91\u7BA1\u7406\u63A5\u53E3":"\u65B0\u589E\u7BA1\u7406\u63A5\u53E3"),{loading:V,setLoading:B}=ve(),z=async()=>{var o;try{if(!await((o=i.value)==null?void 0:o.validate())){B(!0),p.loading({content:"\u4FDD\u5B58\u4E2D",id:"upStatus"});let c=I(R(t)),F="";c.fields&&c.fields.forEach(y=>{y&&(F==""?F+=y:F+=","+y)}),c.fields=F;let U="";c.tablename&&c.tablename.forEach(y=>{y&&(U==""?U+=y:U+=","+y)}),c.tablename=U,await De(R(c)),p.success({content:"\u4FDD\u5B58\u6210\u529F",id:"upStatus"}),D(),s("success"),B(!1)}}catch{B(!1),p.clear("top")}},N=async()=>{try{p.loading({content:"\u751F\u6210\u63A5\u53E3\u4EE3\u7801\u4E2D",id:"upStatus",duration:0}),await Be({id:t.value.id})&&(t.value.is_install=1,s("success"),p.success({content:"\u751F\u6210\u63A5\u53E3\u4EE3\u7801\u6210\u529F",id:"upStatus",duration:1e3}))}catch{p.clear("top")}},G=async()=>{try{p.loading({content:"\u5378\u8F7D\u4E2D",id:"upStatus",duration:0}),await he({id:t.value.id})&&(s("success"),t.value.is_install=2,p.success({content:"\u5378\u8F7D\u6210\u529F",id:"upStatus",duration:1e3}))}catch{p.clear("top")}},l=async()=>{try{p.loading({content:"\u5220\u9664\u6587\u4EF6\u4E2D",id:"upStatus",duration:0}),await Ve({id:t.value.id})&&(t.value.is_install=0,p.success({content:"\u5220\u9664\u6587\u4EF6\u529F",id:"upStatus",duration:1e3}))}catch{p.clear("top")}},W=()=>{t.value.apicode_type!=0&&q()},q=()=>{t.value.apicode_type==2&&g.value==""&&(g.value=I(t.value.url)),J()},J=()=>{if(t.value.apicode_type==2)t.value.url="/common/api/"+P();else if(t.value.apicode_type==1){if(t.value.tablename){const o=t.value.tablename.split("_");o.length>=3?t.value.url=`/${o[1]}/${o[2]}/`+P():o.length==2&&(t.value.url=`/${o[0]}/${o[1]}/`+P())}}else t.value.url=g.value?g.value:t.value.url},P=()=>{let o="";return t.value.method=="get"?t.value.getdata_type=="list"?o="get_list":t.value.getdata_type=="detail"&&(o="get_detail"):t.value.method=="post"?o="save":t.value.method=="delete"&&(o="del"),o};return{registerModal:$,getTitle:S,handleSubmit:z,formRef:i,loading:V,formData:t,groupList:w,handleInstall:N,handleUninstall:G,fieldList:b,handelApicodeType:q,handelGetdataType:J,handelSelectFields:async o=>{if(o&&(!b.value||b.value.length==0)){if(!t.value.tablename){p.error({content:"\u8BF7\u4F60\u5148\u586B\u5199\u6570\u636E\u5E93\u540D\u79F0\u518D\u9009\u62E9\u6570\u636E\u5B57\u6BB5",id:"upStatus"});return}b.value=await Q({tablename:t.value.tablename})}},handelMethodType:W,handleRemoveFile:l,tablelist:L,tablefallback:o=>(console.log(o),{value:o,label:`++${o}++`}),routerlist:h}}});const ke=e=>(pe("data-v-eb1299c5"),e=e(),fe(),e),Ae={class:"flexbox"},we={class:"left"},Se={class:"right"},Me={key:2,class:"notig"},Ue=ke(()=>E("div",{class:"text"},"\u8BF7\u5148\u4FDD\u5B58\u6570\u636E\u540E\u518D\u751F\u6210\u4EE3\u7801",-1)),Ie=[Ue],Re={class:"tigmsg"},Te={class:"tigmsg"};function Le(e,s,A,b,w,L){const h=ee,i=ae,r=ue,t=le,g=te,$=oe,m=se,D=de,S=ne,V=ie,B=K("icon-exclamation-circle"),z=re,N=me,G=K("BasicModal");return n(),f(G,x(e.$attrs,{onRegister:e.registerModal,loading:e.loading,helpMessage:"\u7F16\u8F91\u548C\u4FEE\u6539\u63A5\u53E3",width:"1050px",minHeight:480,title:e.getTitle,onOk:e.handleSubmit}),{default:a(()=>[u(N,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:a(()=>[u(z,{gutter:16},{default:a(()=>[u(r,{span:12},{default:a(()=>[u(i,{field:"title",label:"\u63A5\u53E3\u540D\u79F0","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u63A5\u53E3\u540D\u79F0"}]},{default:a(()=>[u(h,{modelValue:e.formData.title,"onUpdate:modelValue":s[0]||(s[0]=l=>e.formData.title=l),placeholder:"\u8BF7\u586B\u63A5\u53E3\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),u(r,{span:12},{default:a(()=>[u(i,{field:"url",label:"\u63A5\u53E3\u8DEF\u5F84",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u63A5\u63A5\u53E3\u8DEF\u5F84"}]},{default:a(()=>[e.formData.url||e.formData.apicode_type==2?(n(),f(h,{key:0,modelValue:e.formData.url,"onUpdate:modelValue":s[1]||(s[1]=l=>e.formData.url=l),placeholder:"\u8BF7\u586B\u63A5\u53E3\u8DEF\u5F84",disabled:e.formData.apicode_type==2,"allow-clear":""},null,8,["modelValue","disabled"])):(n(),f(g,{key:1,modelValue:e.formData.url,"onUpdate:modelValue":s[2]||(s[2]=l=>e.formData.url=l),placeholder:"\u8BF7\u586B\u63A5\u53E3\u8DEF\u5F84","allow-search":"","allow-clear":"","allow-create":""},{default:a(()=>[(n(!0),C(T,null,O(e.routerlist,l=>(n(),f(t,{value:l},{default:a(()=>[d(k(l),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),u(r,{span:12},{default:a(()=>[u(i,{field:"dept_id",label:"\u9009\u62E9\u5206\u7EC4",style:{"margin-bottom":"15px"}},{default:a(()=>[u($,{placeholder:"\u9009\u62E9\u5206\u7EC4",data:e.groupList,fieldNames:{key:"id",title:"name",children:"children"},modelValue:e.formData.cid,"onUpdate:modelValue":s[3]||(s[3]=l=>e.formData.cid=l)},null,8,["data","modelValue"])]),_:1})]),_:1}),u(r,{span:12},{default:a(()=>[E("div",Ae,[E("div",we,[u(i,{field:"status",label:"\u72B6\u6001","label-col-style":{flex:" 0 0 57px"},style:{"margin-bottom":"15px"}},{default:a(()=>[u(D,{modelValue:e.formData.status,"onUpdate:modelValue":s[4]||(s[4]=l=>e.formData.status=l)},{default:a(()=>[u(m,{value:0,style:{"margin-right":"2px"}},{default:a(()=>[d("\u542F\u7528")]),_:1}),u(m,{value:1,style:{"margin-right":"2px"}},{default:a(()=>[d("\u7981\u7528")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),E("div",Se,[u(i,{field:"istoken",label:"Token","label-col-style":{flex:" 0 0 57px"},style:{"margin-bottom":"15px"}},{default:a(()=>[u(D,{modelValue:e.formData.istoken,"onUpdate:modelValue":s[5]||(s[5]=l=>e.formData.istoken=l)},{default:a(()=>[u(m,{value:0,style:{"margin-right":"2px"}},{default:a(()=>[d("\u4E0D\u9700")]),_:1}),u(m,{value:1,style:{"margin-right":"2px"}},{default:a(()=>[d("\u9700\u8981")]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),_:1}),u(r,{span:12},{default:a(()=>[u(i,{field:"tablename",label:"\u6570\u636E\u8868\u540D",style:{"margin-bottom":"15px"}},{default:a(()=>[u(g,{modelValue:e.formData.tablename,"onUpdate:modelValue":s[6]||(s[6]=l=>e.formData.tablename=l),placeholder:"\u8BF7\u586B\u6570\u636E\u8868\u540D(\u9009\u586B)","allow-search":"",multiple:"","allow-clear":""},{label:a(({data:l})=>[E("span",null,k(l==null?void 0:l.value),1)]),default:a(()=>[(n(!0),C(T,null,O(e.tablelist,l=>(n(),f(t,{value:l.name},{default:a(()=>[d(k(l.name+" "+l.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),u(r,{span:12},{default:a(()=>[u(i,{field:"method",label:"\u8BF7\u6C42\u65B9\u5F0F",style:{"margin-bottom":"15px"}},{default:a(()=>[u(D,{modelValue:e.formData.method,"onUpdate:modelValue":s[7]||(s[7]=l=>e.formData.method=l),onChange:e.handelMethodType},{default:a(()=>[u(m,{value:"get"},{default:a(()=>[d("get")]),_:1}),u(m,{value:"post"},{default:a(()=>[d("post")]),_:1}),u(m,{value:"delete"},{default:a(()=>[d("delete")]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),u(r,{span:12},{default:a(()=>[u(i,{field:"param",label:"\u53C2\u6570",style:{"margin-bottom":"15px"}},{default:a(()=>[u(S,{modelValue:e.formData.param,"onUpdate:modelValue":s[8]||(s[8]=l=>e.formData.param=l),placeholder:"\u8BF7\u586B\u53C2\u6570(\u9009\u586B)","auto-size":{minRows:5,maxRows:6}},null,8,["modelValue"])]),_:1})]),_:1}),u(r,{span:12},{default:a(()=>[u(i,{field:"remark",label:"\u5907\u6CE8",style:{"margin-bottom":"15px"}},{default:a(()=>[u(S,{modelValue:e.formData.des,"onUpdate:modelValue":s[9]||(s[9]=l=>e.formData.des=l),placeholder:"\u8BF7\u586B\u5907\u6CE8","auto-size":{minRows:5,maxRows:6}},null,8,["modelValue"])]),_:1})]),_:1}),u(r,{span:14},{default:a(()=>[u(i,{field:"apicode_type",label:"\u63A5\u53E3\u4EE3\u7801\u7C7B\u578B",style:{"margin-bottom":"5px"}},{default:a(()=>[u(D,{modelValue:e.formData.apicode_type,"onUpdate:modelValue":s[10]||(s[10]=l=>e.formData.apicode_type=l),onChange:e.handelApicodeType},{default:a(()=>[u(m,{value:0},{default:a(()=>[d("\u624B\u5199\u4EE3\u7801")]),_:1}),u(m,{value:1},{default:a(()=>[d("\u81EA\u52A8\u751F\u6210")]),_:1}),u(m,{value:2},{default:a(()=>[d("\u901A\u7528\u6570\u636E\u63A5\u53E3")]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),e.formData.apicode_type==1||e.formData.apicode_type==2?(n(),C(T,{key:0},[e.formData.method=="get"?(n(),f(r,{key:0,span:10},{default:a(()=>[u(i,{field:"getdata_type",label:"\u83B7\u53D6\u6570\u636E\u7C7B\u578B",style:{"margin-bottom":"5px"}},{default:a(()=>[u(D,{modelValue:e.formData.getdata_type,"onUpdate:modelValue":s[11]||(s[11]=l=>e.formData.getdata_type=l),onChange:e.handelGetdataType},{default:a(()=>[u(m,{value:"list"},{default:a(()=>[d("\u6570\u636E\u5217\u8868")]),_:1}),u(m,{value:"detail"},{default:a(()=>[d("\u5355\u6761\u6570\u636E")]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})):v("",!0),e.formData.apicode_type==1?(n(),f(r,{key:1,span:12},{default:a(()=>[u(i,{label:"",style:{"margin-bottom":"15px"}},{default:a(()=>[E("div",{class:Z(["btnrow",{uphandel:e.formData.id==0}])},[u(V,{onClick:e.handleInstall,"html-type":"submit",size:"large",type:"primary",shape:"round",style:{width:"150px"}},{default:a(()=>[d(k(e.formData.is_install!=0?"\u91CD\u65B0\u751F\u6210":"\u5F00\u59CB\u751F\u6210"),1)]),_:1},8,["onClick"]),e.formData.is_install==1?(n(),f(V,{key:0,onClick:e.handleUninstall,size:"large",shape:"round",style:{width:"150px"}},{default:a(()=>[d("\u5378\u8F7D\u4EE3\u7801")]),_:1},8,["onClick"])):v("",!0),e.formData.is_install==2?(n(),f(V,{key:1,onClick:e.handleRemoveFile,size:"large",shape:"round",style:{width:"150px"}},{default:a(()=>[d("\u5220\u9664\u6587\u4EF6")]),_:1},8,["onClick"])):v("",!0),e.formData.id==0?(n(),C("div",Me,Ie)):v("",!0)],2)]),_:1})]),_:1})):v("",!0),e.formData.method=="get"?(n(),f(r,{key:2,span:12},{default:a(()=>[u(i,{field:"fields",label:"\u67E5\u8BE2\u5217\u8868\u5B57\u6BB5"},{default:a(()=>[u(g,{modelValue:e.formData.fields,"onUpdate:modelValue":s[12]||(s[12]=l=>e.formData.fields=l),onPopupVisibleChange:e.handelSelectFields,placeholder:"\u9009\u62E9\u67E5\u8BE2\u5217\u8868\u5B57\u6BB5",multiple:"","max-tag-count":12,"allow-clear":""},{default:a(()=>[(n(!0),C(T,null,O(e.fieldList,l=>(n(),f(t,{value:l.value},{default:a(()=>[d(k(l.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","onPopupVisibleChange"])]),_:1})]),_:1})):v("",!0),e.formData.apicode_type==1&&e.formData.method=="get"&&e.formData.id!=0?(n(),f(r,{key:3,span:12},{default:a(()=>[E("div",Re,[u(B,{class:"iconsd"}),d("\u5982\u679C\u6709\u4FEE\u6539\u5185\u5BB9\u8BF7\u5148\u4FDD\u5B58\u5728\u751F\u6210\u4EE3\u7801 \u5426\u5219\u53C2\u6570\u4E0D\u662F\u6700\u65B0\u7684")])]),_:1})):v("",!0),e.formData.apicode_type==2?(n(),f(r,{key:4,span:24},{default:a(()=>[E("div",Te,[u(B),d("\u201C\u901A\u7528\u6570\u636E\u63A5\u53E3\u201D\u65E0\u9700\u7F16\u5199\u4EE3\u7801 \u76F4\u63A5\u8C03\u7528\u901A\u7528api\u63A5\u53E3\u5373\u53EF\u5B8C\u6210\u589E\u5220\u67E5\u6539\uFF08\u4F20apiID\u533A\u5206\uFF09")])]),_:1})):v("",!0)],64)):v("",!0)]),_:1})]),_:1},8,["model"])]),_:1},16,["onRegister","loading","title","onOk"])}const na=Y(Ce,[["render",Le],["__scopeId","data-v-eb1299c5"]]);export{na as default};
