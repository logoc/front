import{n as ye,_ as _e}from"./index.a2bf8911.js";/* empty css                *//* empty css               *//* empty css                *//* empty css               */import{d as he,e as _,r as ve,c as be,u as Ee,t as De,aS as l,aR as j,aL as D,C as c,aE as V,aH as h,G as o,F as L,D as m,aK as M,aJ as z,E as U,aO as q,aF as w,bA as W,aI as f,aN as G,bB as x,bU as Le,aY as we,c9 as Ce,bN as Be,aW as Ae,bW as Se,b2 as Me,b3 as ke}from"./arco.b02d9b55.js";import{B as Ie,u as $e}from"./index.c4821ce7.js";import{u as Pe}from"./loading.7f7bf96d.js";import{F as He,s as J,g as Ve,u as ze,d as Ue}from"./FileLibrary.aa44c3ce.js";import{I as Oe}from"./Icon.031e5930.js";import"./chart.67655b2c.js";import"./vue.e4c26cfd.js";/* empty css                *//* empty css              *//* empty css              *//* empty css                *//* empty css               *//* empty css                *//* empty css                */import"./lodash.b99388fa.js";const Te={}.VITE_APP_ENV=="production"?window==null?void 0:window.globalConfig.Upinfile_url:window==null?void 0:window.globalConfig.Upinfile_url_dev;function Ne(s,d){return ye.uploadFile({url:`${Te}/datacenter/upfile/uploadFile`,onUploadProgress:d},s)}const Re=he({name:"FileManage",components:{BasicModal:Ie,FileLibrary:He,Icon:Oe},emits:["success"],setup(s,{emit:d}){const{loading:O,setLoading:k}=Pe(),C=_(1),I=_("use"),$=_(620),b=_(620),e=ve({activeKey:1,myFileList:[],searchword:"",typeid:0,pid:0,upLoading:!1,upaccept:"image/*",selectdata:{getnumber:"one",exdata:"",filetype:"image"},selectList:[],dirmenu:[],pagenum:1,pagetotall:0,picture:[],fileMaxSize:1,modaltitle:"\u9009\u62E9\u56FE\u7247",modaldes:"(\u53EA\u80FD\u6DFB\u52A0jpg,jpeg,bmp,png,gif, \u5927\u5C0F\u4E0D\u8D85\u8FC71MB\u3002)",tapList:[{id:1,name:"\u6211\u7684\u6587\u4EF6"},{id:2,name:"\u56FE\u7247\u5E93"}]}),B=window==null?void 0:window.globalConfig.MaxSizeVideo,A=window==null?void 0:window.globalConfig.MaxSizeImage,y=_(),[P,{setModalProps:a,closeModal:n}]=$e(async t=>{C.value=1,a({confirmLoading:!1}),e.selectList=[],e.pid=0,y.value=(t==null?void 0:t.param)||"",e.selectdata.getnumber=(t==null?void 0:t.getnumber)||"one",e.selectdata.filetype=(t==null?void 0:t.filetype)||"image",I.value=(t==null?void 0:t.openfrom)||"user",e.selectdata.exdata=t,e.selectdata.filetype=="video"?(e.fileMaxSize=B,e.modaltitle="\u9009\u62E9\u89C6\u9891",e.upaccept="video/*",e.modaldes=`(\u53EA\u80FD\u6DFB\u52A0mp4, \u5927\u5C0F\u4E0D\u8D85\u8FC7${B}MB\u3002)`):(e.fileMaxSize=A,e.modaltitle="\u9009\u62E9\u56FE\u7247",e.upaccept="image/*",e.modaldes=`(\u53EA\u80FD\u6DFB\u52A0jpg,jpeg,bmp,png,gif, \u5927\u5C0F\u4E0D\u8D85\u8FC7${A}MB\u3002)`),E("")}),Y=be(()=>Ee(e.selectdata.filetype)=="image"?"\u56FE\u7247\u7BA1\u7406":"\u89C6\u9891\u7BA1\u7406"),Q=()=>{X({title:"\u65B0\u5EFA\u6587\u4EF6\u5939",type:1,pid:e.pid})},X=async t=>{try{l.loading({content:"\u63D0\u4EA4\u4E2D...",id:"saveData",duration:0});const i=await J(t);i?(e.myFileList=i.concat(e.myFileList),l.success({content:"\u63D0\u4EA4\u6210\u529F\uFF01",id:"saveData",duration:2e3})):i==0&&l.success({content:"\u5DF2\u63D0\u4EA4\uFF01",id:"saveData",duration:2e3})}catch{l.clear()}},Z=t=>{l.loading({content:"\u4E0A\u4F20\u4E2D",id:"upStatus",duration:0});const i=new AbortController;return async function(){const{onProgress:r,onError:p,onSuccess:v,fileItem:S}=t;r(20);const ge=F=>{let g;F.total>0&&(g=F.loaded/F.total*100),r(parseInt(String(g),10),F)};try{const F=(S==null?void 0:S.name)||"",g=await Ne({name:"file",file:S.file,filename:F,data:{pid:e.pid,filetype:e.selectdata.filetype}},ge);g?g.code==0?(g.message=="\u6587\u4EF6\u5DF2\u4E0A\u4F20"&&(e.myFileList=e.myFileList.filter(Fe=>g.data.id!=Fe.id)),e.myFileList=[g.data].concat(e.myFileList),l.success({content:"\u4E0A\u4F20\u6210\u529F",id:"upStatus",duration:2e3})):(l.clear(),j.error({title:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25",titleAlign:"start",content:g.message})):l.error({content:g.message,id:"upStatus",duration:2e3})}catch(F){p(F),l.error({content:"\u4E0A\u4F20\u5931\u8D25",id:"upStatus",duration:2e3})}}(),{abort(){i.abort()}}},ee=t=>{b.value=t},K=_(),te=t=>{C.value=t,t==2&&K.value.initGetPictureCate(e.selectdata.getnumber)},se=(t,i)=>{e.picture=i,e.selectList=e.selectList.filter(u=>u.indexOf("mt_")==-1),t.forEach(u=>{e.selectList.indexOf(u)==-1&&e.selectList.push(u)})},ie=async()=>{try{if(e.selectList&&e.selectList.length>0){const t=[],i=[];e.selectList.forEach(u=>{const r=u.split("_");if(e.selectdata.filetype=="image"){if(r[0]=="my"){const p=e.myFileList.find(v=>v.id==parseInt(r[1]));p&&t.push(p.url)}else if(r[0]=="mt"){const p=e.picture.find(v=>v.id==parseInt(r[1]));p&&t.push(p.url)}}else{const p=e.myFileList.find(v=>v.id==parseInt(r[1]));p&&i.push({url:p.url,cover_url:p.cover_url})}}),e.selectdata.filetype=="image"?e.selectdata.getnumber=="one"?d("success",{param:y.value,type:e.selectdata.getnumber,url:t[0],list:[],data:e.selectdata.exdata}):d("success",{param:y.value,type:e.selectdata.getnumber,url:"",list:t,data:e.selectdata.exdata}):e.selectdata.getnumber=="one"?d("success",{param:y.value,type:e.selectdata.getnumber,...i[0],list:[],data:e.selectdata.exdata}):d("success",{param:y.value,type:e.selectdata.getnumber,url:"",cover_url:"",list:i,data:e.selectdata.exdata}),n()}else I.value=="use"?l.error(e.selectdata.filetype=="image"?"\u8BF7\u9009\u62E9\u56FE\u7247":"\u8BF7\u9009\u62E9\u89C6\u9891"):n()}catch(t){l.error(t.String())}},ae=()=>{e.searchword?E(e.searchword):E("")},E=async t=>{k(!0);const i=await Ve({searchword:t,pid:e.pid,filetype:e.selectdata.filetype});if(i)if(e.myFileList=i.items,i.dirmenu.length>0){let u=[{id:0,title:"\u9ED8\u8BA4\u6587\u4EF6\u5939",pid:0}];e.dirmenu=u.concat(i.dirmenu)}else e.dirmenu=[];k(!1)};function oe(t){if(t.type==0){var i=`my_${t.id}`;e.selectList.indexOf(i)>-1?e.selectList=e.selectList.filter(u=>u!=i):e.selectdata.getnumber=="one"?e.selectList=[i]:e.selectList.push(i)}else if(t.type==2){var i=`my_${t.id}`;e.selectList.indexOf(i)>-1?e.selectList=e.selectList.filter(r=>r!=i):e.selectdata.getnumber=="one"?e.selectList=[i]:e.selectList.push(i)}else t.type==1&&(e.pid=t.id,e.searchword="",E(""))}const le=t=>{t.preventDefault()},ne=(t,i)=>{const u=t.dataTransfer.getData("imgid");ce(u,i)},ue=()=>{},re=(t,i)=>{t.dataTransfer.setData("imgid",i)},ce=async(t,i)=>{l.loading({content:"\u79FB\u52A8\u4E2D...",id:"upImgPid",duration:0});const u=await ze({imgid:t,pid:i});u?(e.myFileList=e.myFileList.filter(r=>t!=r.id),l.success({content:"\u79FB\u52A8\u6210\u529F\uFF01",id:"upImgPid",duration:2e3})):u==0?l.clear():l.error({content:"\u79FB\u52A8\u5931\u8D25",id:"upImgPid",duration:2e3})},de=t=>{e.pid!=t.id&&(e.pid=t.id,e.searchword="",E(""))},pe=(t,i)=>{t.stopPropagation(),j.warning({title:"\u60A8\u786E\u5B9A\u5220\u9664\u5417\uFF1F",content:"\u5220\u9664\u540E\u5185\u5BB9\u5C06\u65E0\u6CD5\u6062\u590D\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",cancelText:"\u53D6\u6D88",okText:"\u5220\u9664",titleAlign:"start",hideCancel:!1,onOk:async()=>{l.loading({content:"\u5220\u9664\u4E2D",id:"delFile",duration:0}),await Ue({ids:[i]})?(e.myFileList=e.myFileList.filter(r=>i!=r.id),l.success({content:"\u5220\u9664\u6210\u529F",id:"delFile",duration:2})):l.error({content:"\u5220\u9664\u5931\u8D25",id:"delFile",duration:2})}})},H=_(!1),me=()=>{H.value=!0},fe=async(t,i)=>{const u=i.target._value;if(H.value){H.value=!1,l.loading({content:"\u66F4\u65B0\u4E2D...",id:"upFile",duration:0});const r=await J({id:t,title:u});r?l.success({content:"\u66F4\u65B0\u6210\u529F\uFF01",id:"upFile",duration:2e3}):r==0?l.clear():l.error({content:"\u66F4\u65B0\u5931\u8D25",id:"upFile",duration:2e3})}};return{...De(e),registerModal:P,getTitle:Y,handleSubmit:ie,loading:O,tapList:[{id:1,name:"\u6211\u7684\u6587\u4EF6"},{id:2,name:"\u56FE\u7247\u5E93"}],activeKey:C,selectLibrary:se,customRequest:Z,modelHeight:$,onHeightChange:ee,windHeight:b,selectTab:te,fileLibraryRef:K,onAddFolder:Q,onSearchMyfile:ae,allowDrop:le,drop:ne,dragleaves:ue,drag:re,onSelectImg:oe,onDel:pe,onChangFile:me,onUpFile:fe,onDirmun:de}}});const Ke=s=>(Me("data-v-16dcf3d4"),s=s(),ke(),s),je={class:"tabs-header"},qe={class:"tabs-nav-wrap"},We=["onClick"],Ge={class:"label"},xe={class:"tabs-content"},Je={class:"content_box"},Ye={class:"header_toopl"},Qe={class:"btnlist"},Xe={class:"search"},Ze={key:0,class:"dirmun"},et=["onClick"],tt={class:"dirmun_inner"},st=Ke(()=>o("span",{class:"dirmun_separator"},">",-1)),it={class:"file_list",style:{"{height":"`${windHeight-(dirmenu.length>0?80:55)}px`}"}},at={class:"file_list_box"},ot={class:"file_item"},lt=["onClick"],nt={key:0,class:"img_raw"},ut={class:"img_preview"},rt=["src"],ct={key:1,class:"img_raw"},dt={class:"img_preview videobox"},pt=["src"],mt=["onDrop"],ft=["draggable","onDragstart"],gt={class:"titlebox"},Ft={class:"edit_title"};function yt(s,d,O,k,C,I){const $=D("icon-upload"),b=we,T=Ce,N=D("icon-folder-add"),R=Be,e=D("Icon"),B=Ae,A=Se,y=D("FileLibrary"),P=D("BasicModal");return c(),V(P,Le(s.$attrs,{onRegister:s.registerModal,isPadding:!1,loading:s.loading,width:"1000px",onHeightChange:s.onHeightChange,minHeight:s.modelHeight,title:s.getTitle,onOk:s.handleSubmit}),{default:h(()=>[o("div",{class:"addFormbox",style:L({"min-height":`${s.windHeight}px`})},[o("div",je,[o("div",qe,[(c(!0),m(M,null,z(s.tapList,a=>(c(),m(M,null,[a.id==1||a.id==2&&s.selectdata.filetype=="image"?(c(),m("div",{key:0,class:U(["tap_item",{item_active:s.activeKey==a.id}]),onClick:n=>s.selectTab(a.id)},[o("div",Ge,q(a.name),1)],10,We)):w("",!0)],64))),256))]),o("div",{class:"tabs-bar",style:L({top:`${(s.activeKey-1)*64}px`,height:"64px"})},null,4)]),o("div",xe,[o("div",Je,[W(o("div",{class:"myfile",style:L({height:`${s.windHeight}px`})},[o("div",Ye,[o("div",Qe,[f(T,{accept:s.upaccept,"show-file-list":!1,multiple:!0,"custom-request":s.customRequest},{"upload-button":h(()=>[f(b,null,{icon:h(()=>[f($)]),default:h(()=>[G("\u76F4\u63A5\u4E0A\u4F20 ")]),_:1})]),_:1},8,["accept","custom-request"]),f(b,{onClick:s.onAddFolder,style:{"margin-left":"10px"}},{icon:h(()=>[f(N)]),default:h(()=>[G(" \u65B0\u589E\u6587\u4EF6\u5939 ")]),_:1},8,["onClick"])]),o("div",Xe,[f(R,{modelValue:s.searchword,"onUpdate:modelValue":d[0]||(d[0]=a=>s.searchword=a),style:{width:"300px"},onPressEnter:s.onSearchMyfile,"allow-clear":"",onSearch:s.onSearchMyfile,placeholder:"\u641C\u7D22\u6587\u4EF6\u540D\u79F0"},null,8,["modelValue","onPressEnter","onSearch"])])]),s.dirmenu&&s.dirmenu.length>0?(c(),m("div",Ze,[(c(!0),m(M,null,z(s.dirmenu,a=>(c(),m("span",{class:"dirmun_item",onClick:n=>s.onDirmun(a)},[o("span",tt,q(a.title),1),st],8,et))),256))])):w("",!0),o("div",it,[f(A,{style:L([{overflow:"auto"},{height:`${s.windHeight-(s.dirmenu.length>0?80:55)}px`}])},{default:h(()=>[o("div",at,[(c(!0),m(M,null,z(s.myFileList,a=>(c(),m("div",ot,[o("div",null,[o("div",{class:U({imgbox:a.type==0||a.type==2,folderbox:a.type==1}),onClick:n=>s.onSelectImg(a)},[a.type==0?(c(),m("div",nt,[o("div",ut,[o("img",{src:a.url,class:"img_item"},null,8,rt)])])):a.type==2?(c(),m("div",ct,[o("div",dt,[o("img",{src:a.cover_url,class:"img_item"},null,8,pt),f(e,{class:"folder_video",color:"#ffffff",animation:200,icon:"ic:twotone-slow-motion-video",size:24})])])):a.type==1?(c(),m("div",{key:2,class:"folder_raw",onDragover:d[1]||(d[1]=n=>s.allowDrop(n)),onDrop:n=>s.drop(n,a.id),onDragleave:d[2]||(d[2]=n=>s.dragleaves())},[f(e,{icon:"svgfont-wenjianjia-1",class:"folder_preview",forceFallback:!0,size:82,color:"#ed6f6f"})],40,mt)):w("",!0),o("div",{class:U(["edit_layer",{l_active:s.selectList.indexOf(`my_${a.id}`)>-1}]),draggable:a.type==0||a.type==2,onDragstart:n=>s.drag(n,a.id)},[a.is_common!=1?(c(),V(e,{key:0,icon:"svgfont-guanbi",class:"colse",size:18,onClick:n=>s.onDel(n,a.id),color:"red"},null,8,["onClick"])):w("",!0),a.type==0?(c(),V(e,{key:1,icon:"svgfont-mark_sel",class:"choose",size:18})):w("",!0)],42,ft)],10,lt),o("div",gt,[o("div",Ft,[f(B,{modelValue:a.title,"onUpdate:modelValue":n=>a.title=n,placeholder:"\u8F93\u5165\u540D\u79F0",readonly:a.is_common==1,style:{padding:"0"},onChange:s.onChangFile,onPressEnter:n=>{s.onUpFile(a.id,n)},onBlur:n=>{s.onUpFile(a.id,n)},bordered:!1},null,8,["modelValue","onUpdate:modelValue","readonly","onChange","onPressEnter","onBlur"])])])])]))),256))])]),_:1},8,["style"])])],4),[[x,s.activeKey==1]]),W(o("div",{class:"hcontent",style:L({height:`${s.windHeight}px`})},[f(y,{ref:"fileLibraryRef",onOk:s.selectLibrary},null,8,["onOk"])],4),[[x,s.activeKey==2]])])])],4)]),_:1},16,["onRegister","loading","onHeightChange","minHeight","title","onOk"])}const Ut=_e(Re,[["render",yt],["__scopeId","data-v-16dcf3d4"]]);export{Ut as default};
