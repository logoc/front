import{n as v,p as O,_ as j}from"./index.a2bf8911.js";/* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css                *//* empty css               *//* empty css              *//* empty css                *//* empty css              *//* empty css               *//* empty css                */import{d as K,e as l,c as W,u as R,aS as f,aL as k,C as _,aE as U,aH as o,G as n,F as $,aI as t,bA as z,D,aK as q,aJ as G,aN as Y,aO as J,aF as Q,bB as X,bU as Z,bR as x,b7 as ee,b_ as te,bL as oe,bM as ae,c9 as se,aW as ue,c4 as ne,bW as re,bc as le,b2 as ie,b3 as de}from"./arco.b02d9b55.js";import{B as ce,u as pe}from"./index.c4821ce7.js";import{u as me}from"./loading.7f7bf96d.js";import{l as fe}from"./lodash.b99388fa.js";import{g as _e}from"./picturecate.1f8d9eeb.js";function xe(e){return e.createdTime&&(e.createdTime=fe.exports.join(e.createdTime)),v.get({url:"/matter/picture/get_list2",params:e},{errorMessageMode:"none"})}function ge(e){return v.post({url:"/matter/picture/save",params:e},{errorMessageMode:"message"})}function et(e){return v.post({url:"/matter/picture/upStatus",params:e},{errorMessageMode:"message"})}function tt(e){return v.delete({url:"/matter/picture/del",params:e},{errorMessageMode:"message"})}const he={}.VITE_APP_ENV=="production"?window==null?void 0:window.globalConfig.Root_url:window==null?void 0:window.globalConfig.Root_url_dev;function be(e,u){return v.uploadFile({url:`${he}/matter/picture/uploadFile`,onUploadProgress:u},e)}const ve=K({name:"AddBook",components:{BasicModal:ce},emits:["success"],setup(e,{emit:u}){const L=l(!0),F=l(!1),E=l([]),B=l(1),S=l(450),p=l(450),i=l(),y={id:0,type:0,cid:0,url:"",title:""},r=l(y),C=l(),[M,{setModalProps:A,closeModal:V}]=pe(async s=>{var b;(b=i.value)==null||b.resetFields(),B.value=1,A({confirmLoading:!1});const m=await _e({}),h=[{id:0,name:"\u672A\u9009\u5206\u7C7B",type:2}];m?E.value=h.concat(m):E.value=h,F.value=!!(s!=null&&s.isUpdate),R(F)?r.value=O(s.record):r.value=y}),H=W(()=>R(F)?"\u7F16\u8F91\u6570\u636E":"\u65B0\u589E\u6570\u636E"),{loading:I,setLoading:g}=me();return{registerModal:M,getTitle:H,handleSubmit:async()=>{var s;try{if(!await((s=i.value)==null?void 0:s.validate())){g(!0),f.loading({content:"\u63D0\u4EA4\u4E2D",id:"upStatus",duration:2e3});let h=O(R(r));await ge(h),f.success({content:"\u63D0\u4EA4\u6210\u529F",id:"upStatus",duration:2e3}),V(),u("success"),g(!1)}}catch{g(!1),f.clear("top")}},formRef:i,loading:I,formData:r,cateList:E,OYoptions:[{label:"\u7D20\u6750\u56FE",value:0},{label:"\u63D2\u56FE",value:1}],activeKey:B,customRequest:s=>{f.loading({content:"\u4E0A\u4F20\u4E2D",id:"upStatus",duration:0});const m=new AbortController;return async function(){const{onProgress:b,onError:T,onSuccess:Le,fileItem:w}=s;b(20);const N=d=>{let c;d.total>0&&(c=d.loaded/d.total*100),b(parseInt(String(c),10),d)};try{const d=(w==null?void 0:w.name)||"",c=await be({name:"file",file:w.file,filename:d,data:{cid:0}},N);console.log("\u66F4\u65B0\u56FE\u7247:",c),c.code==0&&(r.value.url=c.data.url,r.value.id=c.data.id,r.value.title=c.data.title),f.success({content:"\u4E0A\u4F20\u6210\u529F",id:"upStatus",duration:1500})}catch(d){T(d),f.error({content:"\u4E0A\u4F20\u5931\u8D25",id:"upStatus",duration:2e3})}}(),{abort(){m.abort()}}},modelHeight:S,editorRef:C,onHeightChange:s=>{p.value=s},windHeight:p,isEditor:L}}});const Fe=e=>(ie("data-v-d2245ae6"),e=e(),de(),e),Ee={class:"tabs-content addpadding"},ye={class:"content_box"},we={class:"besecontent"},De={class:"upimagebox"},Be={class:"imagebtn"},Se={key:0,class:"upload-show-picture"},Ce=["src"],Me={class:"upload-show-picture-mask"},Ae={key:1,class:"upload-picture-card"},Ve={class:"upload-picture-card-text"},He=Fe(()=>n("div",{style:{"margin-top":"10px","font-weight":"600"}},"\u4E0A\u4F20\u56FE\u7247",-1));function Ie(e,u,L,F,E,B){const S=x,p=ee,i=te,y=oe,r=ae,C=k("IconEdit"),M=k("IconPlus"),A=se,V=ue,H=ne,I=re,g=le,P=k("BasicModal");return _(),U(P,Z(e.$attrs,{onRegister:e.registerModal,isPadding:!1,loading:e.loading,width:"800px",onHeightChange:e.onHeightChange,minHeight:e.modelHeight,title:e.getTitle,onOk:e.handleSubmit}),{default:o(()=>[n("div",{class:"addFormbox",style:$({"min-height":`${e.windHeight}px`})},[n("div",Ee,[t(g,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:o(()=>[n("div",ye,[z(t(I,{style:$([{overflow:"auto"},{height:`${e.windHeight}px`}])},{default:o(()=>[n("div",we,[t(H,{gutter:16},{default:o(()=>[t(i,{span:12},{default:o(()=>[t(p,{field:"cid",label:"\u56FE\u7247\u7C7B\u578B","validate-trigger":"input"},{default:o(()=>[t(S,{modelValue:e.formData.type,"onUpdate:modelValue":u[0]||(u[0]=a=>e.formData.type=a),options:e.OYoptions},null,8,["modelValue","options"])]),_:1})]),_:1}),t(i,{span:16},{default:o(()=>[t(p,{field:"cid",label:"\u9009\u62E9\u5206\u7C7B",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u5206\u7C7B"}]},{default:o(()=>[t(r,{modelValue:e.formData.cid,"onUpdate:modelValue":u[1]||(u[1]=a=>e.formData.cid=a),placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B","allow-search":""},{default:o(()=>[(_(!0),D(q,null,G(e.cateList,a=>(_(),D(q,null,[a.type==e.formData.type||a.type==2?(_(),U(y,{key:0,value:a.id},{default:o(()=>[Y(J(a.name),1)]),_:2},1032,["value"])):Q("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(i,{span:24},{default:o(()=>[t(p,{field:"image",label:"\u56FE\u7247",style:{"margin-bottom":"15px"}},{default:o(()=>[t(A,{accept:"image/*","show-file-list":!1,"custom-request":e.customRequest},{"upload-button":o(()=>[n("div",De,[n("div",Be,[e.formData.url?(_(),D("div",Se,[n("img",{src:e.formData.url},null,8,Ce),n("div",Me,[t(C)])])):(_(),D("div",Ae,[n("div",Ve,[t(M),He])]))])])]),_:1},8,["custom-request"])]),_:1})]),_:1}),t(i,{span:16},{default:o(()=>[t(p,{field:"title",label:"\u56FE\u7247\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u56FE\u7247\u540D\u79F0"}]},{default:o(()=>[t(V,{modelValue:e.formData.title,"onUpdate:modelValue":u[2]||(u[2]=a=>e.formData.title=a),placeholder:"\u8BF7\u586B\u56FE\u7247\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["style"]),[[X,e.activeKey==1]])])]),_:1},8,["model"])])],4)]),_:1},16,["onRegister","loading","onHeightChange","minHeight","title","onOk"])}const Re=j(ve,[["render",Ie],["__scopeId","data-v-d2245ae6"]]),ot=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));export{Re as A,ot as a,tt as d,xe as g,et as u};
